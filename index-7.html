<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A common place.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Cloistered Monkey (old posts, page 7) | The Cloistered Monkey</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/index-7.html">
<link rel="prev" href="." type="text/html">
<link rel="next" href="index-6.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/">

                <span id="blog-title">The Cloistered Monkey</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="machine-learning-projects/">Machine Learning</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/p5_explorations/">P5 Explorations</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/tddmachinelearning/">TDD Machine Learning</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/data_science/">Data Science With Python</a>
            </li>
</ul>
</li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/org-babel-noweb-ref/" class="u-url">Inserting Text Between Methods in Org-Mode</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/org-babel-noweb-ref/" rel="bookmark"><time class="published dt-published" datetime="2017-02-19T11:06:06-08:00" title="2017-02-19 11:06">2017-02-19 11:06</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This is an attempt to get org-mode to insert text between methods in a class definition using the noweb-ref property. I think you can also do it by just tangling everything to the same file, but I like the noweb notation better.
</p>

<div id="outline-container-orgfed635f" class="outline-2">
<h2 id="orgfed635f">The Tangle</h2>
<div class="outline-text-2" id="text-orgfed635f">
<p>
To keep it simple I'm just going to include a section for the class definition and a <code>main</code> section to check out the results. Note that to be able to break up the class definition I had to turn off org-mode's clean-up so all the python blocks have to be indented exactly the way they will be in the final python file.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">first</span><span class="o">-</span><span class="n">class</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">main</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgae2c802" class="outline-2">
<h2 id="orgae2c802">The First Class</h2>
<div class="outline-text-2" id="text-orgae2c802">
<p>
This first class won't do much, but if I understand the documentation I should be able to insert text between the parts of it and still have it work when the python gets tangled out. The org-mode source block starts like this - <code>#+BEGIN_SRC python :noweb-ref first-class</code>.
</p>
</div>

<div id="outline-container-orge7a8e60" class="outline-3">
<h3 id="orge7a8e60">The Constructor</h3>
<div class="outline-text-3" id="text-orge7a8e60">
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>   <span class="k">class</span> <span class="nc">FirstClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
       <span class="sd">"""a class that is first</span>
<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>

<span class="sd">       name: string</span>
<span class="sd">	 some kind of identifier</span>
<span class="sd">       """</span>
       <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
	   <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
	   <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge604d5b" class="outline-3">
<h3 id="orge604d5b">The Call</h3>
<div class="outline-text-3" id="text-orge604d5b">
<p>
The call emits the name. To concatenate this method to the previous block I'm using the same org-mode source-block header as I did with the constructor (<code>#+BEGIN_SRC python :noweb-ref first-class</code>). You could use a different name and insert another reference in the tangle but this seems more logical to me. One problem here is that python-mode (or some other mode) will interpret the methods as stand-alone functions and move them flush left. To fix this I had to turn off the automatic indentation using <code>(setq org-src-preserve-indentation t)</code>. This means that you have to keep track of the indentation yourself, regardless of where the code sits in the org-mode document (so as you create sub-sections it will look uglier and uglier in the original document, at least to me). Putting the method in a separate block also requires that you to insert an empty line before the method to  keep it from being stuck to the bottom of the previous one, but it doesn't include it when it gets exported to HTML, so you can't see it in this post. In fact, I noticed afterwards that the HTML export also stripped out the indentation on the left so you can't really see what I'm talking about.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>   <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="sd">"""prints the name"""</span>
       <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
       <span class="k">return</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org5bf5b7f" class="outline-2">
<h2 id="org5bf5b7f">The Main</h2>
<div class="outline-text-2" id="text-org5bf5b7f">
<p>
This part constructs the <code>FirstClass</code> object and calls it.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
      <span class="n">thing</span> <span class="o">=</span> <span class="n">FirstClass</span><span class="p">(</span><span class="s2">"Bob"</span><span class="p">)</span>
      <span class="n">thing</span><span class="p">()</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd6f412c" class="outline-2">
<h2 id="orgd6f412c">Trying it out</h2>
<div class="outline-text-2" id="text-orgd6f412c">
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  python noweb_ref.py
</pre></div>

<pre class="example">
Bob

</pre>
</div>
</div>

<div id="outline-container-org050ec29" class="outline-2">
<h2 id="org050ec29">Summary</h2>
<div class="outline-text-2" id="text-org050ec29">
<p>
The point of trying this out is that I want to be able to break up and document class-methods better. Unfortunately it requires you to do a little more fiddling with the white-space yourself and makes the source org-mode file a little harder to read (I think) but I'm going to try it for a little while and see if the resulting documents are worth the extra headache. Maybe I'll just have to stick with docstrings for documenting the separate methods…
</p>

<p>
This bit at the end makes it so the indentation is always preserved, even if the <code>init.el</code> file isn't set up that way.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  <span class="c1"># Local Variables:</span>
  <span class="c1"># org-src-preserve-indentation: t</span>
  <span class="c1"># End:</span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/org-babel-stderr-results/" class="u-url">Org-Babel Stderr Results</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/org-babel-stderr-results/" rel="bookmark"><time class="published dt-published" datetime="2017-01-11T22:53:13-08:00" title="2017-01-11 22:53">2017-01-11 22:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
If you execute a code-block in org-mode the default behavior when the executed code sends output to <code>stderr</code> is to open a pop-up buffer rather than including it in the org-babel file. Sometimes, though, you might want to document actual output from <code>stderr</code> but, as it turns out, this is how <i>org-mode</i> is designed so you are mostly stuck with it. There is a simple work-around though, just put an entry in the source-block that outputs to <code>stdout</code> at the end of the block and everyhing will show up in the results.
</p>

<p>
This is how you could include the output when there are failing tests run by <a href="http://docs.pytest.org/en/latest/">py.test</a>:
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+BEGIN_SRC sh :results verbatim
  py.test tests/
  echo
#+END_SRC
</pre></div>

<p>
This will run all the tests in the <code>tests</code> folder and include the output in the <i>org-mode</i> file even if there are failures, thanks to the <code>echo</code> at the end.
</p>

<p>
I got this from <a href="https://stackoverflow.com/questions/27304469/capturing-the-output-of-diff-with-org-babel">Stack Overflow</a>, of course.
</p>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/install-chrome-extensions-in-vivaldi/" class="u-url">Install Chrome Extensions in Vivaldi</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/install-chrome-extensions-in-vivaldi/" rel="bookmark"><time class="published dt-published" datetime="2017-01-11T22:00:14-08:00" title="2017-01-11 22:00">2017-01-11 22:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
This was taken from the <a href="http://forum.vivaldi.net/topic/1896/how-to-install-lastpass-for-vivaldi">vivaldi forums</a>. It explains how to install the <i>LastPass</i> extension into the <a href="https://vivaldi.com">vivaldi browser</a> and should work for other plugins as well (although I haven't tried yet).
</p>

<div id="outline-container-orgbbc8f44" class="outline-2">
<h2 id="orgbbc8f44">The Procedure</h2>
<div class="outline-text-2" id="text-orgbbc8f44">
<ol class="org-ol">
<li>Install the <a href="https://github.com/Rob--W/crxviewer">Chrome extension source viewer (CRX Viewer)</a> in Chrome</li>
<li>Go to the Chrome Web Store and search for the <i>LastPass</i> extension</li>
<li>Right click on the <i>LastPass</i> search result to bring up the context menu</li>
<li>In the context menu selecte <i>View extension source</i>
</li>
<li>In the page that opens, click on the <i>Download</i> link in the upper corner</li>
<li>Go to the <i>Downloads</i> folder and make a new folder (e.g. <code>mkdir lastpass</code>)</li>
<li>Move the zip-file that you downloaded into the folder (mine was called <code>hdokiejnpimakedhajhdlcegeplioahd.zip</code> so I assume the names are random)</li>
<li>Unzip the download</li>
<li>Re-name <code>_metadata</code> to <code>metadata</code> (the post suggests deleting it, so that might work too)</li>
<li>In <i>Vivaldi</i>, open the link <i>vivaldi://chrome/extensions</i>
</li>
<li>Click the <i>Developer mode</i> checkbox</li>
<li>Click on <i>Load unpacked extension</i>
</li>
<li>Select the folder you unpacked the zip file into (<code>lastpass</code> in this case)</li>
<li>Configure Last Pass</li>
</ol>
</div>
</div>
<div id="outline-container-org93190df" class="outline-2">
<h2 id="org93190df">Conclusion</h2>
<div class="outline-text-2" id="text-org93190df">
<p>
This gives the procedure for installing extensions like <i>LastPass</i> into the <i>Vivaldi</i> browser. In the course of writing this up I found out that you don't need to do this for all the extensions (just the ones with leading underscores in some of their folder names, I think). For other extensions just install them from the store - they seem to work out of the box.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/org-babel-pdf-export/" class="u-url">Org-Babel PDF Export</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/org-babel-pdf-export/" rel="bookmark"><time class="published dt-published" datetime="2017-01-07T12:29:47-08:00" title="2017-01-07 12:29">2017-01-07 12:29</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>
These are my notes on exporting a PDF from an <i>org-babel</i> file.
</p>

<div id="outline-container-org71d24b2" class="outline-2">
<h2 id="org71d24b2">First Try</h2>
<div class="outline-text-2" id="text-org71d24b2">
<p>
The key sequence to export a PDF from an <i>org</i> file is <code>C-c C-e l p</code> (<i>c</i> as in… <i>c</i>, <i>e</i> as in <i>export</i>, <i>l</i> as in <i>LaTex</i>, and <i>p</i> as in <i>PDF</i>). My first try produced this error:
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>! LaTeX Error: File <span class="sb">`</span>ulem.sty<span class="sb">`</span> not found.
</pre></div>

<blockquote>
<p>
The actual output had <code>`ulem.sty`</code> ending with an apostrophe (which I can't show here because org either renders the apostrophe as an accent or if I put it in an inline verbatim block it disables the verbatim markup - seems like a bug) but either <i>nikola</i> or <i>org</i> or something else marked the single apostrophe as an error with a red box around it in the output so I changed it to a backtick (<code>`</code>) to get rid of the box.
</p>
</blockquote>

<p>
Past experience told me that the error indicated I was likely missing a (debian) package.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>apt-cache search ulem
</pre></div>

<pre class="example">
texlive-generic-recommended - TeX Live: Generic recommended packages
libextutils-modulemaker-perl - Perl extension to build module from scratch

</pre>

<p>
Since I'm doing something with <i>LaTex</i>, not <i>perl</i> I decided that installing the <i>texlive-generic-recommended</i> package was probably what I should do.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>sudo apt-get install texlive-generic-recommended
</pre></div>
</div>
</div>

<div id="outline-container-orgec10ed6" class="outline-2">
<h2 id="orgec10ed6">Second try</h2>
<div class="outline-text-2" id="text-orgec10ed6">
<p>
I hit <code>C-c C-e l p</code> again and this time it did output a PDF, but there was no syntax-highlighting of the code. Followng <a href="https://joat-programmer.blogspot.com/2013/07/org-mode-version-8-and-pdf-export-with.html">this blog post</a> I added this to my <code>init.el</code> file:
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="c1">;; export to latex/pdf</span>
<span class="p">(</span><span class="nf">require</span> <span class="ss">'ox-latex</span><span class="p">)</span>

<span class="c1">;; syntax-highlighting for pdf's</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">'org-latex-packages-alist</span> <span class="o">'</span><span class="p">(</span><span class="s">""</span> <span class="s">"minted"</span><span class="p">))</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">org-latex-listings</span> <span class="ss">'minted</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">org-latex-pdf-process</span> <span class="o">'</span><span class="p">(</span><span class="s">"pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"</span><span class="p">))</span>
</pre></div>

<p>
Once I re-loaded the <code>init.el</code> file, the PDF's came out with the syntax highlighting working.
</p>

<blockquote>
<p>
The original post used <code>xelatex</code> instead of <code>pdflatex</code> but I don't use <code>xelatex</code>. Also <code>minted</code> can be found in the <code>texlive-latex-extras</code> package if it isn't already installed. The post also mentions needing <code>pygments</code> but I didn't need it, possibly because it's a dependency for other python libraries that I've already installed.
</p>
</blockquote>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/org-babel-cheat-sheet/" class="u-url">Org-Babel Cheat Sheet</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/org-babel-cheat-sheet/" rel="bookmark"><time class="published dt-published" datetime="2016-12-29T12:30:23-08:00" title="2016-12-29 12:30">2016-12-29 12:30</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgc6adc49" class="outline-2">
<h2 id="orgc6adc49">Keyboard Shortcuts</h2>
<div class="outline-text-2" id="text-orgc6adc49">
</div>
<div id="outline-container-org98e6cf2" class="outline-3">
<h3 id="org98e6cf2">Code Block Shortcuts</h3>
<div class="outline-text-3" id="text-org98e6cf2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Keys</th>
<th scope="col" class="org-left">Command</th>
<th scope="col" class="org-left">Effect</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><code>C-c C-c</code></td>
<td class="org-left"><code>org-babel-execute-src-block</code></td>
<td class="org-left">Execute the code in the current block.</td>
</tr>
<tr>
<td class="org-left">
<code>C-c</code> '</td>
<td class="org-left"> </td>
<td class="org-left">Open/close edit-buffer with mode set to match the code-block language.</td>
</tr>
<tr>
<td class="org-left"><code>C-c C-v C-z</code></td>
<td class="org-left"><code>org-babel-switch-to-session</code></td>
<td class="org-left">Open a python/ipython console (only works with <code>:session</code>)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgb405c65" class="outline-3">
<h3 id="orgb405c65">Buffer-wide Shortcuts</h3>
<div class="outline-text-3" id="text-orgb405c65">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Keys</th>
<th scope="col" class="org-left">Command</th>
<th scope="col" class="org-left">Effect</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">
<code>&lt;s</code> Tab</td>
<td class="org-left"> </td>
<td class="org-left">Create a code block.</td>
</tr>
<tr>
<td class="org-left"><code>C-c C-v C-b</code></td>
<td class="org-left"><code>org-babel-execute-buffer</code></td>
<td class="org-left">Execute all code blocks in buffer.</td>
</tr>
<tr>
<td class="org-left"><code>C-c C-v C-f</code></td>
<td class="org-left"><code>org-babel-tangle-file</code></td>
<td class="org-left">Tangle all blocks marked to <code>:tangle</code>
</td>
</tr>
<tr>
<td class="org-left"><code>C-c C-v C-t</code></td>
<td class="org-left"><code>org-babel-tangle</code></td>
<td class="org-left">Seems like an alias for tangle file…</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgffef689" class="outline-2">
<h2 id="orgffef689">Code Block Headers</h2>
<div class="outline-text-2" id="text-orgffef689">
<p>
This is the subset of headers/header values that I'm interested in right now.
</p>
</div>
<div id="outline-container-org850d8ff" class="outline-3">
<h3 id="org850d8ff">Code to tangle</h3>
<div class="outline-text-3" id="text-org850d8ff">
<p>
The pattern I use to tangle (create an external code file) is:
</p>
<ul class="org-ul">
<li>
<code>python</code> as the language (since I'm not using it with an interactive session, no need for ipython)</li>
<li>
<code>:noweb tangle</code> is turned on from <code>init.el</code> so that I can substitute code defined elsewhere into the block</li>
<li><code>:tangle &lt;path to file&gt;</code></li>
</ul>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  #+begin_src python :tangle literate_python/literate.py
    """A docstring for the literate.py module"""

    # imports
    import sys
    &lt;&lt;literate-main-imports&gt;&gt;

    # constants

    # exception classes

    # interface functions

    # classes


    &lt;&lt;LiterateClass-definition&gt;&gt;

    # internal functions &amp; classes

    &lt;&lt;literate-main&gt;&gt;


    if __name__ == "__main__":
	status = main()
	sys.exit(status)
  #+end_src
</pre></div>

<p>
Since I have <code>:noweb tangle</code> set, the substitions (e.g. <code>&lt;&lt;literate-main-imports&gt;&gt;</code>) don't get expanded in HTML/Latex output (although they do when you create the python file). 
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  <span class="sd">"""A docstring for the literate.py module"""</span>

  <span class="c1"># imports</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="o">&lt;&lt;</span><span class="n">literate</span><span class="o">-</span><span class="n">main</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>
</pre></div>

<p>
If you want to show the substitutions when exporting use <code>:noweb yes</code> in the header.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  <span class="sd">"""A docstring for the literate.py module"""</span>

  <span class="c1"># imports</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</pre></div>
</div>
</div>

<div id="outline-container-org78955b6" class="outline-3">
<h3 id="org78955b6">A named section</h3>
<div class="outline-text-3" id="text-org78955b6">
<p>
The <code>noweb</code> substitution above (<code>&lt;&lt;literate-main-imports&gt;&gt;</code>) worked because there was a named-section (defined here) that it could use:
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  #+name: literate-main-imports
  #+begin_src python
    from argparse import ArgumentParser
  #+end_src
</pre></div>
</div>
</div>

<div id="outline-container-orgd795858" class="outline-3">
<h3 id="orgd795858">Results</h3>
<div class="outline-text-3" id="text-orgd795858">
<p>
The <code>:results</code> header argument declares how to handle what's returned from executing a code block. There are three classes of arguments and you can use up to one of each in the header.
</p>
</div>
<div id="outline-container-orga6d0f97" class="outline-4">
<h4 id="orga6d0f97">Result Classes</h4>
<div class="outline-text-4" id="text-orga6d0f97">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Class</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">collection</td>
<td class="org-left">How the results should be collected if there's multiple outputs.</td>
</tr>
<tr>
<td class="org-left">type</td>
<td class="org-left">Declare what type of result the code block will return.</td>
</tr>
<tr>
<td class="org-left">handling</td>
<td class="org-left">How should results be handled.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgc6b964f" class="outline-4">
<h4 id="orgc6b964f">Collection Class</h4>
<div class="outline-text-4" id="text-orgc6b964f">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">value</td>
<td class="org-left">(Default) Uses the value of the last statement in the block (python requires a return statement)</td>
</tr>
<tr>
<td class="org-left">output</td>
<td class="org-left">(<code>:results output</code>) Collects everything sent to stdout in the block.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org6c78801" class="outline-4">
<h4 id="org6c78801">Type Class</h4>
<div class="outline-text-4" id="text-org6c78801">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Example</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">table</td>
<td class="org-left"><code>:results value table</code></td>
<td class="org-left">Return an org-mode table (vector)</td>
</tr>
<tr>
<td class="org-left">scalar</td>
<td class="org-left"><code>:results value scalar</code></td>
<td class="org-left">Return exactly the value returned (string)</td>
</tr>
<tr>
<td class="org-left">file</td>
<td class="org-left"><code>:results value file</code></td>
<td class="org-left">Return an org-mode link to a file</td>
</tr>
<tr>
<td class="org-left">raw</td>
<td class="org-left"><code>:results value raw</code></td>
<td class="org-left">Return as org-mode command</td>
</tr>
<tr>
<td class="org-left">html</td>
<td class="org-left"><code>:results value html</code></td>
<td class="org-left">Expect contents for <code>#+begin_html</code>
</td>
</tr>
<tr>
<td class="org-left">latex</td>
<td class="org-left"><code>:results value latex</code></td>
<td class="org-left">Expect contents for <code>#+begin_latex</code>
</td>
</tr>
<tr>
<td class="org-left">code</td>
<td class="org-left"><code>:results value code</code></td>
<td class="org-left">Expect contents for <code>#+begin_src</code>
</td>
</tr>
<tr>
<td class="org-left">pp</td>
<td class="org-left"><code>:results value pp</code></td>
<td class="org-left">Expect code and pretty-print it</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-orgdc4eb49" class="outline-4">
<h4 id="orgdc4eb49">Handling Class</h4>
<div class="outline-text-4" id="text-orgdc4eb49">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Example</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">silent</td>
<td class="org-left"><code>:results output silent</code></td>
<td class="org-left">Don't output in org-mode buffer</td>
</tr>
<tr>
<td class="org-left">replace</td>
<td class="org-left"><code>:results output replace</code></td>
<td class="org-left">(Default) Overwrite any previous result</td>
</tr>
<tr>
<td class="org-left">append</td>
<td class="org-left"><code>:results output append</code></td>
<td class="org-left">Append output after any previous output</td>
</tr>
<tr>
<td class="org-left">prepend</td>
<td class="org-left"><code>:results output prepend</code></td>
<td class="org-left">Put output above any previous output</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org5df827e" class="outline-3">
<h3 id="org5df827e">Exports</h3>
<div class="outline-text-3" id="text-org5df827e">
<p>
This argument tells org-babel what to put in any exported HTML or Latex files.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Example</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">code</td>
<td class="org-left"><code>:exports code</code></td>
<td class="org-left">(default) The code in the block will be included in the export.</td>
</tr>
<tr>
<td class="org-left">results</td>
<td class="org-left"><code>:exports results</code></td>
<td class="org-left">The result of evaluating the code will be included.</td>
</tr>
<tr>
<td class="org-left">both</td>
<td class="org-left"><code>:exports both</code></td>
<td class="org-left">Include <code>code</code> and <code>results</code> in the file.</td>
</tr>
<tr>
<td class="org-left">none</td>
<td class="org-left"><code>:exports none</code></td>
<td class="org-left">Don't include anything in the file.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org5f3ac01" class="outline-2">
<h2 id="org5f3ac01">Running Tests</h2>
<div class="outline-text-2" id="text-org5f3ac01">
<p>
Say there was another section in the document that tangled a test-file (named <code>testliterate.py</code>) to test our main source file. Once both are tangled you can run it in the document using <code>sh</code> as the language. The org-mode documentation shows a more complex version of this which builds a pass-fail table, but that's beyond me right now.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>   #+name: shell-run-pytest
   #+begin_src sh :results output :exports both
   py.test -v literate_python/testliterate.py
   #+end_src
</pre></div>

<pre class="example">
============================= test session starts ==============================
platform linux -- Python 3.5.1+, pytest-3.0.5, py-1.4.32, pluggy-0.4.0 -- /home/cronos/.virtualenvs/nikola/bin/python3
cachedir: .cache
rootdir: /home/cronos/projects/nikola/posts, inifile: 
plugins: faker-2.0.0, bdd-2.18.1
collecting ... collected 1 items

literate_python/testliterate.py::test_constructor PASSED

=========================== 1 passed in 0.06 seconds ===========================
</pre>
</div>
</div>

<div id="outline-container-org3775d1e" class="outline-2">
<h2 id="org3775d1e">Specific Block Cases</h2>
<div class="outline-text-2" id="text-org3775d1e">
</div>
<div id="outline-container-orga1675d6" class="outline-3">
<h3 id="orga1675d6">Plant UML</h3>
<div class="outline-text-3" id="text-orga1675d6">
<p>
Besides setting the language to <code>plantuml</code> you need to specify and output-file path and set <code>:exports results</code> so that the actual plantuml code won't be in the exported document but the diagram will.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+begin_src plantuml :file literate_python/literateclass.png :exports results
skinparam monochrome true

LiterateClass : String who
LiterateClass : String ()
#+end_src
</pre></div>
</div>
</div>

<div id="outline-container-orgaab4a70" class="outline-3">
<h3 id="orgaab4a70">ob-ipython</h3>
<div class="outline-text-3" id="text-orgaab4a70">
<p>
The main thing to remember for ob-ipython is that you need to run it as a <code>:session</code>. I didn't do it for most of the examples, but I've found since I first wrote this that using named sessions makes it a lot easier to work. Otherwise you might have more than one buffer with an org-babel document and they will be sharing the same <i>ipython</i> process, which can cause mysterious errors.
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+begin_src ipython :session session1
  # python standard library
  import os
#+end_src
</pre></div>
<p>
When using <code>pandas</code> most of the methods produce values, but the <code>info</code> method instead prints to <code>stdout</code> so you have to specify this as the <code>:results</code> or it will popup a separate buffer with the output.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+begin_src ipython :session session1 :results output
housing.info()
#+end_src
</pre></div>

<p>
When you create figures, besides making sure that you use the <code>%matplotlib inline</code> magic, you also need to specify a file path where <i>matplotlib</i> can save the image.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+BEGIN_SRC ipython :session session1 :file "images/ocean_proximity_count.png"
figure = seaborn.countplot(x="ocean_proximity", data=housing)
#+end_src
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge56456e" class="outline-2">
<h2 id="orge56456e">Set Up</h2>
<div class="outline-text-2" id="text-orge56456e">
</div>
<div id="outline-container-org01da681" class="outline-3">
<h3 id="org01da681">Dependencies</h3>
<div class="outline-text-3" id="text-org01da681">
<p>
I'm using <a href="https://github.com/gregsexton/ob-ipython">ob-ipython</a> to use jupyter/ipython with org-babel so you have to install it (I used MELPA). In addition you need to install the python dependencies, the main ones being <i>ipython</i> and <i>jupyter</i>. Additionally, I use <a href="https://github.com/jorgenschaefer/elpy">elpy</a> (also from MELPA) which has its own dependencies. I think the easiest way to check and see what <i>elpy</i> dependencies you need is to install <i>elpy</i> (there's two components, an emacs one you install from <i>melpa</i> and a python component you install from <i>pip</i>) then run <code>M-x elpy-config</code> to see what's missing.
</p>
</div>
</div>
<div id="outline-container-org63caa0b" class="outline-3">
<h3 id="org63caa0b">init.el</h3>
<div class="outline-text-3" id="text-org63caa0b">
<p>
Since I mentioned <i>ob-ipython</i> and <i>elpy</i> I'll list what I have in my <i>init.el</i> file for <i>elpy</i> and <i>org-babel</i>.
</p>
</div>
<div id="outline-container-org6a5e5b3" class="outline-4">
<h4 id="org6a5e5b3">Elpy</h4>
<div class="outline-text-4" id="text-org6a5e5b3">
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="c1">;; elpy</span>
<span class="p">(</span><span class="nf">elpy-enable</span><span class="p">)</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">elpy-rpc-backend</span> <span class="s">"jedi"</span><span class="p">)</span>
<span class="p">(</span><span class="nf">eval-after-load</span> <span class="s">"python"</span>
 <span class="o">'</span><span class="p">(</span><span class="nv">define-key</span> <span class="nv">python-mode-map</span> <span class="s">"\C-cx"</span> <span class="ss">'jedi-direx:pop-to-buffer</span><span class="p">))</span>
<span class="p">(</span><span class="nf">elpy-use-ipython</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org54acab4" class="outline-4">
<h4 id="org54acab4">org-babel</h4>
<div class="outline-text-4" id="text-org54acab4">
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="c1">;; org-babel</span>
<span class="c1">;;; syntax-highlighting/editing</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">'org-src-lang-modes</span> <span class="o">'</span><span class="p">(</span><span class="s">"rst"</span> <span class="o">.</span> <span class="s">"rst"</span><span class="p">))</span>
<span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">'org-src-lang-modes</span> <span class="o">'</span><span class="p">(</span><span class="s">"feature"</span> <span class="o">.</span> <span class="s">"feature"</span><span class="p">))</span>

<span class="c1">;;; languages to execute/edit</span>
<span class="p">(</span><span class="nf">org-babel-do-load-languages</span>
 <span class="ss">'org-babel-load-languages</span>
 <span class="o">'</span><span class="p">((</span><span class="nf">ipython</span> <span class="o">.</span> <span class="nv">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">plantuml</span> <span class="o">.</span> <span class="nv">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">shell</span> <span class="o">.</span> <span class="nv">t</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">org</span> <span class="o">.</span> <span class="nv">t</span><span class="p">)</span>
   <span class="c1">;; other languages..</span>
   <span class="p">))</span>

<span class="c1">;;; noweb expansion only when you tangle</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">org-babel-default-header-args</span>
      <span class="p">(</span><span class="nb">cons </span><span class="o">'</span><span class="p">(</span><span class="nv">:noweb</span> <span class="o">.</span> <span class="s">"tangle"</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">assq-delete-all</span> <span class="nv">:noweb</span> <span class="nv">org-babel-default-header-args</span><span class="p">))</span>
      <span class="p">)</span>

<span class="c1">;;; Plant UML diagrams</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">org-plantuml-jar-path</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">"/usr/share/plantuml/plantuml.jar"</span><span class="p">))</span>

<span class="c1">;;; execute block evaluation without confirmation</span>
<span class="p">(</span><span class="nf">setq</span> <span class="nv">org-confirm-babel-evaluate</span> <span class="nv">nil</span><span class="p">)</span>   

<span class="c1">;;; display/update images in the buffer after evaluation</span>
<span class="p">(</span><span class="nf">add-hook</span> <span class="ss">'org-babel-after-execute-hook</span> <span class="ss">'org-display-inline-images</span> <span class="ss">'append</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div id="outline-container-org9c2df93" class="outline-2">
<h2 id="org9c2df93">Integrating with Nikola/Sphinx</h2>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/python-with-org-babel/" class="u-url">Python with Org-Babel</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="posts/python-with-org-babel/" rel="bookmark"><time class="published dt-published" datetime="2016-12-28T14:12:41-08:00" title="2016-12-28 14:12">2016-12-28 14:12</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org07ba4bd" class="outline-2">
<h2 id="org07ba4bd">What is this about?</h2>
<div class="outline-text-2" id="text-org07ba4bd">
<p>
This is an initial look at how to use org-babel to create a literate-programming document. In the past I have used jupyter notebooks and pweave to do similar things, with each having a separate role - jupyter notebooks are good for interactive exploration but somewhat less amenable to working with sphinx (which I did with pweave). The hope here is that the org-babel system will provide something more amenable to both. Since you still have to convert the org-files to restructured text files (with pandoc or ox-nikola) it's still not everything I wanted, but hopefully this will make things a little easier
</p>

<p>
Most of this is stolen from <a href="http://home.fnal.gov/~neilsen/notebook/orgExamples/org-examples.html">this page</a> - I'm fairly new to org-babel in general so I'm just walking in other people's footsteps for now.
</p>

<p>
Also, the inclusion of the org-babel code turned out to be both tedious and aesthetically unsatisfying so I didn't do it as much as I thought I would. The original org-file is <a href="https://raw.githubusercontent.com/necromuralist/necromuralist.github.io/master/posts/python-with-org-babel/index.org">here</a>.
</p>
</div>
</div>
<div id="outline-container-org72300ad" class="outline-2">
<h2 id="org72300ad">High-Level Module Structure</h2>
<div class="outline-text-2" id="text-org72300ad">
<p>
One nice thing about the org-babel/noweb system is that it has a system that makes it easy to create a template (in this case based on the the module structure from <a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#module-structure">Code Like A Pythonista</a>) with parts that we're updating inserted using the noweb syntax. To actually see this I had to include the python code as an org-mode snippet so the syntax highlighting isn't there. 
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  #+begin_src python :noweb yes :tangle literate_python/literate.py
    """A docstring for the literate.py module"""

    # imports
    import sys
    &lt;&lt;literate-main-imports&gt;&gt;

    # constants

    # exception classes

    # interface funchtions

    # classes


    &lt;&lt;LiterateClass-definition&gt;&gt;

    # internal functions &amp; classes

    &lt;&lt;literate-main&gt;&gt;


    if __name__ == "__main__":
	status = main()
	sys.exit(status)
  #+end_src
</pre></div>

<p>
This is what the final file looks like once the no-web substitutions happen.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>  <span class="sd">"""A docstring for the literate.py module"""</span>

  <span class="c1"># imports</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>

  <span class="c1"># constants</span>

  <span class="c1"># exception classes</span>

  <span class="c1"># interface funchtions</span>

  <span class="c1"># classes</span>


  <span class="k">class</span> <span class="nc">LiterateClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
      <span class="sd">"""A class to be substituted above</span>

<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>

<span class="sd">      String who: name of user</span>
<span class="sd">      """</span>
      <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">who</span><span class="p">):</span>
	  <span class="bp">self</span><span class="o">.</span><span class="n">who</span> <span class="o">=</span> <span class="n">who</span>
	  <span class="k">return</span>

      <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	  <span class="k">print</span><span class="p">(</span><span class="s2">"Who: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">who</span><span class="p">))</span>

  <span class="c1"># internal functions &amp; classes</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"literate caller"</span><span class="p">)</span>
      <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">"-w"</span><span class="p">,</span> <span class="s2">"--who"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
			  <span class="n">default</span><span class="o">=</span><span class="s2">"me"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"who are you?"</span><span class="p">)</span>
      <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
      <span class="n">who</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">who</span>
      <span class="n">thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="n">who</span><span class="p">)</span>
      <span class="n">thing</span><span class="p">()</span>
      <span class="k">return</span> <span class="mi">0</span>


  <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

<p>
To create the `literate.py` file (and all the other code-files) you see above execute <code>M-x org-babel-tangle</code>.
</p>
</div>
</div>

<div id="outline-container-org296914d" class="outline-2">
<h2 id="org296914d">LiterateClass</h2>
<div class="outline-text-2" id="text-org296914d">
<p>
This is the class definition that get substituted above. The code block for the definition is named <code>LiterateClass-definition</code> so the main template will substitute its contents for <code>&lt;&lt;LiterateClass-definition&gt;&gt;</code> when it gets tangled.
</p>


<div class="figure">
<p><img src="posts/python-with-org-babel/literate_python/literateclass.png" alt="literateclass.png"></p>
</div>


/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LiterateClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""A class to be substituted above</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    String who: name of user</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">who</span><span class="p">):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">who</span> <span class="o">=</span> <span class="n">who</span>
	<span class="k">return</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s2">"Who: {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">who</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga75fde8" class="outline-2">
<h2 id="orga75fde8">Main functions</h2>
<div class="outline-text-2" id="text-orga75fde8">
<p>
The <b>Code Like a Pythonista</b> template expects that you are creating a command-line executable with a <b>main</b> entry-point. This section implements that case as an example.
</p>

<p>
First the <code>&lt;&lt;literate-main-imports&gt;&gt;</code>.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
</pre></div>

<p>
Now the <code>&lt;&lt;literate-main&gt;&gt;</code>.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"literate caller"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">"-w"</span><span class="p">,</span> <span class="s2">"--who"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
			<span class="n">default</span><span class="o">=</span><span class="s2">"me"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"who are you?"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">who</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">who</span>
    <span class="n">thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="n">who</span><span class="p">)</span>
    <span class="n">thing</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>

<p>
As a quick check we can run the code at the command line to see that it's working (the main block has to be tangled for this to work).
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>python literate_python/literate.py --who <span class="s2">"Not Me"</span>
</pre></div>

<pre class="example">
Who: Not Me

</pre>
</div>
</div>

<div id="outline-container-orgc145b07" class="outline-2">
<h2 id="orgc145b07">Testing</h2>
<div class="outline-text-2" id="text-orgc145b07">
<p>
One nice thing about the org-babel infrastructure is that the tests and source can be put in the same org-file, then exported to separate files to be run.
</p>
</div>
<div id="outline-container-org89777a2" class="outline-3">
<h3 id="org89777a2">Doctest</h3>
<div class="outline-text-3" id="text-org89777a2">
<p>
For the stdout output, doctesting can be a convenient way to check that things are behaving as expected while also providing an explicit example of how to run the command-line interface.
</p>
</div>
<div id="outline-container-orgba8f8a0" class="outline-4">
<h4 id="orgba8f8a0">Setting up the cases</h4>
<div class="outline-text-4" id="text-orgba8f8a0">
<p>
The output of a successful doctest is nothing, which is good for automated tests but less interesting here so I'll make a doctest that passes and one that should fail.
</p>

<p>
This next section (named <code>literate-doctest</code>) creates a code snippet that will pass. 
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">example</span><span class="p">::</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">literate_python.literate</span> <span class="kn">import</span> <span class="n">LiterateClass</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="s2">"Gorgeous George"</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">thing</span><span class="p">()</span>
  <span class="n">Who</span><span class="p">:</span> <span class="n">Gorgeous</span> <span class="n">George</span>
</pre></div>

<p>
And now here's a test (named <code>literate-bad-doctest</code>) that will fail.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">bad</span><span class="p">::</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">bad_thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="s2">"Gorilla Glue"</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">bad_thing</span><span class="p">()</span>
  <span class="n">Who</span><span class="p">:</span> <span class="n">Magilla</span> <span class="n">Gorilla</span>
</pre></div>

<p>
This next section will include the two doctests and export them to a file so they can be tested. Note that you need an empty line between the tests for both of them to run. Warning - since this file is going to be exported, if you are using <code>nikola</code> or some other system that assumes all files with a certain file-extension are blog-posts you have to use an extension that won't get picked up (in my case both <code>rst</code> and <code>txt</code> were interpreted as blog-posts).
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>#+begin_src text :noweb yes :tangle literate_python/test_literate_output.doctest :exports none
&lt;&lt;literate-doctest&gt;&gt;

&lt;&lt;literate-bad-doctest&gt;&gt;
#+end_src
</pre></div>

<p>
Which gets tangled into this. Note that the doctests aren't valid python so you can tangle this but not execute it.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="n">example</span><span class="p">::</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">literate_python.literate</span> <span class="kn">import</span> <span class="n">LiterateClass</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="s2">"Gorgeous George"</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">thing</span><span class="p">()</span>
  <span class="n">Who</span><span class="p">:</span> <span class="n">Gorgeous</span> <span class="n">George</span>

<span class="n">bad</span><span class="p">::</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">bad_thing</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="s2">"Gorilla Glue"</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">bad_thing</span><span class="p">()</span>
  <span class="n">Who</span><span class="p">:</span> <span class="n">Magilla</span> <span class="n">Gorilla</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbe8ab8f" class="outline-4">
<h4 id="orgbe8ab8f">Running the doctests</h4>
<div class="outline-text-4" id="text-orgbe8ab8f">
<p>
Now we can actually run them with python to see what happens.
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>python -m doctest literate_python/test_literate_output.doctest
<span class="nb">true</span>
</pre></div>

<pre class="example">
**********************************************************************
File "literate_python/test_literate_output.doctest", line 9, in test_literate_output.doctest
Failed example:
    bad_thing()
Expected:
    Who: Magilla Gorilla
Got:
    Who: Gorilla Glue
**********************************************************************
1 items had failures:
   1 of   5 in test_literate_output.doctest
***Test Failed*** 1 failures.
</pre>

<p>
Note that since this returned a non-zero exit code (I think) you need to put <code>true</code> in the code block or there would be no output.
</p>
</div>
</div>
</div>

<div id="outline-container-org27fcc31" class="outline-3">
<h3 id="org27fcc31">PyTest BDD</h3>
<div class="outline-text-3" id="text-org27fcc31">
<p>
While doctests are neat I prefer unit-testing, in particular using Behavior Driven Development (BDD) facilitated in this case by <code>py.test</code> and <code>pytest_bdd</code>.
</p>
</div>

<div id="outline-container-org953bbcc" class="outline-4">
<h4 id="org953bbcc">The feature file</h4>
<div class="outline-text-4" id="text-org953bbcc">
<p>
Identifying the code-block with <code>#+begin_src feature</code> adds some syntax highlighting (if you have feature-mode installed and set-up). This works both when you are in the external editor and in the main org-babel document as well.
</p>

<p>
To make sure that org-babel recognizes feature mode add this to the <code>init.el</code> file.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">add-to-list</span> <span class="ss">'org-src-lang-modes</span> <span class="o">'</span><span class="p">(</span><span class="s">"feature"</span> <span class="o">.</span> <span class="s">"feature"</span><span class="p">))</span>
</pre></div>

<p>
This is what is going in the feature file.
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>Feature: Literate Class
Scenario: Creating a literate object
  Given a name
  When a Literate object is created with the name
  Then the literate object has the name
</pre></div>
</div>
</div>

<div id="outline-container-orge3b1f32" class="outline-4">
<h4 id="orge3b1f32">The test file</h4>
<div class="outline-text-4" id="text-orge3b1f32">
<p>
This is another file that gets tangled out. In this case it is so that we can run <code>py.test</code> on it.
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span>
<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">fixture</span>
<span class="kn">from</span> <span class="nn">pytest_bdd</span> <span class="kn">import</span> <span class="n">given</span>
<span class="kn">from</span> <span class="nn">pytest_bdd</span> <span class="kn">import</span> <span class="n">scenario</span>
<span class="kn">from</span> <span class="nn">pytest_bdd</span> <span class="kn">import</span> <span class="n">then</span>
<span class="kn">from</span> <span class="nn">pytest_bdd</span> <span class="kn">import</span> <span class="n">when</span>

<span class="c1"># this code</span>
<span class="kn">from</span> <span class="nn">literate</span> <span class="kn">import</span> <span class="n">LiterateClass</span>

<span class="n">FEATURE_FILE</span> <span class="o">=</span> <span class="s2">"literate.feature"</span>


<span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""context object"""</span>


<span class="nd">@fixture</span>
<span class="k">def</span> <span class="nf">context</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Context</span><span class="p">()</span>


<span class="nd">@scenario</span><span class="p">(</span><span class="n">FEATURE_FILE</span><span class="p">,</span> <span class="s2">"Creating a literate object"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_constructor</span><span class="p">():</span>
    <span class="k">return</span>


<span class="nd">@given</span><span class="p">(</span><span class="s2">"a name"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_name</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">faker</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>


<span class="nd">@when</span><span class="p">(</span><span class="s1">'a Literate object is created with the name'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_object</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">LiterateClass</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="nd">@then</span><span class="p">(</span><span class="s2">"the literate object has the name"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_object_name</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">who</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3c7ce5d" class="outline-4">
<h4 id="org3c7ce5d">Running the test</h4>
<div class="outline-text-4" id="text-org3c7ce5d">
<p>
One important thing to note is that this will put an error message in a separate buffer if something goes wrong (like you don't have py.test installed), which in at least some cases makes it look like it failed silently. Unlike with the doctests, no output means something in the setup needs to be fixed, so you should tangle the file and then run it at the command-line to debug what happened.
</p>
/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span>py.test -v literate_python/testliterate.py
</pre></div>

<pre class="example">
============================= test session starts ==============================
platform linux -- Python 3.5.1+, pytest-3.0.5, py-1.4.32, pluggy-0.4.0 -- /home/cronos/.virtualenvs/nikola/bin/python3
cachedir: .cache
rootdir: /home/cronos/projects/nikola/posts, inifile: 
plugins: faker-2.0.0, bdd-2.18.1
collecting ... collected 1 items

literate_python/testliterate.py::test_constructor PASSED

=========================== 1 passed in 0.04 seconds ===========================
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org360caaa" class="outline-2">
<h2 id="org360caaa">Getting This Into Nikola</h2>
<div class="outline-text-2" id="text-org360caaa">
<p>
I tried three ways to get this document into nikola:
</p>
<ul class="org-ul">
<li>converting to rst with pandoc</li>
<li>exporting it with <a href="https://github.com/masayuko/ox-nikola">ox-nikola</a>
</li>
<li>using the <a href="https://plugins.getnikola.com/#orgmode">orgmode</a> plugin for nikola</li>
</ul>
<p>
<b>ox-nikola</b> worked (as did pandoc), but at the moment I'm trying to use the <b>orgmode</b> plugin so that I can keep editing this document without having to convert back and forth. This is turning out to be about the same amount of work as using jupyter (and with a steeper learning curve). But I like the folding and navigation that org-mode offers, so I'll stick with it for a bit. I'm just using the default set-up right now. It seems to work. 
</p>

<p>
The main problem I had initially was the same one I had with jupyter - I'm starting with a file that wasn't generated by the <code>nikola new_post</code> sub-command so it didn't have the header that <b>nikola</b> expected but the only error <code>nikola build</code> reported was an invalid date format. 
</p>

<p>
This is what needs to be at the top of the org-file for nikola to work with it (or something like it).
</p>

/home/hades/.virtualenvs/necromuralist.github.io/bin/python: No module named virtualfish
<div class="highlight"><pre><span></span> #+BEGIN_COMMENT
.. title: Python with Org-Babel
.. slug: python-with-org-babel
.. date: 2016-12-28 14:12:41 UTC-08:00
.. tags: howto python babel literateprogramming
.. category: how_to
.. link: 
.. description: 
.. type: text
#+END_COMMENT
</pre></div>

<p>
The other thing is that the org-mode plugin doesn't seem to copy over the png-files correctly (or at all) so I had to create a <code>files/posts/python-with-org-babel/literate_python</code> folder and move the UML diagram over there by hand. Lastly, it didn't color the feature file and since there's no intermediate rst-file I don't really know how to fix this. Either I'm going to have to learn a lot more about org-mode than I might want to, or for cases where I want more control over things I'll use <b>ox-nikola</b> to convert it to rst first and edit it. That kind of wrecks the one-document idea, but I guess it would also give me a reason to re-work and polish things instead of improvising everything.
</p>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-6.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:necromuralist@gmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
