<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mocking Print | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/posts/201310mocking-print/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script><meta name="author" content="Cloistered Monkey">
<link rel="prev" href="../201310argparse-and-argument-parser/" title="argparse and the Argument Parser" type="text/html">
<link rel="next" href="../201411installing-python-package-for-single/" title="Installing a Python Package for a Single User" type="text/html">
<meta property="og:site_name" content="The Cloistered Monkey">
<meta property="og:title" content="Mocking Print">
<meta property="og:url" content="https://necromuralist.github.io/posts/201310mocking-print/">
<meta property="og:description" content="BackgroundI wanted to check to make sure I was sending the right output to the screen so I thought I would use mock to catch what I was sending to it. These are some notes about what happened.Mocking ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2013-10-05T22:48:00-07:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-default navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/">

                <span id="blog-title">The Cloistered Monkey</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../machine-learning-projects/">Machine Learning</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/data_science/">Data Science With Python</a>
            </li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Pages <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://necromuralist.github.io/vue_practice/">Vue Practice</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/reading-list/">Reading Notes</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/text-processing/">Notes on Text-Procesing</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/tddmachinelearning/">TDD Machine Learning</a>
                    </li>
<li>
<a href="https://necromuralist.github.io/p5_explorations/">P5 Explorations</a>
            </li>
</ul>
</li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.src.html" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Mocking Print</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2013-10-05T22:48:00-07:00" itemprop="datePublished" title="2013-10-05 22:48">2013-10-05 22:48</time></a></p>
            
        <p class="sourceline"><a href="index.src.html" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="document" id="mocking-print">   <div class="section" id="background">
<h4>Background</h4>
<p>I wanted to check to make sure I was sending the right output to the screen so I thought I would use <a class="reference external" href="https://pypi.python.org/pypi/mock">mock</a> to catch what I was sending to it. These are some notes about what happened.</p>
</div>
<div class="section" id="id1">
<h4>Mocking print</h4>
<p>If you try to <a class="reference external" href="http://www.voidspace.org.uk/python/mock/getting-started.html#patch-decorators">patch</a>   <tt class="docutils literal">print</tt> with MagicMock, here is what you get.</p>
<pre class="literal-block"><br>from mock import MagicMock, patch, call<br><br>mock_print = MagicMock()<br>try:<br>    with patch('print', mock_print):<br>        print 'test'<br>except TypeError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Need a valid target to patch. You supplied: 'print'<br></pre>
<p>So it looks like 'print' is not the right thing to patch. Maybe you need to call it a built-in funtion:</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print 'test'<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>What if you call it as a function?</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print( 'test')<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>So neither of those raise an error, but they also do not manage to mock <tt class="docutils literal">print</tt>. Well, if you look at the description for <a class="reference external" href="http://docs.python.org/2/library/functions.html#print">print</a>, it turns out that the print function has the signature:</p>
<pre class="literal-block"><br>print(*objects, sep=' ', end='\n', file=sys.stdout)<br></pre>
<p>It also says that the function call is not normally available unless you import it from the future.</p>
<p>But, presuming that the print statement works the same way as the function call, what happens if you mock <tt class="docutils literal">sys.stdout</tt>?</p>
</div>
<div class="section" id="mocking-sys-stdout">
<h4>Mocking sys.stdout</h4>
<p>This doesn't answer the question of why I can't mock print directly, but maybe mocking <tt class="docutils literal">sys.stdout</tt> will work instead.</p>
<pre class="literal-block"><br>with patch('sys.stdout', mock_print):<br>    print 'test'<br><br>expected = [call('test')]<br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Expected: [call('test')] Actual: [call.write('test'), call.write('\n')]<br></pre>
<p>It looks like the mock works this time, but it did not return what I was expecting -- <tt class="docutils literal">print</tt> makes two calls to <tt class="docutils literal">stdout.write</tt>, the first is the string you pass it which it then follows with a newline character. Given this slightly more complete understanding of <tt class="docutils literal">print</tt>:</p>
<pre class="literal-block"><br># create some output to send to print<br>lines = "a b c".split()<br><br># reset the mock so the previous calls are gone<br>mock_print.reset_mock()<br>with patch('sys.stdout', mock_print):<br>    for line in lines:<br>        print line<br><br>expected = []<br>for line in lines:<br>    expected.append(call.write(line))<br>    expected.append(call.write('\n'))<br><br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
</div>
<div class="section" id="conclusion">
<h4>Conclusion</h4>
<p>Not earth-shattering, but I thought it was interesting that even after using Python for years, something as basic as <tt class="docutils literal">print</tt> can yield something new if looked at more closely. It was also useful to see how mock can be used to discover the calls that are being made on an object, not just to test that expected calls are being made.</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../201310argparse-and-argument-parser/" rel="prev" title="argparse and the Argument Parser">Previous post</a>
            </li>
            <li class="next">
                <a href="../201411installing-python-package-for-single/" rel="next" title="Installing a Python Package for a Single User">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
