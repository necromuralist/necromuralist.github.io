<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Fixing the Python Virtual Environments broken by upgrading to Ubuntu 24.04 (Noble Numbat)." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Noble Numbat and the Broken Virtual Environments | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/posts/noble-numbat-and-the-broken-virtual-environments/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../fish-links/" rel="prev" title="Fish Links" type="text/html">
<link href="../protonpass-finding-the-suggested-password/" rel="next" title="ProtonPass: Finding the Suggested Password" type="text/html">
<meta content="The Cloistered Monkey" property="og:site_name">
<meta content="Noble Numbat and the Broken Virtual Environments" property="og:title">
<meta content="https://necromuralist.github.io/posts/noble-numbat-and-the-broken-virtual-environments/" property="og:url">
<meta content="Fixing the Python Virtual Environments broken by upgrading to Ubuntu 24.04 (Noble Numbat)." property="og:description">
<meta content="article" property="og:type">
<meta content="2024-05-27T16:21:26-07:00" property="article:published_time">
<meta content="pipx" property="article:tag">
<meta content="ubuntu" property="article:tag">
<meta content="upgrading" property="article:tag">
<meta content="virtualfish" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Give-The-Fish/">Give the Fish</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Noble Numbat and the Broken Virtual Environments</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author"><a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2024-05-27T16:21:26-07:00" itemprop="datePublished" title="2024-05-27 16:21">2024-05-27 16:21</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org40429aa">What is this about?</a></li>
<li><a href="#org052aae9">What Happened</a></li>
<li><a href="#org63adcfe">Short Version</a></li>
<li><a href="#org46a1c07">The First Hint (pipx)</a></li>
<li><a href="#org16f65f6">The Broken Virtual Environments</a></li>
<li><a href="#org6dab3cd">Then a Nikola Error</a></li>
<li><a href="#orgf9d15a8">An Ape-Iron Problem (no distutils)</a></li>
<li><a href="#org5b4d613">Links</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org40429aa">
<h2 id="org40429aa">What is this about?</h2>
<div class="outline-text-2" id="text-org40429aa">
<p>These are notes I made when I was fixing some errors that occurred after updating Ubuntu to 24.04. It's been over a year so I don't really remember writing this, but, here it is. The fixes are specific to <a href="https://github.com/justinmayer/virtualfish">virtualfish</a>, <a href="https://github.com/pypa/pipx">pipx</a>, and <a href="https://getnikola.com/">nikola</a>.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org052aae9">
<h2 id="org052aae9">What Happened</h2>
<div class="outline-text-2" id="text-org052aae9">
<ul class="org-ul">
<li>I updated Ubuntu</li>
<li>Something raised an obscure error when I changed into one of my git repositories</li>
<li>It turned out that the upgrade broke the python virtual environment</li>
<li>Re-setting-up using the newer version of python that came with the upgrade fixed things.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org63adcfe">
<h2 id="org63adcfe">Short Version</h2>
<div class="outline-text-2" id="text-org63adcfe">
<ul class="org-ul">
<li>Upgrading to Ubuntu 24.04 made python changes that broke all my virtual enviroments</li>
<li>Reinstalled <code>pipx</code> using apt</li>
<li><code>vf ls --details</code> shows the python versions for all (virtualfish created) virtual environments (and which are broken)</li>
<li><code>vf upgrade --rebuild</code> will upgrade the currently active virtual environment (may take more than one run to get past errors)</li>
<li><code>pipx reinstall-all</code> fixed the missing <code>nikola</code> and <code>pygmentize</code> errors (and probably others)</li>
<li>fixing <code>pygments</code> doesn't fix the errors in posts that were alread built so do a <code>nikola clean</code> and <code>nikola build</code></li>
<li><code>pip install setuptools --upgrade</code> in the environment re-setup <code>distutils</code> which was removed from python 3.12 (which Ubuntu Installed)</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org46a1c07">
<h2 id="org46a1c07">The First Hint (pipx)</h2>
<div class="outline-text-2" id="text-org46a1c07">
<p>I don't remember exactly what cued me in to what was going wrong, but somewhere in trying to figure out what was wrong I found that running <a href="https://github.com/frostming/legit">legit</a> after updating to Ubuntu 24.04 returned an error saying that <code>legit</code> wasn't found. It took a while to figure out where <code>legit</code> was supposed to be coming from, but it turned out I had installed it with <a href="https://pipx.pypa.io/latest/installation/">pipx</a> and had to re-install it to get it working.</p>
<p>I don't remember exactly what I did anymore, but based on the command history it looks like:</p>
<ol class="org-ol">
<li>Re-install <code>pipx</code> (I purged the original installation that had been installed using <code>pip</code> and instead used <code>apt</code>)</li>
<li>Re-install <code>legit</code> using the updated <code>pipx</code></li>
</ol>
<p>So, was <code>pipx</code> the problem? Well, partly.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org16f65f6">
<h2 id="org16f65f6">The Broken Virtual Environments</h2>
<div class="outline-text-2" id="text-org16f65f6">
<p>The next problem came when I tried to build the HTML for this site.</p>
<div class="highlight">
<pre><span></span>nikola build
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"/home/hades/.virtualenvs/necromuralist.github.io/bin/nikola"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">nikola.__main__</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'nikola'</span>
</pre></div>
<p>For some reason the <code>nikola</code> executable was missing. Since I was in a virtual environment I tried to re-install nikola but using <code>pip</code> gave another error.</p>
<div class="highlight">
<pre><span></span>pip --version
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"/home/hades/.virtualenvs/necromuralist.github.io/bin/pip"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pip._internal.cli.main</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'pip'</span>
</pre></div>
<p>So, not only was <code>nikola</code> missing but so was <code>pip</code>, which I thought was a part of the python installation… I looked at what was in the virtualenvironment -</p>
<div class="highlight">
<pre><span></span>ls ~/.virtualenvs/necromuralist.github.io/lib
</pre></div>
<p>And saw that it had this python version:</p>
<div class="highlight">
<pre><span></span>python3.11/
</pre></div>
<p>But when I checked the version of the python I was using it gave this.</p>
<div class="highlight">
<pre><span></span>python --version
</pre></div>
<div class="highlight">
<pre><span></span>Python 3.12.3
</pre></div>
<p>So it looked like the ubuntu update created a bit of a mismatch. It turns out that <a href="https://virtualfish.readthedocs.io/en/latest/">virtualfish</a> has a command to list what virtual environments you have set up (<code>vf ls</code>) and if you pass it the <code>--details=</code> option it will show you the python version the environment is using.</p>
<div class="highlight">
<pre><span></span>vf ls --details
</pre></div>
<p>It listed all my environments but in particular it showed this for the environment for this site's repository.</p>
<div class="highlight">
<pre><span></span>necromuralist.github.io <span class="o">(</span>broken<span class="o">)</span>
</pre></div>
<p><code>virtualfish</code> also has a command to upgrade the currently active environment so I tried running it.</p>
<p>Running this with the <i>necromuralist</i> environment active:</p>
<div class="highlight">
<pre><span></span>vf upgrade --rebuild
</pre></div>
<p>Gave this error.</p>
<div class="highlight">
<pre><span></span>Collecting <span class="nv">PyYAML</span><span class="o">==</span>6.0
  Downloading PyYAML-6.0.tar.gz <span class="o">(</span><span class="m">124</span> kB<span class="o">)</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 125.0/125.0 kB 3.5 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... error
  error: subprocess-exited-with-error

  × Getting requirements to build wheel did <span class="k">not</span> run successfully.
  │ <span class="k">exit</span> code: 1
  ╰─&gt; <span class="o">[</span><span class="m">54</span> lines of output<span class="o">]</span>
      running egg_info
      writing lib/PyYAML.egg-info/PKG-INFO
      writing dependency_links to lib/PyYAML.egg-info/dependency_links.txt
      writing top-level names to lib/PyYAML.egg-info/top_level.txt
      Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
        File <span class="s2">"/home/hades/.virtualenvs/necromuralist.github.io/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py"</span>, line 353, <span class="k">in</span> <span class="o">&lt;</span>module&gt;
          main<span class="o">()</span>
        File <span class="s2">"/home/hades/.virtualenvs/necromuralist.github.io/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py"</span>, line 335, <span class="k">in</span> main
          json_out<span class="o">[</span><span class="s1">'return_val'</span><span class="o">]</span> <span class="o">=</span> hook<span class="o">(</span>**hook_input<span class="o">[</span><span class="s1">'kwargs'</span><span class="o">])</span>
                                   <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"/home/hades/.virtualenvs/necromuralist.github.io/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py"</span>, line 118, <span class="k">in</span> get_requires_for_build_wheel
          <span class="k">return</span> hook<span class="o">(</span>config_settings<span class="o">)</span>
                 <span class="o">^^^^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/build_meta.py"</span>, line 325, <span class="k">in</span> get_requires_for_build_wheel
          <span class="k">return</span> self._get_build_requires<span class="o">(</span>config_settings, <span class="nv">requirements</span><span class="o">=[</span><span class="s1">'wheel'</span><span class="o">])</span>
                 <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/build_meta.py"</span>, line 295, <span class="k">in</span> _get_build_requires
          self.run_setup<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/build_meta.py"</span>, line 311, <span class="k">in</span> run_setup
          <span class="nb">exec</span><span class="o">(</span>code, locals<span class="o">())</span>
        File <span class="s2">"&lt;string&gt;"</span>, line 288, <span class="k">in</span> <span class="o">&lt;</span>module&gt;
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/__init__.py"</span>, line 103, <span class="k">in</span> setup
          <span class="k">return</span> distutils.core.setup<span class="o">(</span>**attrs<span class="o">)</span>
                 <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/core.py"</span>, line 184, <span class="k">in</span> setup
          <span class="k">return</span> run_commands<span class="o">(</span>dist<span class="o">)</span>
                 <span class="o">^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/core.py"</span>, line 200, <span class="k">in</span> run_commands
          dist.run_commands<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/dist.py"</span>, line 969, <span class="k">in</span> run_commands
          self.run_command<span class="o">(</span>cmd<span class="o">)</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/dist.py"</span>, line 968, <span class="k">in</span> run_command
          super<span class="o">()</span>.run_command<span class="o">(</span><span class="nb">command</span><span class="o">)</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/dist.py"</span>, line 988, <span class="k">in</span> run_command
          cmd_obj.run<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/command/egg_info.py"</span>, line 321, <span class="k">in</span> run
          self.find_sources<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/command/egg_info.py"</span>, line 329, <span class="k">in</span> find_sources
          mm.run<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/command/egg_info.py"</span>, line 550, <span class="k">in</span> run
          self.add_defaults<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/command/egg_info.py"</span>, line 588, <span class="k">in</span> add_defaults
          sdist.add_defaults<span class="o">(</span>self<span class="o">)</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/command/sdist.py"</span>, line 102, <span class="k">in</span> add_defaults
          super<span class="o">()</span>.add_defaults<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/command/sdist.py"</span>, line 250, <span class="k">in</span> add_defaults
          self._add_defaults_ext<span class="o">()</span>
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/command/sdist.py"</span>, line 335, <span class="k">in</span> _add_defaults_ext
          self.filelist.extend<span class="o">(</span>build_ext.get_source_files<span class="o">())</span>
                               <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        File <span class="s2">"&lt;string&gt;"</span>, line 204, <span class="k">in</span> get_source_files
        File <span class="s2">"/tmp/pip-build-env-1ai8jd66/overlay/lib/python3.12/site-packages/setuptools/_distutils/cmd.py"</span>, line 107, <span class="k">in</span> __getattr__
          raise AttributeError<span class="o">(</span>attr<span class="o">)</span>
      AttributeError: cython_sources
      <span class="o">[</span><span class="k">end</span> of output<span class="o">]</span>

  note: This error originates from a subprocess, <span class="k">and</span> is likely <span class="k">not</span> a problem with pip.
</pre></div>
<p>Which looked like I was in trouble, but it turned out that re-running the upgrade fixed it. One of those magic fixes that would be scary if this was a critical site, I suppose, but which is instead, just another bit of python mystery.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org6dab3cd">
<h2 id="org6dab3cd">Then a Nikola Error</h2>
<div class="outline-text-2" id="text-org6dab3cd">
<p>So, with the virtual environment updated to the current python, I waded back into building the site.</p>
<div class="highlight">
<pre><span></span>nikola build
</pre></div>
<p>First this produced a <code>nikola</code> not found error (updating the virtual environment apparently doesn't fix everything). But since the environment itself was fixed pip was now working so I installed it again, but then building the site produced a different error.</p>
<div class="highlight">
<pre><span></span>DependencyError - taskid:render_posts:cache/posts/2ac-updating-a-nikola-shortcode-plugin.html  
ERROR: Task <span class="s1">'render_posts:cache/posts/2ac-updating-a-nikola-shortcode-plugin.html'</span> saving success: Dependent file <span class="s1">'/home/hades/.virtualenvs/necromuralist.github.io/lib/python3.11/site-packa</span>
<span class="s1">ges/nikola/data/shortcodes/mako/raw.tmpl'</span> does <span class="k">not</span> exist.
</pre></div>
<p>Re-reinstalling nikola and re-running the build made the error go away, but in the output I noticed some disturbing messages that looked like these.</p>
<div class="highlight">
<pre><span></span>.  render_pages:output/posts/destroying-tags-with-beautiful-soup/index.html
line <span class="m">135</span> column <span class="m">56</span> - Error: <span class="o">&lt;</span>module&gt; is <span class="k">not</span> recognized!
line <span class="m">144</span> column <span class="m">56</span> - Error: <span class="o">&lt;</span>module&gt; is <span class="k">not</span> recognized!
line <span class="m">154</span> column <span class="m">56</span> - Error: <span class="o">&lt;</span>module&gt; is <span class="k">not</span> recognized!
This document has errors that must be fixed before
using HTML Tidy to generate a tidied up version.
</pre></div>
<p>There were are a lot of these errors (which didn't cause nikola to quit so I wouldn't have seen them if I wasn't watching the build messages).</p>
<p>This turned out to be because nikola was encountering errors, trapping them and not failing and then embedding the python error messages into the HTML (and the error messages were causing HTML tidy to fail and then raise a different error message).</p>
<p>This is an example of an error message embedded in the HTML nikola created:</p>
<div class="highlight">
<pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"/home/hades/.local/bin/pygmentize"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pygments.cmdline</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'pygments'</span>
</pre></div>
<p>The cause for this one was a little more mysterious, but it turned out that I had installed <code>pygmentize</code> using <code>pipx</code> so it needed to be updated separately. I decided to use <code>pipx reinstall-all</code> to get everything updated.</p>
<p>Unfortunately, there were a lot of posts with the <code>pygmentize</code> errors, and since they aren't registered as errors by nikola, just building the site didn't fix them so I wiped it first and then re-built it.</p>
<div class="highlight">
<pre><span></span>nikola clean
nikola build
</pre></div>
<p>And since there weren't anymore errors I decided to cross my fingers and move on.</p>
<div class="notecard" id="org9ea6956">
<p><b>Note to future self:</b> This happened again with the update to Ubuntu 25.04 (Plucky Puffin) and the error messages from not cleaning the old build were confusing/misleading enough to cause me to waste time troubleshooting them. A clean build is a <i>really</i> good idea.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf9d15a8">
<h2 id="orgf9d15a8">An Ape-Iron Problem (no distutils)</h2>
<div class="outline-text-2" id="text-orgf9d15a8">
<p>The <code>vf ls --details</code> command I used to check on the virtual environment for this site also showed that all my other virtual environments were broken so I decided to try and fix the <code>Ape-Iron</code> repository while it was fresh on my mind. First I rebuilt the environment.</p>
<div class="highlight">
<pre><span></span>vf upgrade --rebuild Ape-Iron
</pre></div>
<p>And of course, it gave me errors.</p>
<div class="highlight">
<pre><span></span>Collecting <span class="nv">numpy</span><span class="o">==</span>1.24.3
  Downloading numpy-1.24.3.tar.gz <span class="o">(</span>10.9 MB<span class="o">)</span>
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 10.9/10.9 MB 7.7 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
ERROR: Exception:
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/home/hades/.virtualenvs/Ape-Iron/lib/python3.12/site-packages/pip/_internal/cli/base_command.py"</span>, line 180, <span class="k">in</span> exc_logging_wrapper
</pre></div>
<div class="highlight">
<pre><span></span>File <span class="s2">"/tmp/pip-build-env-f7h7lvcc/overlay/lib/python3.12/site-packages/setuptools/__init__.py"</span>, line 10, <span class="k">in</span> <span class="o">&lt;</span>module&gt;
    import distutils.core
ModuleNotFoundError: No module named <span class="s1">'distutils'</span>
</pre></div>
<p>According to <a href="https://stackoverflow.com/a/77233866">this answer</a> to a question on <i>StackOverflow</i> <code>distutils</code> was removed from python 3.12, which is the default with <i>noble-numbat</i>. The answer suggests installing <a href="https://github.com/pypa/setuptools"><code>setuptools</code></a>.</p>
<p>So, I tried that.</p>
<div class="highlight">
<pre><span></span>pip install setuptools --upgrade
</pre></div>
<p>Amazingly, the upgrade of Ape-Iron seemed to work.</p>
<div class="highlight">
<pre><span></span>vf upgrade --rebuild Ape-Iron
</pre></div>
<p>At this point I think I just called it a day.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org5b4d613">
<h2 id="org5b4d613">Links</h2>
<div class="outline-text-2" id="text-org5b4d613">
<ul class="org-ul">
<li><a href="https://virtualfish.readthedocs.io/en/latest/usage.html#upgrading-virtual-environments">Upgrading Virtual Environments</a>: Virtualfish Documentation</li>
<li><a href="https://github.com/yaml/pyyaml/issues/601">AttributeError: cython_sources</a>: A PyYAML bug report that looks related to the error.</li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/pipx/" rel="tag">pipx</a></li>
<li><a class="tag p-category" href="../../categories/ubuntu/" rel="tag">ubuntu</a></li>
<li><a class="tag p-category" href="../../categories/upgrading/" rel="tag">upgrading</a></li>
<li><a class="tag p-category" href="../../categories/virtualfish/" rel="tag">virtualfish</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../fish-links/" rel="prev" title="Fish Links">Previous post</a></li>
<li class="next"><a href="../protonpass-finding-the-suggested-password/" rel="next" title="ProtonPass: Finding the Suggested Password">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbled by the <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
