<html><body><div class="document" id="mock-a-file"><div class="section" id="creating-the-readable-mock"><h4>Creating The Readable Mock</h4>To mock a file you can use <cite>StringIO</cite> and an input string. Since the <cite>StringIO</cite> will only traverse once (like a regular file) it might be convenient to make a mock builder.  <br><div class="highlight"><pre><span class="k">def</span> <span class="nf">mock_open</span><span class="p">(</span><span class="n">data_string</span><span class="p">):</span><br>    <span class="n">mock_file</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="nb">file</span><span class="p">)</span><br>    <span class="n">mock_file</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">data_string</span><span class="p">)</span><br>    <span class="k">return</span> <span class="n">mock_file</span><br></pre></div></div><div class="section" id="using-the-mock"><h4>Using the Mock</h4>To use the mock you patch the built-in <cite>open</cite> function.</div><div class="highlight"><pre><span class="n">opened</span> <span class="o">=</span> <span class="n">mock_file()</span><br><br><span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s">'__builtin__.open'</span><span class="p">,</span> <span class="n">opened</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span><br>    <span class="n">run_tests_here</span><span class="p">()</span><br></pre></div><div class="section" id="checking-the-mock"><h4>Checking the Mock</h4>To see if the file was opened correctly:<br><pre class="code python literal-block"><span class="n">opened</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">r_or_w</span><span class="p">)</span><br></pre>To check write calls look at <cite>opened.write.mock_calls</cite>.</div></div></body></html>