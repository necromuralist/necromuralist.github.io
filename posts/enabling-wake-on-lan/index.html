<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to enable Wake-On-LAN in Ubuntu.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Enabling Wake-On-LAN (In Ubuntu 20.10) | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/posts/enabling-wake-on-lan/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="manifest" href="../../site.webmanifest">
<meta name="author" content="Cloistered Monkey">
<link rel="prev" href="../bib-the-kekule-problem/" title="Bib: The Kekule Problem" type="text/html">
<link rel="next" href="../mount-an-encrypted-drive-using-cryptsetup/" title="Mount An Encrypted Drive Using cryptsetup" type="text/html">
<meta property="og:site_name" content="The Cloistered Monkey">
<meta property="og:title" content="Enabling Wake-On-LAN (In Ubuntu 20.10)">
<meta property="og:url" content="https://necromuralist.github.io/posts/enabling-wake-on-lan/">
<meta property="og:description" content="How to enable Wake-On-LAN in Ubuntu.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-11-28T17:57:35-08:00">
<meta property="article:tag" content="networking">
<meta property="article:tag" content="ubuntu">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">The Cloistered Monkey</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/Bowling-For-Data/" class="dropdown-item">Bowling For Data</a>
                    <a href="https://necromuralist.github.io/Anechoic-Echolalia/" class="dropdown-item">Anechoic Echolalia</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/student_intervention/" class="dropdown-item">Student Intervention Project</a>
                    <a href="https://necromuralist.github.io/boston_housing/" class="dropdown-item">Boston Housing Project</a>
                    <a href="https://necromuralist.github.io/data_science/" class="dropdown-item">Data Science With Python</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<!-- 
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
-->
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/">
</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Enabling Wake-On-LAN (In Ubuntu 20.10)</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-11-28T17:57:35-08:00" itemprop="datePublished" title="2020-11-28 17:57">2020-11-28 17:57</time><span class="updated"> (updated
                    <time class="updated dt-updated" datetime="2020-12-06T15:14:00-08:00" itemprop="dateUpdated" title="2020-12-06 15:14">2020-12-06 15:14</time>)</span>
            </a>
            </p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0e5e1c3">Beginning</a></li>
<li>
<a href="#org9241b86">Middle</a>
<ul>
<li><a href="#orgbf59437">Ethtool</a></li>
<li><a href="#orgea2f140">Checking the Interface</a></li>
<li><a href="#orgd8c6d7e">Turn It On Temporarily</a></li>
<li><a href="#org3aad86d">Test It Out</a></li>
<li><a href="#orgaaf943a">Take Two</a></li>
<li><a href="#org6b734d2">Making It Permanent</a></li>
</ul>
</li>
<li><a href="#org4820a25">End</a></li>
</ul>
</div>
</div>

<p>
<b><b>Note:</b></b> The systemd configuration here isn't quite right, but since this post is kind of long and convoluted I made a standalone update about the systemd configuration file in <a href="../using-systemd-to-enable-wake-on-lan/">this post</a>.
</p>

<div id="outline-container-org0e5e1c3" class="outline-2">
<h2 id="org0e5e1c3">Beginning</h2>
<div class="outline-text-2" id="text-org0e5e1c3">
<p>
These are my notes on getting <a href="https://en.wikipedia.org/wiki/Wake-on-LAN">Wake-On-LAN</a> working in Ubuntu 20.10. I have a server that I use to run most of the computation on when I use emacs/jupyter but I have it in a corner upstairs and although it's only a little walk, I find that the fact that I have to stop what I'm doing and go upstairs to push that little button on the front makes me lazy and so it ends up running more than it has to so I thought I'd enable Wake-On-LAN so I can suspend it and wake it up whenever I need to. I'm only going to use suspend (<a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">APM</a> S3). When I tried to use hibernate (S4) it ended up shutting down my machine (S5). Interestingly, my BIOS menu has an option to enable waking up from shutdown, but since my disk is encrypted, and I didn't set up a separate SSH server, I have to go enter the passphrase to unlock the disk before the operating system can boot up, so it kind of defeats its own purpose.
</p>
</div>
</div>
<div id="outline-container-org9241b86" class="outline-2">
<h2 id="org9241b86">Middle</h2>
<div class="outline-text-2" id="text-org9241b86">
</div>
<div id="outline-container-orgbf59437" class="outline-3">
<h3 id="orgbf59437">Ethtool</h3>
<div class="outline-text-3" id="text-orgbf59437">
<p>
The command I used to set up Wake-On-LAN on the remote machine is called <a href="https://en.wikipedia.org/wiki/Ethtool">ethtool</a>. It's in the Ubuntu repositories but wasn't installed on my machine so I had to add it.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
</module>
</div>
</div>
<div id="outline-container-orgea2f140" class="outline-3">
<h3 id="orgea2f140">Checking the Interface</h3>
<div class="outline-text-3" id="text-orgea2f140">
<p>
From what I've read, not all ethernet interfaces support Wake-On-LAN (although I've never seen one that doesn't) so a quick check might be useful. First, find the name of your ethernet interface.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
My machine shows four interfaces so I'll just show the output for the interface I'm interested in rather than the whole output for the command.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Ethtool uses the name of the interface, in this case it's <code>enp4s0</code>, so we'll need to note that. Additionally, the machine that I used to wake up the machine needs the MAC address (<code>38:d5:47:79:ab:0b</code>) so it'd be useful to write that down someplace. I'm waking it up from the LAN so the IP address isn't so important, and to be able to SSH into it I need to know it anyway, so it's really those two pieces of information that I need. Now to check if it supports Wake-On-LAN.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Ethtool will give you some information if you don't run it as root but for Wake-On-LAN you need to run it as root. The important lines in the output is near the bottom and it looks something like this if it supports Wake-On-LAN.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
The man-page for <code>ethtool</code> tell you what that cryptic <code>pumbg</code> means - the letters are different options that this interface supports for Wake-On-LAN. In this case they are:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">p</td>
<td class="org-left">Wake on PHY activity</td>
</tr>
<tr>
<td class="org-left">u</td>
<td class="org-left">Wake on unicast messages</td>
</tr>
<tr>
<td class="org-left">m</td>
<td class="org-left">Wake on multicast messages</td>
</tr>
<tr>
<td class="org-left">b</td>
<td class="org-left">Wake on broadcast messages</td>
</tr>
<tr>
<td class="org-left">g</td>
<td class="org-left">Wake on MagicPacket messages</td>
</tr>
</tbody>
</table>
<p>
There's an additional option which is what the interface was set on – <code>d</code> – as you can see in the last line of the output. This means <i>Disable (wake on nothing).  This option clears all previous options.</i> I don't have many devices on my network, so I don't know that there's a lot of broadcasts, multicasts, etc. that would be waking it up all the time, but since one feature of Wake-On-LAN is that it only wakes the machine when it gets the "Magic Packet", only the <code>g</code> and <code>d</code> options matter. Now that I knew it was supported, it was time to try it out.
</p>
</module></module></module></module>
</div>
</div>

<div id="outline-container-orgd8c6d7e" class="outline-3">
<h3 id="orgd8c6d7e">Turn It On Temporarily</h3>
<div class="outline-text-3" id="text-orgd8c6d7e">
<p>
The <code>ethtool</code> will turn on Wake-On-LAN, but (supposedly) everytime you reboot the machine it will reset to disabled. I haven't really tested this out, but I'll document how to make it permanent later, anyway.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
So, as you might guess, we changed the Wake-On-LAN setting to listen for MagicPacket messages. You can check using the ethtool again.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
The <code>Wake-on</code> line should have changed to:
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Now to suspend the machine so we can test it out.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
</module></module></module></module>
</div>
</div>
<div id="outline-container-org3aad86d" class="outline-3">
<h3 id="org3aad86d">Test It Out</h3>
<div class="outline-text-3" id="text-org3aad86d">
<p>
Now, on my local machine I needed to install <a href="https://github.com/jpoliv/wakeonlan">wakeonlan</a>. There's a surprising number of programs to send the Magic Packet, but this just happened to be the one I used.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
The default way to use <code>wakeonlan</code> is apparently to just pass it the MAC address of the computer to wake up, and it will send the Magic Packet out as a broadcast, so that's what I did.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
And then I pinged the machine and I waited. And I waited. And I waited… Eventually I went upstairs and saw that it was still sleeping so I pushed the power button to wake it up and went back downstairs.
</p>
</module></module>
</div>
</div>
<div id="outline-container-orgaaf943a" class="outline-3">
<h3 id="orgaaf943a">Take Two</h3>
<div class="outline-text-3" id="text-orgaaf943a">
<p>
Something wasn't right so I SSHd into the server and started up <a href="https://www.tcpdump.org/">tcpdump</a> to see if the packets were going through.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Which gave me this output:
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
And then I sent the Magic Packet again.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
…And nothing happened. For some reason the packets weren't getting picked up by the machine. Luckily, <code>wakeonlan</code> lets you pass in an IP address as an option. The man page recommends using a broadcast address, but I have the IP addresses of my machines on the LAN reserved on my router/access-point so I just passed in the full address (I did try the LAN broadcast and it worked too).
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
I have my machine's IP address aliased in my <code>/etc/hosts</code> file so <code>erebus</code> is just an alias for the machine's IP address. The subnet broadcast version looked like this.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
The output from <code>tcpdump</code> for the first packet looked like this.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
So, something was different. I suspended the machine again and sent the Magic Packet and this time it worked. Go figure.
</p>
</module></module></module></module></module></module>
</div>
</div>

<div id="outline-container-org6b734d2" class="outline-3">
<h3 id="org6b734d2">Making It Permanent</h3>
<div class="outline-text-3" id="text-org6b734d2">
</div>
<div id="outline-container-org2e361b5" class="outline-4">
<h4 id="org2e361b5">Set It Up</h4>
<div class="outline-text-4" id="text-org2e361b5">
<p>
The reasons that I said earlier that the Wake-On-LAN setting "supposedly" is temporary is that:
</p>
<ol class="org-ol">
<li>I haven't really re-booted that machine to test it out (I have rebooted, but I haven't disable the <a href="https://en.wikipedia.org/wiki/Systemd">systemd</a> service that I'm documenting here).</li>
<li>The machine that I'm typing this on had Wake-On-LAN enabled and it doesn't have a <code>systemd</code> service enabled.</li>
</ol>
<p>
But, really, I don't remember even enabling Wake-On-LAN on this machine so maybe it just was the default and I didn't realise it… another thing I should look into one of these days. Anyway, to make a service that always enables Wake-On-LAN the first step is to find the path to <code>ethertool</code>.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
In my case the path was <code>/sbin/ethtool</code>, so once you know this you can create a file at <code>/etc/systemd/system/wol.service</code> (I think you can use another systemd sub-folder, and you can name the file anything you want, within reason, but this one seems to work well enough). In this file you put settings that look something like this:
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
The only thing specific to my machine is <code>enp4s0</code>, the name of the ethernet interface, although it's possible that the path to the <code>ethtool</code> executable might be different too… but it should be the same on Ubuntu 20.10, anyway.
</p>
</module></module>
</div>
</div>

<div id="outline-container-orgfa06e14" class="outline-4">
<h4 id="orgfa06e14">Enable The Service</h4>
<div class="outline-text-4" id="text-orgfa06e14">
<p>
To enable it you can do this:
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Where <code>wol.service</code> is the name of the file you created with the settings. You can check its status if you want.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
And that's that.
</p>
</module></module>
</div>
</div>
</div>
</div>
<div id="outline-container-org4820a25" class="outline-2">
<h2 id="org4820a25">End</h2>
<div class="outline-text-2" id="text-org4820a25">
<p>
So, that's how I got one machine working with Wake-On-LAN. Hopefully I won't have to look so hard the next time. Here's the pages that I stole this from.
</p>

<ul class="org-ul">
<li>
<a href="https://www.techrepublic.com/article/how-to-enable-wake-on-lan-in-ubuntu-server-18-04/">TechRepublic</a> on using <code>ethtool</code> and setting up a <code>systemd</code> service for this (don't use the systemd file here, though).</li>
<li>
<a href="https://askubuntu.com/questions/1792/how-can-i-suspend-hibernate-from-command-line">Stack Overflow</a> on how to suspend and hibernate from the command-line</li>
<li>
<a href="https://askubuntu.com/questions/3369/what-is-the-difference-between-hibernate-and-suspend">Stack Overflow</a> on what the difference is between suspend and hibernate</li>
<li>
<a href="https://unix.stackexchange.com/questions/318137/wake-on-lan-not-working-on-ubuntu-16-04">Stack Overflow</a> on using <code>tcpdump</code> to look for the Magic Packets on the remote machine</li>
<li>
<a href="https://stackoverflow.com/questions/2177687/open-file-via-ssh-and-sudo-with-emacs">Stack Overflow</a> on editing remote files as root with emacs (not documented here, but maybe later)</li>
<li>
<a href="https://stackoverflow.com/questions/95631/open-a-file-with-su-sudo-inside-emacs">Stack Overflow</a> on editing a local file as root with emacs (not used here, but I can never remember the syntax)</li>
</ul>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/networking/" rel="tag">networking</a></li>
            <li><a class="tag p-category" href="../../categories/ubuntu/" rel="tag">ubuntu</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../bib-the-kekule-problem/" rel="prev" title="Bib: The Kekule Problem">Previous post</a>
            </li>
            <li class="next">
                <a href="../mount-an-encrypted-drive-using-cryptsetup/" rel="next" title="Mount An Encrypted Drive Using cryptsetup">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2023         <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
