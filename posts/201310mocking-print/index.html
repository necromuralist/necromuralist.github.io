<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Mocking Print | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/posts/201310mocking-print/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/latest.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<meta content="Cloistered Monkey" name="author">
<link href="../201310argparse-and-argument-parser/" rel="prev" title="argparse and the Argument Parser" type="text/html">
<link href="../201411installing-python-package-for-single/" rel="next" title="Installing a Python Package for a Single User" type="text/html">
<meta content="The Cloistered Monkey" property="og:site_name">
<meta content="Mocking Print" property="og:title">
<meta content="https://necromuralist.github.io/posts/201310mocking-print/" property="og:url">
<meta content="BackgroundI wanted to check to make sure I was sending the right output to the screen so I thought I would use mock to catch what I was sending to it. These are some notes about what happened.Mocking" property="og:description">
<meta content="article" property="og:type">
<meta content="2013-10-05T22:48:00-07:00" property="article:published_time">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/In-Too-Deep/">In Too Deep (Neural Networks)</a> <a class="dropdown-item" href="../../machine-learning-projects/">Machine Learning</a> <a class="dropdown-item" href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/data_science/">Data Science With Python</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.src.html" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Mocking Print</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="../../authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2013-10-05T22:48:00-07:00" itemprop="datePublished" title="2013-10-05 22:48">2013-10-05 22:48</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.src.html">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div class="document" id="mocking-print">
<div class="section" id="background">
<h4>Background</h4>
<p>I wanted to check to make sure I was sending the right output to the screen so I thought I would use <a class="reference external" href="https://pypi.python.org/pypi/mock">mock</a> to catch what I was sending to it. These are some notes about what happened.</p>
</div>
<div class="section" id="id1">
<h4>Mocking print</h4>
<p>If you try to <a class="reference external" href="http://www.voidspace.org.uk/python/mock/getting-started.html#patch-decorators">patch</a> <tt class="docutils literal">print</tt> with MagicMock, here is what you get.</p>
<pre class="literal-block"><br>from mock import MagicMock, patch, call<br><br>mock_print = MagicMock()<br>try:<br>    with patch('print', mock_print):<br>        print 'test'<br>except TypeError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Need a valid target to patch. You supplied: 'print'<br></pre>
<p>So it looks like 'print' is not the right thing to patch. Maybe you need to call it a built-in funtion:</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print 'test'<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>What if you call it as a function?</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print( 'test')<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>So neither of those raise an error, but they also do not manage to mock <tt class="docutils literal">print</tt>. Well, if you look at the description for <a class="reference external" href="http://docs.python.org/2/library/functions.html#print">print</a>, it turns out that the print function has the signature:</p>
<pre class="literal-block"><br>print(*objects, sep=' ', end='\n', file=sys.stdout)<br></pre>
<p>It also says that the function call is not normally available unless you import it from the future.</p>
<p>But, presuming that the print statement works the same way as the function call, what happens if you mock <tt class="docutils literal">sys.stdout</tt>?</p>
</div>
<div class="section" id="mocking-sys-stdout">
<h4>Mocking sys.stdout</h4>
<p>This doesn't answer the question of why I can't mock print directly, but maybe mocking <tt class="docutils literal">sys.stdout</tt> will work instead.</p>
<pre class="literal-block"><br>with patch('sys.stdout', mock_print):<br>    print 'test'<br><br>expected = [call('test')]<br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Expected: [call('test')] Actual: [call.write('test'), call.write('\n')]<br></pre>
<p>It looks like the mock works this time, but it did not return what I was expecting -- <tt class="docutils literal">print</tt> makes two calls to <tt class="docutils literal">stdout.write</tt>, the first is the string you pass it which it then follows with a newline character. Given this slightly more complete understanding of <tt class="docutils literal">print</tt>:</p>
<pre class="literal-block"><br># create some output to send to print<br>lines = "a b c".split()<br><br># reset the mock so the previous calls are gone<br>mock_print.reset_mock()<br>with patch('sys.stdout', mock_print):<br>    for line in lines:<br>        print line<br><br>expected = []<br>for line in lines:<br>    expected.append(call.write(line))<br>    expected.append(call.write('\n'))<br><br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre></div>
<div class="section" id="conclusion">
<h4>Conclusion</h4>
<p>Not earth-shattering, but I thought it was interesting that even after using Python for years, something as basic as <tt class="docutils literal">print</tt> can yield something new if looked at more closely. It was also useful to see how mock can be used to discover the calls that are being made on an object, not just to test that expected calls are being made.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="pager hidden-print">
<li class="previous"><a href="../201310argparse-and-argument-parser/" rel="prev" title="argparse and the Argument Parser">Previous post</a></li>
<li class="next"><a href="../201411installing-python-package-for-single/" rel="next" title="Installing a Python Package for a Single User">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents Â© 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js">
</script><!-- fancy dates -->
<script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
</script><!-- end fancy dates -->
<script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
