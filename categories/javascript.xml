<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>The Cloistered Monkey (Posts about javascript)</title><link>https://necromuralist.github.io/</link><description></description><atom:link href="https://necromuralist.github.io/categories/javascript.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2020 &lt;a href="mailto:necromuralist@protonmail.com"&gt;Cloistered Monkey&lt;/a&gt; </copyright><lastBuildDate>Thu, 06 Aug 2020 04:24:24 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>A Random Walk(er)</title><link>https://necromuralist.github.io/posts/a-random-walker/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/a-random-walker/#org3aa7e08"&gt;Beginning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/a-random-walker/#org98ca249"&gt;Middle&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/a-random-walker/#org91a5694"&gt;A Div to Locate the Sketch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/a-random-walker/#orgd58da2c"&gt;The Javascript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/a-random-walker/#org448238a"&gt;End&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3aa7e08" class="outline-2"&gt;
&lt;h2 id="org3aa7e08"&gt;Beginning&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org3aa7e08"&gt;
&lt;p&gt;
This is another post to see if I understand how to get &lt;a href="https://p5js.org/"&gt;p5.js&lt;/a&gt; working in nikola. It's been a while since I tried and I just want to see if I remember how. This uses the random walk example from Daniel Schiffman's book &lt;i&gt;the Nature of Code&lt;/i&gt;.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org98ca249" class="outline-2"&gt;
&lt;h2 id="org98ca249"&gt;Middle&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org98ca249"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org91a5694" class="outline-3"&gt;
&lt;h3 id="org91a5694"&gt;A Div to Locate the Sketch&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org91a5694"&gt;
&lt;p&gt;
The id of this div is set in the &lt;code&gt;p5.js&lt;/code&gt; &lt;code&gt;setup&lt;/code&gt; function as the parent of the sketch.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;script language="javascript" type="text/javascript" src="walker.js"&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;div id="random-walk-container"&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;script language="javascript" type="text/javascript" src="https://necromuralist.github.io/posts/a-random-walker/walker.js"&gt;&lt;/script&gt;
&lt;div id="random-walk-container"&gt;
&lt;/div&gt;

&lt;p&gt;
&lt;b&gt;Note:&lt;/b&gt; Originally this wasn't working, because I had the line to include the javascript inside the &lt;code&gt;div&lt;/code&gt; to hold the canvas. Make sure that &lt;code&gt;div&lt;/code&gt; is always empty.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgd58da2c" class="outline-3"&gt;
&lt;h3 id="orgd58da2c"&gt;The Javascript&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgd58da2c"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;let sketch = function(p) {
    p.setup = function() {
	let parent_div_id = "random-walk-container";
	this.canvas = p.createCanvas($("#" + parent_div_id).outerWidth(true), 300);
	this.canvas.parent();
	p.walker = new Walker(p);
    }

    p.draw = function() {
	p.background(255);
	p.walker.walk();
	p.walker.display();
    }
};

function Walker(p) {
  this.x = p.width/2;
  this.y = p.height/2;

  this.walk = function() {
    this.x = this.x + p.random(-1, 1) * 10;
    this.y = this.y + p.random(-1, 1) * 10;
  }

  this.display = function() {
    p.fill(0);
    p.ellipse(this.x, this.y, 48, 48);
  }
}

//let node = document.getElementById("random-walk")
//window.document.getElementsByTagName("body")[0].appendChild(node);
sketch_container = new p5(sketch, 'random-walk-container');
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org448238a" class="outline-2"&gt;
&lt;h2 id="org448238a"&gt;End&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org448238a"&gt;
&lt;p&gt;
As always, this was way harder than it should have been.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>javascript</category><category>p5.js</category><category>processing</category><guid>https://necromuralist.github.io/posts/a-random-walker/</guid><pubDate>Sun, 21 Jul 2019 19:29:09 GMT</pubDate></item><item><title>Headless Firefox with Karma</title><link>https://necromuralist.github.io/posts/headless-firefox-with-karma/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="outline-container-orgc46c58a" class="outline-2"&gt;
&lt;h2 id="orgc46c58a"&gt;Introduction&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgc46c58a"&gt;
&lt;p&gt;
I recently started revisiting some &lt;a href="https://vuejs.org/"&gt;vue.js&lt;/a&gt; code that I was working on at work and when I ran the unit-tests all of them failed with pretty much the same error.
&lt;/p&gt;

&lt;pre class="example"&gt;
actual.should.equal is not a function. (In 'actual.should.equal(expected)', 'actual.should.equal' is an instance of ProxyObject)
&lt;/pre&gt;

&lt;p&gt;
I'm using the &lt;a href="http://www.chaijs.com/guide/styles/#should"&gt;chai BDD 'should'&lt;/a&gt; style of testing, so this &lt;i&gt;should&lt;/i&gt; have worked (because it was working before). To debug it I ran it with FireFox and when I did, all the tests mysteriously started working. It turns out I was using &lt;a href="http://phantomjs.org/"&gt;PhantomJS&lt;/a&gt;, which &lt;a href="https://github.com/ariya/phantomjs/issues/15344"&gt;has been abandoned&lt;/a&gt;, and somewhere along the line something in chai stopped working with it, so I decided to set up Firefox headless as my browser instead. This is how I did it.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgb24c118" class="outline-2"&gt;
&lt;h2 id="orgb24c118"&gt;Set Up&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgb24c118"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org6315e14" class="outline-3"&gt;
&lt;h3 id="org6315e14"&gt;Install the plugin&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org6315e14"&gt;
&lt;p&gt;
I already had this installed for debugging, but I'll mention it anyway, for completeness.
&lt;/p&gt;

&lt;pre class="example"&gt;
npm install karma-firefox-launcher --save-dev
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org2e3185e" class="outline-3"&gt;
&lt;h3 id="org2e3185e"&gt;Set it up in Karma&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org2e3185e"&gt;
&lt;p&gt;
I'm running the tests using &lt;a href="https://karma-runner.github.io/2.0/index.html"&gt;karma&lt;/a&gt; and I had hoped that I would just have to change the name of the browser in the configuration, but it turns out to need a little setup in the &lt;code&gt;karma.conf.js&lt;/code&gt; file. First get rid of the &lt;code&gt;PhantomJS&lt;/code&gt; reference. Delete this:
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;browsers: ['PhantomJS'],
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
and replace it with this.
&lt;/p&gt;

&lt;pre class="example"&gt;
browsers: ['FirefoxHeadless'],
&lt;/pre&gt;

&lt;p&gt;
The &lt;code&gt;FirefoxHeadless&lt;/code&gt; browser isn't actually defined, so you have to add it (I put it right after the &lt;code&gt;browsers&lt;/code&gt; declaration).
&lt;/p&gt;

&lt;pre class="example"&gt;
customLaunchers: {
      'FirefoxHeadless': {
        base: 'Firefox',
        flags: [
          '-headless',
        ],
      }
    },
&lt;/pre&gt;

&lt;p&gt;
This tells karma to run &lt;code&gt;firefox&lt;/code&gt; and pass in the &lt;code&gt;-headless&lt;/code&gt; flag, as shown in the Mozilla documentation about &lt;a href="https://developer.mozilla.org/en-US/Firefox/Headless_mode#Using_headless_mode"&gt;firefox's headless mode&lt;/a&gt;. I found out how to do it from &lt;a href="https://stackoverflow.com/questions/46779498/running-karma-tests-in-headless-firefox-browser-not-working-on-jenkins"&gt;a question on Stack Overflow&lt;/a&gt;.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgac02038" class="outline-2"&gt;
&lt;h2 id="orgac02038"&gt;Conclusion&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgac02038"&gt;
&lt;p&gt;
&lt;code&gt;PhantomJS&lt;/code&gt; breaks the Chai's BDD style of testing, but since both Firefox and &lt;a href="https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md"&gt;Chrome&lt;/a&gt; have headless modes, using them instead makes it work without actually needing to have the GUI launch.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>javascript</category><category>karma</category><category>testing</category><guid>https://necromuralist.github.io/posts/headless-firefox-with-karma/</guid><pubDate>Thu, 21 Jun 2018 20:23:31 GMT</pubDate></item></channel></rss>