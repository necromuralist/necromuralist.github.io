<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>The Cloistered Monkey (Posts about XML)</title><link>https://necromuralist.github.io/</link><description></description><atom:link href="https://necromuralist.github.io/categories/cat_xml.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2023 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;Cloistered Monkey&lt;/a&gt; </copyright><lastBuildDate>Thu, 04 May 2023 00:33:49 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>XML To Pandas</title><link>https://necromuralist.github.io/posts/xml-to-pandas/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#orgf8ce94f"&gt;Beginning&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#orgd731d06"&gt;Imports&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org9d328c5"&gt;Set Up&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#orgd37e367"&gt;Middle&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org3b3a8ab"&gt;The XML&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org6e01c28"&gt;To a DataFrame&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org016817d"&gt;Save It&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org1fa61a8"&gt;End&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/xml-to-pandas/#org1f622d9"&gt;Time Series&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgf8ce94f" class="outline-2"&gt;
&lt;h2 id="orgf8ce94f"&gt;Beginning&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgf8ce94f"&gt;
&lt;p&gt;
I went to the &lt;a href="https://www.ssa.gov/"&gt;Social Security website&lt;/a&gt; to change my password (I had forgotten it so they mailed a temporary one to me) and noticed that they have your yearly reported earnings both as a PDF and as a data download. Unfortunately the data is given as an XML file instead of a CSV (it has more than just the earnings data, so it would have to be a series of CSVs instead of one file) so these are my notes on converting it to a pandas DataFrame using &lt;a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/"&gt;BeautifulSoup&lt;/a&gt;.
&lt;/p&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgd731d06" class="outline-3"&gt;
&lt;h3 id="orgd731d06"&gt;Imports&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgd731d06"&gt;
&lt;p&gt;
To actually do the conversion you only need BeautifulSoup and pandas, all the rest of the stuff comes into play because I'm making a post.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org9d328c5" class="outline-3"&gt;
&lt;h3 id="org9d328c5"&gt;Set Up&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org9d328c5"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org861041b" class="outline-4"&gt;
&lt;h4 id="org861041b"&gt;The Dotenv&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org861041b"&gt;
&lt;p&gt;
I'm using a &lt;code&gt;.env&lt;/code&gt; file to point to the location of the file so this call will load it.
&lt;/p&gt;
Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgc265226" class="outline-4"&gt;
&lt;h4 id="orgc265226"&gt;The Plotting&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-orgc265226"&gt;
&lt;p&gt;
This is just a central place to set up some constants so I don't have to re-type them or hunt around for them if I want to change things.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org35db19a" class="outline-4"&gt;
&lt;h4 id="org35db19a"&gt;The Random Seed&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org35db19a"&gt;
&lt;p&gt;
I decided since I'm talking about social security stuff I'd make at least some attempt at obfuscating things so I'm adding a random offset to the years.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgd37e367" class="outline-2"&gt;
&lt;h2 id="orgd37e367"&gt;Middle&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgd37e367"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3b3a8ab" class="outline-3"&gt;
&lt;h3 id="org3b3a8ab"&gt;The XML&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org3b3a8ab"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org00e42bb" class="outline-4"&gt;
&lt;h4 id="org00e42bb"&gt;Loading It&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org00e42bb"&gt;
&lt;p&gt;
First, I'll load the XML into BeautifulSoup.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;p&gt;
Note that you have to pass in the &lt;code&gt;"xml"&lt;/code&gt; argument - BeautifulSoup is primarily an HTML parser so it assumes an HTML document by default. Normally I'd do some exploring at this point, but I didn't find it such an easy thing to do (I don't work with XML data generally) and found that it was easier to look at it with &lt;a href="https://www.wikiwand.com/en/Less_(Unix)"&gt;less&lt;/a&gt; and figure out what I needed.
&lt;/p&gt;
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3706435" class="outline-4"&gt;
&lt;h4 id="org3706435"&gt;The Earnings&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org3706435"&gt;
&lt;p&gt;
The data I wanted is in a set of tags that look like this:
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;p&gt;
This set represents what was collected in 1998 - $526 for Social Security and Medicare (FICA stands for &lt;a href="https://www.wikiwand.com/en/Federal_Insurance_Contributions_Act_tax"&gt;Federal Insurance Contributions Act&lt;/a&gt; and is the name of the tax that funds Social Security). Yes, I only made $526 in 1998 because I was a teenager working a part-time job taking store inventories - still, I can't believe how little I got paid…
&lt;/p&gt;

&lt;p&gt;
Anyway, so the first thing to do is to grab all the nodes representing earning.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
34
&amp;lt;osss:Earnings endYear="1998" startYear="1998"&amp;gt;
&amp;lt;osss:FicaEarnings&amp;gt;526&amp;lt;/osss:FicaEarnings&amp;gt;
&amp;lt;osss:MedicareEarnings&amp;gt;526&amp;lt;/osss:MedicareEarnings&amp;gt;
&amp;lt;/osss:Earnings&amp;gt;
&lt;/pre&gt;
&lt;/module&gt;&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org10ef338" class="outline-4"&gt;
&lt;h4 id="org10ef338"&gt;The Years&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org10ef338"&gt;
&lt;p&gt;
Now that we have the earnings, we can see about getting the years. Although they have &lt;code&gt;endYear&lt;/code&gt; and &lt;code&gt;startYear&lt;/code&gt; they're always the same so I'll use &lt;code&gt;startYear&lt;/code&gt;. I'm adding the &lt;code&gt;OFFSET&lt;/code&gt; here just to obfuscate what years I'm looking at.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
1998
1999
2000
2001
2002
&lt;/pre&gt;
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgf534531" class="outline-4"&gt;
&lt;h4 id="orgf534531"&gt;Collected&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-orgf534531"&gt;
&lt;p&gt;
Next I'll see about grabbing the amounts collected for each year. The FICA and Medicare amounts are always the same so I'll just use the FICA amount.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
526
1123
1546
0
0
&lt;/pre&gt;


&lt;p&gt;
That looks right. It drops to 0 because I went to college and started working on campus and since I went to a state university they didn't collect FICA. 
&lt;/p&gt;
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org6e01c28" class="outline-3"&gt;
&lt;h3 id="org6e01c28"&gt;To a DataFrame&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org6e01c28"&gt;
&lt;p&gt;
Anyway, that's basically all you need to get it going.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
   offset  amount
0    1998     526
1    1999    1123
2    2000    1546
3    2001       0
4    2002       0
&lt;/pre&gt;
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org016817d" class="outline-3"&gt;
&lt;h3 id="org016817d"&gt;Save It&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org016817d"&gt;
Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org1fa61a8" class="outline-2"&gt;
&lt;h2 id="org1fa61a8"&gt;End&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org1fa61a8"&gt;
&lt;p&gt;
I usually like to put in a little plotting so I'm going to plot the amount over time. Since I already shared my first five years I'm going to start after that and obscure the numbers a little.
&lt;/p&gt;
&lt;/div&gt;


&lt;div id="outline-container-org1f622d9" class="outline-3"&gt;
&lt;h3 id="org1f622d9"&gt;Time Series&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org1f622d9"&gt;
&lt;p&gt;
First I'll add the offset year back in, then I'm going to scale it.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;object type="text/html" data="https://necromuralist.github.io/posts/xml-to-pandas/income_over_time.html" style="width:100%" height="800"&gt;
  &lt;p&gt;Figure Missing&lt;/p&gt;
&lt;/object&gt;

&lt;p&gt;
Well, there you go. Since I'm adding a random offset to the years I removed the x-axis labels, but the plot starts out with me still working for the State, so there's no reported income, then there's an uptick when I took a retail job, then a drop again when I went back to school for a little while to look into getting a design degree, then there's another uptick when I gave up on the design degree and went to work as a clerk for a real estate office, then the next drop comes when I went back to get a Computer Science degree and the rising after that shows the difference between working retail/clerical versus being a computer programmer, with the two plateaus representing the two companies I've worked for.
&lt;/p&gt;
&lt;/module&gt;&lt;/module&gt;&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>beautiful soup</category><category>pandas</category><category>xml</category><guid>https://necromuralist.github.io/posts/xml-to-pandas/</guid><pubDate>Sun, 12 Jul 2020 23:24:26 GMT</pubDate></item></channel></rss>