<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A common place." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>The Cloistered Monkey</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/" rel="canonical">
<link href="index-14.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/latest.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js" type="text/javascript"></script>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link href="/posts/linear-regression-and-binary-data/" rel="prefetch" type="text/html">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="/"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="/machine-learning-projects/">Machine Learning</a> <a class="dropdown-item" href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/data_science/">Data Science With Python</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/linear-regression-and-binary-data/">Linear Regression and Binary Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/linear-regression-and-binary-data/" rel="bookmark"><time class="published dt-published" datetime="2020-08-01T17:31:46-07:00" itemprop="datePublished" title="2020-08-01 17:31">2020-08-01 17:31</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/linear-regression-and-binary-data/#orgef033e1">Beginning</a>
<ul>
<li><a href="/posts/linear-regression-and-binary-data/#orga15a01c">Set Up</a></li>
</ul>
</li>
<li><a href="/posts/linear-regression-and-binary-data/#org84a7073">Middle</a>
<ul>
<li><a href="/posts/linear-regression-and-binary-data/#org17df850">The Data</a></li>
<li><a href="/posts/linear-regression-and-binary-data/#org8dcd8eb">Encode the Gender</a></li>
<li><a href="/posts/linear-regression-and-binary-data/#orgbfd88e8">Fit the Regression</a></li>
</ul>
</li>
<li><a href="/posts/linear-regression-and-binary-data/#orgce12e79">End</a></li>
<li><a href="/posts/linear-regression-and-binary-data/#orgace7323">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgef033e1">
<h2 id="orgef033e1">Beginning</h2>
<div class="outline-text-2" id="text-orgef033e1">
<p>I'm going to look at binary classification (two classes) and linear regression. In particular I'm going to use the <a href="/posts/bibliography/isl-credit-data-set/">Credit Card Balance</a> data set <a href="/posts/bibliography/an-introduction-to-statistical-learning/">(James et al., 2013)</a> to look at how to interpret the linear model once we encode gender.</p>
</div>
<div class="outline-3" id="outline-container-orga15a01c">
<h3 id="orga15a01c">Set Up</h3>
<div class="outline-text-3" id="text-orga15a01c"></div>
<div class="outline-4" id="outline-container-orgd5eace5">
<h4 id="orgd5eace5">Imports</h4>
<div class="outline-text-4" id="text-orgd5eace5">
<p>First, some importing.</p>
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be_true</span><span class="p">,</span>
    <span class="n">expect</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">statsmodels</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">statsmodels_formula</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">CountPercentage</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5332e1f">
<h4 id="org5332e1f">The Environment</h4>
<div class="outline-text-4" id="text-org5332e1f">
<p>This loads the path to files.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">".env"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgebf0501">
<h4 id="orgebf0501">Plotting</h4>
<div class="outline-text-4" id="text-orgebf0501">
<p>This just sets up some convenience values for plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"linear-regression-and-binary-data"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"PLOT_CONSTANTS"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">Plot</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1b1a088">
<h4 id="org1b1a088">The Data</h4>
<div class="outline-text-4" id="text-org1b1a088">
<p>I downloaded the data from the <a href="https://faculty.marshall.usc.edu/gareth-james/ISL/data.html">ISL Data Set page</a> previously so I'll load it here.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"CREDIT"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<p>I passed in the <code>index_col</code> argument because the first column is a index column with no header, so it just looks goofy if you don't. There are several columns but I only want <code>Gender</code> and <code>Balance</code> (the credit card balance).</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">"Gender"</span><span class="p">,</span> <span class="s2">"Balance"</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org84a7073">
<h2 id="org84a7073">Middle</h2>
<div class="outline-text-2" id="text-org84a7073"></div>
<div class="outline-3" id="outline-container-org17df850">
<h3 id="org17df850">The Data</h3>
<div class="outline-text-3" id="text-org17df850">
<p>Now that we have the data we can take a quick look at what's there.</p>
<div class="highlight">
<pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="n">CountPercentage</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Gender</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">())</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Gender</th>
<th class="org-right" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Female</td>
<td class="org-right">207</td>
<td class="org-right">51.75</td>
</tr>
<tr>
<td class="org-left">Male</td>
<td class="org-right">193</td>
<td class="org-right">48.25</td>
</tr>
</tbody>
</table>
<p>Our two classes are "Female" and "Male" and they are roughly, but not quite, equal in number. Now I'll look at the balance.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"Balance"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Credit Card Balance Distribution by Gender"</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"balance_distributions"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/linear-regression-and-binary-data/balance_distributions.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like there are two populations for each gender. The larger one for both genders is centered near 0 and then both genders have a secondary population that carries a balance.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org8dcd8eb">
<h3 id="org8dcd8eb">Encode the Gender</h3>
<div class="outline-text-3" id="text-org8dcd8eb">
<p>Since the <code>Gender</code> data is categorical we need to create a <i>dummy variable</i> to encode it. So what I'm going to do is encode males as 0 and females as 1 (because of the nature of binary encoding, we could swap the numbers and it would still work).</p>
<div class="highlight">
<pre><span></span><span class="n">gender</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">Male</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">Female</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">"gender"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Gender</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">gender</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
<pre class="example">
1    207
0    193
Name: gender, dtype: int64
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgbfd88e8">
<h3 id="orgbfd88e8">Fit the Regression</h3>
<div class="outline-text-3" id="text-orgbfd88e8">
<p>Now I'll fit the model with <a href="https://www.statsmodels.org/stable/index.html">statsmodels</a>, which uses r-style arguments (I think it supports regular python arguments too).</p>
<div class="highlight">
<pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">statsmodels_formula</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s2">"Balance ~ gender"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
<pre class="example">
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                Balance   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                 -0.002
Method:                 Least Squares   F-statistic:                    0.1836
Date:                Sun, 02 Aug 2020   Prob (F-statistic):              0.669
Time:                        16:55:01   Log-Likelihood:                -3019.3
No. Observations:                 400   AIC:                             6043.
Df Residuals:                     398   BIC:                             6051.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept    509.8031     33.128     15.389      0.000     444.675     574.931
gender        19.7331     46.051      0.429      0.669     -70.801     110.267
==============================================================================
Omnibus:                       28.438   Durbin-Watson:                   1.940
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               27.346
Skew:                           0.583   Prob(JB):                     1.15e-06
Kurtosis:                       2.471   Cond. No.                         2.66
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre>
<p>The model is something like this:</p>
<p>\[ balance = \beta_0 + \beta_1 \times gender \]</p>
<p>Since we encoded Male as 0 and Female as 1, when the gender is Male the second term drops out and all you have is \(\beta_0\), while for females you have have the full equation. How do you interpret the \(\beta\)s?</p>
<ul class="org-ul">
<li>\(\beta_0\) is the average balance that males carry</li>
<li>\(\beta_0 + \beta_1\) is the average balance that females carry</li>
<li>\(\beta_1\) is the difference between the average balances</li>
</ul>
<p>We can check this by comparing the <code>coef</code> entry in the summary table that I printed. The <code>Intercept</code> is \(\beta_0\) and <code>gender</code> is \(\beta_1\)</p>
<div class="highlight">
<pre><span></span><span class="n">male_mean</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Gender</span><span class="o">==</span><span class="s2">"Male"</span><span class="p">]</span><span class="o">.</span><span class="n">Balance</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">female_mean</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Gender</span><span class="o">==</span><span class="s2">"Female"</span><span class="p">]</span><span class="o">.</span><span class="n">Balance</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average Male Balance: </span><span class="si">{</span><span class="n">male_mean</span><span class="si">:</span><span class="s2">.7</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average Female Balance: </span><span class="si">{</span><span class="n">female_mean</span><span class="si">:</span><span class="s2">0.7</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Average difference: </span><span class="si">{</span><span class="n">female_mean</span> <span class="o">-</span> <span class="n">male_mean</span><span class="si">:</span><span class="s2">0.7</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">male_mean</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">Intercept</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">female_mean</span> <span class="o">-</span> <span class="n">male_mean</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">gender</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<pre class="example">
Average Male Balance: 509.8031
Average Female Balance: 529.5362
Average difference: 19.73312
</pre>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"Balance"</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"prediction"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gender</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">scatter</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Balance"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"prediction"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"Gender"</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Gender Model"</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">scatter</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"Gender Model"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<object data="/posts/linear-regression-and-binary-data/Gender%20Model.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>I didn't set up a hypothesis test, but if you look at the p-value (the <code>P&gt;|t|</code> column in the summary) for <code>gender</code> you can see that it's much larger than 0.05 or whatever level you would normally choose, so it's probable that <code>gender</code> isn't significant, so the average balance for both genders is really the same, given the deviation, but this is just about interpreting the coefficients, not deciding the validity of this particular model.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgce12e79">
<h2 id="orgce12e79">End</h2>
<div class="outline-text-2" id="text-orgce12e79">
<p>So there you have it. If you have the specialized case of binary categorical data you can convert the category to <i>dummy variables</i> and then fit a linear regression to it. If you encode the values as <i>0</i> and <i>1</i> then the <i>y-intercept</i> will give you the average output value for the category set to 0 and the <i>slope</i> will give you the difference between the average outputs for the categories. If you use different dummy variables the meanings will change slightly, although you will still be inferring things about the averages. Why is this interesting - predicting the mean for each category?</p>
<p>Logistic regression also relies on dummy variables for categorical encodings and this shows a preliminary step that helps us:</p>
<ul class="org-ul">
<li>encode the dummy variables</li>
<li>build a linear model using statsmodels</li>
<li>view summary information about the model</li>
</ul>
<p>I didn't emphasize it, but the p-value for the f-statistic might be valuable when deciding whether the categorical data is different enough to use as a feature.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgace7323">
<h2 id="orgace7323">Sources</h2>
<div class="outline-text-2" id="text-orgace7323">
<ul class="org-ul">
<li><a href="/posts/bibliography/an-introduction-to-statistical-learning/">An Introduction To Statistical Learning</a></li>
<li><a href="/posts/bibliography/isl-credit-data-set/">ISL Credit Data Set</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/step-one-get-the-behavior/">Step One: Get the Behavior</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/step-one-get-the-behavior/" rel="bookmark"><time class="published dt-published" datetime="2020-07-31T15:41:00-07:00" itemprop="datePublished" title="2020-07-31 15:41">2020-07-31 15:41</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="outline-2" id="outline-container-org7eba804">
<h2 id="org7eba804">Note</h2>
<div class="outline-text-2" id="text-org7eba804">
<p>The first step of Clicker Training is "Get your rabbit to do what you want it to do", which seems a little ambiguous when you see it on the list, but it breaks down into four basic categories.</p>
</div>
<div class="outline-3" id="outline-container-orgb89c143">
<h3 id="orgb89c143">Capture Something She Does on Her Own</h3>
<div class="outline-text-3" id="text-orgb89c143">
<p>If you see your rabbit do something that she naturally does, like sit up or come to you at certain times, then click and reward it so you can build it up as something she'll do on cue.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org42c476d">
<h3 id="org42c476d">Lure With Food</h3>
<div class="outline-text-3" id="text-org42c476d">
<p>If your rabbit will take food from your hand you can teach her to go places by having her follow your hand with food in it, although the next category - <i>Follow a Target</i> - is a preferable way to do this.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org21741b6">
<h3 id="org21741b6">Follow a Target</h3>
<div class="outline-text-3" id="text-org21741b6">
<p>Create a target (like a ping-pong ball on the end of a stick) and teach your rabbit to follow it.</p>
<ul class="org-ul">
<li>Start by putting it near her and clicking when she touches it with her nose or mouth</li>
<li>Extend it slowly by moving it away from her and rewarding her when she follows it</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orgff19626">
<h3 id="orgff19626">Shaping</h3>
<div class="outline-text-3" id="text-orgff19626">
<p>The target training follows the <i>shaping</i> pattern, wherein you start by rewarding anything that sort of looks like what you want her to do - like just looking at the target when you show it to her, then progressively extending the behavior needed until it's the one that you want. For example:</p>
<ol class="org-ol">
<li>look at the target</li>
<li>touch the target</li>
<li>follow the target a little</li>
<li>follow the target further</li>
<li>follow the target into her carrier</li>
</ol>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6ab23d1">
<h2 id="org6ab23d1">Source</h2>
<div class="outline-text-2" id="text-org6ab23d1">
<ul class="org-ul">
<li><a href="/posts/bibliography/clicking-with-your-rabbit/">Clicking With Your Rabbit</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/twitter-sentiment-classification-using-distant-supervison/">Twitter Sentiment Classification Using Distant Supervison</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/twitter-sentiment-classification-using-distant-supervison/" rel="bookmark"><time class="published dt-published" datetime="2020-07-31T15:16:27-07:00" itemprop="datePublished" title="2020-07-31 15:16">2020-07-31 15:16</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>This was a project report that looked at using emoticons to create a labeled data set for tweets.</p>
<div class="outline-2" id="outline-container-orge595eb1">
<h2 id="orge595eb1">About the Data</h2>
<div class="outline-text-2" id="text-orge595eb1">
<p>The authors noted that tweets are different from many other sources used for sentiment analysis - things like movie reviews - in that:</p>
<ul class="org-ul">
<li>they are character limited (140 characters at the time of the paper, it has since doubled)</li>
<li>there is a huge amount of data to pull - and it is continuously being generated</li>
<li>there is an unusual amount of slang and non-normal spelling</li>
<li>it isn't subject specific - you can filter using the API, but twitter itself isn't a single-subject service</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org7653134">
<h2 id="org7653134">Using Emoticons as Labels</h2>
<div class="outline-text-2" id="text-org7653134">
<p>The use of emoticons to decide if a tweet is positive, or negative has the benefit of automatically creating a labled dataset, but since they are used as the labels they have to remove them from the training set, removing one of the more useful ways of identifying the tweet sentiment.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org646b59e">
<h2 id="org646b59e">Getting and Cleaning the Data</h2>
<div class="outline-text-2" id="text-org646b59e">
<p>The pulled 100 tweets form the API every 2 minutes until they had 800,000 positive and 800,000 negative tweets (after removing some tweets in pre-processing). The API lets you query by emoticon so the used ":)" to grab positive tweets (the API matches any known equivalent emoticon) and ":(" for negative tweets. They removed re-tweets and duplicates as well as any tweet that had both positive and negative emoticons in them. They then replaced usernames with the token <code>USERNAME</code> and URLs with <code>URL</code> and limited the number of consecutively repeated characters to 2.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/opinion-mining-and-sentiment-analysis/">Opinion Mining and Sentiment Analysis</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/opinion-mining-and-sentiment-analysis/" rel="bookmark"><time class="published dt-published" datetime="2020-07-30T13:12:55-07:00" itemprop="datePublished" title="2020-07-30 13:12">2020-07-30 13:12</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="outline-2" id="outline-container-org7312ab7">
<h2 id="org7312ab7">Note</h2>
<div class="outline-text-2" id="text-org7312ab7">
<p>An <i>opinion</i> is a subjective statement about what a <b>person</b> thinks or believes about <b>something</b>.</p>
<p>There are three basic parts needed to understand an opinion:</p>
<ol class="org-ol">
<li>The opinion holder (<b>person</b>)</li>
<li>The opinion target (<b>something</b>)</li>
<li>The opinion content</li>
</ol>
<p>In addition, to make it meaningful, you can add:</p>
<ul class="org-ul">
<li>The Context of the opinion</li>
<li>The Sentiment of the opinion</li>
</ul>
<p><a href="/posts/bibliography/text-data-management-and-analysis/">(Zhai & Massung, 2016)</a></p>
<p>Sentiment Analysis is a part of Natural Language Processing that looks to transform freeform text into structured data. Opinion is an expression of belief, while sentiment is an expression of feeling. What is sometimes called Sentiment Analysis - the measurement of positive or negative sentiment of a text is really Polarity Classification, a subset of Sentiment Analysis. <a href="/posts/bibliography/sentiment-analysis-in-social-networks/">(Pozzi, Fersini, et al., 2017)</a>.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/memorizing-binaries/">Memorizing Binaries</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/memorizing-binaries/" rel="bookmark"><time class="published dt-published" datetime="2020-07-29T23:41:28-07:00" itemprop="datePublished" title="2020-07-29 23:41">2020-07-29 23:41</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>This is one way that you can memorize binary states - not just binary number, since you can encode the binary states as binary numbers.</p>
<ol class="org-ol">
<li>Encode as bits (e.g. <i>white=0</i>, <i>black=1</i>)</li>
<li>
<p>Arrange the bits into 3x3 grids - 3 bits per row, 3 rows per grid</p>
<p>\[ 000\\ 110\\ 101\\ \]</p>
</li>
<li>
<p>Convert each row to decimal numbers.</p>
<p>\[ 000 = 0\\ 110 = 6\\ 101 = 5\\ \]</p>
</li>
<li>Convert the decimal to a word-image using a system. In the case of the Major System you might get <i>065 = sgl = seagull</i>.</li>
<li>Repeat until you have all the bits covered</li>
<li>Put the images into a Memory Palace, two images per location.</li>
</ol>
<div class="outline-2" id="outline-container-orgf2fb684">
<h2 id="orgf2fb684">Bibliography</h2>
<div class="outline-text-2" id="text-orgf2fb684">
<ul class="org-ul">
<li><a href="/posts/bibliography/mnemonic-alphabet-systems/">Mnemonic Alphabet Systems</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/basics-steps-of-clicker-training/">Basics Steps of Clicker Training</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/basics-steps-of-clicker-training/" rel="bookmark"><time class="published dt-published" datetime="2020-07-29T23:33:37-07:00" itemprop="datePublished" title="2020-07-29 23:33">2020-07-29 23:33</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>These are the basic steps of clicker training.</p>
<ol class="org-ol">
<li>Get your rabbit to do what you want it to do</li>
<li>Click the instant she does it</li>
<li>Reward your rabbit with a treat</li>
<li>Add a cue once she's learned to do it so she knows the name of what she's doing</li>
<li>Gradually fade out the clicks and treats</li>
</ol>
<div class="outline-2" id="outline-container-orgf4157d4">
<h2 id="orgf4157d4">Links</h2>
<div class="outline-text-2" id="text-orgf4157d4">
<ul class="org-ul">
<li><a href="/posts/clicking-basics/">Clicking Basics</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgccaa37a">
<h2 id="orgccaa37a">Source</h2>
<div class="outline-text-2" id="text-orgccaa37a">
<ul class="org-ul">
<li><a href="/posts/bibliography/clicking-with-your-rabbit/">Clicking With Your Rabbit</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/clicking-basics/">Clicking Basics</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/clicking-basics/" rel="bookmark"><time class="published dt-published" datetime="2020-07-29T23:28:21-07:00" itemprop="datePublished" title="2020-07-29 23:28">2020-07-29 23:28</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>The basics ideas of clicker training are:</p>
<ul class="org-ul">
<li>Click at the moment that some desired behavior has happened</li>
<li>Follow every click with a reward</li>
<li>Ignore any behavior you don't want or don't care about</li>
</ul>
<div class="outline-2" id="outline-container-orgf4fe8cb">
<h2 id="orgf4fe8cb">Sources</h2>
<div class="outline-text-2" id="text-orgf4fe8cb">
<ul class="org-ul">
<li><a href="/posts/bibliography/clicking-with-your-rabbit/">Clicking With Your Rabbit</a></li>
<li><a href="/posts/bibliography/clicker-training-wikipedia-article/">Wikipedia article on Clicker Training</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/why-is-ham-radio-called-ham-radio/">Why Is Ham Radio Called Ham Radio?</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/why-is-ham-radio-called-ham-radio/" rel="bookmark"><time class="published dt-published" datetime="2020-07-29T20:21:08-07:00" itemprop="datePublished" title="2020-07-29 20:21">2020-07-29 20:21</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>So, why is <a href="https://www.wikiwand.com/en/Amateur_radio">Amateur Radio called</a> <i>ham</i> radio? It appears that the term originated with Telegraph Operators who referred to unskilled operators as "hams", presumably because they were considered "ham-fisted" (or "ham-handed"). When radio first became available to the general population many of the first radio ("wireless telegraph") operators were former telegraph operators and it became the norm for both amateurs and professionals to refer to amateur operators who accidentally interfered with other broadcasts as "hams" and eventually the term was adopted by the amateur radio community as the term for "amateur" radio.</p>
<div class="outline-2" id="outline-container-orgbd47385">
<h2 id="orgbd47385">Citations</h2>
<div class="outline-text-2" id="text-orgbd47385">
<ul class="org-ul">
<li><a href="/posts/bibliography/arrl-ham-radio-license-manual/">ARRL Ham Radio License Manual</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/the-alphabet-peg/">The Alphabet Peg</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/the-alphabet-peg/" rel="bookmark"><time class="published dt-published" datetime="2020-07-29T19:54:16-07:00" itemprop="datePublished" title="2020-07-29 19:54">2020-07-29 19:54</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>This is a type of Mnemonic Peg System that helps you memorize lists using a pre-built Peg List based on the alphabet. It doesn't have to be the alphabet, it can be any ordered list of words that you already have memorized.</p>
<p>First you created a list of words wherein the first letter of each word matches the letters of the alphabet - <i>Ape, Bat, Crane</i>, etc. Now whenever you need to memorize a list you associate each item on the list with a word in the alphabet list in order. So if you need to memorize <i>a loaf of bread, a container of milk, and a stick of butter</i> you would do something like this:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Abecadarium</th>
<th class="org-left" scope="col">List</th>
<th class="org-left" scope="col">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Ape</td>
<td class="org-left">Loaf of Bread</td>
<td class="org-left">King Kong climbing the Empire State Building holding a loaf of bread</td>
</tr>
<tr>
<td class="org-left">Bat</td>
<td class="org-left">Container of Milk</td>
<td class="org-left">Supermarket milk jug with a bat in it</td>
</tr>
<tr>
<td class="org-left">Crane</td>
<td class="org-left">Stick of Butter</td>
<td class="org-left">A crane choking on a giant stick of butter</td>
</tr>
</tbody>
</table>
<p>Once you've made the associations you can remember the list by starting with Ape and working through the alphabet.</p>
<div class="outline-2" id="outline-container-org6d3c4b9">
<h2 id="org6d3c4b9">Bibliography</h2>
<div class="outline-text-2" id="text-org6d3c4b9">
<ul class="org-ul">
<li><a href="/posts/bibliography/mnemonic-alphabet-systems/">Mnemonic Alphabet Systems</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/2c-updating-a-nikola-shortcode-plugin/">Updating a Nikola Shortcode Plugin</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="/authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="/posts/2c-updating-a-nikola-shortcode-plugin/" rel="bookmark"><time class="published dt-published" datetime="2020-07-28T16:33:43-07:00" itemprop="datePublished" title="2020-07-28 16:33">2020-07-28 16:33</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org59e907c">Beginning</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#orgdc4bd67">Middle</a>
<ul>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org4794d34">The Plugin File</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#orgf6ac894">The Plugin Code</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org12b7323">Stealing From the <code>doc</code></a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org3f4e8a2">The Plugin</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org67bb7ec">Checking It Out</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org1d9e375">Does it work like the original doc?</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#orgb1e7168">Does it accept a title?</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org5bffbf4">What if the slug doesn't exist?</a></li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#orgc4c5f79">One More Thing</a></li>
</ul>
</li>
<li><a href="/posts/2c-updating-a-nikola-shortcode-plugin/#org9a8b786">End</a></li>
</ul>
</div>
</div>
<div class="figure">
<p><img alt="lancelot_link.jpg" src="/posts/2c-updating-a-nikola-shortcode-plugin/lancelot_link.jpg"></p>
</div>
<p>Source: <a href="https://www.flickr.com/photos/myprontopup/264413649/in/photostream/">Brian</a> (<a href="https://creativecommons.org/licenses/by-nc/2.0/">CC License</a>)/Unmodified</p>
<div class="outline-2" id="outline-container-org59e907c">
<h2 id="org59e907c">Beginning</h2>
<div class="outline-text-2" id="text-org59e907c">
<p>These are some notes to help me remember what I did to alter a <a href="https://www.getnikola.com/">Nikola</a> <a href="https://www.getnikola.com/handbook.html#shortcodes">shortcode</a> plugin. A while back I looked into using their <a href="https://www.getnikola.com/handbook.html#doc"><code>doc</code></a> <a href="https://www.getnikola.com/handbook.html#restructuredtext-extensions">reStructured Text extension</a> ("role"?) which automatically creates links to other posts by looking up the <a href="https://www.wikiwand.com/en/Clean_URL#/Slug">slug</a> or title that you pass to it, but since I switched to using org-mode instead of restructured text I couldn't use it. Then I found out the other day that they built a <a href="https://www.getnikola.com/handbook.html#shortcodes">shortcode</a> that allows you to use it in other formats and when I tried it it worked - mostly.</p>
<p>A tag that looks like this:</p>
<p>{{% doc %}}2-nikola-inter-site-links{{% /doc %}}</p>
<p>Gets turned into this: <a href="/posts/2-nikola-inter-site-links/">Nikola Inter-Site Links</a>.</p>
<p>The problem is that, while the <code>doc</code> shortcode supports giving the link an alternate title, it expects restructured-text formatting. e.g. <code>`alternate title&lt;some-slug&gt;`</code>. Why is this a problem? Well, I didn't look into where it's happening, but when the text within the {{% doc %}} tags gets sent to the shortcode code (meaning the python plugin code) for processing it converts the angle brackets (<code>&lt;</code> and <code>&gt;</code>) to <a href="https://www.w3schools.com/html/html_entities.asp">HTML character entities</a> (e.g. the <code>&lt;</code> becomes <code>&amp;lt</code>) but the regular expression in the code that extracts the alternate title is looking for the braces (presumably the role is processed differently from the shortcode) anyway, I was trying to figure out some workarounds but then I looked at the code and it looked fairly easy to customize so I decided I would so that I could learn how to do it (and have a way to use alternative titles in org-mode). So, here it goes.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgdc4bd67">
<h2 id="orgdc4bd67">Middle</h2>
<div class="outline-text-2" id="text-orgdc4bd67">
<p>I'm going to call my shortcode <code>lancelot</code>. I was going to call it link, but that seems like it might clash with something else, either now or in the future, so I decided to name it after <a href="https://www.wikiwand.com/en/Lancelot_Link,_Secret_Chimp">Lancelot Link, Secret Chimp</a> instead. Hopefully that won't end up conflicting with anything.</p>
</div>
<div class="outline-3" id="outline-container-org4794d34">
<h3 id="org4794d34">The Plugin File</h3>
<div class="outline-text-3" id="text-org4794d34">
<p>The first thing I did was poke around in the nikola folders for something I could copy. I decided to use the existing <code>gist</code> shortcode to start with. Why not use <code>doc</code>? because it's in a different folder and inherits from the <code>RestExtension</code> which didn't seem like what I wanted, although maybe that's what makes the angle brackets work, but anyway, the <code>gist</code> seemed like a good place to start. They appear to be using <a href="https://yapsy.readthedocs.io/en/latest/">yapsy</a> for the plugin system, which requires two files for your plugin, a python file where you define the plugin and a plugin-info file (which looks like an ini file). So to start I copied <code>nikola/plugins/shortcode/gist.plugin</code> and renamed it <code>lancelot.plugin</code> then edited it to look like this.</p>
<div class="highlight">
<pre><span></span>[Core]
name = lancelot
module = lancelot

[Nikola]
PluginCategory = Shortcode

[Documentation]
author = The Cloistered Monkey
version = 0.1
website = https://necromuralist.github.io/
description = Variant of the doc shortcode that allows alternate titles for non-restructured text formats.
</pre></div>
<p>Seems easy enough. Now to the plugin code.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgf6ac894">
<h3 id="orgf6ac894">The Plugin Code</h3>
<div class="outline-text-3" id="text-orgf6ac894">
<p>According to the documentation on <a href="https://getnikola.com/extending.html#shortcodes">creating a shortcode</a>, the requirements are that you create a plugin that inherits from the <code>ShortcodePlugin</code> (you'll find it in the <code>nikola/plugin_categories.py</code> file if you want to check it out) and define the <code>handler</code> method that handles the shortcode and returns a tuple of <code>(output, dependencies)</code>. The <code>output</code> is the text that will replace the shortcode in the document and the <code>dependencies</code> is a list of files that nikola will use to check if something is out of date (I don't use it here).</p>
<p>There are three required named arguments for the <code>handler</code> method:</p>
<ul class="org-ul">
<li><code>site</code>: an object that you can use to check the state of the site</li>
<li><code>data</code>: The text between the shortcode tags (if it uses both opening and closing tags)</li>
<li><code>lang</code>: the current language</li>
</ul>
<p>In addition, any attributes added within the shortcode tag will be passed into the <code>handler</code> method by position or keyword. Anyway, since I copied the <code>doc</code> code I didn't actually read this until just now, but maybe it's good to know. Onward.</p>
<p>The next thing to do was to create <code>lancelot.py</code> in the same folder as the <code>lancelot.plugin</code> file. The basic definition of class (and the start of the file) looks more-or-less the same for all the plugins.</p>
<div class="highlight">
<pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># This file is public domain according to its author, the Cloistered Monkey</span>

<span class="sd">"""Shortcode for non-restructured text inter-site links."""</span>

<span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">ShortcodePlugin</span>


<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">ShortcodePlugin</span><span class="p">):</span>
    <span class="sd">"""Plugin for non-rst inter-site links."""</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">"lancelot"</span>
</pre></div>
<p>So, other than some doc-strings all you have to do is set the name and then the handler, which we'll do next.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org12b7323">
<h3 id="org12b7323">Stealing From the <code>doc</code></h3>
<div class="outline-text-3" id="text-org12b7323">
<p>The file that I stole most of the code from is located in <code>nikola/plugins/compile/rest/doc.py</code>. The <code>Plugin</code> class in that file is handling both the restructured text role and the shortcode so we don't need all of it. According to the documentation I linked to above, the <code>set_site</code> method is used to tell nikola to use something other than the <code>handler</code> method, and in this case the author used it to register the functions for the two things it's handling.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">set_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">):</span>
    <span class="sd">"""Set Nikola site."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
    <span class="n">roles</span><span class="o">.</span><span class="n">register_canonical_role</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="n">doc_role</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register_shortcode</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="n">doc_shortcode</span><span class="p">)</span>
    <span class="n">doc_role</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="n">site</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Plugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_site</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
</pre></div>
<p>If you look at the line <code>self.site.register_shortcode('doc', doc_shortcode)</code> you can figure out that we need to steal from a function named - wait for it <code>doc_shortcode</code>. Here's what's in that function:</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">doc_shortcode</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">"""Implement the doc shortcode."""</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">twin_slugs</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">permalink</span><span class="p">,</span> <span class="n">slug</span> <span class="o">=</span> <span class="n">_doc_link</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">LOGGER</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">twin_slugs</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">'More than one post with the same slug. Using "</span><span class="si">{0}</span><span class="s1">" for doc shortcode'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">permalink</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">'&lt;a href="</span><span class="si">{0}</span><span class="s1">"&gt;</span><span class="si">{1}</span><span class="s1">&lt;/a&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">permalink</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">'"</span><span class="si">{0}</span><span class="s1">" slug doesn</span><span class="se">\'</span><span class="s1">t exist.'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slug</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">'&lt;span class="error text-error" style="color: red;"&gt;Invalid link: </span><span class="si">{0}</span><span class="s1">&lt;/span&gt;'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
<p>It looks pretty straight-forward except it's using two things not defined within it - <code>LOGGER</code> and <code>_doc_link</code>. The <code>LOGGER</code> is just an import so we can just change the start of our file to grab it. The <code>doc_link</code> is a function in the same file as <code>doc_shortcode</code>. My first thought for the <code>_doc_link</code> was that since it's a standalone function I could just import it and call it. That turned out to have a small problem though - right in the middle of <code>_doc_link</code> is this for loop:</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">doc_role</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">timeline</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">meta</span><span class="p">(</span><span class="s1">'slug'</span><span class="p">)</span> <span class="o">==</span> <span class="n">slug</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">twin_slugs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
</pre></div>
<p>What you'll notice is that the <code>doc_role</code> function has an attribute <code>site</code>. Well, it doesn't really, until it's set in that <code>set_site</code> method above. So, okay, maybe I could figure out some way to set it or maybe not, I don't know but even if I could it seems like it'd get kind of convoluted, and who knows what changes the original author might make in the future, it just seemed like it'd make more sense to re-implement it myself.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org3f4e8a2">
<h3 id="org3f4e8a2">The Plugin</h3>
<div class="outline-text-3" id="text-org3f4e8a2">
<p>So, first a different start to our file, this time with the <code>LOGGER</code> and <code>slugify</code> imported (the <code>slugify</code> was in <code>_doc_link</code> which I'm re-defining later).</p>
<div class="highlight">
<pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># This file is public domain according to its author, the Cloisted Monkey</span>

<span class="sd">"""Shortcode for non-restructured text inter-site links.</span>
<span class="sd">Re-write of the ``doc`` plugin to allow alternative titles outside of RST"""</span>

<span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">ShortcodePlugin</span>
<span class="kn">from</span> <span class="nn">nikola.utils</span> <span class="kn">import</span> <span class="n">LOGGER</span><span class="p">,</span> <span class="n">slugify</span>


<span class="k">class</span> <span class="nc">Plugin</span><span class="p">(</span><span class="n">ShortcodePlugin</span><span class="p">):</span>
    <span class="sd">"""Plugin for non-rst inter-site links."""</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">"lancelot"</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9a30d9d">
<h4 id="org9a30d9d"><code>lancelot_link</code></h4>
<div class="outline-text-4" id="text-org9a30d9d">
<p>To replace the <code>_doc_link</code> I made a new function called <code>lancelot_link</code> which I'll be looking at in parts. First up is the function declaration.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">lancelot_link</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="sd">"""process the slug, check if it exists or is duplicated</span>

<span class="sd">    if `title` is None this will grab the post-title</span>

<span class="sd">    Args:</span>
<span class="sd">     site: the Nikola object</span>
<span class="sd">     slug: the text between the shortcode tags</span>
<span class="sd">     title: the title passed in by the user (if any)</span>

<span class="sd">    Returns:</span>
<span class="sd">     tuple (success, has duplicate slugs, title, permalink, slug)</span>
<span class="sd">    """</span>
</pre></div>
<p>The interface wants the objects that nikola passes into the <code>handler</code> method - the <code>site</code> object , the <code>data</code> (renamed <code>slug</code>) and the <code>title</code>.</p>
<p><b>Note:</b> I'm not indenting the rest of the code in the post but imagine it's indented four spaces.</p>
</div>
<ul class="org-ul">
<li><a id="orga596e77"></a>Slugification<br>
<div class="outline-text-5" id="text-orga596e77">
<p>The first thing the function does is split out any fragments that might have been attached and "slugifies" the slug (makes sure it's ASCII and has only alphanumeric characters).</p>
<div class="highlight">
<pre><span></span><span class="k">if</span> <span class="s1">'#'</span> <span class="ow">in</span> <span class="n">slug</span><span class="p">:</span>
    <span class="n">slug</span><span class="p">,</span> <span class="n">fragment</span> <span class="o">=</span> <span class="n">slug</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'#'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fragment</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><a id="org3ef0557"></a>Find the Post<br>
<div class="outline-text-5" id="text-org3ef0557">
<p>Next it checks to see if the slug refers to an actual page on the site and if there are duplicate slugs. If the page doesn't exist, then it short-circuits the function so the <code>handler</code> can return some error text instead of a link. If it does exist it saves the <code>post</code> object for the next step (using the first post in the timeline if there were duplicates).</p>
<div class="highlight">
<pre><span></span><span class="n">twin_slugs</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">post</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">site</span><span class="o">.</span><span class="n">timeline</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">meta</span><span class="p">(</span><span class="s1">'slug'</span><span class="p">)</span> <span class="o">==</span> <span class="n">slug</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">twin_slugs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

<span class="k">if</span> <span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">slug</span>
</pre></div>
</div>
</li>
<li><a id="org0003e69"></a>The Title<br>
<div class="outline-text-5" id="text-org0003e69">
<p>If the user didn't pass in an alternative title this grabs the title that was given to the post we're linking to.</p>
<p><b>Note:</b> The <code>doc</code> shortcode raises then catches a <code>ValueError</code> exception if there's no matching post. I had thought that this was for logging, but that doesn't appear to be the case so I took it out. But since I don't know what it was doing in the first place I might be breaking something. Not that I can tell, though.</p>
<div class="highlight">
<pre><span></span><span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><a id="org33b83ce"></a>The Permalink<br>
<div class="outline-text-5" id="text-org33b83ce">
<p>Now we grab the permalink.</p>
<div class="highlight">
<pre><span></span><span class="n">permalink</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="n">permalink</span><span class="p">()</span>
<span class="k">if</span> <span class="n">fragment</span><span class="p">:</span>
    <span class="n">permalink</span> <span class="o">+=</span> <span class="s1">'#'</span> <span class="o">+</span> <span class="n">fragment</span>
</pre></div>
</div>
</li>
<li><a id="orge0ae8fd"></a>The Return<br>
<div class="outline-text-5" id="text-orge0ae8fd">
<p>And finally we do the return dance to answer some questions for the <code>handler</code>:</p>
<ul class="org-ul">
<li><i>Did we find the post?</i></li>
<li><i>Were there duplicate posts with the same slug?</i></li>
<li><i>What's the text to display for the link?</i></li>
<li><i>What's the address for the anchor tag?</i></li>
<li><i>What's the correct slug?</i></li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">twin_slugs</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">permalink</span><span class="p">,</span> <span class="n">slug</span>
</pre></div>
<p>The <code>slug</code> is only for the logging messages.</p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org0468789">
<h4 id="org0468789">The handler</h4>
<div class="outline-text-4" id="text-org0468789">
<p>Now I'll define the <code>handler</code> that's called by nikola. This is a method of the Plugin class that I started above, but I'm showing it after the <code>lancelot_link</code> function since it mostly just calls <code>lancelot_link</code> and creates the output from what it returned. I originally had it all in the same method (and maybe I'll put it back at some point). But I thought it was a little easier to read this way, especially as I referred back to the original <code>doc</code> plugin to see what's going on.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Create an inter-site link</span>

<span class="sd">    Args:</span>
<span class="sd">     title: optional argument to specify a different title from the post</span>

<span class="sd">    Returns:</span>
<span class="sd">     output HTML to replace the shortcode</span>
<span class="sd">    """</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">twin_slugs</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">permalink</span><span class="p">,</span> <span class="n">slug</span> <span class="o">=</span> <span class="n">lancelot_link</span><span class="p">(</span>
        <span class="n">site</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">twin_slugs</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">'More than one post with the same slug. '</span>
                <span class="sa">f</span><span class="s1">'Using "</span><span class="si">{</span><span class="n">permalink</span><span class="si">}</span><span class="s1">" for lancelot shortcode'</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'&lt;a href="</span><span class="si">{</span><span class="n">permalink</span><span class="si">}</span><span class="s1">"&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&lt;/a&gt;'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">slug</span><span class="si">}</span><span class="s1">" slug doesn</span><span class="se">\'</span><span class="s1">t exist.'</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'&lt;span class="error text-error" style="color: red;"&gt;'</span>
                  <span class="sa">f</span><span class="s1">'Invalid link: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">&lt;/span&gt;'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="p">[]</span>
</pre></div>
<p>One thing to note here is that the original <code>doc</code> plugin only returns the output, not an empty list, even though the documentation says you should. It works either way, but I noticed the <code>gist</code> plugin returned an empty list with the output so I followed, like a lemming to the sea.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org67bb7ec">
<h3 id="org67bb7ec">Checking It Out</h3>
<div class="outline-text-3" id="text-org67bb7ec">
<p>Now let's give it a dry run.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org1d9e375">
<h3 id="org1d9e375">Does it work like the original doc?</h3>
<div class="outline-text-3" id="text-org1d9e375">
<p>If we put this in the post: {{% lancelot %}}2-nikola-inter-site-links{{% /lancelot %}}</p>
<p>We get this:</p>
<p><a href="/posts/2-nikola-inter-site-links/">Nikola Inter-Site Links</a></p>
</div>
</div>
<div class="outline-3" id="outline-container-orgb1e7168">
<h3 id="orgb1e7168">Does it accept a title?</h3>
<div class="outline-text-3" id="text-orgb1e7168">
<p>Now, what this was all about.</p>
<p>{{% lancelot title="An old post about linking to another post." %}}2-nikola-inter-site-links{{% /lancelot %}}</p>
<p>Gives us:</p>
<p><a href="/posts/2-nikola-inter-site-links/">An old post about linking to another post.</a></p>
<p>And if you forget the name of the parameter, you can just pass in the alternate title instead.</p>
<p>{{% lancelot "Without the 'title=' part" %}}2-nikola-inter-site-links{{% /lancelot %}}</p>
<p>Gives this:</p>
<p><a href="/posts/2-nikola-inter-site-links/">Without the 'title=' part</a></p>
</div>
</div>
<div class="outline-3" id="outline-container-org5bffbf4">
<h3 id="org5bffbf4">What if the slug doesn't exist?</h3>
<div class="outline-text-3" id="text-org5bffbf4">
<p>{{% lancelot title="Oops." %}}this-error-is-on-purpose-ignore-it{{% /lancelot %}}</p>
<p>Gives us:</p>
<p><span class="error text-error" style="color: red;">Invalid link: this-error-is-on-purpose-ignore-it</span></p>
<p>Note that adding this error to this post means it shows up in the logging every time I re-build. I hope I don't forget and try and hunt it down later.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc4c5f79">
<h3 id="orgc4c5f79">One More Thing</h3>
<div class="outline-text-3" id="text-orgc4c5f79">
<p>When I originally was trying to figure this out I put the <code>lancelot</code> files in the <code>shortcodes</code> folder next to the <code>gist</code> files (in the virtualenv, so I knew it was a bad idea, even as I did it) but while I was re-writing them for this post I wanted a place to stash the files so I put them in the <code>plugins</code> folder that sits in the site repository next to the <code>conf.py</code> file - which already existed because that's where nikola put the <a href="https://plugins.getnikola.com/v7/orgmode/">org-mode plugin</a> - and when I first re-built the site with the code only partially written, it raised an <code>Exception</code> because it turns out that the place to put plugins, including shortcode plugins, for nikola/yapsy to find them is in the <code>plugins</code> folder. Imagine that.</p>
<p>Also, to use an interactive debugger (like my favorite one, <a href="https://pypi.org/project/pudb/">pudb</a>) you need to change the verbosity when you build the site to 2.</p>
<div class="highlight">
<pre><span></span>nikola build -v 2
</pre></div>
<p>Otherwise it captures the stdout and you won't see the debugger (it will just look like it hung-up). The other thing is if you see an error something like this:</p>
<div class="highlight">
<pre><span></span>[2020-07-28 20:53:44] ERROR: Nikola: Shortcode error: Syntax error in shortcode 'lancelot' at line 426, column 27: expecting whitespace!
</pre></div>
<p>It more than likely mean that the error is actually in the tag - no space after the first <code>%</code> or before the second one or one time I chopped off the end of a tag when copying and pasting and it gave the same error - it seems to be a generic error that means "check the tag".</p>
<p>I guess that's actually three more things.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9a8b786">
<h2 id="org9a8b786">End</h2>
<div class="outline-text-2" id="text-org9a8b786">
<p>So, that's my first foray into making a nikola plugin. I've been using nikola for a while now, but I never really looked at the code before. It's nice to see that the plugin system is so easy to use.</p>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="next"><a href="/index-14.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
</script><!--End of body content-->
<footer id="footer">Contents  2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script> </div>
</div>
</body>
</html>
