<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A common place." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>The Cloistered Monkey</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/" rel="canonical">
<link href="index-21.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="site.webmanifest" rel="manifest">
<link href="posts/apt-fast-in-sparky-linux/" rel="prefetch" type="text/html">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/apt-fast-in-sparky-linux/">Apt-Fast In Sparky Linux</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/apt-fast-in-sparky-linux/" rel="bookmark"><time class="published dt-published" datetime="2023-06-16T13:15:45-07:00" itemprop="datePublished" title="2023-06-16 13:15">2023-06-16 13:15</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/apt-fast-in-sparky-linux/#org5885bbe">Background</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org734033c">The Intructions</a>
<ul>
<li><a href="posts/apt-fast-in-sparky-linux/#org14be73b">Create An Apt Entry</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org5601624">Add the Keyring and Install</a></li>
</ul>
</li>
<li><a href="posts/apt-fast-in-sparky-linux/#org791e6a7">The apt-key Solution</a>
<ul>
<li><a href="posts/apt-fast-in-sparky-linux/#orgf041767">The Start of the Solution</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org22ed7ae">Getting the GPG File</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org16fe8a6">Now Back to Setting it Up</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org56b1deb">Update and Install</a></li>
</ul>
</li>
<li><a href="posts/apt-fast-in-sparky-linux/#org0746c19">And Now, Another Problem</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org6e2ff14">What Have We Learned Today Children?</a></li>
<li><a href="posts/apt-fast-in-sparky-linux/#org13aee93">Links Collected</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org5885bbe">
<h2 id="org5885bbe">Background</h2>
<div class="outline-text-2" id="text-org5885bbe">
<p>I have an old eeePC netbook that I thought I'd revive by loading <a href="https://sparkylinux.org/">Sparky Linux</a> onto it. One of the things I set up on it is <a href="https://github.com/ilikenwf/apt-fast">apt-fast</a>, which the README on the github repository describes like this:</p>
<blockquote>
<p>apt-fast is a shellscript wrapper for apt-get and aptitude that can drastically improve apt download times by downloading packages in parallel, with multiple connections per package.</p>
</blockquote>
<p>I've used it for a while on ubuntu but Sparky Linux didn't have it in the repositories. The apt-fast documentation has instructions for <a href="https://github.com/ilikenwf/apt-fast#debian-and-derivates">installing it on debian (and derivatives)</a> and since Sparky Linux is based on debian (the current version, SparkyLinux 6.7 (Po-Tolo) is based on debian bullseye) I decided to try that. Ultimately I got it working, but as is often the case, it wasn't quite so straightforward as I would like for it to have been.</p>
<p>Unusual Ingredients List:</p>
<ul class="org-ul">
<li>SparkyLinux 6.7 (Po-Tolo)</li>
<li>fish shell</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org734033c">
<h2 id="org734033c">The Intructions</h2>
<div class="outline-text-2" id="text-org734033c">
<p>Although the PPA system is built for Ubuntu, the recommendation from apt-fast is to use it with debian-based systems too (apt-fast is just a shell-script that runs <code>aria2</code> and <code>apt</code> (or <code>apt-get</code>, etc.) so it's not like there's a lot of dependencies that might conflict). This is what they say to do.</p>
</div>
<div class="outline-3" id="outline-container-org14be73b">
<h3 id="org14be73b">Create An Apt Entry</h3>
<div class="outline-text-3" id="text-org14be73b">
<p>First I created a file for the sources at <code>/etc/apt/sources.list.d/apt-fast.list</code> and put these lines in it.</p>
<div class="highlight">
<pre><span></span>deb http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main 
deb-src http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
<p>Bionic came out in 2018 so they maybe haven't updated the instructions in a while.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org5601624">
<h3 id="org5601624">Add the Keyring and Install</h3>
<div class="outline-text-3" id="text-org5601624">
<p>Once the file was in place I ran the commands.</p>
<div class="highlight">
<pre><span></span>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
apt-get update
apt-get install apt-fast
</pre></div>
<p>The first output I saw was a warning:</p>
<div class="highlight">
<pre><span></span>Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).
</pre></div>
<p>This is something I've seen on ubuntu as well so fixing it seemed like a useful thing to do, especially since at the end of the regular output I got an error.</p>
<p>Between the warning and the error there was the usual output that I've seen:</p>
<div class="highlight">
<pre><span></span>Executing: /tmp/apt-key-gpghome.YL04bWmGAF/gpg.1.sh --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
gpg: key 1EE2FF37CA8DA16B: public key "Launchpad PPA for apt-fast" imported
gpg: Total number processed: 1
gpg:               imported: 1
</pre></div>
<p>Then came this, which is not what I usually see:</p>
<div class="highlight">
<pre><span></span>gpg: no writable keyring found: Not found
gpg: error reading '[stdin]': General error
gpg: import from '[stdin]' failed: General error
gpg: Total number processed: 0
</pre></div>
<p>I don't know if this is a debian problem or a sparky linux problem, but since you're not supposed to be using this method anyway, I went looking for a different solution.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org791e6a7">
<h2 id="org791e6a7">The apt-key Solution</h2>
<div class="outline-text-2" id="text-org791e6a7"></div>
<div class="outline-3" id="outline-container-orgf041767">
<h3 id="orgf041767">The Start of the Solution</h3>
<div class="outline-text-3" id="text-orgf041767">
<p>The first part of the solution was pointed to by <a href="https://stackoverflow.com/a/71384057">this Stack Overflow Answer</a>. There was a problem with the answer, though, in that the person asking the question was using a URL that pointed to a gpg file, so the answers all assumed you could download it with curl, wget, etc. (all the answers that I could understand, anyway). So now that I had the answer I had a new problem - how do you get the file from the keyserver?</p>
</div>
</div>
<div class="outline-3" id="outline-container-org22ed7ae">
<h3 id="org22ed7ae">Getting the GPG File</h3>
<div class="outline-text-3" id="text-org22ed7ae">
<p>Once again to the web, this time <a href="https://superuser.com/a/1643115">this answer from SuperUser</a> seemed to work.</p>
<p>First, I made a temporary directory and pointed <code>GNUPGHOME</code> to it so that I wasn't adding anything to my actual gpg setup (this is fish-shell syntax).</p>
<div class="highlight">
<pre><span></span>set -x GNUPGHOME $(mktemp -d)
</pre></div>
<p><code>echo $GNUPGHOME</code> showed that this created a file at <code>/tmp/tmp.dUDUEgFQ0x</code> (but I didn't actually need to know that, I'm just mentioning it).</p>
<p>Taking the <code>--recv-keys</code> argument from the instructions above (<code>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B</code>) I added the key.</p>
<div class="highlight">
<pre><span></span>gpg --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
</pre></div>
<p>Next I made a place to put the gpg file.</p>
<div class="highlight">
<pre><span></span>sudo mkdir /etc/apt/keyrings
</pre></div>
<p>Then I output the file in my home directory (GNUPGHOME is only available to my user, so I put the file somewhere that I didn't need to be root).</p>
<div class="highlight">
<pre><span></span>gpg -o A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg --export A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
</pre></div>
<p>Then I moved the file into the directory I created for it.</p>
<div class="highlight">
<pre><span></span>sudo mv A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg /etc/apt/keyrings/
</pre></div>
<p>The SuperUser answer I linked to used <code>gpg -ao</code> but the <code>a</code> option makes it an "armored" file, and part of the Stack Overflow answer for setting up the key is about de-armoring it so I just left that option out.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org16fe8a6">
<h3 id="org16fe8a6">Now Back to Setting it Up</h3>
<div class="outline-text-3" id="text-org16fe8a6">
<p>So now that we have the keyring we need to edit the <code>/etc/apt/sources.list.d/apt-fast.list</code> file that we created at the beginning of this.</p>
<p>This is what I started with.</p>
<div class="highlight">
<pre><span></span>deb http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main 
deb-src http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
<p>And I changed it to refer to the gpg file that I created.</p>
<div class="highlight">
<pre><span></span>deb [signed-by=/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg] http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
deb-src  [signed-by=/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg]  http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org56b1deb">
<h3 id="org56b1deb">Update and Install</h3>
<div class="outline-text-3" id="text-org56b1deb">
<p>So then I updated apt and installed it.</p>
<div class="highlight">
<pre><span></span>sudo apt update
sudo apt install apt-fast
</pre></div>
<p>And it worked.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0746c19">
<h2 id="org0746c19">And Now, Another Problem</h2>
<div class="outline-text-2" id="text-org0746c19">
<p>This got me to a working <code>apt-fast</code> installation but the fact that I was using <code>bionic</code> seemed off to me so I decided to update the <code>apt-fast.list</code>. Under the instructions for adding the PPA is this note.</p>
<blockquote>
<p>Note that the PPA version bionic might need to be updated with the recent Ubuntu LTS codename to stay up-to-date.</p>
</blockquote>
<p>So I went and looked up the <a href="https://ubuntu.com/about/release-cycle">Ubuntu Release Cycle</a> and saw that "jammy" is the most recent version so I updated the <code>apt-fast.list</code> file to match.</p>
<div class="highlight">
<pre><span></span>deb [signed-by=/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg] http://ppa.launchpad.net/apt-fast/stable/ubuntu jammy main
deb-src  [signed-by=/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg]  http://ppa.launchpad.net/apt-fast/stable/ubuntu jammy main
</pre></div>
<p>And then I installed the newer version.</p>
<div class="highlight">
<pre><span></span>sudo apt update
sudo apt install apt-fast
</pre></div>
<p>And I got a nice long stack-trace and error message at the bottom of which was this:</p>
<div class="highlight">
<pre><span></span>dpkg-deb: error: archive '/var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb' uses unknown compression for member 'control.tar.zst', giving up
dpkg: error processing archive /var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb (--unpack):
 dpkg-deb --control subprocess returned error exit status 2
Errors were encountered while processing:
 /var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb
E: Sub-process /usr/bin/dpkg returned an error code (1)
</pre></div>
<p>The part of it seemed to be the fragment: <code>uses unknown compression for member 'control.tar.zst', giving up</code>. What is a <code>zst</code> file? <a href="https://en.wikipedia.org/wiki/Zstd?useskin=vector">According to wikipedia</a> it's a "Zstandard" file and Debian and Ubuntu added support for using it to compress <code>deb</code> packages back in 2018. There is a package listed in <code>apt</code> called <code>zstd</code> that it says supports <code>zst</code> compression so I installed it but the error remained.</p>
<p>Once again, someone ran into this and asked about it on <a href="https://unix.stackexchange.com/questions/669004/zst-compression-not-supported-by-apt-dpkg">Stack Exchange</a>. <a href="https://unix.stackexchange.com/a/669008">One of the answers</a> said:</p>
<blockquote>
<p>Debian’s dpkg package didn’t support zstd compression prior to version 1.21.18. Support was added just in time for Debian 12.</p>
</blockquote>
<p>Since the SparkyLinux install is based on Debian 11 that seemed like it might be the problem. I checked the dpkg-version and got back:</p>
<div class="highlight">
<pre><span></span>Debian<span class="w"> </span><span class="s1">'dpkg'</span><span class="w"> </span>package<span class="w"> </span>management<span class="w"> </span>program<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.20.12<span class="w"> </span><span class="o">(</span>i386<span class="o">)</span>.
</pre></div>
<p>So that seemed like the likely culprit. The ubuntu release dates page noted that there was a LTS version between "bionic" and "jammy" called "focal" so I edited the <code>apt-fast.list</code> file again, replacing "jammy" with "focal" and re-ran the installation and so far… it works.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org6e2ff14">
<h2 id="org6e2ff14">What Have We Learned Today Children?</h2>
<div class="outline-text-2" id="text-org6e2ff14">
<p>Further down in the installation instructions it says that you can just download the files and install them along with the <code>aria2</code> package, so going through this whole thing was kind of unnecessary, but getting around the apt-key problem was something that I'd wondered about before, so it might be useful in the future, if PPA creators keep using it and they don't come up with an automatic fix for it.</p>
<p>I guess the main thing I learned is that I should have read to the end of the instructions and picked the easy way out instead of trying to force the old familiar way to work.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org13aee93">
<h2 id="org13aee93">Links Collected</h2>
<div class="outline-text-2" id="text-org13aee93">
<ul class="org-ul">
<li>FWDekker. Answer to “Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead” [Internet]. Stack Overflow. 2022 [cited 2023 Jun 16]. Available from: <a href="https://stackoverflow.com/a/71384057">https://stackoverflow.com/a/71384057</a></li>
<li>Kitt S. Answer to “zst compression not supported by apt/dpkg” [Internet]. Unix & Linux Stack Exchange. 2021 [cited 2023 Jun 16]. Available from: <a href="https://unix.stackexchange.com/a/669008">https://unix.stackexchange.com/a/669008</a></li>
<li>fuzzydrawrings. Answer to “gpg: only download a key from a keyserver” [Internet]. Super User. 2021 [cited 2023 Jun 16]. Available from: <a href="https://superuser.com/a/1643115">https://superuser.com/a/1643115</a></li>
<li>ilikenwf/apt-fast: apt-fast: A shellscript wrapper for apt that speeds up downloading of packages. [Internet]. [cited 2023 Jun 16]. Available from: <a href="https://github.com/ilikenwf/apt-fast">https://github.com/ilikenwf/apt-fast</a></li>
<li>zstd. In: Wikipedia [Internet]. 2023 [cited 2023 Jun 16]. Available from: <a href="https://en.wikipedia.org/w/index.php?title=Zstd&amp;oldid=1157564498">https://en.wikipedia.org/w/index.php?title=Zstd&amp;oldid=1157564498</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/fish-mocha-chai-a-local-global-installation-in-ubuntu/">Fish, Mocha, Chai - A Local Global Installation In Ubuntu</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/fish-mocha-chai-a-local-global-installation-in-ubuntu/" rel="bookmark"><time class="published dt-published" datetime="2023-06-08T16:29:32-07:00" itemprop="datePublished" title="2023-06-08 16:29">2023-06-08 16:29</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="outline-2" id="outline-container-org2816271">
<h2 id="org2816271">What This Is About</h2>
<div class="outline-text-2" id="text-org2816271">
<p>I've been getting back into <a href="https://p5.js.org">p5.js</a> lately and thought that I should add some testing so I went to their site and found that they had a tutorial page called <a href="https://p5js.org/learn/tdd.html">"Unit Testing and Test Driven Development"</a> which I decided to follow along with to get re-acquainted with testing javascript but then I ran into a problem running <a href="https://mochajs.org/">mocha</a>, or more specifically, running mocha crashed because it couldn't find <a href="https://www.chaijs.com/">chai</a> even though I'd followed the instructions to install it. So here goes what I did to fix it.</p>
<p>This is another case where you can basically find the answer online if you look at the right page - but there seems to be more pages with the unhelpful answers and I use the fish shell and ubuntu so it's a little different from the stuff I found that did work.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd89403f">
<h2 id="orgd89403f">The Tutorial's Installation</h2>
<div class="outline-text-2" id="text-orgd89403f">
<p>This is how they tell you to install mocha and chai.</p>
<p>First, update npm (assuming you've already installed it somehow).</p>
<div class="highlight">
<pre><span></span>sudo npm install npm@latest -g
</pre></div>
<p>Then install mocha and chai using npm.</p>
<div class="highlight">
<pre><span></span>npm install mocha -g
npm install chai -g
</pre></div>
<p>This right here is actually where the trouble starts. If you try to install things globally, you need to run it as root, thus the use of <code>sudo</code> when updating <code>npm</code>. But their instructions on installing <code>mocha</code> and <code>chai</code> don't say to use <code>sudo</code>, which will result in a permission error, so did they forget to run it as root, or did they not mean to install it globally? I decided to re-run their instructions as root.</p>
<div class="highlight">
<pre><span></span>sudo npm install mocha -g
sudo npm install chai -g
</pre></div>
<p>This seemed to work, but when I ran <code>mocha</code> on the folder where I put the code given in the tutorial:</p>
<div class="highlight">
<pre><span></span>mocha color_unit_tests/
</pre></div>
<p>It gave me an error.</p>
<div class="highlight">
<pre><span></span>Error: Cannot find module 'chai'
Require stack:
- /home/hades/projects/ape-iron/p5tests/color_unit_tests/test.js
    at Module._resolveFilename (node:internal/modules/cjs/loader:1097:15)
    at Module._load (node:internal/modules/cjs/loader:942:27)
    at Module.require (node:internal/modules/cjs/loader:1163:19)
    at require (node:internal/modules/cjs/helpers:110:18)
    at Object.&lt;anonymous&gt; (/home/hades/projects/ape-iron/p5tests/color_unit_tests/test.js:5:16
)
    at Module._compile (node:internal/modules/cjs/loader:1276:14)
    at Module._extensions..js (node:internal/modules/cjs/loader:1330:10)
    at Module.load (node:internal/modules/cjs/loader:1139:32)
    at Module._load (node:internal/modules/cjs/loader:980:12)
    at ModuleWrap.&lt;anonymous&gt; (node:internal/modules/esm/translators:169:29)
    at ModuleJob.run (node:internal/modules/esm/module_job:194:25)
</pre></div>
<p>So, maybe that wasn't the answer.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgf332ac2">
<h2 id="orgf332ac2">This Might Be the Wrong Way</h2>
<div class="outline-text-2" id="text-orgf332ac2">
<p>I found a <a href="https://stackoverflow.com/questions/43156635/chai-mocha-global-local">Stack Overflow</a> question that described the exact problem I had, but one of the comments had this to say:</p>
<blockquote>
<p>Mocha can be installed either locally or globally, but Chai can only be installed locally. Has to do with the way it is applied (i.e., to the specific app instance). – Steve Carey May 30, 2020 at 21:11</p>
</blockquote>
<p>I don't know who "Steve Carey" is and whether what he is saying is true, but the <a href="https://www.chaijs.com/guide/installatio">chai installation instructions</a> do tell you to install it locally, rather than globally, but when you do this for every project you end up with <code>node_modules</code> and <code>package.json</code> files all over the place. I suppose there's a reason for this, maybe to couple the version of chai you're using with the project, but I decided to try another way.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org18164a9">
<h2 id="org18164a9">The Local Global</h2>
<div class="outline-text-2" id="text-org18164a9">
<p><a href="https://stackoverflow.com/a/13021677">This answer</a> on Stack Overflow describes how to install npm-packages into your home directory as your global directory. It assumes you're using bash, though, so I had to change it up a little bit.</p>
</div>
<div class="outline-3" id="outline-container-org597238b">
<h3 id="org597238b">Make a local package directory</h3>
<div class="outline-text-3" id="text-org597238b">
<p>First I made a local package directory.</p>
<div class="highlight">
<pre><span></span>mkdir ~/.npm-packages
</pre></div>
<p>Then I created a file called <code>~/.npmrc</code> that had one line in it.</p>
<div class="highlight">
<pre><span></span>prefix = /home/hades/.npm-packages
</pre></div>
<p>With <code>/home/hades/</code> being my home-directory.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgd940c0b">
<h3 id="orgd940c0b">Edit the Fish Configuration</h3>
<div class="outline-text-3" id="text-orgd940c0b">
<p>At the bottom of the <code>~/.config/fish/config.fish</code> file I added these lines.</p>
<div class="highlight">
<pre><span></span>set -x NPM_PACKAGES $HOME/.npm-packages
</pre></div>
<p>This is where <code>npm</code> will install stuff if you tell it to install files globally once we're done. The folder can be named anything, I imagine, but it will need to match what's in the <code>.npmrc</code> file.</p>
<p>When <code>npm</code> installs packages some of them will be executable commands (like <code>mocha</code>) and so I had to update the fish <code>PATH</code>.</p>
<div class="highlight">
<pre><span></span>fish_add_path $HOME/.npm-packages/bin
</pre></div>
<p>Although this will make <code>mocha</code> available, <code>chai</code> isn't an executable so you have to set the <code>NODE_PATH</code> variable so that node will no where to look for modules to import.</p>
<div class="highlight">
<pre><span></span>set --export NODE_PATH $NPM_PACKAGES/lib/node_modules
</pre></div>
<p>I was originally appending the current contents of <code>NODE_PATH</code> to the end, like you would with a regular path variable (<code>$NPM_PACKAGES/lib/node_modules:$NODE_PATH</code>) but for some reason this breaks something and the variable doesn't get set. Or at least it was always empty when I tried to run <code>mocha</code>. So the solution for me was to always clobber the entire path (the variable was empty before I started using it anyway).</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org81c56ec">
<h2 id="org81c56ec">And Now</h2>
<div class="outline-text-2" id="text-org81c56ec">
<p>Running the tests again:</p>
<div class="highlight">
<pre><span></span>mocha ../../ape-iron/p5tests/color_unit_tests/
</pre></div>
<pre class="example">


these are my first tests for p5js
  ✔ should be a string
  ✔ should be equal to awesome


2 passing (5ms)

</pre>
<p>The path is different because I'm writing this post in a different repository, but, anyway, it looks like it works.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org09092be">
<h2 id="org09092be">Sources</h2>
<div class="outline-text-2" id="text-org09092be">
<ul class="org-ul">
<li>Drechsel E. Install NPM into home directory with distribution nodejs package (Ubuntu) [Internet]. Stack Overflow. 2019 [cited 2023 Jun 8]. Available from: <a href="https://stackoverflow.com/q/10081293">https://stackoverflow.com/q/10081293</a></li>
<li>Unit Testing and Test Driven Development | p5.js [Internet]. [cited 2023 Jun 8]. Available from: <a href="https://p5js.org/learn/tdd.html">https://p5js.org/learn/tdd.html</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/python-311-and-emacs-jupyter-symbols-variable-is-void-error/">Ubuntu 22.04, Python 3.11 and the "emacs-jupyter Symbol's variable is void" Error</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/python-311-and-emacs-jupyter-symbols-variable-is-void-error/" rel="bookmark"><time class="published dt-published" datetime="2023-05-25T16:12:27-07:00" itemprop="datePublished" title="2023-05-25 16:12">2023-05-25 16:12</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="outline-2" id="outline-container-org3ca4a17">
<h2 id="org3ca4a17">What This Is About</h2>
<div class="outline-text-2" id="text-org3ca4a17">
<p>Ubuntu 22.04 no longer let's you install python packages globally using pip by default (you can override it but they warn you not to). This has caused a cascade of broken parts on my system, since I use python so much. This particular case started with me trying to start the <a href="https://docs.jupyter.org/en/latest/projects/kernels.html"><code>jupyter kernel</code></a> so that I could run some python code in org-mode and getting (what looked like) an error and fixing it ended up uncovering the fact that working with the new policy for pip broke my emacs setup a little too, so this is a dump of how I got it back up and running again. I recorded it as I was fixing things so there might be a better way, but this is the first pass I took.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orge76df86">
<h2 id="orge76df86">The Jupyter Kernel Warning</h2>
<div class="outline-text-2" id="text-orge76df86">
<p>This is what happened when I tried to start the jupyter kernel.</p>
<div class="highlight">
<pre><span></span><span class="o">(</span>Ape-Iron<span class="o">)</span><span class="w"> </span>hades@erebus<span class="w"> </span>~&gt;<span class="w"> </span>jupyter<span class="w"> </span>kernel
<span class="o">[</span>KernelApp<span class="o">]</span><span class="w"> </span>Starting<span class="w"> </span>kernel<span class="w"> </span><span class="s1">'python3'</span>
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>Debugger<span class="w"> </span>warning:<span class="w"> </span>It<span class="w"> </span>seems<span class="w"> </span>that<span class="w"> </span>frozen<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>being<span class="w"> </span>used,<span class="w"> </span>which<span class="w"> </span>may
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>make<span class="w"> </span>the<span class="w"> </span>debugger<span class="w"> </span>miss<span class="w"> </span>breakpoints.<span class="w"> </span>Please<span class="w"> </span>pass<span class="w"> </span>-Xfrozen_modules<span class="o">=</span>off
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>to<span class="w"> </span>python<span class="w"> </span>to<span class="w"> </span>disable<span class="w"> </span>frozen<span class="w"> </span>modules.
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>Note:<span class="w"> </span>Debugging<span class="w"> </span>will<span class="w"> </span>proceed.<span class="w"> </span>Set<span class="w"> </span><span class="nv">PYDEVD_DISABLE_FILE_VALIDATION</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span>disable<span class="w"> </span>this<span class="w"> </span>val
idation.
<span class="o">[</span>KernelApp<span class="o">]</span><span class="w"> </span>Connection<span class="w"> </span>file:<span class="w"> </span>/home/hades/.local/share/jupyter/runtime/kernel-a57a8231-bfea-468
<span class="m">0</span>-9f8b-6bf1b1e3a7ac.json
<span class="o">[</span>KernelApp<span class="o">]</span><span class="w"> </span>To<span class="w"> </span>connect<span class="w"> </span>a<span class="w"> </span>client:<span class="w"> </span>--existing<span class="w"> </span>kernel-a57a8231-bfea-4680-9f8b-6bf1b1e3a7ac.json
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>Debugger<span class="w"> </span>warning:<span class="w"> </span>It<span class="w"> </span>seems<span class="w"> </span>that<span class="w"> </span>frozen<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>being<span class="w"> </span>used,<span class="w"> </span>which<span class="w"> </span>may
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>make<span class="w"> </span>the<span class="w"> </span>debugger<span class="w"> </span>miss<span class="w"> </span>breakpoints.<span class="w"> </span>Please<span class="w"> </span>pass<span class="w"> </span>-Xfrozen_modules<span class="o">=</span>off
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>to<span class="w"> </span>python<span class="w"> </span>to<span class="w"> </span>disable<span class="w"> </span>frozen<span class="w"> </span>modules.
<span class="m">0</span>.00s<span class="w"> </span>-<span class="w"> </span>Note:<span class="w"> </span>Debugging<span class="w"> </span>will<span class="w"> </span>proceed.<span class="w"> </span>Set<span class="w"> </span><span class="nv">PYDEVD_DISABLE_FILE_VALIDATION</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span>disable<span class="w"> </span>this<span class="w"> </span>validation.
</pre></div>
<p>According to <a href="https://stackoverflow.com/questions/75114841/debugger-warning-from-ipython-frozen-modules">this Stack Overflow post</a> the output, though scary-looking, is only a warning, and you should be able to ignore it. It's happening because python 3.11 uses a "frozen" version of python with code objects for some of the built-in python modules that get loaded when the interpreter starts up already pre-allocated in order to reduce their load time during python's start up (i.e. they set it up to start faster), and their doing this means that the debugger might not work correctly - but since I'm not using the debugger, it shouldn't matter.</p>
<ul class="org-ul">
<li><a href="https://docs.python.org/3/whatsnew/3.11.html#faster-startup">Python Note on their freezing the modules</a></li>
<li><a href="https://wiki.python.org/moin/Freeze">Python documentation of "freezing"</a></li>
</ul>
<p>Ah, but there's always a problem lurking behind the advice to ignore "harmless warnings". Even with the kernel running, I couldn't get python/jupyter to work in my org-babel source blocks, so there was more to do.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org141db97">
<h2 id="org141db97">Getting emacs-jupyter Working</h2>
<div class="outline-text-2" id="text-org141db97"></div>
<div class="outline-3" id="outline-container-org3e2ccb9">
<h3 id="org3e2ccb9">The Problem</h3>
<div class="outline-text-3" id="text-org3e2ccb9">
<p>The first clue as to what might be happing was this line in emacs' startup messages.</p>
<pre class="example" id="orgc0957f3">
Symbol’s function definition is void: org-babel-execute:jupyter-python
</pre>
<p>It looked like <a href="https://github.com/emacs-jupyter/jupyter">emacs-jupyter</a> wasn't loading properly. There was also this message in the output:</p>
<pre class="example" id="orgb7ae7a6">
Error retrieving kernelspecs: (json-number-format 5)
</pre>
<p>Searching for that error-message brought up this bug-report on github:</p>
<ul class="org-ul">
<li><a href="https://github.com/emacs-jupyter/jupyter/issues/436">https://github.com/emacs-jupyter/jupyter/issues/436</a></li>
</ul>
<p>Wherein the author of the bug-report mentions that loading emacs-jupyter is failing because it's trying to parse the output of jupyter and the warnings I was seeing causes it to fail (the bug-report references a different jupyter command, but the problematic output is the same).</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7e8aab9">
<h3 id="org7e8aab9">Testing Turning Off the Warning</h3>
<div class="outline-text-3" id="text-org7e8aab9">
<p>The first thing I tried was to follow the directions in the output and supress the warnings by setting an environment variable.</p>
<div class="highlight">
<pre><span></span><span class="nb">set</span><span class="w"> </span>--universal<span class="w"> </span>--export<span class="w"> </span>PYDEVD_DISABLE_FILE_VALIDATION<span class="w"> </span><span class="m">1</span>
</pre></div>
<p><b>Note:</b> This is fish-shell syntax.</p>
<p>I restarted the jupyter kernel and the warnings had gone away, so this much worked.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org8477523">
<h3 id="org8477523">Really Turning Off the Warning</h3>
<div class="outline-text-3" id="text-org8477523">
<p>Setting the environment variable at the command-line changes the environment for my user, but I'm running <a href="https://www.emacswiki.org/emacs/EmacsAsDaemon">emacs as a daemon</a> so I needed to edit the <code>systemctl</code> file for my emacs service. I opened up the <code>~/.config/systemd/user/emacs.service</code> file in emacs and added the line to set the environment variable for the emacs daemon.</p>
<div class="highlight">
<pre><span></span>[Service]
Environment="PYDEVD_DISABLE_FILE_VALIDATION=1"
</pre></div>
<p>Then I restarted the service.</p>
<div class="highlight">
<pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>--user<span class="w"> </span>emacs
</pre></div>
<p>Which gave me a warning that my changes to the configuration have to be re-loaded before restarting the service.</p>
<pre class="example" id="org1ba3b97">
Warning: The unit file, source configuration file or drop-ins of emacs.service changed on disk
. Run 'systemctl --user daemon-reload' to reload units.
</pre>
<p>Oops.</p>
<div class="highlight">
<pre><span></span>systemctl<span class="w"> </span>--user<span class="w"> </span>daemon-reload
systemctl<span class="w"> </span>restart<span class="w"> </span>--user<span class="w"> </span>emacs
</pre></div>
<p>This time the emacs startup messages didn't have the jupyter errors so it looked like things were fixed.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge86b025">
<h2 id="orge86b025">Swapping a Virtual Environment For pipx</h2>
<div class="outline-text-2" id="text-orge86b025">
<p>Suppressing the warnings <i>pretty much</i> solved the problem, but while I was getting this fixed I was also trying to set up a USB Windows installer using <a href="https://github.com/WoeUSB/WoeUSB">WoeUSB</a> and found that pipx couldn't install it because of a dependency error. Pipx is good at installing some standalone python commands but it won't install things that are just libraries and it seems to sometimes also have problems installing dependencies for the commands that it <i>will</i> install. This has come up for me before, and the old solution was just for me to install the dependencies separately using <code>pip</code> before trying to install whatever it was that I was installing with pipx. Now, though, since ubuntu is trying to keep you from installing python modules globally, installing the dependencies means they either have to be available through <code>apt</code> or you have to set up a virtual environment and install them there (when I say <i>have to</i> I mean that since that's the way I know how to do it, that's the way I have to do it, not that there aren't other ways to do it that I just don't know about).</p>
<p>Doing it this way is easy enough, since I use python virtual environments a lot anyway, but then I ran into another problem which was that once I got the virtual environment set up I found out I had to run woeUSB as root, which then bypasses the whole virtual environment setup. The solution to that was to pass the full path to the virtual environment's woeUSB launcher to <code>sudo</code>, but it took enough time experimenting with other ways to do it before I got to that step that I decided I should minimalize how much I use pipx as much as possible - and in particular I should avoid using it with my emacs setup, since emacs will sometimss just quietly fail if there's a python-based error and it's only when things don't work that I'll realize there's a problem. So I decided to go with a dedicated virtual environment instead of installing jupyter with pipx.</p>
<p>This, once again was not a big deal in hindsight, but it took enough experimenting with other options before coming to the conclusion that this was the way to go that I thought I should make a note to my future self about it. To get jupyter working with jupyter-emacs:</p>
<ul class="org-ul">
<li>create a virtual environment (<code>python3 -m venv emacs-environment</code>) in the <code>.virtualenvs</code> folder</li>
<li>activate it, then use pip to install <code>wheels</code> and <code>jupyter</code></li>
</ul>
<p>In the <code>/.emacs.d/init.el</code> file, activate the virtual environment <i>before</i> you load emacs-jupyter or anything else that needs python:</p>
<div class="highlight">
<pre><span></span><span class="p">(</span><span class="nf">require</span><span class="w"> </span><span class="ss">'pyvenv</span><span class="p">)</span>
<span class="p">(</span><span class="nf">pyvenv-activate</span><span class="w"> </span><span class="s">"~/.virtualenvs/emacs-environment"</span><span class="p">)</span>
</pre></div>
<p>Then restart emacs. So far this seems to have fixed it.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org821f370">
<h2 id="org821f370">Other Links</h2>
<div class="outline-text-2" id="text-org821f370">
<ul class="org-ul">
<li>EmacsWiki: Emacs As Daemon [Internet]. [cited 2023 May 28]. Available from: <a href="https://www.emacswiki.org/emacs/EmacsAsDaemon#h5o-2">https://www.emacswiki.org/emacs/EmacsAsDaemon#h5o-2</a></li>
<li>Schäfer J. pyvenv.el, Python virtual environment support for Emacs [Internet]. 2023 [cited 2023 May 28]. Available from: <a href="https://github.com/jorgenschaefer/pyvenv">https://github.com/jorgenschaefer/pyvenv</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/kernel-panic-at-the-lunar-lobster/">Kernel Panic At the Lunar Lobster</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/kernel-panic-at-the-lunar-lobster/" rel="bookmark"><time class="published dt-published" datetime="2023-05-03T16:20:07-07:00" itemprop="datePublished" title="2023-05-03 16:20">2023-05-03 16:20</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#org6ff5e6c">What Is This About?</a></li>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#orgc40f585">First Get It Working</a></li>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#org7483335">Not a Solution But A Finger Pointing</a></li>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#orge0ce278">Blame It On the Drivers</a></li>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#org5ec4d17">From Nouveau To Nvidia</a></li>
<li><a href="posts/kernel-panic-at-the-lunar-lobster/#org4fd4280">And the End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org6ff5e6c">
<h2 id="org6ff5e6c">What Is This About?</h2>
<div class="outline-text-2" id="text-org6ff5e6c">
<p>I got a notification yesterday (May 3, 2023) that there's a new version of Ubuntu out (<i>Lunar Lobster - 23.04</i>) so I ran <code>do-release-upgrade</code> while watching a video (<a href="https://en.wikipedia.org/wiki/An_Honest_Liar?useskin=vector">An Honest Liar</a>) about James Randi. At the end of the upgrade there was some kind of error message about not being able to configure the Linux headers, which in retrospect should have worried me, but I was distracted so I just dismissed it. Then today when I booted up the computer I got an error message saying <code>Kernel Panic - Not syncing: VFS: Unable to mount root fs on unknown-block (0,0)</code>. I managed to get it working (eventually) but now that Ubuntu's been around long enough and search engines seem to be choked with outdated answers I thought I'd document what I did in case it happens on another update.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgc40f585">
<h2 id="orgc40f585">First Get It Working</h2>
<div class="outline-text-2" id="text-orgc40f585">
<p>The first thing I tried was to follow the answers on <a href="https://askubuntu.com/questions/41930/kernel-panic-not-syncing-vfs-unable-to-mount-root-fs-on-unknown-block0-0">this Stackoverflow page</a>. The only thing this did was get my computer up and running again - which is, I suppose a big thing, not to be minimized, but there's a lot of stuff on that page and the only relevant parts were:</p>
<ol class="org-ol">
<li>Reboot</li>
<li>At the menu that comes up choose "Advanced Options for Ubuntu"</li>
<li>Pick a prior version of the Linux kernel (5.19.26 in my case) and let it finish starting up.</li>
</ol>
</div>
</div>
<div class="outline-2" id="outline-container-org7483335">
<h2 id="org7483335">Not a Solution But A Finger Pointing</h2>
<div class="outline-text-2" id="text-org7483335">
<p>The first thing I tried from that page was from <a href="https://askubuntu.com/a/939883">this answer</a>:</p>
<div class="highlight">
<pre><span></span>sudo dpkg --configure -a
</pre></div>
<p>This gave me <code>error processing package linux-image-6.2.0-generic (--configure)</code>. So I searched some more and tried the suggestion from <a href="https://askubuntu.com/a/517882">this askubuntu answer</a>:</p>
<div class="highlight">
<pre><span></span>sudo dpkg --purge linux-image-6.2.0-20-generic
</pre></div>
<p>This gives an error along the lines of "<code>dependency problems, not purging</code>". Oi. So then I tried:</p>
<div class="highlight">
<pre><span></span>sudo apt autoremove
</pre></div>
<p>This gave me another error:</p>
<p><img alt="Purge Error" src="posts/kernel-panic-at-the-lunar-lobster/purge-error.webp"></p>
<p>This time in the error message it said to check out <code>/var/lib/dkms/nvidia/510.108.03/build/make.log</code> which turned out not to have any useful information (to me, anyway) but it did tell me that there was something going on with my nvidia drivers that was causing the configuration of the new Linux kernel to fail.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orge0ce278">
<h2 id="orge0ce278">Blame It On the Drivers</h2>
<div class="outline-text-2" id="text-orge0ce278">
<p><i>"Something going on with my nvidia drivers"</i> being a little too vague for me to troubleshoot, I decided to go the brute force way and uninstall the nvidia-drivers. This actually proved a little harder than I thought it would be (which seems to always be the case, maybe I'm too optimistic about this kind of stuff). Every time I tried to run</p>
<div class="highlight">
<pre><span></span>sudo apt remove nvidia-driver-510
</pre></div>
<p><code>apt</code> would try and configure the Linux kernel and run into the same error that I had before and exit without uninstalling the driver. Some kind of chicken and the egg thing. So then I tried <code>dpkg</code> instead of <code>apt</code> first:</p>
<div class="highlight">
<pre><span></span>sudo dpkg --purge nvidia-driver-510
sudo apt autoremove
</pre></div>
<p><code>dpkg</code> managed to uninstall the driver and running <code>apt autoremove</code> not only cleaned out the unused packages but also triggered the kernel configuration and this time… no errors.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org5ec4d17">
<h2 id="org5ec4d17">From Nouveau To Nvidia</h2>
<div class="outline-text-2" id="text-org5ec4d17">
<p>After a reboot it started up okay and this time <code>uname -r</code> showed that I was using the newer kernel (<code>6.2.0-20-generic</code>). Yay. But now when I tried to re-install the nvidia drivers neither <code>ubuntu-drivers</code> nor <code>apt</code> seemed to know that they existed. It turns out that updating the ubuntu installation removes the proprietary drivers from the apt sources. So I launched the "Software & Updates" GUI.</p>
<p><img alt="Software &amp; Updates" src="posts/kernel-panic-at-the-lunar-lobster/software-updates.webp"></p>
<p>And checked the "Proprietary drivers for devices (restricted)" button.</p>
<p><img alt="Proprietary Drivers" src="posts/kernel-panic-at-the-lunar-lobster/proprietary-drivers.webp"></p>
<p>I chose to update the apt listing when I closed the GUI and then installed the drivers at the command line:</p>
<div class="highlight">
<pre><span></span>sudo ubuntu-drivers install
</pre></div>
<p>And then, after another reboot, now it works (I checked with <code>nvidia-smi</code>).</p>
</div>
</div>
<div class="outline-2" id="outline-container-org4fd4280">
<h2 id="org4fd4280">And the End</h2>
<div class="outline-text-2" id="text-org4fd4280">
<p>I haven't run any tests other than using the system but this seems to have fixed the problem. Well, the problem with the kernel, updating also broke all my python virtual environments, but, oh, well, better than a kernel panic, I suppose.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/converting-a-date-to-day-of-the-year-in-python/">Converting A Date To Day of the Year In Python</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/converting-a-date-to-day-of-the-year-in-python/" rel="bookmark"><time class="published dt-published" datetime="2023-02-07T16:56:59-08:00" itemprop="datePublished" title="2023-02-07 16:56">2023-02-07 16:56</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/converting-a-date-to-day-of-the-year-in-python/#org65d7765">Date To Day of Year</a></li>
<li><a href="posts/converting-a-date-to-day-of-the-year-in-python/#org08d5112">Day Of Year To Date</a></li>
<li><a href="posts/converting-a-date-to-day-of-the-year-in-python/#org8c44f50">Source</a></li>
</ul>
</div>
</div>
<p>This is a quick note on how to take a date and convert it to the day of the year (and back again) using python.</p>
<div class="outline-2" id="outline-container-org65d7765">
<h2 id="org65d7765">Date To Day of Year</h2>
<div class="outline-text-2" id="text-org65d7765">
<p>We're going to use python's built-in <a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a> object to create the date then convert it to a timetuple using its <a href="https://docs.python.org/3/library/datetime.html#datetime-objects">timetuple</a> method. The timetuple has an attribute <code>tm_yday</code> which is the number of days in the year that the date represents.</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span> <span class="o">=</span> <span class="mi">2023</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span>

<span class="n">DAY_OF_YEAR</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DAY_OF_YEAR</span><span class="p">)</span>
</pre></div>
<pre class="example">
38
</pre>
<p>So, February 7, 2023 is the 38th day of the year.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org08d5112">
<h2 id="org08d5112">Day Of Year To Date</h2>
<div class="outline-text-2" id="text-org08d5112">
<p>Now to go in the other direction we start with the first day of the year (represented as a datetime object) and add the number of days into the year we want. You can't create a datetime object with day zero so we need to start it on day one and then subtract one day from the number of days that we want.</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">JANUARY</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">JANUARY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">DAY_OF_YEAR</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">))</span>
</pre></div>
<pre class="example">
2023-02-07
</pre>
<p>Easy-peasey.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org8c44f50">
<h2 id="org8c44f50">Source</h2>
<div class="outline-text-2" id="text-org8c44f50">
<ul class="org-ul">
<li><a href="https://stackoverflow.com/a/623312">Answer on StackOverflow</a> that shows how to get the day of the year from the date.</li>
<li><a href="https://stackoverflow.com/a/13032755">Answer to the same question</a> that shows how to go from the day of the year back to the date.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/pytorch-and-the-unknown-cuda-error/">PyTorch and the Unknown CUDA Error</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/pytorch-and-the-unknown-cuda-error/" rel="bookmark"><time class="published dt-published" datetime="2022-10-31T17:58:27-07:00" itemprop="datePublished" title="2022-10-31 17:58">2022-10-31 17:58</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/pytorch-and-the-unknown-cuda-error/#orgd6a3853">The Problem</a></li>
<li><a href="posts/pytorch-and-the-unknown-cuda-error/#org684865c">The Symptom</a></li>
<li><a href="posts/pytorch-and-the-unknown-cuda-error/#org5bd59d4">The Disease and Its Cure</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd6a3853">
<h2 id="orgd6a3853">The Problem</h2>
<div class="outline-text-2" id="text-orgd6a3853">
<p>I recently decided to get back into using neural networks again and tried to update my docker container to get <a href="https://www.fast.ai/">fastai</a> up and running, but couldn't get CUDA working. After a while spent trying different configurations of CUDA, pytorch, pip, conda, and on and on I eventually found out that there's some kind of problem with using CUDA after suspending and then resuming your system (at least with linux/Ubuntu). This is a documentation of that particular problem and it's fixes (fastest but not necessarily the best answer: always shutdown or reboot the machine, don't suspend and resume).</p>
</div>
</div>
<div class="outline-2" id="outline-container-org684865c">
<h2 id="org684865c">The Symptom</h2>
<div class="outline-text-2" id="text-org684865c">
<p>This is what happens if I try to use CUDA after waking the machine from a suspend.</p>
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
</pre></div>
<pre class="example">
/home/athena/.conda/envs/neurotic-fastai/lib/python3.9/site-packages/torch/cuda/__init__.py:88: UserWarning: CUDA initialization: CUDA unknown error - this may be due to an incorrectly set up environment, e.g. changing env variable CUDA_VISIBLE_DEVICES after program start. Setting the available devices to be zero. (Triggered internally at /opt/conda/conda-bld/pytorch_1666642975993/work/c10/cuda/CUDAFunctions.cpp:109.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
<p>As you can see, the error message doesn't really give any useful information about what's wrong - there <i>are</i> a couple of suggestions but neither seems relevant or at least doesn't lead you to the fix.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org5bd59d4">
<h2 id="org5bd59d4">The Disease and Its Cure</h2>
<div class="outline-text-2" id="text-org5bd59d4">
<p>There's a post on the <a href="https://discuss.pytorch.org/t/userwarning-cuda-initialization-cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment-e-g-changing-env-variable-cuda-visible-devices-after-program-start-setting-the-available-devices-to-be-zero/129335/2">pytorch discussion boards</a> about this error in which "ptrblck" says that he runs into this problem if his machine is put into the suspend state. While mentioning this he also says that restarting his machine fixes the problem, but restarting it every time seems to defeat the purpose of using suspend (and I'd have to walk to a different room to log in and decrypt the drive after restarting the machine - ugh, so much work).</p>
<p>Luckily, in a <a href="https://discuss.pytorch.org/t/userwarning-cuda-initialization-cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment-e-g-changing-env-variable-cuda-visible-devices-after-program-start-setting-the-available-devices-to-be-zero/129335/5">later post</a> in the thread the same user mentions that you can also fix it by reloading the <code>nvidia_uvm</code> kernel module by entering these commands in the terminal:</p>
<div class="highlight">
<pre><span></span>sudo rmmod nvidia_uvm
sudo modprobe nvidia_uvm
</pre></div>
<p>Which seems to fix the problem for me right at the moment, without the need to restart the machine.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>
</pre></div>
<pre class="example">
False
</pre>
<p>Ummm… oops. Well, it did sort of fix one problem - the <code>CUDA unknown error</code>, but now it's saying that CUDA isn't available on this machine. Every fix begets a new problem. Let's try it again after restarting the Jupyter kernel.</p>
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>
</pre></div>
<pre class="example">
True
</pre>
<p>Okay, that's better, I guess. It feels a little inelegant to have to do this, but at least it seems to work.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/tangling-multiple-org-files/">Tangling Multiple Org Files</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/tangling-multiple-org-files/" rel="bookmark"><time class="published dt-published" datetime="2022-03-21T17:30:14-07:00" itemprop="datePublished" title="2022-03-21 17:30">2022-03-21 17:30</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/tangling-multiple-org-files/#orgc5a13c6">The Steps</a>
<ul>
<li><a href="posts/tangling-multiple-org-files/#org90471af">Create one.org</a></li>
<li><a href="posts/tangling-multiple-org-files/#org00e3a83">Create two.org</a></li>
<li><a href="posts/tangling-multiple-org-files/#org2d245df">Export one.org</a></li>
<li><a href="posts/tangling-multiple-org-files/#orge562fb1">Tangle one.org.org</a></li>
</ul>
</li>
<li><a href="posts/tangling-multiple-org-files/#org5ee95b9">Sources</a></li>
</ul>
</div>
</div>
<p>I've been looking off and on for ways to combine separate code-blocks in org-mode into a single tangled file. I wanted to use it because I tangle code that I want to re-use out of posts but then if I want to break the posts up I need to create a separate file (tangle) for each post. I'm hopeful that this method will allow me to break up a tangle across multiple posts. I've only tried it on toy files but I want to get some initial documentation for it in place.</p>
<div class="outline-2" id="outline-container-orgc5a13c6">
<h2 id="orgc5a13c6">The Steps</h2>
<div class="outline-text-2" id="text-orgc5a13c6">
<p>Let's say that there are two source org-files:</p>
<ul class="org-ul">
<li><code>one.org</code>: contains the tangle block and a source block</li>
<li><code>two.org</code>: contains another block that we want to tangle with the one in <code>one.org</code></li>
</ul>
<p>The steps are:</p>
<ol class="org-ol">
<li>Put an <code>#+INCLUDE</code> directive to include <code>two.org</code> into <code>one.org</code></li>
<li>Export <code>one.org</code> to an <code>org</code> file</li>
<li>Open the exported org file (<code>one.org.org</code>)</li>
<li>Tangle it.</li>
</ol>
</div>
<div class="outline-3" id="outline-container-org90471af">
<h3 id="org90471af">Create one.org</h3>
<div class="outline-text-3" id="text-org90471af">
<p>The file <code>one.org</code> is going to have the tangle and the first source-block:</p>
<div class="highlight">
<pre><span></span>#+begin_src python :tangle ~/test.py :exports none
&lt;&lt;block-one&gt;&gt;

&lt;&lt;block-two&gt;&gt;
#+end_src
</pre></div>
<div class="highlight">
<pre><span></span>#+begin_src python :noweb-ref block-one
def one():
    print("One")
#+end_src
</pre></div>
<p>We also need to include what's in the second file (<code>two.org</code>). The code we want to include is in a section called <code>Two</code> so we can include just that section by adding a search term at the end.</p>
<div class="highlight">
<pre><span></span>#+INCLUDE: "./two.org::*Two"
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org00e3a83">
<h3 id="org00e3a83">Create two.org</h3>
<div class="outline-text-3" id="text-org00e3a83">
<p>In the other file add the section header to match the <code>INCLUDE</code> search term (<code>*Two</code>) and put a code block with a reference named <code>block-two</code> to match what's in the tangle block above.</p>
<div class="highlight">
<pre><span></span>* Two
#+begin_src python :noweb-ref block-two
def two():
print("Two")
#+end_src
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2d245df">
<h3 id="org2d245df">Export one.org</h3>
<div class="outline-text-3" id="text-org2d245df">
<p>Tangling unfortunately ignores the <code>INCLUDE</code> directive so we have to export it first to another org-file in order to get the text from <code>org.two</code> into our source file. By default, exporting to <code>org</code> is disabled so you need to enable it (e.g. starting with <code>M-x customize</code> <code>org-export-backends</code>).</p>
<p>Once it's enabled you can export <code>one.org</code> to an org-mode file using <code>C-c C-e O v</code> (the default name will be <code>one.org.org</code>).</p>
</div>
</div>
<div class="outline-3" id="outline-container-orge562fb1">
<h3 id="orge562fb1">Tangle one.org.org</h3>
<div class="outline-text-3" id="text-orge562fb1">
<p>The last choice when we exported the file in the previous step (<code>v</code>) will save it to a file and open it up in an emacs buffer. When the buffer is open you can then tangle it (<code>C-c C-v C-t</code>) and the output (<code>/test.py</code> from our tangle block) should contain both of our functions.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5ee95b9">
<h2 id="org5ee95b9">Sources</h2>
<div class="outline-text-2" id="text-org5ee95b9">
<p>This is where I got the information on breaking up the files. It includes some emacs-lisp to run the steps automatically (although I didn't try it):</p>
<ul class="org-ul">
<li>Multi-File Org-Babel Tangles with Include Directives [Internet]. DEV Community. [cited 2022 Mar 21]. Available from: <a href="https://dev.to/jfhbrook/multi-file-org-babel-tangles-with-include-directives-5522">https://dev.to/jfhbrook/multi-file-org-babel-tangles-with-include-directives-5522</a></li>
</ul>
<p>This is the post that mentions that exporting org-files to org-format needs to be enabled (and how to do it):</p>
<ul class="org-ul">
<li>exporting - Org mode export subtree to new org file - option missing? [Internet]. Emacs Stack Exchange. [cited 2022 Mar 21]. Available from: <a href="https://emacs.stackexchange.com/a/70453">https://emacs.stackexchange.com/a/70453</a></li>
</ul>
<p>This is the manual page explaining the search syntax (which is what the <code>#+INCLUDE</code> format uses).</p>
<ul class="org-ul">
<li>Search Options (The Org Manual) [Internet]. [cited 2022 Mar 21]. Available from: <a href="https://orgmode.org/manual/Search-Options.html">https://orgmode.org/manual/Search-Options.html</a></li>
</ul>
<p>This explains the <code>#+INCLUDE</code> directive options:</p>
<ul class="org-ul">
<li>Include Files (The Org Manual) [Internet]. [cited 2022 Mar 21]. Available from: <a href="https://orgmode.org/manual/Include-Files.html">https://orgmode.org/manual/Include-Files.html</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/code-wars-pick-peaks/">CodeWars: Pick Peaks</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/code-wars-pick-peaks/" rel="bookmark"><time class="published dt-published" datetime="2022-02-18T17:10:32-08:00" itemprop="datePublished" title="2022-02-18 17:10">2022-02-18 17:10</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/code-wars-pick-peaks/#orgccea467">Beginning</a></li>
<li><a href="posts/code-wars-pick-peaks/#org2e28c7a">Code</a>
<ul>
<li><a href="posts/code-wars-pick-peaks/#orgceed2b4">Imports</a></li>
<li><a href="posts/code-wars-pick-peaks/#orgb8bf68c">The Submission</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgccea467">
<h2 id="orgccea467">Beginning</h2>
<div class="outline-text-2" id="text-orgccea467">
<p>The problem given is to write a function that returns the location and values of local maxima within a list (array). The inputs will be (possibly empty) lists with integers. The first and last elements cannot be called peaks since we don't know what comes before the first element or after the last element.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org2e28c7a">
<h2 id="org2e28c7a">Code</h2>
<div class="outline-text-2" id="text-org2e28c7a"></div>
<div class="outline-3" id="outline-container-orgceed2b4">
<h3 id="orgceed2b4">Imports</h3>
<div class="outline-text-3" id="text-orgceed2b4">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb8bf68c">
<h3 id="orgb8bf68c">The Submission</h3>
<div class="outline-text-3" id="text-orgb8bf68c">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">pick_peaks</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find local maxima</span>

<span class="sd">    Args:</span>
<span class="sd">     array: list of integers to search</span>

<span class="sd">    Returns:</span>
<span class="sd">     pos, peaks dict of maxima</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">[],</span> <span class="n">peaks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">array</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">peak</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">peak</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">array</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">array</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">"pos"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">"peaks"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peak</span><span class="p">)</span>
            <span class="n">peak</span> <span class="o">=</span> <span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">3</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">3</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">3</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="s2">"peaks"</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s1">'pos'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span> <span class="s1">'peaks'</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">18</span><span class="p">]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[],</span><span class="s2">"peaks"</span><span class="p">:[]}))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pick_peaks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">({</span><span class="s2">"pos"</span><span class="p">:[],</span><span class="s2">"peaks"</span><span class="p">:[]}))</span>
</pre></div>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/codewars-simple-pig-latin/">CodeWars: Simple Pig Latin</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/codewars-simple-pig-latin/" rel="bookmark"><time class="published dt-published" datetime="2022-02-15T18:12:05-08:00" itemprop="datePublished" title="2022-02-15 18:12">2022-02-15 18:12</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/codewars-simple-pig-latin/#orge9443db">Description</a></li>
<li><a href="posts/codewars-simple-pig-latin/#org0f991c2">Code</a>
<ul>
<li><a href="posts/codewars-simple-pig-latin/#org66bfde7">Imports</a></li>
<li><a href="posts/codewars-simple-pig-latin/#orga97dadc">Submission</a></li>
</ul>
</li>
<li><a href="posts/codewars-simple-pig-latin/#org5e6ce16">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge9443db">
<h2 id="orge9443db">Description</h2>
<div class="outline-text-2" id="text-orge9443db">
<p>Move the first letter of each word to the end of it, then add "ay" to the end of the word. Leave punctuation marks untouched.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org0f991c2">
<h2 id="org0f991c2">Code</h2>
<div class="outline-text-2" id="text-org0f991c2"></div>
<div class="outline-3" id="outline-container-org66bfde7">
<h3 id="org66bfde7">Imports</h3>
<div class="outline-text-3" id="text-org66bfde7">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orga97dadc">
<h3 id="orga97dadc">Submission</h3>
<div class="outline-text-3" id="text-orga97dadc">
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">LETTERS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[a-zA-Z]"</span><span class="p">)</span>
<span class="n">WORD_BOUNDARY</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\b"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert a single word to pig-latin</span>

<span class="sd">    Args:</span>
<span class="sd">     token: string representing a single token</span>

<span class="sd">    Returns: </span>
<span class="sd">     pig-latinized word (if appropriate)</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}{</span><span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">ay"</span>
            <span class="k">if</span> <span class="n">token</span> <span class="ow">and</span> <span class="n">LETTERS</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">else</span> <span class="n">token</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pig_it</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Basic pig latin converter</span>

<span class="sd">    Moves first letter of words to the end and adds 'ay' to the end</span>

<span class="sd">    Args:</span>
<span class="sd">     text: string to pig-latinize</span>

<span class="sd">    Returns:</span>
<span class="sd">     pig-latin version of text</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">WORD_BOUNDARY</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">pig_it</span><span class="p">(</span><span class="s1">'Pig latin is cool'</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s1">'igPay atinlay siay oolcay'</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pig_it</span><span class="p">(</span><span class="s1">'This is my string'</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s1">'hisTay siay ymay tringsay'</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pig_it</span><span class="p">(</span><span class="s2">"Hello World !"</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"elloHay orldWay !"</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5e6ce16">
<h2 id="org5e6ce16">Sources</h2>
<div class="outline-text-2" id="text-org5e6ce16">
<ul class="org-ul">
<li><a href="https://www.codewars.com/kata/520b9d2ad5c005041100000f/train/python">CodeWars: Simple Pig Latin</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/codewars-rgb-to-hexadecimal/">CodeWars: RGB To Hexadecimal</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/codewars-rgb-to-hexadecimal/" rel="bookmark"><time class="published dt-published" datetime="2022-02-14T20:07:51-08:00" itemprop="datePublished" title="2022-02-14 20:07">2022-02-14 20:07</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/codewars-rgb-to-hexadecimal/#orgc2308b4">Description</a></li>
<li><a href="posts/codewars-rgb-to-hexadecimal/#org288013c">The Code</a>
<ul>
<li><a href="posts/codewars-rgb-to-hexadecimal/#orga61e8df">Imports</a></li>
<li><a href="posts/codewars-rgb-to-hexadecimal/#orgd776ac0">Submission</a></li>
<li><a href="posts/codewars-rgb-to-hexadecimal/#org8745641">Alternatives</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc2308b4">
<h2 id="orgc2308b4">Description</h2>
<div class="outline-text-2" id="text-orgc2308b4">
<p>Given three arguments <code>r</code>, <code>g</code>, and <code>b</code> which are integers from 0 to 255 representing RGB values, convert them to a six digit (zero-padded) hexadecimal string. Invalid (out of range) values need to be rounded to nearest value.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org288013c">
<h2 id="org288013c">The Code</h2>
<div class="outline-text-2" id="text-org288013c"></div>
<div class="outline-3" id="outline-container-orga61e8df">
<h3 id="orga61e8df">Imports</h3>
<div class="outline-text-3" id="text-orga61e8df">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd776ac0">
<h3 id="orgd776ac0">Submission</h3>
<div class="outline-text-3" id="text-orgd776ac0">
<div class="highlight">
<pre><span></span><span class="n">HEX_DIGITS</span> <span class="o">=</span> <span class="s2">"0123456789ABCDEF"</span>
<span class="n">RGB_TO_HEX</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">HEX_DIGITS</span><span class="p">)),</span> <span class="n">HEX_DIGITS</span><span class="p">))</span>
<span class="n">HEX</span> <span class="o">=</span> <span class="mi">16</span>

<span class="k">def</span> <span class="nf">rgb</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert RGB to Hexadecimal</span>

<span class="sd">    If the values are out of bounds they will be set to the nearest limit</span>

<span class="sd">    e.g. -1 becomes 0 and 2919 becomes 255</span>

<span class="sd">    Non-integers will raise an error</span>

<span class="sd">    Args:</span>
<span class="sd">     r: red channel (0-255)</span>
<span class="sd">     g: green channel (0-255)</span>
<span class="sd">     b: blue channel (0-255)</span>

<span class="sd">    Returns:</span>
<span class="sd">     6-digit hexadecimal equivalent of r, g, b</span>
<span class="sd">    """</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">converted</span> <span class="o">=</span> <span class="p">((</span><span class="n">RGB_TO_HEX</span><span class="p">[</span><span class="n">color</span><span class="o">//</span><span class="n">HEX</span><span class="p">],</span> <span class="n">RGB_TO_HEX</span><span class="p">[</span><span class="n">color</span> <span class="o">%</span> <span class="n">HEX</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">converted</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"000000"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"010203"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"FFFFFF"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">254</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span><span class="mi">252</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"FEFDFC"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">275</span><span class="p">,</span><span class="mi">125</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"00FF7D"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8745641">
<h3 id="org8745641">Alternatives</h3>
<div class="outline-text-3" id="text-org8745641">
<p>A surprising number of people used the string formatting - <code>{:02X}</code> to convert the numbers to hexadecimal. I think that's sort of the problem with these earlier puzzles - there's a big question of how much of python's built in functionality you should use. I guess since I use string formatting a lot that might make sense as a shortcut in this case.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">rgb_2</span><span class="p">(</span><span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Convert RGB to Hexadecimal</span>

<span class="sd">    If the values are out of bounds they will be set to the nearest limit</span>

<span class="sd">    e.g. -1 becomes 0 and 2919 becomes 255</span>

<span class="sd">    Non-integers will raise an error</span>

<span class="sd">    Args:</span>
<span class="sd">     r: red channel (0-255)</span>
<span class="sd">     g: green channel (0-255)</span>
<span class="sd">     b: blue channel (0-255)</span>

<span class="sd">    Returns:</span>
<span class="sd">     6-digit hexadecimal equivalent of r, g, b</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">02X</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">rgb_2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"000000"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb_2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"010203"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb_2</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"FFFFFF"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb_2</span><span class="p">(</span><span class="mi">254</span><span class="p">,</span><span class="mi">253</span><span class="p">,</span><span class="mi">252</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"FEFDFC"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rgb_2</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">275</span><span class="p">,</span><span class="mi">125</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"00FF7D"</span><span class="p">))</span>
</pre></div>
<p>Not quite so readable, but short.</p>
</div>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="next"><a href="index-21.html" rel="next">Older posts</a></li>
</ul>
<!--End of body content-->
<footer id="footer">Contents © 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
