<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>The Cloistered Monkey (Posts about troubleshooting)</title><link>https://necromuralist.github.io/</link><description></description><atom:link href="https://necromuralist.github.io/categories/troubleshooting.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2023 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;Cloistered Monkey&lt;/a&gt; </copyright><lastBuildDate>Thu, 04 May 2023 00:33:53 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>PyTorch and the Unknown CUDA Error</title><link>https://necromuralist.github.io/posts/pytorch-and-the-unknown-cuda-error/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/pytorch-and-the-unknown-cuda-error/#org31b7f1d"&gt;The Problem&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/pytorch-and-the-unknown-cuda-error/#org89a3666"&gt;The Symptom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/pytorch-and-the-unknown-cuda-error/#org77787ca"&gt;The Disease and Its Cure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org31b7f1d" class="outline-2"&gt;
&lt;h2 id="org31b7f1d"&gt;The Problem&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org31b7f1d"&gt;
&lt;p&gt;
I recently decided to get back into using neural networks again and tried to update my docker container to get &lt;a href="https://www.fast.ai/"&gt;fastai&lt;/a&gt; up and running, but couldn't get CUDA working. After a while spent trying different configurations of CUDA, pytorch, pip, conda, and on and on I eventually found out that there's some kind of problem with using CUDA after suspending and then resuming your system (at least with linux/Ubuntu). This is a documentation of that particular problem and it's fixes (fastest but not necessarily the best answer: always shutdown or reboot the machine, don't suspend and resume).
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-org89a3666" class="outline-2"&gt;
&lt;h2 id="org89a3666"&gt;The Symptom&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org89a3666"&gt;
&lt;p&gt;
This is what happens if I try to use CUDA after waking the machine from a suspend.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
/home/athena/.conda/envs/neurotic-fastai/lib/python3.9/site-packages/torch/cuda/__init__.py:88: UserWarning: CUDA initialization: CUDA unknown error - this may be due to an incorrectly set up environment, e.g. changing env variable CUDA_VISIBLE_DEVICES after program start. Setting the available devices to be zero. (Triggered internally at /opt/conda/conda-bld/pytorch_1666642975993/work/c10/cuda/CUDAFunctions.cpp:109.)
  return torch._C._cuda_getDeviceCount() &amp;gt; 0
&lt;/pre&gt;


&lt;p&gt;
As you can see, the error message doesn't really give any useful information about what's wrong - there &lt;i&gt;are&lt;/i&gt; a couple of suggestions but neither seems relevant or at least doesn't lead you to the fix.
&lt;/p&gt;
&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org77787ca" class="outline-2"&gt;
&lt;h2 id="org77787ca"&gt;The Disease and Its Cure&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org77787ca"&gt;
&lt;p&gt;
There's a post on the &lt;a href="https://discuss.pytorch.org/t/userwarning-cuda-initialization-cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment-e-g-changing-env-variable-cuda-visible-devices-after-program-start-setting-the-available-devices-to-be-zero/129335/2"&gt;pytorch discussion boards&lt;/a&gt; about this error in which "ptrblck" says that he runs into this problem if his machine is put into the suspend state. While mentioning this he also says that restarting his machine fixes the problem, but restarting it every time seems to defeat the purpose of using suspend (and I'd have to walk to a different room to log in and decrypt the drive after restarting the machine - ugh, so much work). 
&lt;/p&gt;

&lt;p&gt;
Luckily, in a &lt;a href="https://discuss.pytorch.org/t/userwarning-cuda-initialization-cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment-e-g-changing-env-variable-cuda-visible-devices-after-program-start-setting-the-available-devices-to-be-zero/129335/5"&gt;later post&lt;/a&gt; in the thread the same user mentions that you can also fix it by reloading the &lt;code&gt;nvidia_uvm&lt;/code&gt; kernel module by entering these commands in the terminal:
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;p&gt;
Which seems to fix the problem for me right at the moment, without the need to restart the machine.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
False
&lt;/pre&gt;


&lt;p&gt;
Ummm… oops. Well, it did sort of fix one problem - the &lt;code&gt;CUDA unknown error&lt;/code&gt;, but now it's saying that CUDA isn't available on this machine. Every fix begets a new problem. Let's try it again after restarting the Jupyter kernel.
&lt;/p&gt;

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in &lt;module&gt;
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

&lt;pre class="example"&gt;
True
&lt;/pre&gt;


&lt;p&gt;
Okay, that's better, I guess. It feels a little inelegant to have to do this, but at least it seems to work.
&lt;/p&gt;
&lt;/module&gt;&lt;/module&gt;&lt;/module&gt;&lt;/div&gt;
&lt;/div&gt;</description><category>cuda</category><category>pytorch</category><category>troubleshooting</category><guid>https://necromuralist.github.io/posts/pytorch-and-the-unknown-cuda-error/</guid><pubDate>Tue, 01 Nov 2022 00:58:27 GMT</pubDate></item><item><title>Mozilla Madness: Resist Fingerprinting!</title><link>https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/#org36db6b4"&gt;The Short Version For My Future Self&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/#orgf64d440"&gt;Back To the Story: It Was a Dark and Rainy Day&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/#org936f12b"&gt;Start With the Nuclear Option&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/#orga06ccce"&gt;The Slow Crawl Back&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/#orgc1595df"&gt;Is It a Bug?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org36db6b4" class="outline-2"&gt;
&lt;h2 id="org36db6b4"&gt;The Short Version For My Future Self&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org36db6b4"&gt;
&lt;p&gt;
Although some sites tell you to set Firefox's &lt;code&gt;privacy.resistFingerprinting&lt;/code&gt; option to true, it breaks altair's interaction and some other sites that use the canvas. It's probably better not to use that option, but if you do either:
&lt;/p&gt;

&lt;ul class="org-ul"&gt;
&lt;li&gt;Install the &lt;a href="https://addons.mozilla.org/en-US/firefox/addon/toggle-resist-fingerprinting/"&gt;Toggle Resist Fingerprinting&lt;/a&gt; extension and turn it off when things break (or just keep turning it off in &lt;code&gt;about:config&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Or set &lt;code&gt;privacy.resistFingerprinting.autoDeclineNoUserInputCanvasPrompts&lt;/code&gt; to False and accept the popup requests for the page you want to use.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgf64d440" class="outline-2"&gt;
&lt;h2 id="orgf64d440"&gt;Back To the Story: It Was a Dark and Rainy Day&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgf64d440"&gt;
&lt;p&gt;
I decided to give &lt;a href="https://altair-viz.github.io/"&gt;altair&lt;/a&gt;, the python data visualization library a try yesterday, just to see what it looked like. I ran their "hello, world" example and managed to get a plot.
&lt;/p&gt;

&lt;object type="text/html" data="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/test-bar-plot.html" style="width:100%" height="800"&gt;
  &lt;p&gt;Figure Missing&lt;/p&gt;
&lt;/object&gt;

&lt;p&gt;
Nothing fancy. If you move your cursor over the bars you might get a tool-tip giving you the width of the bar. If you do then you don't have the problem I ran into yesterday when I was trying it out. The image itself came out clear enough, but I couldn't figure out how to make the tool-tips work. I got desperate enough to try and read the documentation but it seems to be split between examples and API descriptions with little more in the way of explanatory documentation that would help to figure out how it was supposed to work. There are a lot of examples, though, so I decided to see if they would help, but then when I was looking at their &lt;a href="https://altair-viz.github.io/gallery/scatter_tooltips.html"&gt;Scatter Plot with Tool-tips&lt;/a&gt; example I noticed that their plots didn't have tool-tips either, which seemed suspicious. Was their library that broken? Was the internet?
&lt;/p&gt;

&lt;p&gt;
I took a look at the JavaScript console and that's when I saw these messages.
&lt;/p&gt;

&lt;p&gt;
&lt;img src="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/blocked-canvas-data.png" alt="nil"&gt;
&lt;/p&gt;

&lt;p&gt;
It looked like it might be important, but when I went searching for the message I couldn't find anything relevant. At least not at first.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org936f12b" class="outline-2"&gt;
&lt;h2 id="org936f12b"&gt;Start With the Nuclear Option&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org936f12b"&gt;
&lt;p&gt;
My first thought was that they had somehow made altair Chromium-only so I installed &lt;a href="https://brave.com/"&gt;brave&lt;/a&gt; and, sure enough, the tool-tips worked when I switched browsers. So my initial conclusion was that I'd have to switch browsers if I decided to use altair. But then it occurred to me that I'd had problems in the past with some sites and anti-tracking options turned on in firefox so maybe it had something to do with that or one of the extensions. The question was, what setting was it or what extension? I eventually decided it was too much work to figure out so I first tried to use &lt;a href="https://support.mozilla.org/en-US/kb/diagnose-firefox-issues-using-troubleshoot-mode"&gt;Troubleshoot Mode&lt;/a&gt; to disable all the extensions, and when that didn't work, I did a &lt;a href="https://support.mozilla.org/en-US/kb/refresh-firefox-reset-add-ons-and-settings"&gt;refresh&lt;/a&gt; and wiped out all the customizations I'd done to firefox. Amazingly, this worked, but now I had to go about setting Firefox up again while avoiding whatever I did that broke altair.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orga06ccce" class="outline-2"&gt;
&lt;h2 id="orga06ccce"&gt;The Slow Crawl Back&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orga06ccce"&gt;
&lt;p&gt;
I decided to follow the advice on the &lt;a href="https://restoreprivacy.com/firefox-privacy/"&gt;restoreprivacy.com&lt;/a&gt; page, just because it came up on the first page of my search results and it seemed to touch most of the bases that I'd run before this episode. As I did a step in the setup I would check back with the altair plot to make sure that the tool-tip was still working until, eventually, I came to the setting that broke it - &lt;code&gt;privacy.resistFingerprinting&lt;/code&gt;.
&lt;/p&gt;

&lt;p&gt;
&lt;img src="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/resist-fingerprinting.png" alt="nil"&gt;
&lt;/p&gt;

&lt;p&gt;
When I set it to true the tool-tips would break and when I set it to false they would work again. So, then what? I didn't want to disable fingerprint protection, so I thought I'd do a little more searching and see if there was another way.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgc1595df" class="outline-2"&gt;
&lt;h2 id="orgc1595df"&gt;Is It a Bug?&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgc1595df"&gt;
&lt;p&gt;
I decided to do a search on &lt;a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox"&gt;Bugzilla&lt;/a&gt; and found what seemed like a relevant bug: &lt;a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1631673"&gt;WhatsApp Web images broken if you flip `privacy.resistFingerprinting` due to canvas prompts without user interaction&lt;/a&gt;. The discussion is about What's App and also mentions Instagram and Twitter, and although they are focused on images, the actual error seemed close enough to what I was seeing that it seemed like it might be the same or a similar thing. But the bug was opened two years ago, so if it is a bug it doesn't seem to be something they're eager to fix. Then I ran across this bug: &lt;a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1376865"&gt;Do not display Canvas Prompt unless triggered by user input&lt;/a&gt; which discusses changing the default behavior to not prompt the user for permission to use the canvas. Now that I'm describing it I'm not sure how I came to this next step based on that bug, but for some reason I went looking in &lt;code&gt;about:config&lt;/code&gt; again and noticed that right under &lt;code&gt;resistFingerprinting&lt;/code&gt; was &lt;code&gt;resistFingerprinting.autoDeclineNoUserInputCanvasPrompts&lt;/code&gt;:
&lt;/p&gt;

&lt;p&gt;
&lt;img src="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/auto-decline.png" alt="nil"&gt;
&lt;/p&gt;

&lt;p&gt;
This option is set to True by default and seemed to be what they were talking about in the bug so I turned it off and went back to the altair page and this time when I put my cursor over the plot a popup came up asking me for permission.
&lt;/p&gt;

&lt;p&gt;
&lt;img src="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/allow-dialog.png" alt="nil"&gt;
&lt;/p&gt;

&lt;p&gt;
Once allowed it, it worked, even with &lt;code&gt;resistFingerprinting&lt;/code&gt; set to true. So, if I understand what the bug reports were saying, what was causing the problem is that firefox is getting a request for the canvas but it decides that it isn't the user initiating it, so it needs extra permission but by default the box to ask for permission is turned off and the request is declined without the user (me) getting any feedback. This &lt;i&gt;seemed&lt;/i&gt; like a bug.
&lt;/p&gt;

&lt;p&gt;
As I was thinking about this I remembered that a couple of days ago I went to the kindle cloud reader and one of the books wouldn't render. I went back and played with turning &lt;code&gt;resistFingerprinting&lt;/code&gt; on and off before trying to load the ebook and this &lt;i&gt;was&lt;/i&gt; apparently the culprit so it isn't just altair that's affected for me.
&lt;/p&gt;

&lt;p&gt;
So it's a bug, right? It seemed like one, but there were already reports of this phenomena for other sites going back years so they appear to have done it on purpose. I was trying to figure out whether it was something that should be reported or not when I came upon this bug: &lt;a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1666160"&gt;Users enable `privacy.resistFingerprinting` and then are surprised when it causes problems&lt;/a&gt;.
&lt;/p&gt;

&lt;p&gt;
&lt;img src="https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/surprise-bug.png" alt="nil"&gt;
&lt;/p&gt;

&lt;p&gt;
Despite the fact that I've seen multiple sites saying to enable this "feature" maybe it isn't really a good idea after all. In the near-term I installed the &lt;a href="https://addons.mozilla.org/en-US/firefox/addon/toggle-resist-fingerprinting/"&gt;Toggle Resist Fingerprinting&lt;/a&gt; extension and use it to turn &lt;code&gt;resistFingerprinting&lt;/code&gt; on and off. To be honest, I'm not convinced that it really matters, I just got sucked into a trail of sites making conflicting assertions about what to do and convinced myself that I cared. At least I can read kindle books in the browser again.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>firefox</category><category>note-to-future-self</category><category>troubleshooting</category><category>whining</category><guid>https://necromuralist.github.io/posts/mozilla-madness-resist-fingerprinting/</guid><pubDate>Thu, 23 Dec 2021 21:54:12 GMT</pubDate></item></channel></rss>