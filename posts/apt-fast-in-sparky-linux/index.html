<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Installing apt-fast in sparky linux Po-Tolo." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Apt-Fast In Sparky Linux | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/posts/apt-fast-in-sparky-linux/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../fish-mocha-chai-a-local-global-installation-in-ubuntu/" rel="prev" title="Fish, Mocha, Chai - A Local Global Installation In Ubuntu" type="text/html">
<link href="../fish-links/" rel="next" title="Fish Links" type="text/html">
<meta content="The Cloistered Monkey" property="og:site_name">
<meta content="Apt-Fast In Sparky Linux" property="og:title">
<meta content="https://necromuralist.github.io/posts/apt-fast-in-sparky-linux/" property="og:url">
<meta content="Installing apt-fast in sparky linux Po-Tolo." property="og:description">
<meta content="article" property="og:type">
<meta content="2023-06-16T13:15:45-07:00" property="article:published_time">
<meta content="apt" property="article:tag">
<meta content="debian" property="article:tag">
<meta content="howto" property="article:tag">
<meta content="ubuntu" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Give-The-Fish/">Give the Fish</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Apt-Fast In Sparky Linux</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author"><a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2023-06-16T13:15:45-07:00" itemprop="datePublished" title="2023-06-16 13:15">2023-06-16 13:15</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org60be350">Background</a></li>
<li><a href="#org0f107fb">The Intructions</a>
<ul>
<li><a href="#org1a0b6c1">Create An Apt Entry</a></li>
<li><a href="#org585d000">Add the Keyring and Install</a></li>
</ul>
</li>
<li><a href="#orgc4b9b6e">The apt-key Solution</a>
<ul>
<li><a href="#org0e9e09a">The Start of the Solution</a></li>
<li><a href="#orgac16e32">Getting the GPG File</a></li>
<li><a href="#org7d8e346">Now Back to Setting it Up</a></li>
<li><a href="#org470dcb1">Update and Install</a></li>
</ul>
</li>
<li><a href="#org064f91c">And Now, Another Problem</a></li>
<li><a href="#org6299585">What Have We Learned Today Children?</a></li>
<li><a href="#orgd689746">Links Collected</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org60be350">
<h2 id="org60be350">Background</h2>
<div class="outline-text-2" id="text-org60be350">
<p>I have an old eeePC netbook that I thought I'd revive by loading <a href="https://sparkylinux.org/">Sparky Linux</a> onto it. One of the things I set up on it is <a href="https://github.com/ilikenwf/apt-fast">apt-fast</a>, which the README on the github repository describes like this:</p>
<blockquote>
<p>apt-fast is a shellscript wrapper for apt-get and aptitude that can drastically improve apt download times by downloading packages in parallel, with multiple connections per package.</p>
</blockquote>
<p>I've used it for a while on ubuntu but Sparky Linux didn't have it in the repositories. The apt-fast documentation has instructions for <a href="https://github.com/ilikenwf/apt-fast#debian-and-derivates">installing it on debian (and derivatives)</a> and since Sparky Linux is based on debian (the current version, SparkyLinux 6.7 (Po-Tolo) is based on debian bullseye) I decided to try that. Ultimately I got it working, but as is often the case, it wasn't quite so straightforward as I would like for it to have been.</p>
<p>Unusual Ingredients List:</p>
<ul class="org-ul">
<li>SparkyLinux 6.7 (Po-Tolo)</li>
<li>fish shell</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0f107fb">
<h2 id="org0f107fb">The Intructions</h2>
<div class="outline-text-2" id="text-org0f107fb">
<p>Although the PPA system is built for Ubuntu, the recommendation from apt-fast is to use it with debian-based systems too (apt-fast is just a shell-script that runs <code>aria2</code> and <code>apt</code> (or <code>apt-get</code>, etc.) so it's not like there's a lot of dependencies that might conflict). This is what they say to do.</p>
</div>
<div class="outline-3" id="outline-container-org1a0b6c1">
<h3 id="org1a0b6c1">Create An Apt Entry</h3>
<div class="outline-text-3" id="text-org1a0b6c1">
<p>First I created a file for the sources at <code>/etc/apt/sources.list.d/apt-fast.list</code> and put these lines in it.</p>
<div class="highlight">
<pre><span></span>deb http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main 
deb-src http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
<p>Bionic came out in 2018 so they maybe haven't updated the instructions in a while.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org585d000">
<h3 id="org585d000">Add the Keyring and Install</h3>
<div class="outline-text-3" id="text-org585d000">
<p>Once the file was in place I ran the commands.</p>
<div class="highlight">
<pre><span></span>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
apt-get update
apt-get install apt-fast
</pre></div>
<p>The first output I saw was a warning:</p>
<div class="highlight">
<pre><span></span>Warning: apt-key is deprecated. Manage keyring files <span class="k">in</span> trusted.gpg.d instead <span class="o">(</span>see apt-key<span class="o">(</span>8<span class="o">))</span>.
</pre></div>
<p>This is something I've seen on ubuntu as well so fixing it seemed like a useful thing to do, especially since at the end of the regular output I got an error.</p>
<p>Between the warning and the final error there was the usual output that I've seen:</p>
<div class="highlight">
<pre><span></span>Executing: /tmp/apt-key-gpghome.YL04bWmGAF/gpg.1.sh --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
gpg: key 1EE2FF37CA8DA16B: public key <span class="s2">"Launchpad PPA for apt-fast"</span> imported
gpg: Total number processed: 1
gpg:               imported: 1
</pre></div>
<p>Then came this, the error I mentioned, which is not what I usually see:</p>
<div class="highlight">
<pre><span></span>gpg: no writable keyring found: Not found
gpg: error reading <span class="s1">'[stdin]'</span>: General error
gpg: import from <span class="s1">'[stdin]'</span> failed: General error
gpg: Total number processed: 0
</pre></div>
<p>I don't know if this is a debian problem or a sparky linux problem, but since you're not supposed to be using this method anyway, I went looking for a different solution.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc4b9b6e">
<h2 id="orgc4b9b6e">The apt-key Solution</h2>
<div class="outline-text-2" id="text-orgc4b9b6e"></div>
<div class="outline-3" id="outline-container-org0e9e09a">
<h3 id="org0e9e09a">The Start of the Solution</h3>
<div class="outline-text-3" id="text-org0e9e09a">
<p>The first part of the solution was pointed to by <a href="https://stackoverflow.com/a/71384057">this Stack Overflow Answer</a>. There was a problem with the answer, though, in that the person asking the question was using a URL that pointed to a gpg file, so the answers all assumed you could download it with curl, wget, etc. (all the answers that I could understand, anyway). So now that I had the answer I had a new problem - how do you get the file from the keyserver?</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgac16e32">
<h3 id="orgac16e32">Getting the GPG File</h3>
<div class="outline-text-3" id="text-orgac16e32">
<p>Once again to the web, this time <a href="https://superuser.com/a/1643115">this answer from SuperUser</a> seemed to work.</p>
<p>First, I made a temporary directory and pointed <code>GNUPGHOME</code> to it so that I wasn't adding anything to my actual gpg setup (this is fish-shell syntax).</p>
<div class="highlight">
<pre><span></span><span class="k">set</span> -x GNUPGHOME <span class="nv">$(</span>mktemp -d<span class="o">)</span>
</pre></div>
<p><code>echo $GNUPGHOME</code> showed that this created a file at <code>/tmp/tmp.dUDUEgFQ0x</code> (but I didn't actually need to know that, I'm just mentioning it).</p>
<p>Taking the <code>--recv-keys</code> argument from the instructions above (<code>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B</code>) I added the key.</p>
<div class="highlight">
<pre><span></span>gpg --keyserver keyserver.ubuntu.com --recv-keys A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
</pre></div>
<p>Next I made a place to put the gpg file.</p>
<div class="highlight">
<pre><span></span>sudo mkdir /etc/apt/keyrings
</pre></div>
<p>Then I output the file in my home directory (the <code>GNUPGHOME</code> environment variable is only available to my user, so I put the file somewhere that I didn't need to be root, i.e. my home directory).</p>
<div class="highlight">
<pre><span></span>gpg -o A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg --export A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B
</pre></div>
<p>Then I moved the file into the directory I created for it.</p>
<div class="highlight">
<pre><span></span>sudo mv A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg /etc/apt/keyrings/
</pre></div>
<p>The SuperUser answer I linked to used <code>gpg -ao</code> but the <code>a</code> option makes it an "armored" file, and part of the Stack Overflow answer for setting up the key is about de-armoring it so I just left that option out.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7d8e346">
<h3 id="org7d8e346">Now Back to Setting it Up</h3>
<div class="outline-text-3" id="text-org7d8e346">
<p>So now that we have the keyring we need to edit the <code>/etc/apt/sources.list.d/apt-fast.list</code> file that we created at the beginning of this.</p>
<p>This is what I started with.</p>
<div class="highlight">
<pre><span></span>deb http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main 
deb-src http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
<p>And I changed it to refer to the gpg file that I created.</p>
<div class="highlight">
<pre><span></span>deb <span class="o">[</span>signed-by<span class="o">=</span>/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg<span class="o">]</span> http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
deb-src  <span class="o">[</span>signed-by<span class="o">=</span>/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg<span class="o">]</span>  http://ppa.launchpad.net/apt-fast/stable/ubuntu bionic main
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org470dcb1">
<h3 id="org470dcb1">Update and Install</h3>
<div class="outline-text-3" id="text-org470dcb1">
<p>So then I updated apt and installed it.</p>
<div class="highlight">
<pre><span></span>sudo apt update
sudo apt install apt-fast
</pre></div>
<p>And it worked.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org064f91c">
<h2 id="org064f91c">And Now, Another Problem</h2>
<div class="outline-text-2" id="text-org064f91c">
<p>This got me to a working <code>apt-fast</code> installation but the fact that I was using <code>bionic</code> seemed off to me so I decided to update the <code>apt-fast.list</code>. Under the instructions for adding the PPA is this note.</p>
<blockquote>
<p>Note that the PPA version bionic might need to be updated with the recent Ubuntu LTS codename to stay up-to-date.</p>
</blockquote>
<p>So I went and looked up the <a href="https://ubuntu.com/about/release-cycle">Ubuntu Release Cycle</a> and saw that "jammy" is the most recent version so I updated the <code>apt-fast.list</code> file to match.</p>
<div class="highlight">
<pre><span></span>deb <span class="o">[</span>signed-by<span class="o">=</span>/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg<span class="o">]</span> http://ppa.launchpad.net/apt-fast/stable/ubuntu jammy main
deb-src  <span class="o">[</span>signed-by<span class="o">=</span>/etc/apt/keyrings/A2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B.gpg<span class="o">]</span>  http://ppa.launchpad.net/apt-fast/stable/ubuntu jammy main
</pre></div>
<p>And then I installed the newer version.</p>
<div class="highlight">
<pre><span></span>sudo apt update
sudo apt install apt-fast
</pre></div>
<p>And I got a nice long stack-trace and error message at the bottom of which was this:</p>
<div class="highlight">
<pre><span></span>dpkg-deb: error: archive <span class="s1">'/var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb'</span> uses unknown compression <span class="k">for</span> member <span class="s1">'control.tar.zst'</span>, giving up
dpkg: error processing archive /var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb <span class="o">(</span>--unpack<span class="o">)</span>:
 dpkg-deb --control subprocess returned error <span class="k">exit</span> <span class="nb">status </span>2
Errors were encountered <span class="k">while</span> processing:
 /var/cache/apt/archives/apt-fast_1.9.12-1~ubuntu22.04.1_all.deb
E: Sub-process /usr/bin/dpkg returned an error code <span class="o">(</span>1<span class="o">)</span>
</pre></div>
<p>The part of it that seemed like it might matter the most was the fragment:</p>
<pre class="example">
uses unknown compression for member 'control.tar.zst', giving up~
</pre>
<p>What is a <code>zst</code> file? <a href="https://en.wikipedia.org/wiki/Zstd?useskin=vector">According to wikipedia</a> it's a "Zstandard" file and Debian and Ubuntu added support for using it to compress <code>deb</code> packages back in 2018. There is a package listed in <code>apt</code> called <code>zstd</code> that it says supports <code>zst</code> compression so I installed it but the error remained.</p>
<p>Once again, someone ran into this and asked about it on <a href="https://unix.stackexchange.com/questions/669004/zst-compression-not-supported-by-apt-dpkg">Stack Exchange</a>. <a href="https://unix.stackexchange.com/a/669008">One of the answers</a> said:</p>
<blockquote>
<p>Debian’s dpkg package didn’t support zstd compression prior to version 1.21.18. Support was added just in time for Debian 12.</p>
</blockquote>
<p>Since the SparkyLinux install is based on Debian 11 that seemed like it might be the problem. I checked the dpkg-version and got back:</p>
<div class="highlight">
<pre><span></span>Debian<span class="w"> </span><span class="s1">'dpkg'</span><span class="w"> </span>package<span class="w"> </span>management<span class="w"> </span>program<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.20.12<span class="w"> </span><span class="o">(</span>i386<span class="o">)</span>.
</pre></div>
<p>So that seemed like the likely culprit. The ubuntu release dates page noted that there was a LTS version between "bionic" and "jammy" called "focal" so I edited the <code>apt-fast.list</code> file again, replacing "jammy" with "focal" and re-ran the installation and so far… it works.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org6299585">
<h2 id="org6299585">What Have We Learned Today Children?</h2>
<div class="outline-text-2" id="text-org6299585">
<p>Further down in the installation instructions it says that you can just download the files and install them along with the <code>aria2</code> package, so going through this whole thing was kind of unnecessary, but getting around the apt-key problem was something that I'd wondered about before, so it might be useful in the future, if PPA creators keep using it and they don't come up with an automatic fix for it.</p>
<p>I guess the main thing I learned is that I should have read to the end of the instructions and picked the easy way out instead of trying to force the old familiar way to work.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgd689746">
<h2 id="orgd689746">Links Collected</h2>
<div class="outline-text-2" id="text-orgd689746">
<ul class="org-ul">
<li>FWDekker. Answer to “Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead” [Internet]. Stack Overflow. 2022 [cited 2023 Jun 16]. Available from: <a href="https://stackoverflow.com/a/71384057">https://stackoverflow.com/a/71384057</a></li>
<li>Kitt S. Answer to “zst compression not supported by apt/dpkg” [Internet]. Unix & Linux Stack Exchange. 2021 [cited 2023 Jun 16]. Available from: <a href="https://unix.stackexchange.com/a/669008">https://unix.stackexchange.com/a/669008</a></li>
<li>fuzzydrawrings. Answer to “gpg: only download a key from a keyserver” [Internet]. Super User. 2021 [cited 2023 Jun 16]. Available from: <a href="https://superuser.com/a/1643115">https://superuser.com/a/1643115</a></li>
<li>ilikenwf/apt-fast: apt-fast: A shellscript wrapper for apt that speeds up downloading of packages. [Internet]. [cited 2023 Jun 16]. Available from: <a href="https://github.com/ilikenwf/apt-fast">https://github.com/ilikenwf/apt-fast</a></li>
<li>zstd. In: Wikipedia [Internet]. 2023 [cited 2023 Jun 16]. Available from: <a href="https://en.wikipedia.org/w/index.php?title=Zstd&amp;oldid=1157564498">https://en.wikipedia.org/w/index.php?title=Zstd&amp;oldid=1157564498</a></li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/apt/" rel="tag">apt</a></li>
<li><a class="tag p-category" href="../../categories/debian/" rel="tag">debian</a></li>
<li><a class="tag p-category" href="../../categories/howto/" rel="tag">howto</a></li>
<li><a class="tag p-category" href="../../categories/ubuntu/" rel="tag">ubuntu</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../fish-mocha-chai-a-local-global-installation-in-ubuntu/" rel="prev" title="Fish, Mocha, Chai - A Local Global Installation In Ubuntu">Previous post</a></li>
<li class="next"><a href="../fish-links/" rel="next" title="Fish Links">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbled by the <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
