<html><body><div class="document" id="mocking-print">   <div class="section" id="background"><h4>Background</h4><p>I wanted to check to make sure I was sending the right output to the screen so I thought I would use <a class="reference external" href="https://pypi.python.org/pypi/mock">mock</a> to catch what I was sending to it. These are some notes about what happened.</p></div><div class="section" id="id1"><h4>Mocking print</h4><p>If you try to <a class="reference external" href="http://www.voidspace.org.uk/python/mock/getting-started.html#patch-decorators">patch</a>   <tt class="docutils literal">print</tt> with MagicMock, here is what you get.</p><pre class="literal-block"><br>from mock import MagicMock, patch, call<br><br>mock_print = MagicMock()<br>try:<br>    with patch('print', mock_print):<br>        print 'test'<br>except TypeError as error:<br>    print error<br></pre><pre class="literal-block"><br>Need a valid target to patch. You supplied: 'print'<br></pre><p>So it looks like 'print' is not the right thing to patch. Maybe you need to call it a built-in funtion:</p><pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print 'test'<br><br>print mock_print.mock_calls<br></pre><pre class="literal-block"><br>test<br>[]<br></pre><p>What if you call it as a function?</p><pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print( 'test')<br><br>print mock_print.mock_calls<br></pre><pre class="literal-block"><br>test<br>[]<br></pre><p>So neither of those raise an error, but they also do not manage to mock <tt class="docutils literal">print</tt>. Well, if you look at the description for <a class="reference external" href="http://docs.python.org/2/library/functions.html#print">print</a>, it turns out that the print function has the signature:</p><pre class="literal-block"><br>print(*objects, sep=' ', end='\n', file=sys.stdout)<br></pre><p>It also says that the function call is not normally available unless you import it from the future.</p><p>But, presuming that the print statement works the same way as the function call, what happens if you mock <tt class="docutils literal">sys.stdout</tt>?</p></div><div class="section" id="mocking-sys-stdout"><h4>Mocking sys.stdout</h4><p>This doesn't answer the question of why I can't mock print directly, but maybe mocking <tt class="docutils literal">sys.stdout</tt> will work instead.</p><pre class="literal-block"><br>with patch('sys.stdout', mock_print):<br>    print 'test'<br><br>expected = [call('test')]<br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre><pre class="literal-block"><br>Expected: [call('test')] Actual: [call.write('test'), call.write('\n')]<br></pre><p>It looks like the mock works this time, but it did not return what I was expecting -- <tt class="docutils literal">print</tt> makes two calls to <tt class="docutils literal">stdout.write</tt>, the first is the string you pass it which it then follows with a newline character. Given this slightly more complete understanding of <tt class="docutils literal">print</tt>:</p><pre class="literal-block"><br># create some output to send to print<br>lines = "a b c".split()<br><br># reset the mock so the previous calls are gone<br>mock_print.reset_mock()<br>with patch('sys.stdout', mock_print):<br>    for line in lines:<br>        print line<br><br>expected = []<br>for line in lines:<br>    expected.append(call.write(line))<br>    expected.append(call.write('\n'))<br><br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre></div><div class="section" id="conclusion"><h4>Conclusion</h4><p>Not earth-shattering, but I thought it was interesting that even after using Python for years, something as basic as <tt class="docutils literal">print</tt> can yield something new if looked at more closely. It was also useful to see how mock can be used to discover the calls that are being made on an object, not just to test that expected calls are being made.</p></div></div></body></html>