<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A note on binary classification with Linear Regression." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Linear Regression Binary Classification | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/posts/linear-regression-binary-classification/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../bibliography/isl-default-dataset/" rel="prev" title="ISL Default Dataset" type="text/html">
<link href="../bibliography/head-first-design-patterns/" rel="next" title="Head First Design Patterns" type="text/html">
<meta content="The Cloistered Monkey" property="og:site_name">
<meta content="Linear Regression Binary Classification" property="og:title">
<meta content="https://necromuralist.github.io/posts/linear-regression-binary-classification/" property="og:url">
<meta content="A note on binary classification with Linear Regression." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-08-10T19:07:53-07:00" property="article:published_time">
<meta content="categorical data" property="article:tag">
<meta content="classification" property="article:tag">
<meta content="data" property="article:tag">
<meta content="dummy variables" property="article:tag">
<meta content="linear regression" property="article:tag">
<meta content="slipnote" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Linear Regression Binary Classification</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author"><a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-08-10T19:07:53-07:00" itemprop="datePublished" title="2020-08-10 19:07">2020-08-10 19:07</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgee2ff32">Beginning</a>
<ul>
<li><a href="#org0bf81e0">Set Up</a></li>
</ul>
</li>
<li><a href="#org4e9e741">Middle</a>
<ul>
<li><a href="#org4efcf76">Looking At the Data</a></li>
<li><a href="#org5ba7c25">Probabilities</a></li>
<li><a href="#org30c01a8">Converting To Probabilities</a></li>
<li><a href="#orgd9d9b10">Fit a Regression</a></li>
</ul>
</li>
<li><a href="#org957ba93">End</a></li>
<li><a href="#org841d672">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgee2ff32">
<h2 id="orgee2ff32">Beginning</h2>
<div class="outline-text-2" id="text-orgee2ff32"></div>
<div class="outline-3" id="outline-container-org0bf81e0">
<h3 id="org0bf81e0">Set Up</h3>
<div class="outline-text-3" id="text-org0bf81e0"></div>
<div class="outline-4" id="outline-container-org3eb157c">
<h4 id="org3eb157c">Imports</h4>
<div class="outline-text-4" id="text-org3eb157c">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">statsmodels</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">statsmodels_formula</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">CountPercentage</span><span class="p">,</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9d03f47">
<h4 id="org9d03f47">The Data</h4>
<div class="outline-text-4" id="text-org9d03f47">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">"~/.local/share/env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"ISL_DEFAULT"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org532580c">
<h4 id="org532580c">The Plotting</h4>
<div class="outline-text-4" id="text-org532580c">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"linear-regression-binary-classification"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"TWITTER_PLOT"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">Plot</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4e9e741">
<h2 id="org4e9e741">Middle</h2>
<div class="outline-text-2" id="text-org4e9e741"></div>
<div class="outline-3" id="outline-container-org4efcf76">
<h3 id="org4efcf76">Looking At the Data</h3>
<div class="outline-text-3" id="text-org4efcf76">
<p>The <a href="https://www.picostat.com/dataset/r-dataset-package-islr-default">ISLR Default</a> data set is a simulated set that provides information to help you build models to predict whether a loan will default or not. Let's look at the data.</p>
<div class="highlight">
<pre><span></span><span class="n">default</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
<pre class="example" id="orga75807a">
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 10000 entries, 0 to 9999
Data columns (total 4 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   default  10000 non-null  int64  
 1   student  10000 non-null  int64  
 2   balance  10000 non-null  float64
 3   income   10000 non-null  float64
dtypes: float64(2), int64(2)
memory usage: 312.6 KB
</pre>
<p>So you can see that it has 10,000 rows, all non-null, two float and two integer columns. What might not be obvious in looking at the description is that default and student are actually categorical columns. Furthermore, according to the description they are encoded as "No" and "Yes" which doesn't seem like integers. Let's take a look at the <code>default</code> column (the target).</p>
<div class="highlight">
<pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="n">CountPercentage</span><span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="s2">"Defaulted"</span><span class="p">)</span>
<span class="n">counter</span><span class="p">()</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Defaulted</th>
<th class="org-left" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">9,667</td>
<td class="org-right">96.67</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left">333</td>
<td class="org-right">3.33</td>
</tr>
</tbody>
</table>
<p>So it's a pretty imbalanced set, you could just predict the target is 1 and you would be right around 97% of the time. I'm going to assume that 1 means "No" (didn't default) and 2 means "Yes" (defaulted). For this exercise we're only going to look at the <code>default</code> and <code>balance</code> columns so I'll pull those out - <code>balance</code> is the amount of money still owed on their credit cards after making a monthly payment. I'm also going to change the <code>default</code> values to be 0 and 1 instead of 1 and 2.</p>
<div class="highlight">
<pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="p">[[</span><span class="s2">"default"</span><span class="p">,</span> <span class="s2">"balance"</span><span class="p">]]</span>
<span class="n">default</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"default"</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">default</span> <span class="o">-</span> <span class="mi">1</span>

<span class="n">CountPercentage</span><span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="s2">"Defaulted"</span><span class="p">)()</span>
</pre></div>
<pre class="example">
|   Defaulted |   Count |   Percent (%) |
|-------------+---------+---------------|
|           0 |   9,667 |         96.67 |
|           1 |     333 |          3.33 |
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Defaulted</th>
<th class="org-left" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">9,667</td>
<td class="org-right">96.67</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left">333</td>
<td class="org-right">3.33</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org5ba7c25">
<h3 id="org5ba7c25">Probabilities</h3>
<div class="outline-text-3" id="text-org5ba7c25">
<p>What this is about is figuring out how you can use linear regression to make binary categorical predictions. The way we're going to do this is create probabilities that a balance will default and then fit a line to it. One problem with this is that the balance is a set of real numbers, so we don't end up with anything meaningful if we use them as is.</p>
<div class="highlight">
<pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
<pre class="example">
0.0    499
Name: balance, dtype: int64
</pre>
<p>The only value that appears more than once is 0. I'm going to try and get something more meaningful by rounding. But how should we round?</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">kde</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"balance"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Credit Card Balance Distribution"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"balance_distribution"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
: <object data="balance_distribution.html" height="800" style="width:100%" type="text/html">:
<p>Figure Missing</p>
:</object>
<p>So, I kind of cheated and worked with the whole dataset, but anyway, looking at it you can see that there are two populations (possibly those that default and those that don't) and it peters out around 2,500, so doing it by 1,000 increments might not make sense. I'll try 100's and see if that's good enough.</p>
<div class="highlight">
<pre><span></span><span class="n">default</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"balance"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">balance</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">CountPercentage</span><span class="p">(</span><span class="n">default</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span> <span class="n">value_label</span><span class="o">=</span><span class="s2">"Credit Balance"</span><span class="p">)</span>
<span class="n">counter</span><span class="p">()</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Credit Balance</th>
<th class="org-right" scope="col">Count</th>
<th class="org-right" scope="col">Percent (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">700</td>
<td class="org-right">783</td>
<td class="org-right">7.83</td>
</tr>
<tr>
<td class="org-left">900</td>
<td class="org-right">779</td>
<td class="org-right">7.79</td>
</tr>
<tr>
<td class="org-left">800</td>
<td class="org-right">770</td>
<td class="org-right">7.70</td>
</tr>
<tr>
<td class="org-left">0</td>
<td class="org-right">758</td>
<td class="org-right">7.58</td>
</tr>
<tr>
<td class="org-left">600</td>
<td class="org-right">755</td>
<td class="org-right">7.55</td>
</tr>
<tr>
<td class="org-left">1,000</td>
<td class="org-right">722</td>
<td class="org-right">7.22</td>
</tr>
<tr>
<td class="org-left">500</td>
<td class="org-right">668</td>
<td class="org-right">6.68</td>
</tr>
<tr>
<td class="org-left">1,100</td>
<td class="org-right">616</td>
<td class="org-right">6.16</td>
</tr>
<tr>
<td class="org-left">400</td>
<td class="org-right">586</td>
<td class="org-right">5.86</td>
</tr>
<tr>
<td class="org-left">1,200</td>
<td class="org-right">555</td>
<td class="org-right">5.55</td>
</tr>
<tr>
<td class="org-left">300</td>
<td class="org-right">530</td>
<td class="org-right">5.30</td>
</tr>
<tr>
<td class="org-left">1,300</td>
<td class="org-right">471</td>
<td class="org-right">4.71</td>
</tr>
<tr>
<td class="org-left">200</td>
<td class="org-right">423</td>
<td class="org-right">4.23</td>
</tr>
<tr>
<td class="org-left">1,400</td>
<td class="org-right">357</td>
<td class="org-right">3.57</td>
</tr>
<tr>
<td class="org-left">100</td>
<td class="org-right">316</td>
<td class="org-right">3.16</td>
</tr>
<tr>
<td class="org-left">1,500</td>
<td class="org-right">277</td>
<td class="org-right">2.77</td>
</tr>
<tr>
<td class="org-left">1,600</td>
<td class="org-right">189</td>
<td class="org-right">1.89</td>
</tr>
<tr>
<td class="org-left">1,700</td>
<td class="org-right">157</td>
<td class="org-right">1.57</td>
</tr>
<tr>
<td class="org-left">1,800</td>
<td class="org-right">118</td>
<td class="org-right">1.18</td>
</tr>
<tr>
<td class="org-left">1,900</td>
<td class="org-right">64</td>
<td class="org-right">0.64</td>
</tr>
<tr>
<td class="org-left">2,000</td>
<td class="org-right">47</td>
<td class="org-right">0.47</td>
</tr>
<tr>
<td class="org-left">2,100</td>
<td class="org-right">28</td>
<td class="org-right">0.28</td>
</tr>
<tr>
<td class="org-left">2,200</td>
<td class="org-right">14</td>
<td class="org-right">0.14</td>
</tr>
<tr>
<td class="org-left">2,300</td>
<td class="org-right">10</td>
<td class="org-right">0.10</td>
</tr>
<tr>
<td class="org-left">2,400</td>
<td class="org-right">4</td>
<td class="org-right">0.04</td>
</tr>
<tr>
<td class="org-left">2,500</td>
<td class="org-right">2</td>
<td class="org-right">0.02</td>
</tr>
<tr>
<td class="org-left">2,600</td>
<td class="org-right">1</td>
<td class="org-right">0.01</td>
</tr>
</tbody>
</table>
<p>Well, it's harder to tell but that might be reasonable.</p>
<div class="highlight">
<pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"balance"</span><span class="p">,</span> <span class="s2">"default"</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"balance"</span><span class="p">:</span> <span class="s2">"count"</span><span class="p">})</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"balance"</span><span class="p">:</span> <span class="s2">"count"</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"balance"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">"default"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Credit Balance Counts Rounded To 100ths"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,</span>
    <span class="n">xrotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"balance_bar"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="balance_bar.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>That x-axis is a little funky, but the blue is the count of those that didn't default and the red are those that did. So the defaults seem to peak at 1,800 with a spread around it.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org30c01a8">
<h3 id="org30c01a8">Converting To Probabilities</h3>
<div class="outline-text-3" id="text-org30c01a8">
<p>So to get the probabilities what we want is the count of accounts that defaulted for each balance divided by the total number of accounts with a given balance.</p>
<div class="highlight">
<pre><span></span><span class="n">defaulted</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">grouped</span><span class="o">.</span><span class="n">default</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="n">didnt_default</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">grouped</span><span class="o">.</span><span class="n">default</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">didnt_default</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"balance"</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">defaulted</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">"balance"</span><span class="p">),</span>
    <span class="n">lsuffix</span><span class="o">=</span><span class="s2">"_didnt_default"</span><span class="p">,</span>
    <span class="n">rsuffix</span><span class="o">=</span><span class="s2">"_defaulted"</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">joined</span><span class="p">[</span><span class="s2">"total"</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">count_didnt_default</span> <span class="o">+</span> <span class="n">joined</span><span class="o">.</span><span class="n">count_defaulted</span>
<span class="n">joined</span><span class="p">[</span><span class="s2">"probability_of_default"</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">count_defaulted</span><span class="o">/</span><span class="n">joined</span><span class="o">.</span><span class="n">total</span>
<span class="n">joined</span><span class="p">[</span><span class="s2">"predict_yes"</span><span class="p">]</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">probability_of_default</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"balance"</span><span class="p">,</span>
                             <span class="n">y</span><span class="o">=</span><span class="s2">"probability_of_default"</span><span class="p">,</span>
                             <span class="n">by</span><span class="o">=</span><span class="s2">"predict_yes"</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Probability of Default By Balance"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
    <span class="n">xrotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>    
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"probability_vs_balance"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="probability_vs_balance.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-orgd9d9b10">
<h3 id="orgd9d9b10">Fit a Regression</h3>
<div class="outline-text-3" id="text-orgd9d9b10">
<p>So, one of the problems we have here is that by converting the values to probabilities we lost a lot of data (well, not lost, just aggregated them away).</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">joined</span><span class="p">))</span>
</pre></div>
<pre class="example">
24
</pre>
<p>But this isn't a real model, it's just a look at what happens if you fit a line to the probabilities, so I'll just ignore that little fact.</p>
<div class="highlight">
<pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">joined</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                               <span class="n">joined</span><span class="o">.</span><span class="n">probability_of_default</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">x_s</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">joined</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">joined</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c1"># predictions = model.predict(x_s)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">joined</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">joined</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="n">predictions</span><span class="p">))</span>
<span class="n">crossover_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">probability</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">probability</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="n">crossover</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">crossover_point</span><span class="p">]</span>
<span class="n">vertical_crossover</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">crossover_point</span><span class="p">]</span>
<span class="n">line_plot</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"balance"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"probability"</span><span class="p">)</span>

<span class="n">hline</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">HLine</span><span class="p">(</span><span class="n">crossover</span><span class="p">)</span>
<span class="n">vline</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">VLine</span><span class="p">(</span><span class="n">vertical_crossover</span><span class="p">)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"balance"</span><span class="p">,</span>
                                <span class="n">y</span><span class="o">=</span><span class="s2">"probability_of_default"</span><span class="p">,</span>
                                <span class="n">by</span><span class="o">=</span><span class="s2">"predict_yes"</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_cycle</span><span class="p">,)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">line_plot</span> <span class="o">*</span> <span class="n">scatter</span> <span class="o">*</span> <span class="n">hline</span> <span class="o">*</span> <span class="n">vline</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Probability of Default By Balance"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">font_scale</span><span class="p">,</span>
    <span class="n">xrotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>    
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"probability_vs_balance_with_model"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="probability_vs_balance_with_model.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Looking at the plot - the horizontal line is the point at which the model switches from predicting the loan won't default to predicting that it will. Once again, I'm plotting on the training data so the performance shouldn't be take at face value, but what it does show is that it would be possible to create a model using linear regression that predicts whether someone would default on their loan. One problem, though, would be interpreting the model - the y-intercept comes at -0.2 - what does it mean when the probability is negative? What happens when it's greater than one?</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org957ba93">
<h2 id="org957ba93">End</h2>
<div class="outline-text-2" id="text-org957ba93">
<p>I'm not really sure what to make of this. I did it as an exercise because the <a href="../bibliography/an-introduction-to-statistical-learning/">ISLR</a> book had it and I thought it might make an interesting thing to replicate - although my plot doesn't look at all like theirs, and they don't document what they did so I'm not really sure that I'm doing anything remotely close to what they did. One thing to note is that given the binary nature of our data, even though we fit a linear model, if we assume that any balance that gives a probability greater than 0.5 is going to defaualt means that we could re-state the model as:</p>
<div class="highlight">
<pre><span></span><span class="k">if</span> <span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">2065</span><span class="p">:</span>
    <span class="n">defaulted</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">defaulted</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
<p>Anyway, this isn't something you would normally do, using linear regression to classify data, that is, so it's time to move on.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org841d672">
<h2 id="org841d672">Sources</h2>
<div class="outline-text-2" id="text-org841d672">
<ul class="org-ul">
<li><a href="../bibliography/an-introduction-to-statistical-learning/">An Introduction To Statistical Learning</a></li>
<li><a href="../bibliography/isl-default-dataset/">ISL Default Dataset</a></li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/categorical-data/" rel="tag">categorical data</a></li>
<li><a class="tag p-category" href="../../categories/classification/" rel="tag">classification</a></li>
<li><a class="tag p-category" href="../../categories/data/" rel="tag">data</a></li>
<li><a class="tag p-category" href="../../categories/dummy-variables/" rel="tag">dummy variables</a></li>
<li><a class="tag p-category" href="../../categories/linear-regression/" rel="tag">linear regression</a></li>
<li><a class="tag p-category" href="../../categories/slipnote/" rel="tag">slipnote</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../bibliography/isl-default-dataset/" rel="prev" title="ISL Default Dataset">Previous post</a></li>
<li class="next"><a href="../bibliography/head-first-design-patterns/" rel="next" title="Head First Design Patterns">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
