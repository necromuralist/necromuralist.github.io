<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Using sessions in emacs with jupyter-emacs." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Jupyter-Emacs Sessions with org-mode | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/posts/jupyter-emacs-sessions/" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<link href="../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../making-stuff/making-stuff-links/" rel="prev" title="Making Stuff Links" type="text/html">
<link href="../xml-to-pandas/" rel="next" title="XML To Pandas" type="text/html">
<meta content="The Cloistered Monkey" property="og:site_name">
<meta content="Jupyter-Emacs Sessions with org-mode" property="og:title">
<meta content="https://necromuralist.github.io/posts/jupyter-emacs-sessions/" property="og:url">
<meta content="Using sessions in emacs with jupyter-emacs." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-05-09T15:36:05-07:00" property="article:published_time">
<meta content="emacs" property="article:tag">
<meta content="jupyter" property="article:tag">
<meta content="python" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Anechoic-Echolalia/">Anechoic Echolalia</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Homunculi-Hypergraphia/">Honumculi Hypergraphia</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="../../machine-learning-projects/">Machine Learning</a> <a class="dropdown-item" href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/data_science/">Data Science With Python</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Jupyter-Emacs Sessions with org-mode</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author"><a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-05-09T15:36:05-07:00" itemprop="datePublished" title="2020-05-09 15:36">2020-05-09 15:36</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org554e2f4">Beginning</a></li>
<li><a href="#org27002b3">Middle</a>
<ul>
<li><a href="#org891d1e3">Starting the Jupyter Server</a></li>
<li><a href="#orgfc2295e">Start a Console</a></li>
<li><a href="#orga779a20">Setting the Session</a></li>
</ul>
</li>
<li><a href="#org185fa57">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org554e2f4">
<h2 id="org554e2f4">Beginning</h2>
<div class="outline-text-2" id="text-org554e2f4">
<p>These are my notes on using <a href="https://github.com/dzop/emacs-jupyter">emacs-jupyter</a> using a remote session. It works with a local session as well, but I'll just relate the steps as if you're running the jupyter session on a remote machine.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org27002b3">
<h2 id="org27002b3">Middle</h2>
<div class="outline-text-2" id="text-org27002b3"></div>
<div class="outline-3" id="outline-container-org891d1e3">
<h3 id="org891d1e3">Starting the Jupyter Server</h3>
<div class="outline-text-3" id="text-org891d1e3">
<p>The first thing to do is start the jupyter session on the remote machine. Since I'm doing this with <b>nikola</b> I should note that you want to start the session in the same location as the file you're editing in emacs, because all your file references will be based on that directory (so if you, for instance, create an image and want to place it in the <code>files</code> folder, you will need to note where that stands relative to the file you are editing and where you start the jupyter kernel).</p>
<p>In my case I'm editing a file in <code>~/projects/In-Too-Deep/posts/fastai/</code>.</p>
<div class="highlight">
<pre><span></span>cd ~/projects/In-Too-Deep/posts/fastai/
jupyter kernel
</pre></div>
<p>This will start the kernel and show you the file that you need to copy to your local machine (where you are running emacs). Here's an example output of that command.</p>
<div class="highlight">
<pre><span></span>(In-Too-Deep) hades@erebus ~/p/I/p/fastai (fastai-restart| Dirty:4)&gt; jupyter kernel
[KernelApp] Starting kernel 'python3'
[KernelApp] Connection file: /home/hades/.local/share/jupyter/runtime/kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232.json
[KernelApp] To connect a client: --existing kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232.json
</pre></div>
<p>The important thing to note is the line with <code>Connection file</code> (<code>[KernelApp] Connection file: /home/hades/.local/share/jupyter/runtime/kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232.json</code>). You will need to copy that file to the machine that you are running emacs on. Where do you put it? Check your jupyter location on your local machine (where you're running emacs, not where you're running jupyter).</p>
<div class="highlight">
<pre><span></span>jupyter --runtime-dir
</pre></div>
<p>Change into whatever directory is output by that command and then copy the json file from the machine with the running jupyter kernel onto your local machine.</p>
<div class="highlight">
<pre><span></span>cd ~/.local/share/jupyter/runtime
scp Hades:/home/hades/.local/share/jupyter/runtime/kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232.json .
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfc2295e">
<h3 id="orgfc2295e">Start a Console</h3>
<div class="outline-text-3" id="text-orgfc2295e">
<p>Now that you've copied over the information for the jupyter session you can start a console for it. I'll assume you're still in the directory with the json file in it, so I won't pass in the full path.</p>
<div class="highlight">
<pre><span></span>jupyter --console kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232.json --ssh Hades
</pre></div>
<p>Note the second argument where I passed in the SSH alias for my remote machine. If you don't have an alias set up then replace it with something that looks like <code>&lt;username&gt;@&lt;IP Address&gt;</code> (this assumes, of course, that the machine with the jupyter session running on it also has an SSH server running). This command sets up our session to forward our jupyter commands to the remote machine. When you execute this command it should tell you that you can connect to the kernel using a slightly modified JSON file name:</p>
<div class="highlight">
<pre><span></span>[ZMQTerminalIPythonApp] Forwarding connections to 127.0.0.1 via Hades
[ZMQTerminalIPythonApp] To connect another client via this tunnel, use:
[ZMQTerminalIPythonApp] --existing kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232-ssh.json
</pre></div>
<p>Note that <code>--existing</code> argument for the next session (it should be the same as the original json file but with <code>-ssh</code> added to the end of the name).</p>
</div>
</div>
<div class="outline-3" id="outline-container-orga779a20">
<h3 id="orga779a20">Setting the Session</h3>
<div class="outline-text-3" id="text-orga779a20">
<p>Since this is org-mode-based the first thing you should do is connect your emacs buffer to the console. Add this to the top of your buffer (the file where you intend to run python).</p>
<div class="highlight">
<pre><span></span>#+PROPERTY: header-args :session /home/athena/.local/share/jupyter/runtime/kernel-ae33a6cd-f607-450e-a03b-01abe2a3b232-ssh.json
</pre></div>
<p>If you have this in your file when you open it you don't need to do anything special, but otherwise C-c C-c on it to load the session. What this does is allow subsequent python org-mode blocks to use the remote jupyter session when you execute them, without needing to specify a session.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org185fa57">
<h2 id="org185fa57">End</h2>
<div class="outline-text-2" id="text-org185fa57">
<p>At this point you can run org-mode code blocs that are set up to use <code>emacs-jupyter</code> and they will redirect to the remote jupyter session. That is a whole other adventure so I'll leave it for another time (or to someone else).</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/emacs/" rel="tag">emacs</a></li>
<li><a class="tag p-category" href="../../categories/jupyter/" rel="tag">jupyter</a></li>
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../making-stuff/making-stuff-links/" rel="prev" title="Making Stuff Links">Previous post</a></li>
<li class="next"><a href="../xml-to-pandas/" rel="next" title="XML To Pandas">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents © 2023 <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
