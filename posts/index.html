<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A notebook of things to remember.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Cloistered Monkey</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/posts/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/">

                <span id="blog-title">The Cloistered Monkey</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="#">Blog</a>
                </li>
<li>
<a href="../archive.html">Archive</a>
                </li>
<li>
<a href="../categories/">Tags</a>
                </li>
<li>
<a href="../rss.xml">RSS feed</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../machine-learning-projects/">Machine Learning</a>
                    </li>
<li>
<a href="../p5_explorations/">P5 Exploration</a>
                    </li>
<li>
<a href="../tddmachinelearning">Test-Driven Machine Learning Notes</a>
            </li>
</ul>
</li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://necromuralist.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->
#


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="baysian-spam-detector/" class="u-url">Baysian Spam Detector</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="baysian-spam-detector/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T21:53:05-07:00" title="2016-06-19 21:53">2016-06-19 21:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Spam-detection-with-Bayesian-Networks">Spam detection with Bayesian Networks<a class="anchor-link" href="baysian-spam-detector/#Spam-detection-with-Bayesian-Networks">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These are my notes for the Bayesian Networks section of the udacity course on artifical intelligence.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="k">import</span> <span class="n">Fraction</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># it turns out 'reduce' is no longer a built-in function in python 3</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam</span> <span class="o">=</span> <span class="s1">'offer is secret, click secret link, secret sports link'</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ham</span> <span class="o">=</span> <span class="s1">'play sports today, went play sports, secret sports event, sports is today, sports costs money'</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The terms have to be changed to be either all plural or all singular. In this case I changed 'sport' to 'sports' where needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-SpamDetector-classes">The SpamDetector classes<a class="anchor-link" href="baysian-spam-detector/#The-SpamDetector-classes">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I originally implemented everything as functions, but decided it was too scattered and created these after the fact, which is why there's all the duplication below. I left the old code to validate these classes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-MailBag">The MailBag<a class="anchor-link" href="baysian-spam-detector/#The-MailBag">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This class holds either spam or ham. It actually holds both but the idea is one of them is the real type of interest.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MailBag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A place to put spam or ham</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mail</span><span class="p">,</span> <span class="n">other_mail</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `mail`: list of example mail</span>
<span class="sd">         - `other_mail`: mail not in this class (e.g. spam if this is ham)</span>
<span class="sd">         - `k`: Laplace smoothing constant</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="n">mail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span> <span class="o">=</span> <span class="n">other_mail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vocabulary_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of unique words in all examples</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: list of words in `mail`</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sample_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of mail in both spam and not spam</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of this mail/total sample size</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">SPAM_AND_HAM</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_probability</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">),</span>
                                                   <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">),</span>
                                                   <span class="n">SPAM_AND_HAM</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span>

    <span class="k">def</span> <span class="nf">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `lines`: list of lines</span>

<span class="sd">        :return: list of words taken from the lines</span>
<span class="sd">        """</span>
        <span class="n">tokenized</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
        <span class="n">bag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="n">bag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bag</span>

    <span class="k">def</span> <span class="nf">l_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `event_size`: count of events of interest</span>
<span class="sd">         - `sample_size`: count of all events</span>
<span class="sd">         - `classes`: count of all classes of events</span>

<span class="sd">        :return: probability with Laplace Smoothing</span>
<span class="sd">        """</span>        
        <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">event_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                        <span class="n">sample_size</span> <span class="o">+</span> <span class="n">classes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `message`: line of mail</span>

<span class="sd">        :return: p(message|this class)</span>
<span class="sd">        """</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span>
        
    <span class="k">def</span> <span class="nf">p_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `word`: string to check for</span>
<span class="sd">        :return: fraction of word occurence in bag</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_probability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word_count</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">word_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `word`: string to check for</span>
<span class="sd">        :return: number of times word appears in bag</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag</span> <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">word</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SpamDetector">SpamDetector<a class="anchor-link" href="baysian-spam-detector/#SpamDetector">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">SpamDetector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A bayesian network spam detector</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `spam`: list of example spam lines</span>
<span class="sd">         - `ham`: list of example ham_lines</span>
<span class="sd">         - `k`: laplace smoothing constant</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spam</span> <span class="o">=</span> <span class="n">MailBag</span><span class="p">(</span><span class="n">mail</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">other_mail</span><span class="o">=</span><span class="n">ham</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ham</span> <span class="o">=</span> <span class="n">MailBag</span><span class="p">(</span><span class="n">mail</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">other_mail</span><span class="o">=</span><span class="n">spam</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">p_spam_given_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `message`: line to check if it's spam</span>
<span class="sd">        :return: probability that it's spam</span>
<span class="sd">        """</span>        
        <span class="n">p_message_given_spam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">p_message_given_spam</span><span class="o">/</span> <span class="p">(</span><span class="n">p_message_given_spam</span> <span class="o">+</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

<span class="c1"># leave this in the same cell so updating the class updates the instance</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">)</span>
<span class="n">l_detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-the-size-of-the-vocabulary?">What is the size of the vocabulary?<a class="anchor-link" href="baysian-spam-detector/#What-is-the-size-of-the-vocabulary?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">bagger</span><span class="p">(</span><span class="n">mail</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    converts list of lines into list of tokens</span>
<span class="sd">    </span>
<span class="sd">    :param:</span>
<span class="sd">     - `mail`: list of space-separated lines</span>
<span class="sd">    :return: list of words in `mail`</span>
<span class="sd">    """</span>
    <span class="n">mail_tokenized</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mail</span><span class="p">)</span>
    <span class="n">mail_bag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">mail_tokenized</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">mail_bag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mail_bag</span>

<span class="n">spam_bag</span> <span class="o">=</span> <span class="n">bagger</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
<span class="n">ham_bag</span> <span class="o">=</span> <span class="n">bagger</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span>
            
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">assert_equal</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> \
        <span class="s2">"'</span><span class="si">{2}</span><span class="s2">'</span><span class="se">\n</span><span class="s2">Expected: </span><span class="si">{0}</span><span class="s2">, Actual: </span><span class="si">{1}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocabulary_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">)</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">bag</span><span class="p">,</span> <span class="s1">'check spam bags'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">bag</span><span class="p">,</span> <span class="s1">'ham bags'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">vocabulary_size</span><span class="p">,</span> <span class="s1">'vocabulary size'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="what-is-the-probability-that-a-piece-of-mail-is-spam?">what is the probability that a piece of mail is spam?<a class="anchor-link" href="baysian-spam-detector/#what-is-the-probability-that-a-piece-of-mail-is-spam?">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mail_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">sample_size</span><span class="p">,</span> <span class="s1">'mail count'</span><span class="p">)</span>
<span class="n">p_spam</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">),</span> <span class="n">mail_count</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="s1">'p-spam known'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p-spam detector'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>3/8
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="what-is-p('secret'|-spam)?">what is p('secret'| spam)?<a class="anchor-link" href="baysian-spam-detector/#what-is-p('secret'%7C-spam)?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">word_count</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    count the number of times a word is in the bag</span>

<span class="sd">    :param:</span>
<span class="sd">     - `bag`: collection of words</span>
<span class="sd">     - `word`: word to count</span>
<span class="sd">    :return: number of times word appears in bag</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">bag</span> <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">word</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">p_word</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    fraction of times word appears in the bag</span>

<span class="sd">    :param:</span>
<span class="sd">     - `bag`: collection of words</span>
<span class="sd">     - `word`: word to count in bag</span>
<span class="sd">     - `k`: laplace smoothing constant</span>
<span class="sd">     - `sample_space`: total number of words in vocabulary</span>
<span class="sd">    :return: Fraction of total bag that is word</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">word_count</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bag</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sample_space</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_secret_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_secret_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_secret_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span>
             <span class="s1">'secret given spam'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_secret_given_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="what-is-p('secret'|-ham)?">what is p('secret'| ham)?<a class="anchor-link" href="baysian-spam-detector/#what-is-p('secret'%7C-ham)?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_secret_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_secret_given_ham</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_secret_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_secret_given_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/15
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="You-get-a-message-with-one-word---'sports',-what-is-p(spam|'sports')?">You get a message with one word - 'sports', what is p(spam|'sports')?<a class="anchor-link" href="baysian-spam-detector/#You-get-a-message-with-one-word---'sports',-what-is-p(spam%7C'sports')?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|`sports'</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">`sports' | spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">`sports'</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|`sports') = \frac{p(`sports' | spam)p(spam)}{p(`sports')}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_sports_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_sports_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sports_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(sports|spam)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_sports_given_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_sports_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_sports_given_ham</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sports_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(sports|ham)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_ham</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">),</span> <span class="n">mail_count</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5/8
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_sports</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">word_count</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span> <span class="o">+</span> <span class="n">word_count</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_sports</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_spam_given_sports</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_sports_given_spam</span> <span class="o">*</span> <span class="n">p_spam</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p_sports_given_spam</span> <span class="o">*</span> <span class="n">p_spam</span> <span class="o">+</span> <span class="n">p_sports_given_ham</span> <span class="o">*</span> <span class="n">p_ham</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_sports</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_sports</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(spam|sports)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_sports</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/6
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Given-the-message-'secret-is-secret',-what-is-the-probability-that-it-is-spam?">Given the message 'secret is secret', what is the probability that it is spam?<a class="anchor-link" href="baysian-spam-detector/#Given-the-message-'secret-is-secret',-what-is-the-probability-that-it-is-spam?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|message</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">message|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam}{p</span><span class="o">(</span><span class="nb">message|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">message|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|message) = \frac{p(message|spam)p(spam}{p(message|spam)p(spam) + p(message|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, the question here is, how do you calculate the probabilities for the entire message instead of for a single word? The answer turns out to be to multiply the probability for each of the words together - so  p('secret is secret'| spam) is the product p('secret'|spam) x p('is'|spam) x p('secret'|spam)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|sis</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|sis) = \frac{p(s|spam)p(i|spam)p(s|spam)p(spam)}{p(s|spam)p(i|spam)p(s|spam)p(spam) + p(s|ham)p(i|ham)p(s|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Where s = 'secret', i = 'is' and sis='secret is secret'.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_is_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_is_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|spam)'</span><span class="p">)</span>
<span class="n">p_is_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_is_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|ham)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bag</span><span class="p">,</span> <span class="n">class_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `message`: string of words</span>
<span class="sd">     - `bag`: bag of words</span>
<span class="sd">     - `class_probability`: probability for this class (e.g. p(spam))</span>
<span class="sd">     - `k`: Laplace smoothing constant</span>
<span class="sd">     - `sample_space`: Size of the vocabulary</span>
<span class="sd">    :return: p(message|classification) * p(classification)</span>
<span class="sd">    """</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_word</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">probability</span> <span class="o">=</span> <span class="n">class_probability</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">:</span>
        <span class="n">probability</span> <span class="o">*=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">probability</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `message`: string of words</span>
<span class="sd">     - `k`: Laplace Smoothing constant</span>
<span class="sd">     - `sample_space`: total count of words in spam/ham bags</span>
<span class="sd">    :return: probability message is spam</span>
<span class="sd">    """</span>
    <span class="n">spam_probability</span> <span class="o">=</span> <span class="n">p_spam</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lp_spam</span>
    <span class="n">ham_probability</span> <span class="o">=</span> <span class="n">p_ham</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lp_ham</span>
    <span class="n">p_m_given_spam</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">spam_bag</span><span class="p">,</span> <span class="n">spam_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span>
    <span class="n">p_m_given_ham</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">ham_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_m_given_spam</span><span class="o">/</span><span class="p">(</span><span class="n">p_m_given_spam</span> <span class="o">+</span> <span class="n">p_m_given_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">message</span> <span class="o">=</span> <span class="s1">'secret is secret'</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">p_sis_given_spam</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_secret_given_spam</span> <span class="o">*</span> <span class="n">p_is_given_spam</span> <span class="o">*</span> <span class="n">p_secret_given_spam</span>
                    <span class="o">*</span> <span class="n">p_spam</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">spam_bag</span><span class="p">,</span> <span class="n">p_spam</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_sis_given_spam</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sis_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(sis|spam)'</span><span class="p">)</span>

<span class="n">p_sis_given_ham</span> <span class="o">=</span> <span class="n">p_secret_given_ham</span> <span class="o">*</span> <span class="n">p_is_given_ham</span> <span class="o">*</span> <span class="n">p_secret_given_ham</span> <span class="o">*</span> <span class="n">p_ham</span>
<span class="k">assert</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">p_ham</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_sis_given_ham</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sis_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(sis|ham)'</span><span class="p">)</span>

<span class="n">p_spam_given_sis</span> <span class="o">=</span> <span class="n">p_sis_given_spam</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_sis_given_spam</span> <span class="o">+</span> <span class="n">p_sis_given_ham</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_sis</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(spam|sis)'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_spam_given_sis</span>
<span class="k">assert</span> <span class="n">p_spam_given_sis</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_sis</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>25/26
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id='What-is-the-probability-that-"today-is-secret"-is-spam?'>What is the probability that "today is secret" is spam?<a class="anchor-link" href="baysian-spam-detector/#What-is-the-probability-that-%22today-is-secret%22-is-spam?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|tis</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">t|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">t|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">t|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|tis) = \frac{p(t|spam)p(i|spam)p(s|spam)p(spam)}{p(t|spam)p(i|spam)p(s|spam)p(spam) + p(t|ham)p(i|ham)p(s|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tis</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">p_spam_given_tis</span> <span class="o">=</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_tis</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_tis</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_tis</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span>
             <span class="s1">'p(spam|tis)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s1">'today'</span> <span class="ow">in</span> <span class="n">spam_bag</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since one of the words isn't in the spam bag of words, the numerator is going to be 0 (p('today'|spam) = 0) so the probability overall is 0.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Laplace-Smoothing">Laplace Smoothing<a class="anchor-link" href="baysian-spam-detector/#Laplace-Smoothing">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When a single missing word drops the probability to 0, this means your model is overfitting the data. To get around this Laplace Smoothing is used.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">s</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{s_{count} </span><span class="o">+</span><span class="nb"> k}{total_{count} </span><span class="o">+</span><span class="nb"> k </span><span class="o">*</span><span class="nb"> |classes|}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(s) = \frac{s_{count} + k}{total_{count} + k * |classes|}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let <em>k = 1</em>.</p>
<p><em>What is the probability that a message is spam if you have 1 example message and it's spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">l_probability</span><span class="p">(</span><span class="n">class_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `class_count`: size of event space</span>
<span class="sd">     - `total_count`: size of sample space</span>
<span class="sd">     - `k`: constant to prevent 0 probability</span>
<span class="sd">     - `classes`: total number of events</span>
<span class="sd">    :return: probability of class_count with Laplace Smoothing</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">class_count</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">total_count</span> <span class="o">+</span> <span class="n">classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># classes = spam, ham</span>
<span class="n">number_of_classes</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">messages</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">spam_messages</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">messages</span> <span class="o">+</span> <span class="n">number_of_classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                            
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2/3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What if you have 10 messages and 6 are spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">messages</span><span class="p">,</span> <span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">spam_messages</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">spam_messages</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">messages</span> <span class="o">+</span> <span class="n">number_of_classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>7/12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What if you have 100 messages and 60 are spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">messages</span><span class="p">,</span> <span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l_probability</span><span class="p">(</span><span class="n">spam_messages</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>61/102
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="spam/ham-with-Laplace-Smoothing">spam/ham with Laplace Smoothing<a class="anchor-link" href="baysian-spam-detector/#spam/ham-with-Laplace-Smoothing">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What are the probabilities that a message is spam or ham with k=1?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lp_spam</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">class_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(spam)'</span><span class="p">)</span>
<span class="n">lp_ham</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">class_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_spam</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2/5
3/5
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What are p('today'|spam) and p('today'|ham)?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case the class-count isn't 2 (for spam or ham) but 12, for the total number of words in the vocabulary.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/21
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lp_today_given_spam</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">),</span>
                                    <span class="n">class_count</span><span class="o">=</span><span class="n">word_count</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">),</span>
                                    <span class="n">classes</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_today_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'today'</span><span class="p">),</span> <span class="s1">'p(today|spam)'</span><span class="p">)</span>
<span class="n">lp_today_given_ham</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">),</span>
                                   <span class="n">class_count</span><span class="o">=</span><span class="n">word_count</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">),</span>
                                   <span class="n">classes</span><span class="o">=</span><span class="n">vocabulary</span>
<span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_today_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'today'</span><span class="p">),</span>
             <span class="s1">'p(today|ham)'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_today_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_today_given_ham</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'p(today|spam) = </span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_today_given_spam</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'p(today|ham) = </span><span class="si">{0}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_today_given_ham</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>p(today|spam) = 1/21
p(today|ham) = 1/9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-p(spam|m)-if-m-=-'today-is-secret'-and-k=1?">What is p(spam|m) if m = 'today is secret' and k=1?<a class="anchor-link" href="baysian-spam-detector/#What-is-p(spam%7Cm)-if-m-=-'today-is-secret'-and-k=1?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tis</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">lp_is_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_is_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|spam)'</span><span class="p">)</span>

<span class="n">lp_is_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_is_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|ham)'</span><span class="p">)</span>

<span class="n">lp_secret_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_secret_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|spam)'</span><span class="p">)</span>

<span class="n">lp_secret_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_secret_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|ham)'</span><span class="p">)</span>

<span class="n">lp_tis_given_spam</span> <span class="o">=</span> <span class="n">lp_today_given_spam</span> <span class="o">*</span> <span class="n">lp_is_given_spam</span> <span class="o">*</span> <span class="n">lp_secret_given_spam</span> <span class="o">*</span> <span class="n">lp_spam</span>
<span class="n">lp_tis_given_ham</span> <span class="o">=</span>  <span class="n">lp_today_given_ham</span> <span class="o">*</span> <span class="n">lp_is_given_ham</span> <span class="o">*</span> <span class="n">lp_secret_given_ham</span> <span class="o">*</span> <span class="n">lp_ham</span>
<span class="n">lp_spam_given_tis</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">lp_tis_given_spam</span><span class="p">,</span> <span class="n">lp_tis_given_spam</span> <span class="o">+</span> <span class="n">lp_tis_given_ham</span><span class="p">)</span>

<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_tis_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(tis|spam)'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_tis_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(tis|ham)'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(spam|tis)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>324/667
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is just more double-checking to make sure that the functions I originally wrote match the hand-calculated answers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">tis</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">lp_ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_tis_given_ham</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Expected: </span><span class="si">{0}</span><span class="s2"> Actual: </span><span class="si">{1}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_tis_given_ham</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual</span> <span class="o">=</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">tis</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_spam_given_tis</span> <span class="o">==</span> <span class="n">actual</span> <span class="p">,</span> <span class="s2">"Expected: </span><span class="si">{0}</span><span class="s2"> Actual: </span><span class="si">{1}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Re-do">Re-do<a class="anchor-link" href="baysian-spam-detector/#Re-do">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since the code ended up being so messy I'm going to re-do the last example using the class-based version only.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam_detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">spam_detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"p(spam|'today is secret') = </span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">answer</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>p(spam|'today is secret') = 324/667
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="s2">"p(spam|'today is secret')"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="building-a-jupyter-docker-container/" class="u-url">Building a Jupyter Docker Container</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="building-a-jupyter-docker-container/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T20:48:21-07:00" title="2016-06-19 20:48">2016-06-19 20:48</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is how I built a docker container to run a jupyter server. The reason why I did it was that I wanted to isolate any non-python dependencies I needed to install, but so far I haven't done any, so this could actually be done more easily using <cite>virtualenv</cite>, but this is a starting point.</p>
<div class="section" id="the-dockerfile">
<h2>The Dockerfile</h2>
<p>This is the configuration for building the docker image.</p>
<pre class="code dockerfile"><a name="rest_code_7f3824a885ea41dbac08f52e2491112e-1"></a><span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-2"></a><span class="k">WORKDIR</span><span class="s"> /code</span>
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-3"></a><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get -y upgrade
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-4"></a><span class="k">RUN</span> apt-get install -y build-essential python-dev
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-5"></a><span class="k">RUN</span> apt-get install -y python python-distribute python-pip
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-6"></a><span class="k">RUN</span> pip install pip --upgrade
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-7"></a><span class="k">ADD</span><span class="s"> requirements.txt /code</span>
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-8"></a><span class="k">RUN</span> pip install -r requirements.txt
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-9"></a><span class="k">RUN</span> mkdir /notebooks
<a name="rest_code_7f3824a885ea41dbac08f52e2491112e-10"></a><span class="k">CMD</span><span class="s"> jupyter notebook --no-browser --ip 0.0.0.0 --port 8888 /notebooks</span>
</pre>
<p>The <tt class="docutils literal">FROM</tt> line shows that I'm building my container using an ubuntu image (the latest image). The <tt class="docutils literal">WORKDIR</tt> sets the current working directory so commands that are run will look there for files. The next set of <tt class="docutils literal">RUN</tt> lines just say to update <tt class="docutils literal"><span class="pre">apt-get</span></tt> and install some basic python packages. The <tt class="docutils literal">ADD</tt> line takes the <tt class="docutils literal">requirements.txt</tt> file in the directory where I'm going to run this and put it in <tt class="docutils literal">/CODE</tt> which I pointed to with the <tt class="docutils literal">WORKDIR</tt> line. The next <tt class="docutils literal">RUN</tt> commands install my python dependencies and make a folder called <tt class="docutils literal">/notebooks</tt> to put the jupyter notebooks in. The last line (<tt class="docutils literal">CMD</tt>) is what will be executed when the container is run.</p>
</div>
<div class="section" id="building-the-image">
<h2>Building the Image</h2>
<p>If the docker-file is stored in a file named <tt class="docutils literal">jupyter.dockerfile</tt> next to the <tt class="docutils literal">requirements.txt</tt> file, both of which are in the directory where I run the build command. To build it (and name the image <tt class="docutils literal">jupyter</tt>) I'd run the command:</p>
<pre class="code bash"><a name="rest_code_e9bcb05c8df34726b6011e61816565ba-1"></a>docker -f jupyter.dockerfile -t jupyter:latest .
</pre>
</div>
<div class="section" id="running-the-server">
<h2>Running the Server</h2>
<p>To run the server in the same directory where the notebooks should be stored and using the default port of 8888:</p>
<pre class="code bash"><a name="rest_code_13e6fa047300441caebf9bce6fc888b8-1"></a>docker --name jupyter -p 8888:8888 -v <span class="nv">$PWD</span>:/notebooks -d jupyter
</pre>
<p>Now the server should be reachable at <tt class="docutils literal"><span class="pre">http://localhost:8888</span></tt>.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="linking-two-docker-containers/" class="u-url">Linking Two Docker Containers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="linking-two-docker-containers/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T20:31:20-07:00" title="2016-06-19 20:31">2016-06-19 20:31</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I think this is the deprecated to do it, now that they have <cite>docker connect</cite>, but it works, so I'll keep the notes.</p>
<p>My goal was to link a container that I'd set up to run a <cite>Jupyter Notebook</cite> server to a <cite>Mongo DB</cite> server. I'll leave out the installation notes and just assume that there's a docker image named <tt class="docutils literal">mongo</tt> for <cite>MongoDB</cite> and one named <tt class="docutils literal">jupyter</tt> for my <cite>Jupyter</cite> server.</p>
<p>First I'll run MongoDB. <cite>MongoDB</cite> is going to use <tt class="docutils literal">/data/db</tt> to store its data-files so I'm going to mount my <cite>data</cite> directory there.</p>
<pre class="code bash"><a name="rest_code_10b9cd7b2454486bae71b51520bef6e2-1"></a>docker run --name mongo -v <span class="nv">$PWD</span>/data:/data/db -d mongo
</pre>
<p>Next I'll run the <cite>Jupyter</cite> container, using the <tt class="docutils literal"><span class="pre">--link</span></tt> option to point it to the <tt class="docutils literal">mongo</tt> container. The jupyter notebook is running on port 8888 and looking for notebooks in the <tt class="docutils literal">/notebooks</tt> directory so I'll mount my current working director there.</p>
<pre class="code bash"><a name="rest_code_2414c668c2ce4c29bbea927b161df8bc-1"></a>docker run --name jupyter -v <span class="nv">$PWD</span>:/notebooks -p 8888:8888 --link mongo -d jupyter
</pre>
<p>At this point, opening a browser at <tt class="docutils literal"><span class="pre">http://localhost:8888</span></tt> should open up the jupyter-server's home.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="running-redis-in-docker/" class="u-url">Running Redis in Docker</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="running-redis-in-docker/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T20:25:26-07:00" title="2016-06-19 20:25">2016-06-19 20:25</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>These are the quick notes.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Redis uses port 6379 as the default, which is where those ports in the command come from.</p>
</div>
<div class="section" id="install">
<h2>Install</h2>
<pre class="code bash"><a name="rest_code_5d3d17b86eb3461b94eac33e734f5b58-1"></a>docker pull redis
<a name="rest_code_5d3d17b86eb3461b94eac33e734f5b58-2"></a>docker run -d -p 6379:6379 --name redis redis
</pre>
</div>
<div class="section" id="use-it-with-python-redis">
<h2>Use it with python-redis</h2>
<pre class="code python"><a name="rest_code_9ebde68b6b134ad789df3833c6fef7e3-1"></a><span class="kn">import</span> <span class="nn">redis</span>
<a name="rest_code_9ebde68b6b134ad789df3833c6fef7e3-2"></a><span class="n">server</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="mi">6379</span><span class="p">)</span>
<a name="rest_code_9ebde68b6b134ad789df3833c6fef7e3-3"></a><span class="n">server</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre>
<p>The <tt class="docutils literal">server.keys()</tt> is a double-check. The <tt class="docutils literal">server</tt> object won't actually try to connect to the server until you call it.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="running-mongodb-with-docker/" class="u-url">Running MongoDB With Docker</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="running-mongodb-with-docker/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T20:01:17-07:00" title="2016-06-19 20:01">2016-06-19 20:01</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I am working through O'Reilly's <cite>Data Visualization with Python and JavaScript</cite> and the chapter on reading and writing data uses MongoDB (among other things) as an example. I've wanted to isolate my exploratory/development software installation as much as possible. With python this is fairly easy (thanks to <cite>virtualenv</cite>), and <cite>npm</cite> can make isolating javascript installations easier, but I wanted to try and use Docker to isolate any other things I had to install so this is a first step. It's actuall a second step, since I already have a Redis container, but I didnt' take any notes when I installed it so I don't really remember doing it, and I'm going to extend the use of docker to handle all the intallations I make while reading this book so it's a first-step for this reason, at least.</p>
<p>Anyway, here's what to do.</p>
<p>First pull the <cite>mongo</cite> docker image.</p>
<pre class="code bash"><a name="rest_code_41134a5bf6f64b8794a74e6fd11ac575-1"></a>docker pull mongo
</pre>
<p>To check that it's there after everything is done you can run <tt class="docutils literal">docker images</tt> and you should see something like this.</p>
<pre class="code bash"><a name="rest_code_8ebb83c5bb114fd492d1fab9af34be3b-1"></a>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
<a name="rest_code_8ebb83c5bb114fd492d1fab9af34be3b-2"></a>mongo               latest              282fd552add6        <span class="m">2</span> days ago          336.1 MB
<a name="rest_code_8ebb83c5bb114fd492d1fab9af34be3b-3"></a>redis               latest              be9c5a746699        <span class="m">5</span> weeks ago         184.9 MB
</pre>
<p>In this case I want the connection to Mongo DB to be available so I'm going to bind its local port (27017) to my host. I'm also going mount my local data file in the container so it will save its data my local folder.</p>
<pre class="code bash"><a name="rest_code_7f5117b20e18460087baa4354da2b0b2-1"></a>docker run --name mongo -p 27017:27017 -v <span class="nv">$PWD</span>/data:/data/db -d mongo
</pre>
<p>The <tt class="docutils literal"><span class="pre">--name</span></tt> flag gives the name that you'll see if you run <tt class="docutils literal">docker ps</tt> to see the running containers. <tt class="docutils literal"><span class="pre">-p</span> 27017:27017</tt> makes it available to my host machine via <tt class="docutils literal">localhost:27017</tt>. <tt class="docutils literal"><span class="pre">-v</span> <span class="pre">$PWD/data:/data/db</span></tt> mounts the <tt class="docutils literal">data</tt> folder in the directory where I ran the docker command inside the container at <tt class="docutils literal">/data/db</tt>. <tt class="docutils literal"><span class="pre">-d</span></tt> says to run it as a daemon. Finally the last argument <tt class="docutils literal">mongo</tt> identifies the image for the container.</p>
<p>At this point MongoDb is accessible from my host machine, so, using <tt class="docutils literal">pymongo</tt> I can connect to it using something like this.</p>
<pre class="code python"><a name="rest_code_8bf416a491b940588821bcc6574c12f2-1"></a><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<a name="rest_code_8bf416a491b940588821bcc6574c12f2-2"></a>
<a name="rest_code_8bf416a491b940588821bcc6574c12f2-3"></a><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
</pre>
<p>And that's it.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="fatal-platform-error/" class="u-url">Fatal Python Error</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="fatal-platform-error/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T12:53:31-08:00" title="2016-06-19 12:53">2016-06-19 12:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I was going to make my first <cite>nikola</cite> post in a few months but when I tride the <tt class="docutils literal">nikola new_post</tt> command I got the following error.</p>
<pre class="code bash"><a name="rest_code_21eda990554349fc95fca319970ddd44-1"></a>Could not find platform independent libraries &lt;prefix&gt;
<a name="rest_code_21eda990554349fc95fca319970ddd44-2"></a>Could not find platform dependent libraries &lt;exec_prefix&gt;
<a name="rest_code_21eda990554349fc95fca319970ddd44-3"></a>Consider setting <span class="nv">$PYTHONHOME</span> to &lt;prefix&gt;<span class="o">[</span>:&lt;exec_prefix&gt;<span class="o">]</span>
<a name="rest_code_21eda990554349fc95fca319970ddd44-4"></a>Fatal Python error: Py_Initialize: Unable to get the locale encoding
<a name="rest_code_21eda990554349fc95fca319970ddd44-5"></a>ImportError: No module named <span class="s1">'encodings'</span>
</pre>
<p>I had no idea what this meant so I tried searching the web for the error and found people saying different things about what it meant to them when they encountered it, but the one that pointed the way for me was a <a class="reference external" href="https://github.com/pypa/virtualenv/issues/161">bug report for virtualenv</a> where a user reported that he got this error because, it turned out, the Windows version didn't work with symlinks if the window was opened as an administrator.</p>
<p>I'm not using Windows, but when  I changed into the directory for my <cite>nikola</cite> <cite>virtualenv</cite> installation, <tt class="docutils literal">ls <span class="pre">-l</span></tt> showed that all my symbolic links were broken. I don't know how it happened... maybe something got moved, but the point of this post was to make a note for myself if I see this error again - check the sym-links for the virtualenv installation.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="testing-katex/" class="u-url">Testing KaTex</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="testing-katex/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T14:43:41-08:00" title="2016-03-02 14:43">2016-03-02 14:43</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a test to see if <a class="reference external" href="https://khan.github.io/KaTeX/">KaTex</a> is working.</p>
<div class="math">
\begin{align*}
f(x) = \pi r^2\\
\end{align*}
</div>
<p>The answer is no, but mathjax does seem to work.</p>
<div class="section" id="getting-it-working">
<h2>Getting it Working</h2>
<p>Edit the <tt class="docutils literal">conf.py</tt> file.</p>
<blockquote>
<ol class="arabic simple">
<li>Uncomment the second <tt class="docutils literal">MATHJAX_CONFIG</tt> default (the one with actual content instead of an empty string).</li>
<li>Set <tt class="docutils literal">EXTRA_HEAD_DATA</tt> to the mathjax CDN.</li>
</ol>
</blockquote>
<pre class="code python"><a name="rest_code_220bee07f7754c88937539a7ac4e11a5-1"></a><span class="n">EXTRA_HEAD_DATA</span> <span class="o">=</span> <span class="s1">'''</span>
<a name="rest_code_220bee07f7754c88937539a7ac4e11a5-2"></a><span class="s1">&lt;script type="text/javascript" async</span>
<a name="rest_code_220bee07f7754c88937539a7ac4e11a5-3"></a><span class="s1">  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"&gt;</span>
<a name="rest_code_220bee07f7754c88937539a7ac4e11a5-4"></a><span class="s1">&lt;/script&gt;</span>
<a name="rest_code_220bee07f7754c88937539a7ac4e11a5-5"></a><span class="s1">'''</span>
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference external" href="https://getnikola.com/handbook.html#math">documentation</a> says that you need to add the <tt class="docutils literal">mathjax</tt> tag to the post, but the <tt class="docutils literal">conf.py</tt> has <tt class="docutils literal">HIDDEN_TAGS = ['mathjax']</tt> which I think makes it work anyway. The documentation also makes no mention of the need for the CDN (or installing the javascript) but nikola doesn't seem to come with <cite>mathjax</cite> otherwise.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="processing-test/" class="u-url">Processing Test</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="processing-test/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T12:53:31-08:00" title="2016-03-02 12:53">2016-03-02 12:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a <a class="reference external" href="http://p5js.org/">p5</a> test based on their <a class="reference external" href="http://p5js.org/get-started/">get started</a> tutorial. It's also an indirect test of using the <cite>raw</cite> directive to write HTML to pass to <cite>nikola</cite>.</p>
<p>First the link to the library.</p>
<pre class="code html"><a name="rest_code_9bb17bf997614519beae42b78a66dc1a-1"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.21/p5.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.21/p5.js"></script><p>And now the sketch.</p>
<pre class="code html"><a name="rest_code_29840ad5cd39448b9e13a10695654bd4-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"get_started"</span><span class="p">&gt;</span>
<a name="rest_code_29840ad5cd39448b9e13a10695654bd4-2"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">language</span><span class="o">=</span><span class="s">"javascript"</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">'get_started.js'</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a name="rest_code_29840ad5cd39448b9e13a10695654bd4-3"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre>
<div id="get_started">
<script language="javascript" type="text/javascript" src="processing-test/get_started.js"></script>
</div>
<pre class="code javascript"><a name="rest_code_970f45d6bb7945c39e35dea17495cee0-1"></a><span class="kd">var</span> <span class="nx">diameter</span><span class="p">;</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-2"></a>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-3"></a><span class="kd">function</span> <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-4"></a>    <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">createCanvas</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nx">windowWidth</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-5"></a>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">parent</span><span class="p">(</span><span class="s2">"get_started"</span><span class="p">)</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-6"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-7"></a>    <span class="nx">strokeWeight</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-8"></a>    <span class="nx">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-9"></a>    <span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-10"></a><span class="p">}</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-11"></a>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-12"></a><span class="kd">function</span> <span class="nx">mousePressed</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-13"></a>    <span class="cm">/* set background to blue */</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-14"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-15"></a><span class="p">}</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-16"></a>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-17"></a><span class="kd">function</span> <span class="nx">mouseReleased</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-18"></a>    <span class="cm">/* set background to white */</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-19"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-20"></a><span class="p">}</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-21"></a>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-22"></a><span class="kd">function</span> <span class="nx">draw</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-23"></a>    <span class="cm">/* Draw circles that change diameter based on mouse speed */</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-24"></a>    <span class="cm">/* and color based on if mouse-pressed (or not pressed)   */</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-25"></a>    <span class="k">if</span> <span class="p">(</span><span class="nx">mouseIsPressed</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-26"></a>        <span class="nx">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-27"></a>        <span class="nx">stroke</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-28"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-29"></a>        <span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-30"></a>        <span class="nx">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-31"></a>    <span class="p">}</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-32"></a>    <span class="nx">diameter</span> <span class="o">=</span> <span class="nx">pow</span><span class="p">(</span><span class="nx">dist</span><span class="p">(</span><span class="nx">pmouseX</span><span class="p">,</span> <span class="nx">pmouseY</span><span class="p">,</span> <span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-33"></a>    <span class="nx">ellipse</span><span class="p">(</span><span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">,</span> <span class="nx">diameter</span><span class="p">,</span> <span class="nx">diameter</span><span class="p">);</span>
<a name="rest_code_970f45d6bb7945c39e35dea17495cee0-34"></a><span class="p">}</span>
</pre>
<div class="section" id="notes">
<h2>Notes</h2>
<p>This was a little harder than I thought it would be. First, regarding the javascript file:</p>
<ul class="simple">
<li>In order to get it to the final HTML you need to create a folder with the same name as this post's file (<cite>processing_test.rst</cite>) without extension  within the <cite>files</cite> folder and put the javascript there (<cite>files/posts/processing_test/get_started.js</cite>).</li>
<li>to get the sketch to stay in the post (instead of showing up on the bottom of the page), you have to use the div trick -- create a <cite>div</cite> where you want the sketch and give it a unique ID, then set the parent in the sketch (<tt class="docutils literal"><span class="pre">canvas.parent("get_started")</span></tt> in this example). I don't really like giving the <cite>div</cite> an <cite>id</cite> in the post and then referring to it in the javascript, but it seems to work.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="converting-nikola-from-a-blog-to-a-site/" class="u-url">Converting Nikola from a Blog to a Site</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="converting-nikola-from-a-blog-to-a-site/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T12:53:31-08:00" title="2016-03-02 12:53">2016-03-02 12:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>These are my notes on converting this site to be a web-site first (with a blog on the side). There is an official page on <a class="reference external" href="https://getnikola.com/creating-a-site-not-a-blog-with-nikola.html">creating a site instead of a blog</a>, but I had a little bit of a hard time figuring out what was going on so these are the main points in case I need to do it again.</p>
<p>In a nutshell:</p>
<blockquote>
<ol class="arabic simple">
<li>Get rid of the sub-folder argument in the <tt class="docutils literal">PAGES</tt> variable in <tt class="docutils literal">conf.py</tt>
</li>
<li>Set <tt class="docutils literal">INDEX_PATH</tt> to point to the <cite>posts</cite> sub-folder</li>
<li>Create an index page for the site.</li>
</ol>
</blockquote>
<div class="section" id="conf-py">
<h2>conf.py</h2>
<p>The main things to do are to edit the <cite>conf.py</cite> file so that the pages you create get copied over as the root of the <cite>output</cite> folder (instead of in a sub-folder called <cite>stories</cite>) and moving the blog-index down into a sub-folder.</p>
<div class="section" id="making-stories-the-site">
<h3>Making 'stories' the Site</h3>
<p>To make the pages you create the root of the site you need to change the <tt class="docutils literal">PAGES</tt> variable to not have a sub-folder as the target (this is the second-entry in the tuple). So if it originally was:</p>
<pre class="code python"><a name="rest_code_6e8d96a467de40e89ddb6088a7c9c767-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_6e8d96a467de40e89ddb6088a7c9c767-2"></a>    <span class="p">(</span><span class="s2">"stories/*.rst"</span><span class="p">,</span> <span class="s2">"stories"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a name="rest_code_6e8d96a467de40e89ddb6088a7c9c767-3"></a><span class="p">)</span>
</pre>
<p>You would change the second value in the tuple to an empty string:</p>
<pre class="code python"><a name="rest_code_bc554234fdb84800ae083d0afcb42831-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_bc554234fdb84800ae083d0afcb42831-2"></a>    <span class="p">(</span><span class="s2">"stories/*.rst"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a name="rest_code_bc554234fdb84800ae083d0afcb42831-3"></a><span class="p">)</span>
</pre>
<p>Now when you build the site (<tt class="docutils literal">nikola build</tt>) the <tt class="docutils literal">output</tt> folder will have your 'stories' at the top-level. This means that when you refer to pages (e.g. in the navigation configuration) you don't add 'stories/' as a prefix anymore.</p>
</div>
<div class="section" id="moving-the-blog-index">
<h3>Moving the Blog-index</h3>
<p>Since Nikola assumes that the blog is your main-page you need to tell it to create the index in a sub-folder by setting the <tt class="docutils literal">INDEX_PATH</tt> to the name of the sub-folder. If, for example, the blog-posts are being put into <tt class="docutils literal">posts</tt>, the setting would be:</p>
<pre class="code python"><a name="rest_code_b8dc8db3fde24bf29b95aa1870579021-1"></a><span class="n">INDEX_PATH</span> <span class="o">=</span> <span class="s2">"posts"</span>
</pre>
</div>
</div>
<div class="section" id="creating-the-home-page">
<h2>Creating the Home Page</h2>
<p>At this point if you build the site and navigate to it you'll find that your home-page is now a directory of your <tt class="docutils literal">output</tt> folder. You can navigate to a page by going through the folders, but this is probably not the intended way to get around. The easiest way (that I found) to create the home-page is to create a new-page (<tt class="docutils literal">nikola new_page</tt>) and when prompted for a title, call it <tt class="docutils literal">index</tt>. This will create <tt class="docutils literal">stories/index.rst</tt> which you can edit to become your home page (make sure to change the title if you don't want the page headline to be 'index').</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Some other things might need to be re-done in the <tt class="docutils literal">conf.py</tt> as well, since the folder structure has changed. These are only the basic steps to switch. The <tt class="docutils literal">NAVIGATION_LINKS</tt> in particular may need updating.</p>
</div>
</div>
</div>
    </div>
    </article>
</div>





            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:necromuralist@gmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(1, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
