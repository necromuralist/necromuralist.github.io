<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Using memoization to speed up calculating the fibonacci sequence.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Memoization and the Fibonacci Sequence | The Cloistered Monkey</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/posts/memoization-and-the-fibonacci-sequence/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="manifest" href="../../site.webmanifest">
<meta name="author" content="Cloistered Monkey">
<link rel="prev" href="../brute-force-longest-non-decreasing-sub-sequence/" title="Brute Force Longest Non-Decreasing Sub-Sequence" type="text/html">
<link rel="next" href="../bib-the-kekule-problem/" title="Bib: The Kekule Problem" type="text/html">
<meta property="og:site_name" content="The Cloistered Monkey">
<meta property="og:title" content="Memoization and the Fibonacci Sequence">
<meta property="og:url" content="https://necromuralist.github.io/posts/memoization-and-the-fibonacci-sequence/">
<meta property="og:description" content="Using memoization to speed up calculating the fibonacci sequence.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-11-09T18:32:31-08:00">
<meta property="article:tag" content="algorithms">
<meta property="article:tag" content="recursion">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">The Cloistered Monkey</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/Bowling-For-Data/" class="dropdown-item">Bowling For Data</a>
                    <a href="https://necromuralist.github.io/Anechoic-Echolalia/" class="dropdown-item">Anechoic Echolalia</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/student_intervention/" class="dropdown-item">Student Intervention Project</a>
                    <a href="https://necromuralist.github.io/boston_housing/" class="dropdown-item">Boston Housing Project</a>
                    <a href="https://necromuralist.github.io/data_science/" class="dropdown-item">Data Science With Python</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="form-group">
<input type="text" name="q" class="form-control" placeholder="Search">
</div>
<!-- 
<button type="submit" class="btn btn-primary">
	<span class="glyphicon glyphicon-search"></span>
</button>
-->
<input type="hidden" name="sitesearch" value="https://necromuralist.github.io/">
</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Memoization and the Fibonacci Sequence</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/cloistered-monkey/">Cloistered Monkey</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-11-09T18:32:31-08:00" itemprop="datePublished" title="2020-11-09 18:32">2020-11-09 18:32</time></a>
            </p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdec8707">What It Is</a></li>
<li><a href="#org2207676">Recurse</a></li>
<li><a href="#org1a50c0d">Memoize</a></li>
<li><a href="#orgf3926bf">Once Again With Python</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgdec8707" class="outline-2">
<h2 id="orgdec8707">What It Is</h2>
<div class="outline-text-2" id="text-orgdec8707">
<p>
This is a note on using memoization with recursion - specifically with the generation of a <a href="https://www.wikiwand.com/en/Fibonacci_number">Fibonacci Number</a>. The fibonacci numbers form a sequence where
</p>

<p>
\[
F_0 = 0, F_1 = 1
\]
</p>

<p>
and then for the rest of the numbers greater than 1
</p>

<p>
\[
F_n = F_{n-1} + F_{n-2}
\]
</p>

<p>
So, starting from 0 you get <i>0, 1, 1, 2, 3, 5, 8,</i> etc.
</p>
</div>
</div>
<div id="outline-container-org2207676" class="outline-2">
<h2 id="org2207676">Recurse</h2>
<div class="outline-text-2" id="text-org2207676">
<p>
Calculating the sequence is often done with recursion because you can pretty much take the definition and convert it to a function with little translation.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<pre class="example">
55
</pre>


<p>
Remember that <i>n</i> is the index for number, not the count (the second number in the sequence has index 1).
</p>

<p>
The problem here is that recursion like this has memory limits and takes a long time.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<pre class="example">
2020-11-09 21:11:05,852 graeae.timers.timer start: Started: 2020-11-09 21:11:05.852071
2020-11-09 21:11:50,249 graeae.timers.timer end: Ended: 2020-11-09 21:11:50.249808
2020-11-09 21:11:50,251 graeae.timers.timer end: Elapsed: 0:00:44.397737
40
</pre>


<p>
Less than a minute might not seem like a big deal, but even pushing it up to 45 makes the wait too long (I gave up and killed the process so I don't know how long it ran). So what's the solution? Let's try <a href="https://www.wikiwand.com/en/Memoization">memoization</a>.
</p>
</module></module></module></module>
</div>
</div>
<div id="outline-container-org1a50c0d" class="outline-2">
<h2 id="org1a50c0d">Memoize</h2>
<div class="outline-text-2" id="text-org1a50c0d">
<p>
So, what's memoization? Is it what Elmer Fudd does when he memorizes? No, memoization comes from the latin word <i>memorandum</i>  which means "to be remembered". What we're going to do is create a cache dictionary that will match arguments to our function call to their outputs. Then if a function call comes in that uses arguments that were used before, we can just grab it from the cache instead of re-doing the calculations.
</p>

<p>
We're going to use a python decorator from <a href="https://docs.python.org/3/library/functools.html">functools</a> named <code>wraps</code> that allows you to build a decorator that looks like the original function. It isn't necessary for the decorator to work, but it makes it look more like the original functior passed to the decorator so it's a good practice to use it.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Although it works as a decorator, since we already defined the <code>fibonacci</code> function we can just pass it to <code>memoize</code> to add the cache.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
Now let's see what happens. 
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<pre class="example">
2020-11-10 15:45:08,117 graeae.timers.timer start: Started: 2020-11-10 15:45:08.117332
2020-11-10 15:45:08,118 graeae.timers.timer end: Ended: 2020-11-10 15:45:08.118691
2020-11-10 15:45:08,120 graeae.timers.timer end: Elapsed: 0:00:00.001359
354224848179261915075
</pre>



<p>
<b><b>Note:</b></b> I originally tried renaming the memoized function, but since the recursive calls go to the original function name, this doesn't produce and improved function. You have to use the same name as you did when you defined the function.
</p>

<p>
So memoization really helps, even more than you might expect. The reason why is that the first recursion term (<code>fibonacci(n - 1)</code>) gets evaluated first, so each recursive call goes backwards by one until it hits the base-case where <code>n &lt; 2</code> and then all the rest of the calls are evaluated, but after one run through the indexes you've already hit all the cases you need for these other calls so rather than making more recursive calls, everything gets pulled from the cache.
</p>
</module></module></module></module>
</div>
</div>

<div id="outline-container-orgf3926bf" class="outline-2">
<h2 id="orgf3926bf">Once Again With Python</h2>
<div class="outline-text-2" id="text-orgf3926bf">
<p>
As is often the case, when you implement something useful in python you'll find that it's already been implemented, in this case as part of the python standard library.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<p>
<b><b>Note:</b></b> in python 3.9 there is a <code>cache</code> decorator that is the same thing as the <code>lru_cache</code> with <code>maxsize=None</code> but I'm running this on python 3.8 right now so I can't use it.
</p>

Traceback (most recent call last):
  File "/home/hades/.local/bin/pygmentize", line 5, in <module>
    from pygments.cmdline import main
ModuleNotFoundError: No module named 'pygments'

<pre class="example">
2020-11-09 21:53:19,405 graeae.timers.timer start: Started: 2020-11-09 21:53:19.405955
2020-11-09 21:53:19,407 graeae.timers.timer end: Ended: 2020-11-09 21:53:19.407891
2020-11-09 21:53:19,409 graeae.timers.timer end: Elapsed: 0:00:00.001936
139423224561697880139724382870407283950070256587697307264108962948325571622863290691557658876222521294125
</pre>


<p>
Okay, so, I think it works, although I'm not checking the values, the speed seems to be an improvement.
</p>
</module></module>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/algorithms/" rel="tag">algorithms</a></li>
            <li><a class="tag p-category" href="../../categories/recursion/" rel="tag">recursion</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../brute-force-longest-non-decreasing-sub-sequence/" rel="prev" title="Brute Force Longest Non-Decreasing Sub-Sequence">Previous post</a>
            </li>
            <li class="next">
                <a href="../bib-the-kekule-problem/" rel="next" title="Bib: The Kekule Problem">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><!--End of body content--><footer id="footer">
            Contents © 2023         <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
