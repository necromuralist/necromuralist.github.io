<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="https://necromuralist.github.io/">
<meta name="description" content="A notebook of things to remember.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Cloistered Monkey</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/">
<link rel="next" href="index-5.html" type="text/html">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script><link rel="prefetch" href="posts/processing_test/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://necromuralist.github.io/">

                <span id="blog-title">The Cloistered Monkey</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu"><li>
<a href="machine-learning-projects/">Machine Learning</a>
            </li></ul>
</li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://necromuralist.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->
#


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/processing_test/" class="u-url">A P5 (Processing) Test</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/processing_test/" rel="bookmark"><time class="published dt-published" datetime="2016-03-20T00:00:00-07:00" title="2016-03-20 00:00">2016-03-20 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a <a class="reference external" href="http://p5js.org/">p5</a> test based on their <a class="reference external" href="http://p5js.org/get-started/">get started</a> tutorial. It's also an indirect test of using the <cite>raw</cite> directive to write HTML to pass to <cite>nikola</cite>.</p>
<p>First the link to the library.</p>
<pre class="code html"><a name="rest_code_ae28b983fca44f129e8bbc4833655e26-1"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.21/p5.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.21/p5.js"></script><p>And now the sketch.</p>
<pre class="code html"><a name="rest_code_f9be7bd08f9d4ac6bb22ab847a0ecd33-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"get_started"</span><span class="p">&gt;</span>
<a name="rest_code_f9be7bd08f9d4ac6bb22ab847a0ecd33-2"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">language</span><span class="o">=</span><span class="s">"javascript"</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">'get_started.js'</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a name="rest_code_f9be7bd08f9d4ac6bb22ab847a0ecd33-3"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre>
<div id="get_started">
<script language="javascript" type="text/javascript" src="posts/processing_test/get_started.js"></script>
</div>
<pre class="code javascript"><a name="rest_code_e508ed0482ab4a7abee0185286f59e62-1"></a><span class="kd">var</span> <span class="nx">diameter</span><span class="p">;</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-2"></a>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-3"></a><span class="kd">function</span> <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-4"></a>    <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">createCanvas</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nx">windowWidth</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-5"></a>    <span class="nx">canvas</span><span class="p">.</span><span class="nx">parent</span><span class="p">(</span><span class="s2">"get_started"</span><span class="p">)</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-6"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-7"></a>    <span class="nx">strokeWeight</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-8"></a>    <span class="nx">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-9"></a>    <span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-10"></a><span class="p">}</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-11"></a>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-12"></a><span class="kd">function</span> <span class="nx">mousePressed</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-13"></a>    <span class="cm">/* set background to blue */</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-14"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-15"></a><span class="p">}</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-16"></a>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-17"></a><span class="kd">function</span> <span class="nx">mouseReleased</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-18"></a>    <span class="cm">/* set background to white */</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-19"></a>    <span class="nx">background</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-20"></a><span class="p">}</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-21"></a>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-22"></a><span class="kd">function</span> <span class="nx">draw</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-23"></a>    <span class="cm">/* Draw circles that change diameter based on mouse speed */</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-24"></a>    <span class="cm">/* and color based on if mouse-pressed (or not pressed)   */</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-25"></a>    <span class="k">if</span> <span class="p">(</span><span class="nx">mouseIsPressed</span><span class="p">)</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-26"></a>        <span class="nx">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-27"></a>        <span class="nx">stroke</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-28"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-29"></a>        <span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-30"></a>        <span class="nx">stroke</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-31"></a>    <span class="p">}</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-32"></a>    <span class="nx">diameter</span> <span class="o">=</span> <span class="nx">pow</span><span class="p">(</span><span class="nx">dist</span><span class="p">(</span><span class="nx">pmouseX</span><span class="p">,</span> <span class="nx">pmouseY</span><span class="p">,</span> <span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-33"></a>    <span class="nx">ellipse</span><span class="p">(</span><span class="nx">mouseX</span><span class="p">,</span> <span class="nx">mouseY</span><span class="p">,</span> <span class="nx">diameter</span><span class="p">,</span> <span class="nx">diameter</span><span class="p">);</span>
<a name="rest_code_e508ed0482ab4a7abee0185286f59e62-34"></a><span class="p">}</span>
</pre>
<div class="section" id="notes">
<h2>Notes</h2>
<p>This was a little harder than I thought it would be. First, regarding the javascript file:</p>
<ul class="simple">
<li>In order to get it to the final HTML you need to create a folder with the same name as this post's file (<cite>processing_test.rst</cite>) without extension  within the <cite>files</cite> folder and put the javascript there (<cite>files/posts/processing_test/get_started.js</cite>).</li>
<li>to get the sketch to stay in the post (instead of showing up on the bottom of the page), you have to use the div trick -- create a <cite>div</cite> where you want the sketch and give it a unique ID, then set the parent in the sketch (<tt class="docutils literal"><span class="pre">canvas.parent("get_started")</span></tt> in this example). I don't really like giving the <cite>div</cite> an <cite>id</cite> in the post and then referring to it in the javascript, but it seems to work.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/baysian-spam-detector/" class="u-url">baysian-spam-detector</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/baysian-spam-detector/" rel="bookmark"><time class="published dt-published" datetime="2016-03-20T00:00:00-07:00" title="2016-03-20 00:00">2016-03-20 00:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Spam-detection-with-Bayesian-Networks">Spam detection with Bayesian Networks<a class="anchor-link" href="posts/baysian-spam-detector/#Spam-detection-with-Bayesian-Networks">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These are my notes for the Bayesian Networks section of the udacity course on artifical intelligence.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c1"># python standard library</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="k">import</span> <span class="n">Fraction</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c1"># it turns out 'reduce' is no longer a built-in function in python 3</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">spam</span> <span class="o">=</span> <span class="s1">'offer is secret, click secret link, secret sports link'</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">ham</span> <span class="o">=</span> <span class="s1">'play sports today, went play sports, secret sports event, sports is today, sports costs money'</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The terms have to be changed to be either all plural or all singular. In this case I changed 'sport' to 'sports' where needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-SpamDetector-classes">The SpamDetector classes<a class="anchor-link" href="posts/baysian-spam-detector/#The-SpamDetector-classes">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I originally implemented everything as functions, but decided it was too scattered and created these after the fact, which is why there's all the duplication below. I left the old code to validate these classes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-MailBag">The MailBag<a class="anchor-link" href="posts/baysian-spam-detector/#The-MailBag">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This class holds either spam or ham. It actually holds both but the idea is one of them is the real type of interest.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">class</span> <span class="nc">MailBag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A place to put spam or ham</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mail</span><span class="p">,</span> <span class="n">other_mail</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `mail`: list of example mail</span>
<span class="sd">         - `other_mail`: mail not in this class (e.g. spam if this is ham)</span>
<span class="sd">         - `k`: Laplace smoothing constant</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">=</span> <span class="n">mail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span> <span class="o">=</span> <span class="n">other_mail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vocabulary_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of unique words in all examples</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: list of words in `mail`</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bag</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sample_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of mail in both spam and not spam</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_size</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :return: count of this mail/total sample size</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">SPAM_AND_HAM</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_probability</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">),</span>
                                                   <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mail</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_mail</span><span class="p">),</span>
                                                   <span class="n">SPAM_AND_HAM</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probability</span>

    <span class="k">def</span> <span class="nf">bag_boy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `lines`: list of lines</span>

<span class="sd">        :return: list of words taken from the lines</span>
<span class="sd">        """</span>
        <span class="n">tokenized</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span>
        <span class="n">bag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokenized</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="n">bag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bag</span>

    <span class="k">def</span> <span class="nf">l_probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_size</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `event_size`: count of events of interest</span>
<span class="sd">         - `sample_size`: count of all events</span>
<span class="sd">         - `classes`: count of all classes of events</span>

<span class="sd">        :return: probability with Laplace Smoothing</span>
<span class="sd">        """</span>        
        <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">event_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                        <span class="n">sample_size</span> <span class="o">+</span> <span class="n">classes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">p_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `message`: line of mail</span>

<span class="sd">        :return: p(message|this class)</span>
<span class="sd">        """</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">probability</span>
        
    <span class="k">def</span> <span class="nf">p_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `word`: string to check for</span>
<span class="sd">        :return: fraction of word occurence in bag</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_probability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">word_count</span><span class="p">(</span><span class="n">word</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bag</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary_size</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">word_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `word`: string to check for</span>
<span class="sd">        :return: number of times word appears in bag</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag</span> <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">word</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SpamDetector">SpamDetector<a class="anchor-link" href="posts/baysian-spam-detector/#SpamDetector">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">class</span> <span class="nc">SpamDetector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A bayesian network spam detector</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `spam`: list of example spam lines</span>
<span class="sd">         - `ham`: list of example ham_lines</span>
<span class="sd">         - `k`: laplace smoothing constant</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spam</span> <span class="o">=</span> <span class="n">MailBag</span><span class="p">(</span><span class="n">mail</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">other_mail</span><span class="o">=</span><span class="n">ham</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ham</span> <span class="o">=</span> <span class="n">MailBag</span><span class="p">(</span><span class="n">mail</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">other_mail</span><span class="o">=</span><span class="n">spam</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">p_spam_given_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        :param:</span>
<span class="sd">         - `message`: line to check if it's spam</span>
<span class="sd">        :return: probability that it's spam</span>
<span class="sd">        """</span>        
        <span class="n">p_message_given_spam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">p_message_given_spam</span><span class="o">/</span> <span class="p">(</span><span class="n">p_message_given_spam</span> <span class="o">+</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

<span class="c1"># leave this in the same cell so updating the class updates the instance</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">)</span>
<span class="n">l_detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-the-size-of-the-vocabulary?">What is the size of the vocabulary?<a class="anchor-link" href="posts/baysian-spam-detector/#What-is-the-size-of-the-vocabulary?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">bagger</span><span class="p">(</span><span class="n">mail</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    converts list of lines into list of tokens</span>
<span class="sd">    </span>
<span class="sd">    :param:</span>
<span class="sd">     - `mail`: list of space-separated lines</span>
<span class="sd">    :return: list of words in `mail`</span>
<span class="sd">    """</span>
    <span class="n">mail_tokenized</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mail</span><span class="p">)</span>
    <span class="n">mail_bag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">mail_tokenized</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">mail_bag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mail_bag</span>

<span class="n">spam_bag</span> <span class="o">=</span> <span class="n">bagger</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
<span class="n">ham_bag</span> <span class="o">=</span> <span class="n">bagger</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span>
            
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">assert_equal</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> \
        <span class="s2">"'{2}'</span><span class="se">\n</span><span class="s2">Expected: {0}, Actual: {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">vocabulary_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">)</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">bag</span><span class="p">,</span> <span class="s1">'check spam bags'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">bag</span><span class="p">,</span> <span class="s1">'ham bags'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">vocabulary_size</span><span class="p">,</span> <span class="s1">'vocabulary size'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="what-is-the-probability-that-a-piece-of-mail-is-spam?">what is the probability that a piece of mail is spam?<a class="anchor-link" href="posts/baysian-spam-detector/#what-is-the-probability-that-a-piece-of-mail-is-spam?">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">mail_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">sample_size</span><span class="p">,</span> <span class="s1">'mail count'</span><span class="p">)</span>
<span class="n">p_spam</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">),</span> <span class="n">mail_count</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="s1">'p-spam known'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p-spam detector'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>3/8
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="what-is-p('secret'|-spam)?">what is p('secret'| spam)?<a class="anchor-link" href="posts/baysian-spam-detector/#what-is-p('secret'%7C-spam)?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">word_count</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    count the number of times a word is in the bag</span>

<span class="sd">    :param:</span>
<span class="sd">     - `bag`: collection of words</span>
<span class="sd">     - `word`: word to count</span>
<span class="sd">    :return: number of times word appears in bag</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">bag</span> <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">word</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">p_word</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    fraction of times word appears in the bag</span>

<span class="sd">    :param:</span>
<span class="sd">     - `bag`: collection of words</span>
<span class="sd">     - `word`: word to count in bag</span>
<span class="sd">     - `k`: laplace smoothing constant</span>
<span class="sd">     - `sample_space`: total number of words in vocabulary</span>
<span class="sd">    :return: Fraction of total bag that is word</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">word_count</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bag</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">sample_space</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_secret_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_secret_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_secret_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span>
             <span class="s1">'secret given spam'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_secret_given_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="what-is-p('secret'|-ham)?">what is p('secret'| ham)?<a class="anchor-link" href="posts/baysian-spam-detector/#what-is-p('secret'%7C-ham)?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_secret_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_secret_given_ham</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_secret_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_secret_given_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/15
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="You-get-a-message-with-one-word---'sports',-what-is-p(spam|'sports')?">You get a message with one word - 'sports', what is p(spam|'sports')?<a class="anchor-link" href="posts/baysian-spam-detector/#You-get-a-message-with-one-word---'sports',-what-is-p(spam%7C'sports')?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|`sports'</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">`sports' | spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">`sports'</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|`sports') = \frac{p(`sports' | spam)p(spam)}{p(`sports')}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_sports_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_sports_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sports_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(sports|spam)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_sports_given_spam</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_sports_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_sports_given_ham</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sports_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(sports|ham)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_ham</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">),</span> <span class="n">mail_count</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>5/8
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_sports</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">word_count</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">)</span> <span class="o">+</span> <span class="n">word_count</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'sports'</span><span class="p">),</span> <span class="n">vocabulary</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_sports</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/2
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [41]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_spam_given_sports</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_sports_given_spam</span> <span class="o">*</span> <span class="n">p_spam</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p_sports_given_spam</span> <span class="o">*</span> <span class="n">p_spam</span> <span class="o">+</span> <span class="n">p_sports_given_ham</span> <span class="o">*</span> <span class="n">p_ham</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_sports</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_sports</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="s1">'sports'</span><span class="p">),</span>
             <span class="s1">'p(spam|sports)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_sports</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/6
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Given-the-message-'secret-is-secret',-what-is-the-probability-that-it-is-spam?">Given the message 'secret is secret', what is the probability that it is spam?<a class="anchor-link" href="posts/baysian-spam-detector/#Given-the-message-'secret-is-secret',-what-is-the-probability-that-it-is-spam?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [42]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|message</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">message|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam}{p</span><span class="o">(</span><span class="nb">message|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">message|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|message) = \frac{p(message|spam)p(spam}{p(message|spam)p(spam) + p(message|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, the question here is, how do you calculate the probabilities for the entire message instead of for a single word? The answer turns out to be to multiply the probability for each of the words together - so  p('secret is secret'| spam) is the product p('secret'|spam) x p('is'|spam) x p('secret'|spam)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [43]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|sis</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|sis) = \frac{p(s|spam)p(i|spam)p(s|spam)p(spam)}{p(s|spam)p(i|spam)p(s|spam)p(spam) + p(s|ham)p(i|ham)p(s|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Where s = 'secret', i = 'is' and sis='secret is secret'.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [44]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">p_is_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_is_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|spam)'</span><span class="p">)</span>
<span class="n">p_is_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_is_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|ham)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">bag</span><span class="p">,</span> <span class="n">class_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `message`: string of words</span>
<span class="sd">     - `bag`: bag of words</span>
<span class="sd">     - `class_probability`: probability for this class (e.g. p(spam))</span>
<span class="sd">     - `k`: Laplace smoothing constant</span>
<span class="sd">     - `sample_space`: Size of the vocabulary</span>
<span class="sd">    :return: p(message|classification) * p(classification)</span>
<span class="sd">    """</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_word</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">probability</span> <span class="o">=</span> <span class="n">class_probability</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">:</span>
        <span class="n">probability</span> <span class="o">*=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">probability</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `message`: string of words</span>
<span class="sd">     - `k`: Laplace Smoothing constant</span>
<span class="sd">     - `sample_space`: total count of words in spam/ham bags</span>
<span class="sd">    :return: probability message is spam</span>
<span class="sd">    """</span>
    <span class="n">spam_probability</span> <span class="o">=</span> <span class="n">p_spam</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lp_spam</span>
    <span class="n">ham_probability</span> <span class="o">=</span> <span class="n">p_ham</span> <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lp_ham</span>
    <span class="n">p_m_given_spam</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">spam_bag</span><span class="p">,</span> <span class="n">spam_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span>
    <span class="n">p_m_given_ham</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">ham_probability</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">sample_space</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_m_given_spam</span><span class="o">/</span><span class="p">(</span><span class="n">p_m_given_spam</span> <span class="o">+</span> <span class="n">p_m_given_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [47]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">message</span> <span class="o">=</span> <span class="s1">'secret is secret'</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">p_sis_given_spam</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_secret_given_spam</span> <span class="o">*</span> <span class="n">p_is_given_spam</span> <span class="o">*</span> <span class="n">p_secret_given_spam</span>
                    <span class="o">*</span> <span class="n">p_spam</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">spam_bag</span><span class="p">,</span> <span class="n">p_spam</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_sis_given_spam</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sis_given_spam</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(sis|spam)'</span><span class="p">)</span>

<span class="n">p_sis_given_ham</span> <span class="o">=</span> <span class="n">p_secret_given_ham</span> <span class="o">*</span> <span class="n">p_is_given_ham</span> <span class="o">*</span> <span class="n">p_secret_given_ham</span> <span class="o">*</span> <span class="n">p_ham</span>
<span class="k">assert</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">p_ham</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_sis_given_ham</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_sis_given_ham</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(sis|ham)'</span><span class="p">)</span>

<span class="n">p_spam_given_sis</span> <span class="o">=</span> <span class="n">p_sis_given_spam</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_sis_given_spam</span> <span class="o">+</span> <span class="n">p_sis_given_ham</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_sis</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="s1">'p(spam|sis)'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="n">p_spam_given_sis</span>
<span class="k">assert</span> <span class="n">p_spam_given_sis</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_sis</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>25/26
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id='What-is-the-probability-that-"today-is-secret"-is-spam?'>What is the probability that "today is secret" is spam?<a class="anchor-link" href="posts/baysian-spam-detector/#What-is-the-probability-that-%22today-is-secret%22-is-spam?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [48]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam|tis</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{p</span><span class="o">(</span><span class="nb">t|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb">}{p</span><span class="o">(</span><span class="nb">t|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|spam</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">spam</span><span class="o">)</span><span class="nb"> </span><span class="o">+</span><span class="nb"> p</span><span class="o">(</span><span class="nb">t|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">i|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">s|ham</span><span class="o">)</span><span class="nb">p</span><span class="o">(</span><span class="nb">ham</span><span class="o">)</span><span class="nb">}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(spam|tis) = \frac{p(t|spam)p(i|spam)p(s|spam)p(spam)}{p(t|spam)p(i|spam)p(s|spam)p(spam) + p(t|ham)p(i|ham)p(s|ham)p(ham)}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [49]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tis</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">p_spam_given_tis</span> <span class="o">=</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p_spam_given_tis</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">p_spam_given_tis</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">p_spam_given_tis</span><span class="p">,</span> <span class="n">detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span>
             <span class="s1">'p(spam|tis)'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="s1">'today'</span> <span class="ow">in</span> <span class="n">spam_bag</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[50]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since one of the words isn't in the spam bag of words, the numerator is going to be 0 (p('today'|spam) = 0) so the probability overall is 0.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Laplace-Smoothing">Laplace Smoothing<a class="anchor-link" href="posts/baysian-spam-detector/#Laplace-Smoothing">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When a single missing word drops the probability to 0, this means your model is overfitting the data. To get around this Laplace Smoothing is used.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="c">%%latex</span>
<span class="s">$</span><span class="nb">p</span><span class="o">(</span><span class="nb">s</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\frac</span><span class="nb">{s_{count} </span><span class="o">+</span><span class="nb"> k}{total_{count} </span><span class="o">+</span><span class="nb"> k </span><span class="o">*</span><span class="nb"> |classes|}</span><span class="s">$</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_latex output_subarea ">
$p(s) = \frac{s_{count} + k}{total_{count} + k * |classes|}$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>let <em>k = 1</em>.</p>
<p><em>What is the probability that a message is spam if you have 1 example message and it's spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [52]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="k">def</span> <span class="nf">l_probability</span><span class="p">(</span><span class="n">class_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    :param:</span>
<span class="sd">     - `class_count`: size of event space</span>
<span class="sd">     - `total_count`: size of sample space</span>
<span class="sd">     - `k`: constant to prevent 0 probability</span>
<span class="sd">     - `classes`: total number of events</span>
<span class="sd">    :return: probability of class_count with Laplace Smoothing</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">class_count</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">total_count</span> <span class="o">+</span> <span class="n">classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [53]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># classes = spam, ham</span>
<span class="n">number_of_classes</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">messages</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">spam_messages</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">messages</span> <span class="o">+</span> <span class="n">number_of_classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                            
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2/3
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What if you have 10 messages and 6 are spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [55]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">messages</span><span class="p">,</span> <span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">spam_messages</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">spam_messages</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">messages</span> <span class="o">+</span> <span class="n">number_of_classes</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">actual</span> <span class="o">==</span> <span class="n">expected</span>
<span class="nb">print</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>7/12
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What if you have 100 messages and 60 are spam?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [56]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">messages</span><span class="p">,</span> <span class="n">spam_messages</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">60</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l_probability</span><span class="p">(</span><span class="n">spam_messages</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>61/102
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="spam/ham-with-Laplace-Smoothing">spam/ham with Laplace Smoothing<a class="anchor-link" href="posts/baysian-spam-detector/#spam/ham-with-Laplace-Smoothing">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What are the probabilities that a message is spam or ham with k=1?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [57]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">lp_spam</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">class_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spam</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(spam)'</span><span class="p">)</span>
<span class="n">lp_ham</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="n">mail_count</span><span class="p">,</span> <span class="n">class_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ham</span><span class="p">))</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="s1">'p(ham)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_spam</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_ham</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>2/5
3/5
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>What are p('today'|spam) and p('today'|ham)?</em></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case the class-count isn't 2 (for spam or ham) but 12, for the total number of words in the vocabulary.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [58]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="nb">print</span><span class="p">(</span><span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1/21
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [59]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">lp_today_given_spam</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">),</span>
                                    <span class="n">class_count</span><span class="o">=</span><span class="n">word_count</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">),</span>
                                    <span class="n">classes</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_today_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'today'</span><span class="p">),</span> <span class="s1">'p(today|spam)'</span><span class="p">)</span>
<span class="n">lp_today_given_ham</span> <span class="o">=</span> <span class="n">l_probability</span><span class="p">(</span><span class="n">total_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">),</span>
                                   <span class="n">class_count</span><span class="o">=</span><span class="n">word_count</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'today'</span><span class="p">),</span>
                                   <span class="n">classes</span><span class="o">=</span><span class="n">vocabulary</span>
<span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_today_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'today'</span><span class="p">),</span>
             <span class="s1">'p(today|ham)'</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_today_given_spam</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_today_given_ham</span> <span class="o">==</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'p(today|spam) = {0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_today_given_spam</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'p(today|ham) = {0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_today_given_ham</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>p(today|spam) = 1/21
p(today|ham) = 1/9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What-is-p(spam|m)-if-m-=-'today-is-secret'-and-k=1?">What is p(spam|m) if m = 'today is secret' and k=1?<a class="anchor-link" href="posts/baysian-spam-detector/#What-is-p(spam%7Cm)-if-m-=-'today-is-secret'-and-k=1?">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [60]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">tis</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">lp_is_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_is_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|spam)'</span><span class="p">)</span>

<span class="n">lp_is_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'is'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_is_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'is'</span><span class="p">),</span> <span class="s1">'p(is|ham)'</span><span class="p">)</span>

<span class="n">lp_secret_given_spam</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">spam_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_secret_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|spam)'</span><span class="p">)</span>

<span class="n">lp_secret_given_ham</span> <span class="o">=</span> <span class="n">p_word</span><span class="p">(</span><span class="n">ham_bag</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_secret_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_word</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span> <span class="s1">'p(secret|ham)'</span><span class="p">)</span>

<span class="n">lp_tis_given_spam</span> <span class="o">=</span> <span class="n">lp_today_given_spam</span> <span class="o">*</span> <span class="n">lp_is_given_spam</span> <span class="o">*</span> <span class="n">lp_secret_given_spam</span> <span class="o">*</span> <span class="n">lp_spam</span>
<span class="n">lp_tis_given_ham</span> <span class="o">=</span>  <span class="n">lp_today_given_ham</span> <span class="o">*</span> <span class="n">lp_is_given_ham</span> <span class="o">*</span> <span class="n">lp_secret_given_ham</span> <span class="o">*</span> <span class="n">lp_ham</span>
<span class="n">lp_spam_given_tis</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">lp_tis_given_spam</span><span class="p">,</span> <span class="n">lp_tis_given_spam</span> <span class="o">+</span> <span class="n">lp_tis_given_ham</span><span class="p">)</span>

<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_tis_given_spam</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">spam</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(tis|spam)'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_tis_given_ham</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">ham</span><span class="o">.</span><span class="n">p_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(tis|ham)'</span><span class="p">)</span>
<span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">l_detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">tis</span><span class="p">),</span> <span class="s1">'p(spam|tis)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>324/667
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is just more double-checking to make sure that the functions I originally wrote match the hand-calculated answers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [61]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">actual</span> <span class="o">=</span> <span class="n">p_message_given_class</span><span class="p">(</span><span class="n">tis</span><span class="p">,</span> <span class="n">ham_bag</span><span class="p">,</span> <span class="n">lp_ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_tis_given_ham</span> <span class="o">==</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Expected: {0} Actual: {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_tis_given_ham</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [62]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">actual</span> <span class="o">=</span> <span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">tis</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_space</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">lp_spam_given_tis</span> <span class="o">==</span> <span class="n">actual</span> <span class="p">,</span> <span class="s2">"Expected: {0} Actual: {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Re-do">Re-do<a class="anchor-link" href="posts/baysian-spam-detector/#Re-do">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since the code ended up being so messy I'm going to re-do the last example using the class-based version only.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [64]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">spam_detector</span> <span class="o">=</span> <span class="n">SpamDetector</span><span class="p">(</span><span class="n">spam</span><span class="o">=</span><span class="n">spam</span><span class="p">,</span> <span class="n">ham</span><span class="o">=</span><span class="n">ham</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="s1">'today is secret'</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">spam_detector</span><span class="o">.</span><span class="n">p_spam_given_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"p(spam|'today is secret') = {0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">answer</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>p(spam|'today is secret') = 324/667
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [65]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">assert_equal</span><span class="p">(</span><span class="n">lp_spam_given_tis</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="s2">"p(spam|'today is secret')"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/testing-katex/" class="u-url">Testing KaTex</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/testing-katex/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T14:43:41-08:00" title="2016-03-02 14:43">2016-03-02 14:43</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a test to see if <a class="reference external" href="https://khan.github.io/KaTeX/">KaTex</a> is working.</p>
<div class="math">
\begin{align*}
f(x) = \pi r^2\\
\end{align*}
</div>
<p>The answer is no, but mathjax does seem to work.</p>
<div class="section" id="getting-it-working">
<h2>Getting it Working</h2>
<p>Edit the <tt class="docutils literal">conf.py</tt> file.</p>
<blockquote>
<ol class="arabic simple">
<li>Uncomment the second <tt class="docutils literal">MATHJAX_CONFIG</tt> default (the one with actual content instead of an empty string).</li>
<li>Set <tt class="docutils literal">EXTRA_HEAD_DATA</tt> to the mathjax CDN.</li>
</ol>
</blockquote>
<pre class="code python"><a name="rest_code_4efbf907c4574f24af50a8ff52e60eb3-1"></a><span class="n">EXTRA_HEAD_DATA</span> <span class="o">=</span> <span class="s1">'''</span>
<a name="rest_code_4efbf907c4574f24af50a8ff52e60eb3-2"></a><span class="s1">&lt;script type="text/javascript" async</span>
<a name="rest_code_4efbf907c4574f24af50a8ff52e60eb3-3"></a><span class="s1">  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"&gt;</span>
<a name="rest_code_4efbf907c4574f24af50a8ff52e60eb3-4"></a><span class="s1">&lt;/script&gt;</span>
<a name="rest_code_4efbf907c4574f24af50a8ff52e60eb3-5"></a><span class="s1">'''</span>
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference external" href="https://getnikola.com/handbook.html#math">documentation</a> says that you need to add the <tt class="docutils literal">mathjax</tt> tag to the post, but the <tt class="docutils literal">conf.py</tt> has <tt class="docutils literal">HIDDEN_TAGS = ['mathjax']</tt> which I think makes it work anyway. The documentation also makes no mention of the need for the CDN (or installing the javascript) but nikola doesn't seem to come with <cite>mathjax</cite> otherwise.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/converting-nikola-from-a-blog-to-a-site/" class="u-url">Converting Nikola from a Blog to a Site</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/converting-nikola-from-a-blog-to-a-site/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T12:53:31-08:00" title="2016-03-02 12:53">2016-03-02 12:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>These are my notes on converting this site to be a web-site first (with a blog on the side). There is an official page on <a class="reference external" href="https://getnikola.com/creating-a-site-not-a-blog-with-nikola.html">creating a site instead of a blog</a>, but I had a little bit of a hard time figuring out what was going on so these are the main points in case I need to do it again.</p>
<p>In a nutshell:</p>
<blockquote>
<ol class="arabic simple">
<li>Get rid of the sub-folder argument in the <tt class="docutils literal">PAGES</tt> variable in <tt class="docutils literal">conf.py</tt>
</li>
<li>Set <tt class="docutils literal">INDEX_PATH</tt> to point to the <cite>posts</cite> sub-folder</li>
<li>Create an index page for the site.</li>
</ol>
</blockquote>
<div class="section" id="conf-py">
<h2>conf.py</h2>
<p>The main things to do are to edit the <cite>conf.py</cite> file so that the pages you create get copied over as the root of the <cite>output</cite> folder (instead of in a sub-folder called <cite>stories</cite>) and moving the blog-index down into a sub-folder.</p>
<div class="section" id="making-stories-the-site">
<h3>Making 'stories' the Site</h3>
<p>To make the pages you create the root of the site you need to change the <tt class="docutils literal">PAGES</tt> variable to not have a sub-folder as the target (this is the second-entry in the tuple). So if it originally was:</p>
<pre class="code python"><a name="rest_code_84ef6c85dc434f54a4350865e85a6ca2-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_84ef6c85dc434f54a4350865e85a6ca2-2"></a>    <span class="p">(</span><span class="s2">"stories/*.rst"</span><span class="p">,</span> <span class="s2">"stories"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a name="rest_code_84ef6c85dc434f54a4350865e85a6ca2-3"></a><span class="p">)</span>
</pre>
<p>You would change the second value in the tuple to an empty string:</p>
<pre class="code python"><a name="rest_code_26378a3445454b6aaa7a8ffe8a3ab633-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_26378a3445454b6aaa7a8ffe8a3ab633-2"></a>    <span class="p">(</span><span class="s2">"stories/*.rst"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a name="rest_code_26378a3445454b6aaa7a8ffe8a3ab633-3"></a><span class="p">)</span>
</pre>
<p>Now when you build the site (<tt class="docutils literal">nikola build</tt>) the <tt class="docutils literal">output</tt> folder will have your 'stories' at the top-level. This means that when you refer to pages (e.g. in the navigation configuration) you don't add 'stories/' as a prefix anymore.</p>
</div>
<div class="section" id="moving-the-blog-index">
<h3>Moving the Blog-index</h3>
<p>Since Nikola assumes that the blog is your main-page you need to tell it to create the index in a sub-folder by setting the <tt class="docutils literal">INDEX_PATH</tt> to the name of the sub-folder. If, for example, the blog-posts are being put into <tt class="docutils literal">posts</tt>, the setting would be:</p>
<pre class="code python"><a name="rest_code_7186334ece0a47f2a84e6807c2a67264-1"></a><span class="n">INDEX_PATH</span> <span class="o">=</span> <span class="s2">"posts"</span>
</pre>
</div>
</div>
<div class="section" id="creating-the-home-page">
<h2>Creating the Home Page</h2>
<p>At this point if you build the site and navigate to it you'll find that your home-page is now a directory of your <tt class="docutils literal">output</tt> folder. You can navigate to a page by going through the folders, but this is probably not the intended way to get around. The easiest way (that I found) to create the home-page is to create a new-page (<tt class="docutils literal">nikola new_page</tt>) and when prompted for a title, call it <tt class="docutils literal">index</tt>. This will create <tt class="docutils literal">stories/index.rst</tt> which you can edit to become your home page (make sure to change the title if you don't want the page headline to be 'index').</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Some other things might need to be re-done in the <tt class="docutils literal">conf.py</tt> as well, since the folder structure has changed. These are only the basic steps to switch. The <tt class="docutils literal">NAVIGATION_LINKS</tt> in particular may need updating.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201512some-emacs-notes-mostly-hide-show/" class="u-url">Some Emacs Notes (mostly hide-show)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201512some-emacs-notes-mostly-hide-show/" rel="bookmark"><time class="published dt-published" datetime="2015-12-31T22:03:00-08:00" title="2015-12-31 22:03">2015-12-31 22:03</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <span style="font-family: inherit;">I spent most of yesterday troubleshooting someone else's code and I found these commands useful (among others - these are just the ones that I had to look up).</span><br><span style="font-family: inherit;"><br></span><h3><span style="font-family: inherit;">Occur</span></h3>
<span style="font-family: inherit;">One problem that I ran across was that there were around two dozen class definitions, all of which were similar so the bugs that were in one tended to be in all the other classes as well. I found that using the <span style='font-family: "Courier New",Courier,monospace;'>M-x occur</span> command was useful for looking at all instances of certain lines, so I could search for things that were common among all the class definitions (<span style='font-family: "Courier New",Courier,monospace;'>occur</span> is aliased by the <span style='font-family: "Courier New",Courier,monospace;'>list-matching-lines</span> command).</span><br><br><span style="font-family: inherit;">At one point, for instance, I thought that two class names looked the same, so I guessed that whoever wrote the code probably lost track of the classes that they had defined and duplicated (at least) one of them. To check I entered:</span><br><br><span style="font-family: inherit;"><span style='font-family: "Courier New",Courier,monospace;'>M-x occur class</span> </span><br><br><span style="font-family: inherit;">Which brought up a list of lines that had the word 'class' in them and found that they had indeed duplicated that class definition. The argument 'class' is a regular expression so if there were other places where the word 'class' was used (e.g. in a nested class or a comment), you could add a start of line character:</span><br><br><span style="font-family: inherit;"> <span style='font-family: "Courier New",Courier,monospace;'>M-x occur ^class</span></span><br><span style="font-family: inherit;">  </span><br>This would only bring up lines that started with the work 'class'. <h3><span style="font-family: inherit;">Hide-show </span></h3>This is an emacs mode that I keep rediscovering so I figured I should write it down. This mode enables code-folding (since I program in python this means hiding code that is indented.<br><br>If, for example, you had these class definition:<br><br><pre name="class-test" class="brush: python"><br>class Test(object):<br>     def __init__(self, x):<br>         self.x = x<br><br>class TestTest(Test):<br>    def __init__(self, y, *args, **kwargs):<br>         super(TestTest, self).__init__(*args, **kwargs)<br>         self.y = y<br></pre>
<br>After you folded it you would see:<br><br><pre name="class-test-folded" class="brush: python"><br>class Test(object): <br><br>class TestTest(Test):<br></pre>
<br><br><br>To enable hide-show for the buffer you're in:<br><br><span style='font-family: "Courier New",Courier,monospace;'>M-x hs-minor-mode</span><br><br>But in my case I want it to always be on when I'm editing a python file so I added this to my ~/.emacs.d/init.el file:<br><br><span style='font-family: "Courier New",Courier,monospace;'>(defun turn-on-hideshow () (hs-minor-mode 1))<br>(add-hook 'python-mode-hook 'turn-on-hideshow)</span><br><br>I don't know why but emacs doesn't seem to have a way to automatically associate minor-modes with file-extensions so the work-around is to first define a function that turns on the minor mode (called 'turn-on-hideshow' in this case) and then add it to the hook of the major-mode ('python-mode-hook' in this case). Once you have hideshow working, you have a few options available to you (see <a href="http://www.emacswiki.org/emacs/HideShow" target="_blank">the wiki</a>) but I only use three of them most of the time.<br><br>The main trigger for 'hs-minor-mode' is <span style='font-family: "Courier New",Courier,monospace;'>C-c @</span> which you follow with the actual command. For instance, to hide (fold) everything that isn't flush-left:<br><br><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-H</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>which translates to <span style='font-family: "Courier New",Courier,monospace;'>control-c, @, control-alt-shift-h</span> ('H' is for hide).</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>The opposite (show all the hidden text) is:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-S</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>The only other command that I use a lot (so far) is toggle block:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>What this does is  toggle the block where your cursor is currently located. A block is the line that is flush left and all the lines that follow it that are indented. So, if you have multiple classes and functions defined, each one of them would be a block. If the block you're at isn't folded, then entering <span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span> will hide the indented lines and if they are already hidden then it will un-hide them.</span></span></span><br><h3><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Paragraph Navigation </span></span></span></h3>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>This is one of those things that you learn when you first go through the emacs tutorial, but somehow I always forget it - emacs will jump between paragraphs (it uses newlines so it doesn't work quite right for code, but works for expository text). </span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>To jump to the previous paragraph:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>M-x {</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>To go to the next paragraph:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>M-x }</span><br><br><h3><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'> How I Used It</span></span></span></h3>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'> I don't want to share the code (since it wasn't mine) but in a nutshell what I faced was a file with a couple-dozen class definitions (this was a django-<a href="https://factoryboy.readthedocs.org/en/latest/" target="_blank">factory-boy</a> module so each model (database table) had two classes, a straight factory and a fuzzy version), so the first thing I did was fold all the classes to make it easier to get a high-level view:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-H</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then I noticed the duplicate class names so I listed all the classes that had that name:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>M-x occur class &lt;class name&gt;</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Occur gives you the line numbers so you can jump right to the line (although if the line is within a folded block you have to un-fold it first) so I created two windows:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>C-x 2</span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then I jumped to the starting line of the first definition  in the first window (line 5 in this example) and un-hid it:</span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'>M-g-g 5</span><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span> </span></span></span><br><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then navigated to the other window and jumped to the starting line of  the second definition (line 50 in this example) and un-hid it:</span></span></span><br><span style='font-family: "Courier New",Courier,monospace;'><br></span><span style='font-family: "Courier New",Courier,monospace;'>C-x o</span><br><span style='font-family: "Courier New",Courier,monospace;'>M-g-g 50</span><br><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span><br><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'><br></span></span></span><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Inspecting the definitions revealed that they had the same attributes but were assigned different values so I had no way of knowing which was the class definition to keep and the person who wrote them was on vacation so I decided not to fix it (I needed a different class in the module so this didn't directly affect me).</span></span></span>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201512removing-large-files-from-git-using-bfg/" class="u-url">Removing Large Files From git using BFG</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201512removing-large-files-from-git-using-bfg/" rel="bookmark"><time class="published dt-published" datetime="2015-12-05T23:15:00-08:00" title="2015-12-05 23:15">2015-12-05 23:15</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>I accidentally committed some large files to a git repository and couldn't push my changes up to github, having exceeded their file-size limit. I stumbled upon the <a href="https://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a> and these notes so I don't forget what I did.<br><br>The instructions on the website are pretty clear, but it assumes that the large files are on a remote repository but in my case my changes are local so I needed to change the first step from cloning the repository to cleaning the git repository (which I'll call big_files). In this case I decided to remove anything bigger than 50 MegaBytes.<br><br></p>
<pre class="brush: python">cd big_files<br>git gc<br>cd ../<br>java -jar bfg-1.12.7.jar --strip-blobs-bigger-than 50M big_files<br>cd big_files<br>git reflog expire --expire=now --all<br>git gc --prune=now --aggressive</pre>
<br>So there's three basic parts, cleaning the repository:<br><br><pre class="brush: python">cd big_files<br>git gc<br>cd ../<br><br><br></pre>then running BFG<br><br><pre class="brush: python">java -jar bfg-1.12.7.jar --strip-blobs-bigger-than 50M big_files<br><br><br></pre>and then cleaning up again:<br><br><pre class="brush: python">cd big_files<br>git reflog expire --expire=now --all<br>git gc --prune=now --aggressive<br></pre>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201503ubuntu-1410-and-brother-hl-2140/" class="u-url">Ubuntu 14.10 and the Brother HL-2140</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201503ubuntu-1410-and-brother-hl-2140/" rel="bookmark"><time class="published dt-published" datetime="2015-03-08T23:53:00-07:00" title="2015-03-08 23:53">2015-03-08 23:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a <a href="http://www.brother-usa.com/Printer/ModelDetail/1/hl2140/Overview">Brother HL-2140 Laser Printer </a>which was working previously but for some reason gave me a CUPs error when I tried to print today (I think this was the first time I'd tried to print since upgrading to Ubuntu 14.10). I searched for the error on the web and found this <a href="http://ubuntuforums.org/showthread.php?t=1748457">forum post</a> that didn't address my problem directly but did address a problem I had when I set up my printer before (on Ubuntu 14.04, I'm using 14.10 now) where the printer would churn out blank pages instead of printing what I wanted so I decided to give it a try again. There are a few suggestions on the page but the two I tried both suggested using a different driver. <br><br>The first suggestion I tried was to use the <i>HL-2170</i> instead of the <i>HL-2140.</i> This worked when I printed the first test page but after that it just silently failed no matter what I tried to install.<br><br>The next suggestion I tried was to use the <i>Brother HL-2140 Foomatic/hpijs-pcl5e</i> driver. This didn't print any pages for me and gave a `Idle - filter failed` error in the printer properties dialogue box. I don't know what the message means, but since I fixed it without knowing, I guess I don't need to know.<br><br>Sandwiched between the <i>HL-2170</i> and the <i>HL-2140</i> models in the list of available drivers was the <i>HL-2142</i> model. Since it seemed close enough to the 2140 (only off by two) I decided to try it and for whatever reason it worked. I'm pretty sure I used one of drivers the forum post suggested when I was using 14.04 (and the default <i>HL-2140*</i>driver before that) but something seems to have changed again.<br><br>There's two lessons here:<br><br>  1. Use the <i>HL-2142</i> driver for the <i>Brother HL-2140</i> printer on Ubuntu 14.10<br>  2. Try drivers for similar models if you upgrade your Ubuntu installation and the printer stops working<br></p>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201412using-pudb-with-behave-and-fish-what-is/" class="u-url">Using pudb with Behave and Fish</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201412using-pudb-with-behave-and-fish-what-is/" rel="bookmark"><time class="published dt-published" datetime="2014-12-31T06:43:00-08:00" title="2014-12-31 06:43">2014-12-31 06:43</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div class="document" id="using-pudb-with-behave-and-fish">
<h1>What is this about?</h1>
<div class="section" id="what-is-this-about">
<a class="reference external" href="http://pythonhosted.org/behave/">behave</a> is a behavior-driven-development (BDD) tool for python that tests whether you have properly implemented the features you have defined in your <cite>features</cite> file(s). In their <a class="reference external" href="http://pythonhosted.org/behave/tutorial.html">tutorial</a> they tell you how you can set it up so that it will drop into <a class="reference external" href="http://ipython.org/ipython-doc/rel-0.10.2/html/api/generated/IPython.Debugger.html">ipdb</a> (ipython debugger) when a test fails, but I use <a class="reference external" href="https://github.com/inducer/pudb">pudb</a> and the <a class="reference external" href="http://fishshell.com/">fish</a> shell (not <cite>bash</cite>) so this documents what I had to do to get it to work.</div>
<div class="section" id="how-do-you-do-it-then">
<h1>How do you do it then?</h1>The first thing to do is create a file named <cite>environment.py</cite> in the same folder as the <cite>features</cite> file. Inside of it put the following:<br><pre class="literal-block">from distutils.util import strtobool as _bool<br>import os<br><br>BEHAVE_DEBUG_ON_ERROR = _bool(os.environ.get("BEHAVE_DEBUG_ON_ERROR",<br>                                             "no"))<br>def after_step(context, step):<br>    if BEHAVE_DEBUG_ON_ERROR and step.status == 'failed':<br>        import pudb<br>        pudb.post_mortem(tb=step.exc_traceback,<br>                         e_type=None,<br>                         e_value=None)<br>    return<br></pre>This is more-or-less exactly what was in the tutorial except I swapped out <cite>pudb</cite> for <cite>pdb</cite>. This code tells <cite>behave</cite> to run the <cite>pudb.post_mortem</cite> after a step is finished (a step corresponds to one of the functions you define to implement the tests) if the step failed and your shell has an environment variable named <cite>BEHAVE_DEBUG_ON_ERROR</cite> and it is set to something that <cite>strtobool</cite> recognizes as True. This is from the docstring documentation for <a class="reference external" href="https://docs.python.org/2/distutils/apiref.html#module-distutils.util">strtobool</a>:<br><blockquote> <dl class="docutils">
<dt>distutils.util.strtobool(val)</dt>
<dd>
<div class="first">Convert a string representation of truth to true (1) or false (0).</div>
<ul class="last simple">
<li>True values are <cite>y</cite>, <cite>yes</cite>, <cite>t</cite>, <cite>true</cite>, <cite>on</cite> and <cite>1</cite>
</li>
<li>false values are <cite>n</cite>, <cite>no</cite>, <cite>f</cite>, <cite>false</cite>, <cite>off</cite> and <cite>0</cite>
</li>
<li>Raises <b>ValueError</b> if val is anything else.</li>
</ul>
</dd>
</dl>
</blockquote>The 'no' in the <tt class="docutils literal">os.environ.get</tt> function means that it won't execute by default. To have it run you need to set the environment variable to one of the 'true' values. In fish this would be:<br><pre class="literal-block">set -x BEHAVE_DEBUG_ON_ERROR yes<br></pre>Now when you run behave it will drop into pudb when a test fails.</div>
<div class="section" id="so-what-then">
<h1>So, what then?</h1>Using this has so far been less useful than I thought it would be, since it tends to drop me into the <a class="reference external" href="https://pypi.python.org/pypi/PyHamcrest">pyhamcrest</a> call that failed and although I've managed to step through to the <cite>behave</cite> code I haven't managed to figure out how to get to my own code. It is still useful, though, since <cite>behave</cite> will not stop when it encounters a failed test so this makes it easier to figure out what has failed.<br>Even though the <cite>pudb-behave</cite> combination is less exciting than I thought it would be, there were several things I learned that I want to document here for later.<br><div class="section" id="setting-an-environment-variable-in-fish">
<h2>Setting an environment variable in fish</h2>To set a fish environment variable:<br><pre class="literal-block">set -x &lt;variable&gt; &lt;value&gt;<br></pre>And then unset it:<br><pre class="literal-block">set -e &lt;variable&gt;<br></pre>I've done this before to set my <tt class="docutils literal">PATH</tt> variable but for some reason when I tried to search for it this time I got some false-starts at first.</div>
<div class="section" id="python-s-string-to-boolean">
<h2>Python's String to Boolean</h2>I also learned that python has a built in way to translate strings to booleans. This isn't really a hard thing to do on your own, but it was an interesting discovery. I don't think I would have looked in <cite>distutils</cite> for it.</div>
<div class="section" id="pudb-s-post-mortem-function">
<h2>
<cite>pudb's</cite> post_mortem function</h2>Another interesting thing to find out was that <cite>pudb</cite> has a <cite>post_mortem</cite> function. I like <cite>pudb</cite> but it doesn't seem to be well documented. The <tt class="docutils literal">readme</tt> does say that it displays the same interface as python's <cite>pdb</cite> so I suppose I could just read their documentation, but it seems like one of those things where you have to know what you don't know to know to look for it. In this case I figured out how to call it by looking at the code (it's defined in <tt class="docutils literal">pudb.__init__.py</tt>).</div>
<div class="section" id="using-environment-variables-for-debugging">
<h2>Using environment variables for debugging</h2>Probably the most interesting thing was the way they used <cite>os.environ</cite> to change the behavior of the code. I normally use command-line options to enable debugging but this might be a better pattern since it pulls it out of the user interface. This means that it won't be as obvious to the user, but I suppose if they're going to debug my code they had better read the documentation and not just rely on <tt class="docutils literal"><span class="pre">--help</span></tt> anyway. I think I'll probably get rid of in in the <cite>environment.py</cite> file, though, since I want it to run pretty much all the time, but it's an interesting idea anyway.</div>
</div>
<div class="section" id="conclusion">
<h1>Conclusion</h1>This was a translation of how to set up a post-mortem debugger for behave using <cite>pudb</cite> instead of <cite>ipdb</cite> and <cite>fish</cite> instead of <cite>bash</cite>. It is primarily meant to be a record for me to look at in the future, since I don't set up my <cite>behave</cite> environment on a regular basis and tend to have a hard time re-searching for things (possibly because I use <a class="reference external" href="https://duckduckgo.com/">DuckDuckGo</a> so my search history isn't being used). I think the most valuable thing I got out of it was the pattern for setting up debuggers that I think I'll steal (use) for my own code.</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201411installing-python-package-for-single/" class="u-url">Installing a Python Package for a Single User</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201411installing-python-package-for-single/" rel="bookmark"><time class="published dt-published" datetime="2014-11-06T21:27:00-08:00" title="2014-11-06 21:27">2014-11-06 21:27</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <span style="font-family: Georgia, Times New Roman, serif;">Normally when installing a package that I'm working on I'm using a <i>virtualenv </i>so it's installed within that environment only, but I wanted to test part of my code that was using ssh to run a command that I didn't want to install system-wide. Creating a virtualenv for the test-user and activating it before running the command via ssh seemed excessive (and maybe not possible - I didn't try) but it turns out that you can install packages at the user-level using the 'setup.py' file.</span><br><span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Georgia, Times New Roman, serif;">In this case I wanted the setup.py to create a command-line command called 'rotate' and install it in the user's </span><span style="font-family: Courier New, Courier, monospace;">~/bin</span><span style="font-family: Georgia, Times New Roman, serif;"> folder so I could run it something like this:</span><br><br><span style="font-family: Courier New, Courier, monospace;">ssh test@localhost rotate 90</span><br><br><span style="font-family: Georgia, Times New Roman, serif;">First I changed the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span><span style="font-family: Georgia, Times New Roman, serif;"> to add the bin folder to the </span><span style="font-family: Courier New, Courier, monospace;">PATH</span><span style="font-family: Georgia, Times New Roman, serif;">:</span><br><span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Courier New, Courier, monospace;">PATH=$HOME/bin:$PATH</span><br><span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Georgia, Times New Roman, serif;"> This has to be added to the top of the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span><span style="font-family: Georgia, Times New Roman, serif;"> file because the first thing there by default is a conditional that prevents it from using the things in the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span><span style="font-family: Georgia, Times New Roman, serif;"> file:</span><br><span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Courier New, Courier, monospace;"># If not running interactively, don't do anything</span><br><span style="font-family: Courier New, Courier, monospace;">case $- in</span><br><span style="font-family: Courier New, Courier, monospace;">    *i*) ;;</span><br><span style="font-family: Courier New, Courier, monospace;">      *) return;;</span><br><br><span style="font-family: Courier New, Courier, monospace;">esac</span><br><div><br></div>
<div>Next I changed into the directory where the package's setup.py file was and installed the package:</div>
<div><br></div>
<div><span style="font-family: Courier New, Courier, monospace;">python setup.py install --install-scripts=$HOME/bin --user</span></div>
<div><span style="font-family: Courier New, Courier, monospace;"><br></span></div>
<div>
<span style="font-family: Georgia, Times New Roman, serif;">The </span><span style="font-family: Courier New, Courier, monospace;">--user</span><span style="font-family: Georgia, Times New Roman, serif;"> option is what tells python to install it for the local user instead of </span><span style="font-family: Courier New, Courier, monospace;">/usr/local/bin</span><span style="font-family: Georgia, Times New Roman, serif;"> and the </span><span style="font-family: Courier New, Courier, monospace;">--install-scripts </span><span style="font-family: Georgia, Times New Roman, serif;">tells it where to put the commands it creates. Without the </span><span style="font-family: Courier New, Courier, monospace;">--install-scripts</span><span style="font-family: Georgia, Times New Roman, serif;"> option it will install it in </span><span style="font-family: Courier New, Courier, monospace;">.local/bin </span><span style="font-family: Georgia, Times New Roman, serif;">so another option would be to change the </span><span style="font-family: Courier New, Courier, monospace;">PATH </span><span style="font-family: Georgia, Times New Roman, serif;">variable instead:</span>
</div>
<div><span style="font-family: Georgia, Times New Roman, serif;"><br></span></div>
<div><span style="font-family: 'Courier New', Courier, monospace;">PATH=$HOME/.local/bin:$PATH</span></div>
<div><span style="font-family: 'Courier New', Courier, monospace;"><br></span></div>
<div>
<span style="font-family: Georgia, Times New Roman, serif;">But I use </span><span style="font-family: Courier New, Courier, monospace;">~/bin</span><span style="font-family: Georgia, Times New Roman, serif;"> for other commands anyway so it seemed to make more sense to put it there.</span>
</div>
<div><span style="font-family: Georgia, Times New Roman, serif;"><br></span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">OS : Ubuntu 14.04.1 LTS</span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">Python: 2.7.6</span></div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/201310mocking-print/" class="u-url">Mocking Print</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Cloistered Monkey
            </span></p>
            <p class="dateline"><a href="posts/201310mocking-print/" rel="bookmark"><time class="published dt-published" datetime="2013-10-05T22:48:00-07:00" title="2013-10-05 22:48">2013-10-05 22:48</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div class="document" id="mocking-print">   <div class="section" id="background">
<h4>Background</h4>
<p>I wanted to check to make sure I was sending the right output to the screen so I thought I would use <a class="reference external" href="https://pypi.python.org/pypi/mock">mock</a> to catch what I was sending to it. These are some notes about what happened.</p>
</div>
<div class="section" id="id1">
<h4>Mocking print</h4>
<p>If you try to <a class="reference external" href="http://www.voidspace.org.uk/python/mock/getting-started.html#patch-decorators">patch</a>   <tt class="docutils literal">print</tt> with MagicMock, here is what you get.</p>
<pre class="literal-block"><br>from mock import MagicMock, patch, call<br><br>mock_print = MagicMock()<br>try:<br>    with patch('print', mock_print):<br>        print 'test'<br>except TypeError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Need a valid target to patch. You supplied: 'print'<br></pre>
<p>So it looks like 'print' is not the right thing to patch. Maybe you need to call it a built-in funtion:</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print 'test'<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>What if you call it as a function?</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print( 'test')<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>So neither of those raise an error, but they also do not manage to mock <tt class="docutils literal">print</tt>. Well, if you look at the description for <a class="reference external" href="http://docs.python.org/2/library/functions.html#print">print</a>, it turns out that the print function has the signature:</p>
<pre class="literal-block"><br>print(*objects, sep=' ', end='\n', file=sys.stdout)<br></pre>
<p>It also says that the function call is not normally available unless you import it from the future.</p>
<p>But, presuming that the print statement works the same way as the function call, what happens if you mock <tt class="docutils literal">sys.stdout</tt>?</p>
</div>
<div class="section" id="mocking-sys-stdout">
<h4>Mocking sys.stdout</h4>
<p>This doesn't answer the question of why I can't mock print directly, but maybe mocking <tt class="docutils literal">sys.stdout</tt> will work instead.</p>
<pre class="literal-block"><br>with patch('sys.stdout', mock_print):<br>    print 'test'<br><br>expected = [call('test')]<br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Expected: [call('test')] Actual: [call.write('test'), call.write('\n')]<br></pre>
<p>It looks like the mock works this time, but it did not return what I was expecting -- <tt class="docutils literal">print</tt> makes two calls to <tt class="docutils literal">stdout.write</tt>, the first is the string you pass it which it then follows with a newline character. Given this slightly more complete understanding of <tt class="docutils literal">print</tt>:</p>
<pre class="literal-block"><br># create some output to send to print<br>lines = "a b c".split()<br><br># reset the mock so the previous calls are gone<br>mock_print.reset_mock()<br>with patch('sys.stdout', mock_print):<br>    for line in lines:<br>        print line<br><br>expected = []<br>for line in lines:<br>    expected.append(call.write(line))<br>    expected.append(call.write('\n'))<br><br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
</div>
<div class="section" id="conclusion">
<h4>Conclusion</h4>
<p>Not earth-shattering, but I thought it was interesting that even after using Python for years, something as basic as <tt class="docutils literal">print</tt> can yield something new if looked at more closely. It was also useful to see how mock can be used to discover the calls that are being made on an object, not just to test that expected calls are being made.</p>
</div>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-5.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
            MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
            </script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:necromuralist@gmail.com">Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(1, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
