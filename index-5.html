<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A common place." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>The Cloistered Monkey (old posts, page 5) | The Cloistered Monkey</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/index-5.html" rel="canonical">
<link href="index-6.html" rel="prev" type="text/html">
<link href="index-4.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="site.webmanifest" rel="manifest">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">The Cloistered Monkey</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Projects</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="machine-learning-projects/">Machine Learning</a> <a class="dropdown-item" href="https://necromuralist.github.io/student_intervention/">Student Intervention Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/boston_housing/">Boston Housing Project</a> <a class="dropdown-item" href="https://necromuralist.github.io/data_science/">Data Science With Python</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/fatal-platform-error/">Fatal Python Error</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/fatal-platform-error/" rel="bookmark"><time class="published dt-published" datetime="2016-06-19T12:53:31-08:00" itemprop="datePublished" title="2016-06-19 12:53">2016-06-19 12:53</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>I was going to make my first nikola post in a few months but when I tried the <code>nikola new_post</code> command I got the following error.</p>
<div class="highlight">
<pre><span></span>Could not find platform independent libraries &lt;prefix&gt;
Could not find platform dependent libraries &lt;exec_prefix&gt;
Consider setting <span class="nv">$PYTHONHOME</span> to &lt;prefix&gt;<span class="o">[</span>:&lt;exec_prefix&gt;<span class="o">]</span>
Fatal Python error: Py_Initialize: Unable to get the locale encoding
ImportError: No module named <span class="s1">'encodings'</span>
</pre></div>
<p>I had no idea what this meant so I tried searching the web for the error and found people saying different things about what it meant to them when they encountered it, but the one that pointed the way for me was a <a href="https://github.com/pypa/virtualenv/issues/161">bug report for virtualenv</a> where a user reported that he got this error because, it turned out, the Windows version didn't work with symlinks if the window was opened as an administrator.</p>
<p>I'm not using Windows, but when I changed into the directory for my nikola virtualenv installation, <code>ls -l</code> showed that all my symbolic links were broken. I don't know how it happenedâ€¦ maybe something got moved, but the point of this post was to make a note for myself if I see this error again - check the sym-links for the virtualenv installation.</p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/testing-katex/">Testing KaTex</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/testing-katex/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T14:43:41-08:00" itemprop="datePublished" title="2016-03-02 14:43">2016-03-02 14:43</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div>
<p>This is a test to see if <a class="reference external" href="https://khan.github.io/KaTeX/">KaTex</a> is working.</p>
<div class="math">\begin{align*} f(x) = \pi r^2\\ \end{align*}</div>
<p>The answer is no, but mathjax does seem to work.</p>
<div class="section" id="getting-it-working">
<h2>Getting it Working</h2>
<p>Edit the <code class="docutils literal">conf.py</code> file.</p>
<blockquote>
<ol class="arabic simple">
<li>
<p>Uncomment the second <code class="docutils literal">MATHJAX_CONFIG</code> default (the one with actual content instead of an empty string).</p>
</li>
<li>
<p>Set <code class="docutils literal">EXTRA_HEAD_DATA</code> to the mathjax CDN.</p>
</li>
</ol>
</blockquote>
<pre class="code python"><a id="rest_code_d5a23772f7c14ac4a46e92655757d469-1" name="rest_code_d5a23772f7c14ac4a46e92655757d469-1"></a><span class="n">EXTRA_HEAD_DATA</span> <span class="o">=</span> <span class="s1">'''</span>
<a id="rest_code_d5a23772f7c14ac4a46e92655757d469-2" name="rest_code_d5a23772f7c14ac4a46e92655757d469-2"></a><span class="s1">&lt;script type="text/javascript" async</span>
<a id="rest_code_d5a23772f7c14ac4a46e92655757d469-3" name="rest_code_d5a23772f7c14ac4a46e92655757d469-3"></a><span class="s1">  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"&gt;</span>
<a id="rest_code_d5a23772f7c14ac4a46e92655757d469-4" name="rest_code_d5a23772f7c14ac4a46e92655757d469-4"></a><span class="s1">&lt;/script&gt;</span>
<a id="rest_code_d5a23772f7c14ac4a46e92655757d469-5" name="rest_code_d5a23772f7c14ac4a46e92655757d469-5"></a><span class="s1">'''</span>
</pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="https://getnikola.com/handbook.html#math">documentation</a> says that you need to add the <code class="docutils literal">mathjax</code> tag to the post, but the <code class="docutils literal">conf.py</code> has <code class="docutils literal">HIDDEN_TAGS = ['mathjax']</code> which I think makes it work anyway. The documentation also makes no mention of the need for the CDN (or installing the javascript) but nikola doesn't seem to come with <cite>mathjax</cite> otherwise.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/converting-nikola-from-a-blog-to-a-site/">Converting Nikola from a Blog to a Site</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/converting-nikola-from-a-blog-to-a-site/" rel="bookmark"><time class="published dt-published" datetime="2016-03-02T12:53:31-08:00" itemprop="datePublished" title="2016-03-02 12:53">2016-03-02 12:53</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div>
<p>These are my notes on converting this site to be a web-site first (with a blog on the side). There is an official page on <a class="reference external" href="https://getnikola.com/creating-a-site-not-a-blog-with-nikola.html">creating a site instead of a blog</a>, but I had a little bit of a hard time figuring out what was going on so these are the main points in case I need to do it again.</p>
<p>In a nutshell:</p>
<blockquote>
<ol class="arabic simple">
<li>
<p>Get rid of the sub-folder argument in the <code class="docutils literal">PAGES</code> variable in <code class="docutils literal">conf.py</code></p>
</li>
<li>
<p>Set <code class="docutils literal">INDEX_PATH</code> to point to the <cite>posts</cite> sub-folder</p>
</li>
<li>
<p>Create an index page for the site.</p>
</li>
</ol>
</blockquote>
<div class="section" id="conf-py">
<h2>conf.py</h2>
<p>The main things to do are to edit the <cite>conf.py</cite> file so that the pages you create get copied over as the root of the <cite>output</cite> folder (instead of in a sub-folder called <cite>stories</cite>) and moving the blog-index down into a sub-folder.</p>
<div class="section" id="making-pages-the-site">
<h3>Making 'pages' the Site</h3>
<p>To make the pages you create the root of the site you need to change the <code class="docutils literal">PAGES</code> variable to not have a sub-folder as the target (this is the second-entry in the tuple). So if it originally was:</p>
<pre class="code python"><a id="rest_code_c22944ea9b4c48dd81791a171d332b5a-1" name="rest_code_c22944ea9b4c48dd81791a171d332b5a-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a id="rest_code_c22944ea9b4c48dd81791a171d332b5a-2" name="rest_code_c22944ea9b4c48dd81791a171d332b5a-2"></a>    <span class="p">(</span><span class="s2">"pages/*.rst"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a id="rest_code_c22944ea9b4c48dd81791a171d332b5a-3" name="rest_code_c22944ea9b4c48dd81791a171d332b5a-3"></a><span class="p">)</span>
</pre>
<p>You would change the second value in the tuple to an empty string:</p>
<pre class="code python"><a id="rest_code_956b4c41ea334ebb8336c2852898a5b5-1" name="rest_code_956b4c41ea334ebb8336c2852898a5b5-1"></a><span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
<a id="rest_code_956b4c41ea334ebb8336c2852898a5b5-2" name="rest_code_956b4c41ea334ebb8336c2852898a5b5-2"></a>    <span class="p">(</span><span class="s2">"pages/*.rst"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
<a id="rest_code_956b4c41ea334ebb8336c2852898a5b5-3" name="rest_code_956b4c41ea334ebb8336c2852898a5b5-3"></a><span class="p">)</span>
</pre>
<p>Now when you build the site (<code class="docutils literal">nikola build</code>) the <code class="docutils literal">output</code> folder will have your 'stories' at the top-level. This means that when you refer to pages (e.g. in the navigation configuration) you don't add 'pages/' as a prefix anymore.</p>
</div>
<div class="section" id="moving-the-blog-index">
<h3>Moving the Blog-index</h3>
<p>Since Nikola assumes that the blog is your main-page you need to tell it to create the index in a sub-folder by setting the <code class="docutils literal">INDEX_PATH</code> to the name of the sub-folder. If, for example, the blog-posts are being put into <code class="docutils literal">posts</code>, the setting would be:</p>
<pre class="code python"><a id="rest_code_73c70a95a6ed42149a582129a1f3de5d-1" name="rest_code_73c70a95a6ed42149a582129a1f3de5d-1"></a><span class="n">INDEX_PATH</span> <span class="o">=</span> <span class="s2">"posts"</span>
</pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This was commented out by default so uncomment it and make the change.</p>
</div>
</div>
</div>
<div class="section" id="creating-the-home-page">
<h2>Creating the Home Page</h2>
<p>At this point if you build the site and navigate to it you'll find that your home-page is now a directory of your <code class="docutils literal">output</code> folder. You can navigate to a page by going through the folders, but this is probably not the intended way to get around. The easiest way (that I found) to create the home-page is to create a new-page (<code class="docutils literal">nikola new_page</code>) and when prompted for a title, call it <code class="docutils literal">index</code>. This will create <code class="docutils literal">pages/index.rst</code> which you can edit to become your home page (make sure to change the title if you don't want the page headline to be 'index').</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some other things might need to be re-done in the <code class="docutils literal">conf.py</code> as well, since the folder structure has changed. These are only the basic steps to switch. The <code class="docutils literal">NAVIGATION_LINKS</code> in particular may need updating.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201512some-emacs-notes-mostly-hide-show/">Some Emacs Notes (mostly hide-show)</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201512some-emacs-notes-mostly-hide-show/" rel="bookmark"><time class="published dt-published" datetime="2015-12-31T22:03:00-08:00" itemprop="datePublished" title="2015-12-31 22:03">2015-12-31 22:03</time></a></p>
</div>
</header>
<div class="p-summary entry-summary"><span style="font-family: inherit;">I spent most of yesterday troubleshooting someone else's code and I found these commands useful (among others - these are just the ones that I had to look up).</span><br>
<span style="font-family: inherit;"><br></span>
<h3><span style="font-family: inherit;">Occur</span></h3>
<span style="font-family: inherit;">One problem that I ran across was that there were around two dozen class definitions, all of which were similar so the bugs that were in one tended to be in all the other classes as well. I found that using the <span style='font-family: "Courier New",Courier,monospace;'>M-x occur</span> command was useful for looking at all instances of certain lines, so I could search for things that were common among all the class definitions (<span style='font-family: "Courier New",Courier,monospace;'>occur</span> is aliased by the <span style='font-family: "Courier New",Courier,monospace;'>list-matching-lines</span> command).</span><br>
<br>
<span style="font-family: inherit;">At one point, for instance, I thought that two class names looked the same, so I guessed that whoever wrote the code probably lost track of the classes that they had defined and duplicated (at least) one of them. To check I entered:</span><br>
<br>
<span style="font-family: inherit;"><span style='font-family: "Courier New",Courier,monospace;'>M-x occur class</span></span><br>
<br>
<span style="font-family: inherit;">Which brought up a list of lines that had the word 'class' in them and found that they had indeed duplicated that class definition. The argument 'class' is a regular expression so if there were other places where the word 'class' was used (e.g. in a nested class or a comment), you could add a start of line character:</span><br>
<br>
<span style="font-family: inherit;">&nbsp;<span style='font-family: "Courier New",Courier,monospace;'>M-x occur ^class</span></span><br>
<span style="font-family: inherit;">&nbsp;</span><br>
This would only bring up lines that started with the work 'class'.
<h3><span style="font-family: inherit;">Hide-show</span></h3>
This is an emacs mode that I keep rediscovering so I figured I should write it down. This mode enables code-folding (since I program in python this means hiding code that is indented.<br>
<br>
If, for example, you had these class definition:<br>
<br>
<pre class="brush: python" name="class-test"><br>class Test(object):<br>     def __init__(self, x):<br>         self.x = x<br><br>class TestTest(Test):<br>    def __init__(self, y, *args, **kwargs):<br>         super(TestTest, self).__init__(*args, **kwargs)<br>         self.y = y<br></pre>
<br>
After you folded it you would see:<br>
<br>
<pre class="brush: python" name="class-test-folded"><br>class Test(object): <br><br>class TestTest(Test):<br></pre>
<br>
<br>
<br>
To enable hide-show for the buffer you're in:<br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>M-x hs-minor-mode</span><br>
<br>
But in my case I want it to always be on when I'm editing a python file so I added this to my ~/.emacs.d/init.el file:<br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>(defun turn-on-hideshow () (hs-minor-mode 1))<br>
(add-hook 'python-mode-hook 'turn-on-hideshow)</span><br>
<br>
I don't know why but emacs doesn't seem to have a way to automatically associate minor-modes with file-extensions so the work-around is to first define a function that turns on the minor mode (called 'turn-on-hideshow' in this case) and then add it to the hook of the major-mode ('python-mode-hook' in this case). Once you have hideshow working, you have a few options available to you (see <a href="http://www.emacswiki.org/emacs/HideShow" target="_blank">the wiki</a>) but I only use three of them most of the time.<br>
<br>
The main trigger for 'hs-minor-mode' is <span style='font-family: "Courier New",Courier,monospace;'>C-c @</span> which you follow with the actual command. For instance, to hide (fold) everything that isn't flush-left:<br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-H</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>which translates to <span style='font-family: "Courier New",Courier,monospace;'>control-c, @, control-alt-shift-h</span> ('H' is for hide).</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>The opposite (show all the hidden text) is:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-S</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>The only other command that I use a lot (so far) is toggle block:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>What this does is&nbsp; toggle the block where your cursor is currently located. A block is the line that is flush left and all the lines that follow it that are indented. So, if you have multiple classes and functions defined, each one of them would be a block. If the block you're at isn't folded, then entering <span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span> will hide the indented lines and if they are already hidden then it will un-hide them.</span></span></span><br>
<h3><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Paragraph Navigation&nbsp;</span></span></span></h3>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>This is one of those things that you learn when you first go through the emacs tutorial, but somehow I always forget it - emacs will jump between paragraphs (it uses newlines so it doesn't work quite right for code, but works for expository text).&nbsp;</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>To jump to the previous paragraph:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>M-x {</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>To go to the next paragraph:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>M-x }</span><br>
<br>
<h3><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>&nbsp;How I Used It</span></span></span></h3>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>&nbsp;I don't want to share the code (since it wasn't mine) but in a nutshell what I faced was a file with a couple-dozen class definitions (this was a django-<a href="https://factoryboy.readthedocs.org/en/latest/" target="_blank">factory-boy</a> module so each model (database table) had two classes, a straight factory and a fuzzy version), so the first thing I did was fold all the classes to make it easier to get a high-level view:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-M-H</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then I noticed the duplicate class names so I listed all the classes that had that name:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>M-x occur class &lt;class name&gt;</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Occur gives you the line numbers so you can jump right to the line (although if the line is within a folded block you have to un-fold it first) so I created two windows:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>C-x 2</span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then I jumped to the starting line of the first definition&nbsp; in the first window (line 5 in this example) and un-hid it:</span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'>M-g-g 5</span><br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'><span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span></span></span></span><br>
<br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Then navigated to the other window and jumped to the starting line of&nbsp; the second definition (line 50 in this example) and un-hid it:</span></span></span><br>
<span style='font-family: "Courier New",Courier,monospace;'><br></span><span style='font-family: "Courier New",Courier,monospace;'>C-x o</span><br>
<span style='font-family: "Courier New",Courier,monospace;'>M-g-g 50</span><br>
<span style='font-family: "Courier New",Courier,monospace;'>C-c @ C-c</span><br>
<span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'><br></span></span></span><span style='font-family: "Courier New",Courier,monospace;'><span style='font-family: Times,"Times New Roman",serif;'><span style='font-family: Georgia, "Times New Roman", serif;'>Inspecting the definitions revealed that they had the same attributes but were assigned different values so I had no way of knowing which was the class definition to keep and the person who wrote them was on vacation so I decided not to fix it (I needed a different class in the module so this didn't directly affect me).</span></span></span></div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201503ubuntu-1410-and-brother-hl-2140/">Ubuntu 14.10 and the Brother HL-2140</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201503ubuntu-1410-and-brother-hl-2140/" rel="bookmark"><time class="published dt-published" datetime="2015-03-08T23:53:00-07:00" itemprop="datePublished" title="2015-03-08 23:53">2015-03-08 23:53</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>I have a <a href="http://www.brother-usa.com/Printer/ModelDetail/1/hl2140/Overview">Brother HL-2140 Laser Printer</a> which was working previously but for some reason gave me a CUPs error when I tried to print today (I think this was the first time I'd tried to print since upgrading to Ubuntu 14.10). I searched for the error on the web and found this <a href="http://ubuntuforums.org/showthread.php?t=1748457">forum post</a> that didn't address my problem directly but did address a problem I had when I set up my printer before (on Ubuntu 14.04, I'm using 14.10 now) where the printer would churn out blank pages instead of printing what I wanted so I decided to give it a try again. There are a few suggestions on the page but the two I tried both suggested using a different driver.<br>
<br>
The first suggestion I tried was to use the <i>HL-2170</i> instead of the <i>HL-2140.</i> This worked when I printed the first test page but after that it just silently failed no matter what I tried to install.<br>
<br>
The next suggestion I tried was to use the <i>Brother HL-2140 Foomatic/hpijs-pcl5e</i> driver. This didn't print any pages for me and gave a `Idle - filter failed` error in the printer properties dialogue box. I don't know what the message means, but since I fixed it without knowing, I guess I don't need to know.<br>
<br>
Sandwiched between the <i>HL-2170</i> and the <i>HL-2140</i> models in the list of available drivers was the <i>HL-2142</i> model. Since it seemed close enough to the 2140 (only off by two) I decided to try it and for whatever reason it worked. I'm pretty sure I used one of drivers the forum post suggested when I was using 14.04 (and the default <i>HL-2140*</i>driver before that) but something seems to have changed again.<br>
<br>
There's two lessons here:<br>
<br>
&nbsp; 1. Use the <i>HL-2142</i> driver for the <i>Brother HL-2140</i> printer on Ubuntu 14.10<br>
&nbsp; 2. Try drivers for similar models if you upgrade your Ubuntu installation and the printer stops working<br></p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201412using-pudb-with-behave-and-fish-what-is/">Using pudb with Behave and Fish</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201412using-pudb-with-behave-and-fish-what-is/" rel="bookmark"><time class="published dt-published" datetime="2014-12-31T06:43:00-08:00" itemprop="datePublished" title="2014-12-31 06:43">2014-12-31 06:43</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="document" id="using-pudb-with-behave-and-fish">
<h1>What is this about?</h1>
<div class="section" id="what-is-this-about"><a class="reference external" href="http://pythonhosted.org/behave/">behave</a> is a behavior-driven-development (BDD) tool for python that tests whether you have properly implemented the features you have defined in your <cite>features</cite> file(s). In their <a class="reference external" href="http://pythonhosted.org/behave/tutorial.html">tutorial</a> they tell you how you can set it up so that it will drop into <a class="reference external" href="http://ipython.org/ipython-doc/rel-0.10.2/html/api/generated/IPython.Debugger.html">ipdb</a> (ipython debugger) when a test fails, but I use <a class="reference external" href="https://github.com/inducer/pudb">pudb</a> and the <a class="reference external" href="http://fishshell.com/">fish</a> shell (not <cite>bash</cite>) so this documents what I had to do to get it to work.</div>
<div class="section" id="how-do-you-do-it-then">
<h1>How do you do it then?</h1>
The first thing to do is create a file named <cite>environment.py</cite> in the same folder as the <cite>features</cite> file. Inside of it put the following:<br>
<pre class="literal-block">from distutils.util import strtobool as _bool<br>import os<br><br>BEHAVE_DEBUG_ON_ERROR = _bool(os.environ.get("BEHAVE_DEBUG_ON_ERROR",<br>                                             "no"))<br>def after_step(context, step):<br>    if BEHAVE_DEBUG_ON_ERROR and step.status == 'failed':<br>        import pudb<br>        pudb.post_mortem(tb=step.exc_traceback,<br>                         e_type=None,<br>                         e_value=None)<br>    return<br></pre>
This is more-or-less exactly what was in the tutorial except I swapped out <cite>pudb</cite> for <cite>pdb</cite>. This code tells <cite>behave</cite> to run the <cite>pudb.post_mortem</cite> after a step is finished (a step corresponds to one of the functions you define to implement the tests) if the step failed and your shell has an environment variable named <cite>BEHAVE_DEBUG_ON_ERROR</cite> and it is set to something that <cite>strtobool</cite> recognizes as True. This is from the docstring documentation for <a class="reference external" href="https://docs.python.org/2/distutils/apiref.html#module-distutils.util">strtobool</a>:<br>
<blockquote>
<dl class="docutils">
<dt>distutils.util.strtobool(val)</dt>
<dd>
<div class="first">Convert a string representation of truth to true (1) or false (0).</div>
<ul class="last simple">
<li>True values are <cite>y</cite>, <cite>yes</cite>, <cite>t</cite>, <cite>true</cite>, <cite>on</cite> and <cite>1</cite></li>
<li>false values are <cite>n</cite>, <cite>no</cite>, <cite>f</cite>, <cite>false</cite>, <cite>off</cite> and <cite>0</cite></li>
<li>Raises <b>ValueError</b> if val is anything else.</li>
</ul>
</dd>
</dl>
</blockquote>
The 'no' in the <tt class="docutils literal">os.environ.get</tt> function means that it won't execute by default. To have it run you need to set the environment variable to one of the 'true' values. In fish this would be:<br>
<pre class="literal-block">set -x BEHAVE_DEBUG_ON_ERROR yes<br></pre>
Now when you run behave it will drop into pudb when a test fails.</div>
<div class="section" id="so-what-then">
<h1>So, what then?</h1>
Using this has so far been less useful than I thought it would be, since it tends to drop me into the <a class="reference external" href="https://pypi.python.org/pypi/PyHamcrest">pyhamcrest</a> call that failed and although I've managed to step through to the <cite>behave</cite> code I haven't managed to figure out how to get to my own code. It is still useful, though, since <cite>behave</cite> will not stop when it encounters a failed test so this makes it easier to figure out what has failed.<br>
Even though the <cite>pudb-behave</cite> combination is less exciting than I thought it would be, there were several things I learned that I want to document here for later.<br>
<div class="section" id="setting-an-environment-variable-in-fish">
<h2>Setting an environment variable in fish</h2>
To set a fish environment variable:<br>
<pre class="literal-block">set -x &lt;variable&gt; &lt;value&gt;<br></pre>
And then unset it:<br>
<pre class="literal-block">set -e &lt;variable&gt;<br></pre>
I've done this before to set my <tt class="docutils literal">PATH</tt> variable but for some reason when I tried to search for it this time I got some false-starts at first.</div>
<div class="section" id="python-s-string-to-boolean">
<h2>Python's String to Boolean</h2>
I also learned that python has a built in way to translate strings to booleans. This isn't really a hard thing to do on your own, but it was an interesting discovery. I don't think I would have looked in <cite>distutils</cite> for it.</div>
<div class="section" id="pudb-s-post-mortem-function">
<h2><cite>pudb's</cite> post_mortem function</h2>
Another interesting thing to find out was that <cite>pudb</cite> has a <cite>post_mortem</cite> function. I like <cite>pudb</cite> but it doesn't seem to be well documented. The <tt class="docutils literal">readme</tt> does say that it displays the same interface as python's <cite>pdb</cite> so I suppose I could just read their documentation, but it seems like one of those things where you have to know what you don't know to know to look for it. In this case I figured out how to call it by looking at the code (it's defined in <tt class="docutils literal">pudb.__init__.py</tt>).</div>
<div class="section" id="using-environment-variables-for-debugging">
<h2>Using environment variables for debugging</h2>
Probably the most interesting thing was the way they used <cite>os.environ</cite> to change the behavior of the code. I normally use command-line options to enable debugging but this might be a better pattern since it pulls it out of the user interface. This means that it won't be as obvious to the user, but I suppose if they're going to debug my code they had better read the documentation and not just rely on <tt class="docutils literal"><span class="pre">--help</span></tt> anyway. I think I'll probably get rid of in in the <cite>environment.py</cite> file, though, since I want it to run pretty much all the time, but it's an interesting idea anyway.</div>
</div>
<div class="section" id="conclusion">
<h1>Conclusion</h1>
This was a translation of how to set up a post-mortem debugger for behave using <cite>pudb</cite> instead of <cite>ipdb</cite> and <cite>fish</cite> instead of <cite>bash</cite>. It is primarily meant to be a record for me to look at in the future, since I don't set up my <cite>behave</cite> environment on a regular basis and tend to have a hard time re-searching for things (possibly because I use <a class="reference external" href="https://duckduckgo.com/">DuckDuckGo</a> so my search history isn't being used). I think the most valuable thing I got out of it was the pattern for setting up debuggers that I think I'll steal (use) for my own code.</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201411installing-python-package-for-single/">Installing a Python Package for a Single User</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201411installing-python-package-for-single/" rel="bookmark"><time class="published dt-published" datetime="2014-11-06T21:27:00-08:00" itemprop="datePublished" title="2014-11-06 21:27">2014-11-06 21:27</time></a></p>
</div>
</header>
<div class="p-summary entry-summary"><span style="font-family: Georgia, Times New Roman, serif;">Normally when installing a package that I'm working on I'm using a <i>virtualenv</i> so it's installed within that environment only, but I wanted to test part of my code that was using ssh to run a command that I didn't want to install system-wide. Creating a virtualenv for the test-user and activating it before running the command via ssh seemed excessive (and maybe not possible - I didn't try) but it turns out that you can install packages at the user-level using the 'setup.py' file.</span><br>
<span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Georgia, Times New Roman, serif;">In this case I wanted the setup.py to create a command-line command called 'rotate' and install it in the user's</span> <span style="font-family: Courier New, Courier, monospace;">~/bin</span> <span style="font-family: Georgia, Times New Roman, serif;">folder so I could run it something like this:</span><br>
<br>
<span style="font-family: Courier New, Courier, monospace;">ssh test@localhost rotate 90</span><br>
<br>
<span style="font-family: Georgia, Times New Roman, serif;">First I changed the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span> <span style="font-family: Georgia, Times New Roman, serif;">to add the bin folder to the</span> <span style="font-family: Courier New, Courier, monospace;">PATH</span><span style="font-family: Georgia, Times New Roman, serif;">:</span><br>
<span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Courier New, Courier, monospace;">PATH=$HOME/bin:$PATH</span><br>
<span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Georgia, Times New Roman, serif;">&nbsp;This has to be added to the top of the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span> <span style="font-family: Georgia, Times New Roman, serif;">file because the first thing there by default is a conditional that prevents it from using the things in the .</span><span style="font-family: Courier New, Courier, monospace;">bashrc</span> <span style="font-family: Georgia, Times New Roman, serif;">file:</span><br>
<span style="font-family: Georgia, Times New Roman, serif;"><br></span><span style="font-family: Courier New, Courier, monospace;"># If not running interactively, don't do anything</span><br>
<span style="font-family: Courier New, Courier, monospace;">case $- in</span><br>
<span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; *i*) ;;</span><br>
<span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; *) return;;</span><br>
<br>
<span style="font-family: Courier New, Courier, monospace;">esac</span><br>
<div><br></div>
<div>Next I changed into the directory where the package's setup.py file was and installed the package:</div>
<div><br></div>
<div><span style="font-family: Courier New, Courier, monospace;">python setup.py install --install-scripts=$HOME/bin --user</span></div>
<div><span style="font-family: Courier New, Courier, monospace;"><br></span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">The</span> <span style="font-family: Courier New, Courier, monospace;">--user</span> <span style="font-family: Georgia, Times New Roman, serif;">option is what tells python to install it for the local user instead of</span> <span style="font-family: Courier New, Courier, monospace;">/usr/local/bin</span> <span style="font-family: Georgia, Times New Roman, serif;">and the</span> <span style="font-family: Courier New, Courier, monospace;">--install-scripts</span> <span style="font-family: Georgia, Times New Roman, serif;">tells it where to put the commands it creates. Without the</span> <span style="font-family: Courier New, Courier, monospace;">--install-scripts</span><span style="font-family: Georgia, Times New Roman, serif;">&nbsp;option it will install it in</span> <span style="font-family: Courier New, Courier, monospace;">.local/bin</span> <span style="font-family: Georgia, Times New Roman, serif;">so another option would be to change the</span> <span style="font-family: Courier New, Courier, monospace;">PATH</span> <span style="font-family: Georgia, Times New Roman, serif;">variable instead:</span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;"><br></span></div>
<div><span style="font-family: 'Courier New', Courier, monospace;">PATH=$HOME/.local/bin:$PATH</span></div>
<div><span style="font-family: 'Courier New', Courier, monospace;"><br></span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">But I use</span> <span style="font-family: Courier New, Courier, monospace;">~/bin</span><span style="font-family: Georgia, Times New Roman, serif;">&nbsp;for other commands anyway so it seemed to make more sense to put it there.</span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;"><br></span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">OS :&nbsp;Ubuntu 14.04.1 LTS</span></div>
<div><span style="font-family: Georgia, Times New Roman, serif;">Python: 2.7.6</span></div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201310mocking-print/">Mocking Print</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201310mocking-print/" rel="bookmark"><time class="published dt-published" datetime="2013-10-05T22:48:00-07:00" itemprop="datePublished" title="2013-10-05 22:48">2013-10-05 22:48</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="document" id="mocking-print">
<div class="section" id="background">
<h4>Background</h4>
<p>I wanted to check to make sure I was sending the right output to the screen so I thought I would use <a class="reference external" href="https://pypi.python.org/pypi/mock">mock</a> to catch what I was sending to it. These are some notes about what happened.</p>
</div>
<div class="section" id="id1">
<h4>Mocking print</h4>
<p>If you try to <a class="reference external" href="http://www.voidspace.org.uk/python/mock/getting-started.html#patch-decorators">patch</a> <tt class="docutils literal">print</tt> with MagicMock, here is what you get.</p>
<pre class="literal-block"><br>from mock import MagicMock, patch, call<br><br>mock_print = MagicMock()<br>try:<br>    with patch('print', mock_print):<br>        print 'test'<br>except TypeError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Need a valid target to patch. You supplied: 'print'<br></pre>
<p>So it looks like 'print' is not the right thing to patch. Maybe you need to call it a built-in funtion:</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print 'test'<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>What if you call it as a function?</p>
<pre class="literal-block"><br>with patch('__builtin__.print', mock_print):<br>    print( 'test')<br><br>print mock_print.mock_calls<br></pre>
<pre class="literal-block"><br>test<br>[]<br></pre>
<p>So neither of those raise an error, but they also do not manage to mock <tt class="docutils literal">print</tt>. Well, if you look at the description for <a class="reference external" href="http://docs.python.org/2/library/functions.html#print">print</a>, it turns out that the print function has the signature:</p>
<pre class="literal-block"><br>print(*objects, sep=' ', end='\n', file=sys.stdout)<br></pre>
<p>It also says that the function call is not normally available unless you import it from the future.</p>
<p>But, presuming that the print statement works the same way as the function call, what happens if you mock <tt class="docutils literal">sys.stdout</tt>?</p>
</div>
<div class="section" id="mocking-sys-stdout">
<h4>Mocking sys.stdout</h4>
<p>This doesn't answer the question of why I can't mock print directly, but maybe mocking <tt class="docutils literal">sys.stdout</tt> will work instead.</p>
<pre class="literal-block"><br>with patch('sys.stdout', mock_print):<br>    print 'test'<br><br>expected = [call('test')]<br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre>
<pre class="literal-block"><br>Expected: [call('test')] Actual: [call.write('test'), call.write('\n')]<br></pre>
<p>It looks like the mock works this time, but it did not return what I was expecting -- <tt class="docutils literal">print</tt> makes two calls to <tt class="docutils literal">stdout.write</tt>, the first is the string you pass it which it then follows with a newline character. Given this slightly more complete understanding of <tt class="docutils literal">print</tt>:</p>
<pre class="literal-block"><br># create some output to send to print<br>lines = "a b c".split()<br><br># reset the mock so the previous calls are gone<br>mock_print.reset_mock()<br>with patch('sys.stdout', mock_print):<br>    for line in lines:<br>        print line<br><br>expected = []<br>for line in lines:<br>    expected.append(call.write(line))<br>    expected.append(call.write('\n'))<br><br>actual = mock_print.mock_calls<br><br>try:<br>    assert actual == expected, "Expected: {0} Actual: {1}".format(expected,<br>                                                                  actual)<br>except AssertionError as error:<br>    print error<br></pre></div>
<div class="section" id="conclusion">
<h4>Conclusion</h4>
<p>Not earth-shattering, but I thought it was interesting that even after using Python for years, something as basic as <tt class="docutils literal">print</tt> can yield something new if looked at more closely. It was also useful to see how mock can be used to discover the calls that are being made on an object, not just to test that expected calls are being made.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201310argparse-and-argument-parser/">argparse and the Argument Parser</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201310argparse-and-argument-parser/" rel="bookmark"><time class="published dt-published" datetime="2013-10-05T22:16:00-07:00" itemprop="datePublished" title="2013-10-05 22:16">2013-10-05 22:16</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<div class="document" id="argparse-and-the-argument-parser">
<p>Mocking the <a class="reference external" href="http://docs.python.org/2/library/argparse.html">argeparse ArgumentParser</a> might not seem like a necessary thing, since you can pass in a list of strings to fake the command-line arguments, but I ran into trouble trying to figure out how to test it embedded in one of my classes so I thought I would explore it anyway, out of curiosity if nothing else. I am primarily interested in mocking the calls to sys.argv to see how it works.</p>
<div class="section" id="sys-argv-calls">
<h4>sys.argv Calls</h4>
<p>Using the <a class="reference external" href="http://www.voidspace.org.uk/python/mock/examples.html#tracking-order-of-calls-and-less-verbose-call-assertions">mock_calls</a> list from <tt class="docutils literal">mock</tt> can be useful in figuring out how an object is being used.</p>
<pre class="literal-block"><br>parser = argparse.ArgumentParser()<br>parser.add_argument('--debug', action='store_true')<br>parser.add_argument('-d')<br><br>sys = MagicMock()<br>with patch('sys.argv', sys):<br>    args = parser.parse_args()<br>for item in sys.mock_calls:<br>    print item<br>print args<br></pre>
<pre class="literal-block"><br>call.__getitem__(slice(1, None, None))<br>call.__getitem__().__iter__()<br>call.__getitem__().__getitem__(slice(0, None, None))<br>call.__getitem__().__getitem__().__iter__()<br>call.__getitem__().__getitem__().__len__()<br>Namespace(d=None, debug=False)<br></pre></div>
<div class="section" id="the-getitem-and-slice">
<h4>The getitem and slice</h4>
<p>The first thing to note is the <a class="reference external" href="http://docs.python.org/2/reference/datamodel.html#object.__getitem__">__getitem__</a> calls. According to the documentation it is:</p>
<blockquote>Called to implement evaluation of self[key]. For sequence types, the accepted keys should be integers and slice objects.</blockquote>
<p>So it looks like it is first using the built-in <a class="reference external" href="http://docs.python.org/2/library/functions.html#slice">slice</a> function to get a particular argument. According to the documentation the arguments are the same as for the <tt class="docutils literal">range</tt> function (start, stop, step).</p>
<p>So it looks like it is doing the equivalent of <tt class="docutils literal">[1:]</tt> in the first slice:</p>
<pre class="literal-block"><br>test = [0,1,2]<br><br># what does it do?<br>print test.__getitem__(slice(1, None, None))<br><br># are they the same?<br>print test[1:] == test.__getitem__(slice(1, None, None))<br></pre>
<pre class="literal-block"><br>[1, 2]<br>True<br></pre>
<p>One thing to note is that <tt class="docutils literal">slice(1)</tt> is not the same thing as <tt class="docutils literal">slice(1, None, None)</tt>:</p>
<pre class="literal-block"><br>print slice(1)<br>print slice(1, None, None)<br></pre>
<pre class="literal-block"><br>slice(None, 1, None)<br>slice(1, None, None)<br></pre></div>
<div class="section" id="trying-a-lambda">
<h4>Trying a lambda</h4>
<p>So, if I give <tt class="docutils literal">__getitem__</tt> a function to return the arguments I want, will this work?</p>
<pre class="literal-block"><br>sys.__getitem__ = lambda x,y: ['--debug']<br>with patch('sys.argv', sys):<br>    args = parser.parse_args()<br>for item in sys.mock_calls:<br>    print item<br><br>print args<br></pre>
<pre class="literal-block"><br>call.__getitem__(slice(1, None, None))<br>call.__getitem__().__iter__()<br>call.__getitem__().__getitem__(slice(0, None, None))<br>call.__getitem__().__getitem__().__iter__()<br>call.__getitem__().__getitem__().__len__()<br>Namespace(d=None, debug=True)<br></pre>
<p>It looks like it does, but would it be better to just make <tt class="docutils literal">argv</tt> a list?</p>
</div>
<div class="section" id="argv-as-a-list">
<h4>argv as a list</h4>
<pre class="literal-block"><br>args = ['--debug']<br><br>def getitem(index):<br>    return args[index]<br><br># make a new mock since I set __getitem__ to a  lambda function<br>sys = MagicMock()<br>sys.__getitem__.side_effect = getitem<br><br>with patch('sys.argv', sys):<br>    parsed_args = parser.parse_args()<br><br>for item in sys.mock_calls:<br>    print item<br>print parsed_args<br></pre>
<pre class="literal-block"><br>call.__getitem__(slice(1, None, None))<br>Namespace(d=None, debug=False)<br></pre>
<p>It now does not make the other calls and it also does not set the <cite>debug</cite> to True, so it did not work.</p>
<p>But I seem to have forgotten my earlier slice check -- it is starting at the second item. I think that normally the name of the program is the first thing passed in so maybe there needs to be an extra (first) entry to simulate the command name.</p>
</div>
<div class="section" id="adding-a-command-name">
<h4>Adding a Command Name</h4>
<pre class="literal-block"><br>args = 'commandname --debug'.split()<br><br>def getitem(index):<br>    return args[index]<br><br>sys.__getitem__.side_effect = getitem<br><br>with patch('sys.argv', sys):<br>    parsed_args = parser.parse_args()<br><br>for item in sys.mock_calls:<br>    print item<br>print parsed_args<br></pre>
<pre class="literal-block"><br>call.__getitem__(slice(1, None, None))<br>call.__getitem__(slice(1, None, None))<br>Namespace(d=None, debug=True)<br></pre>
<p>It looks like it worked, and all but the first two calls went away, so it perhaps they were a result of me using the mock, not a normal part of the way <cite>parse_args</cite> works.</p>
</div>
<div class="section" id="the-whole-thing">
<h4>The Whole Thing</h4>
<p>Okay, but what about the option <tt class="docutils literal"><span class="pre">-d</span></tt>?</p>
<pre class="literal-block"><br>args = 'commandname -d cow --debug'.split()<br><br>def getitem(index):<br>    return args[index]<br><br>sys.__getitem__.side_effect = getitem<br><br>with patch('sys.argv', sys):<br>    try:<br>        parsed_args = parser.parse_args()<br>    except Exception as error:<br>        print error<br><br>for item in sys.mock_calls:<br>    print item<br>print parsed_args<br></pre>
<pre class="literal-block"><br>call.__getitem__(slice(1, None, None))<br>call.__getitem__(slice(1, None, None))<br>call.__getitem__(slice(1, None, None))<br>Namespace(d='cow', debug=True)<br></pre>
<p>Well, that was kind of painful. On the one hand, I got it to work, on the other hand, I do not really know what the slice is doing since it seems to slice the same items over and over. I think, looking at the first set of calls, after the initial slice it manipulates the sliced copy and since I am passing a real list instead of a mock, the calls are now hidden.</p>
</div>
<div class="section" id="looking-at-the-code">
<h4>Looking at the Code</h4>
<p>I downloaded the <a class="reference external" href="http://www.python.org/download/releases/2.7.5/">python 2.7 code</a> and looked in argparse.py and found this:</p>
<pre class="literal-block"><br>def parse_args(self, args=None, namespace=None):<br>    args, argv = self.parse_known_args(args, namespace)<br></pre>
<p>There is more to that function, but since it is calling <tt class="docutils literal">parse_known_args</tt> I jumped to it:</p>
<pre class="literal-block"><br>def parse_known_args(self, args=None, namespace=None):<br>    if args is None:<br>        # args default to the system args<br>        args = _sys.argv[1:]<br></pre>
<p>Once again there is more code after that, but this explains the slice that is seen in the calls.</p>
<p>Later on it calls:</p>
<pre class="literal-block"><br>namespace, args = self._parse_known_args(args, namespace)<br></pre>
<p>So jumping to <tt class="docutils literal">_parse_known_args</tt>:</p>
<pre class="literal-block"><br>arg_strings_iter = iter(arg_strings)<br>for i, arg_string in enumerate(arg_strings_iter):<br></pre>
<p>which I think explains the <cite>__iter__</cite> call in the first set of calls. I tried stepping through the code with <cite>pudb</cite> but could only find one slice, I am not sure what the other calls were for. I suppose it would have been smarter to look at the source code first, but this is about figuring out how to use mock so I think it was helpful to try it empirically first. No fair peeking in the back of the book until you have tried at least once.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/201309a-test-of-sphinx-cut-and-paste/">A Test Of Sphinx Cut and Paste</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author"><a href="authors/cloistered-monkey/">Cloistered Monkey</a></span></p>
<p class="dateline"><a href="posts/201309a-test-of-sphinx-cut-and-paste/" rel="bookmark"><time class="published dt-published" datetime="2013-09-08T19:04:00-07:00" itemprop="datePublished" title="2013-09-08 19:04">2013-09-08 19:04</time></a></p>
</div>
</header>
<div class="p-summary entry-summary">
<p>This is a test of dumping a cut-and-paste of body text from a sphinx-generated html page.<br>
This is a puzzle from [RTNS].<br></p>
<div class="section" id="the-puzzle">
<h2>The Puzzle<a class="headerlink" href="http://www.blogger.com/blogger.g?blogID=3828623117312978443#the-puzzle" title="Permalink to this headline">Â¶</a></h2>
A Spanish treasure fleet of three ships was sunk off the coast of Mexico:<br>
<blockquote>
<div>
<ul class="simple">
<li>One had a trunk of gold forward and a trunk of gold aft</li>
<li>One had a trunk of gold forward and a trunk of silver aft</li>
<li>One had a trunk of silver forward and a trunk of silver aft</li>
</ul>
</div>
</blockquote>
Divers just found one of the ships and a trunk of silver in it.<br>
<blockquote>
<div>
<ul class="simple">
<li>What is the probability that the other trunk has silver?</li>
</ul>
</div>
</blockquote>
</div>
<div class="section" id="a-reasoning">
<h2>A Reasoning<a class="headerlink" href="http://www.blogger.com/blogger.g?blogID=3828623117312978443#a-reasoning" title="Permalink to this headline">Â¶</a></h2>
The way to think of this is to not think of each category (silver vs gold) but to identify each trunk and how it is paired with another trunk. For example, we have six trunks:<br>
<blockquote>
<div><img alt="G_1, G_2, G_3, S_1, S_2, S_3" class="math" src="posts/_images/math/96b66c02ca526bffc7c662306b084d6f94a1e7ad.png"></div>
</blockquote>
In the three ships they were paired up:<br>
<blockquote>
<div>
<ul class="simple">
<li><img alt="Ship_1 = \{G_1, G_2\}" class="math" src="posts/_images/math/b171671c3dd6dd728e0e1181bba325faa93fa654.png"></li>
<li><img alt="Ship_2 = \{G_3, S_1\}" class="math" src="posts/_images/math/23358509024ea03188202e6b56acdb77c6e53b46.png"></li>
<li><img alt="Ship_3 = \{S_2, S_3\}" class="math" src="posts/_images/math/a35995757f7aeae4cfd5e1908d34dad9b3bf54d6.png"></li>
</ul>
</div>
</blockquote>
The trunk found had silver so the ship was either <img alt="Ship_2" class="math" src="posts/_images/math/215694a27d4af8de0643a4f32fdca8049454b156.png"> or <img alt="Ship_3" class="math" src="posts/_images/math/3da3ace83a8d796d08a565d76a440d973ef3e8e6.png"> and the trunk was one of <img alt="S_1, S_2, \textrm{or} S_3" class="math" src="posts/_images/math/ca3803bde832b07393dc044bf85c03b4882048af.png">. Call the trunk found <img alt="T_f" class="math" src="posts/_images/math/fa7542bd1fa73e6d35fe0ad5cf035eb914350818.png">.<br>
<blockquote>
<div>
<ul class="simple">
<li>Case 1: <img alt="T_f = S_1" class="math" src="posts/_images/math/82d9e1923f18b498d611616bd87fad5670136c14.png"> then the other trunk will be <img alt="G_3" class="math" src="posts/_images/math/5e592e7c572098aaa72922f31a260997722aab3f.png"></li>
<li>Case 2: <img alt="T_f = S_2" class="math" src="posts/_images/math/5d4808dd5a47bcd955147b498fd8128bc816d065.png"> then the other trunk will be <img alt="S_3" class="math" src="posts/_images/math/54147dbf4167d407147e92a3439b0d168c96bee8.png"></li>
<li>Case 3: <img alt="T_f = S_3" class="math" src="posts/_images/math/2390c3ca5bbb0473569703341b3754394360d383.png"> then the other trunk will be <img alt="S_2" class="math" src="posts/_images/math/7f4caea56d945d0b6e49701b42ce06e0fb92e663.png"></li>
</ul>
</div>
</blockquote>
In 2 out of 3 cases the trunk will be silver and in 1 out of 3 cases the trunk will be gold. So the probability that the next trunk pulled up (from the same ship) will be silver will be 2/3.</div>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="http://www.blogger.com/blogger.g?blogID=3828623117312978443#simulation" title="Permalink to this headline">Â¶</a></h2>
This is the method the book gives:<br>
<blockquote>
<div>
<ol class="arabic simple">
<li>Create three urns: {7,7}, {7,8}, and {8,8}</li>
<li>Choose an urn at random and a random element from the chosen urn</li>
<li>If the element chosen was an 8 (gold), do nothing, if it was a 7 continue</li>
<li>Record the other element in the chosen urn</li>
<li>Calculate the proportion of 7s recorded to 8s</li>
</ol>
</div>
</blockquote>
This seems confusing at first â€“ we know that the trunk found was silver so ship 1 was not the one found, why include it in the simulation? My guess is that we do not need the third urn since we discard all the cases where it is chosen and we are not using the number of trials to find the probabilities. I think the given method might be a clearer simulation if we were trying to recreate what happened in that it reflects the entire story, but it does not really reflect the puzzle at the point it takes up â€“ after the first trunk is found â€“ so adds unnecessary computation (well, I guess the whole random choice thing is probably doing that anyway).<br>
Try this:<br>
<blockquote>
<div>
<ol class="arabic simple">
<li>Create two urns: {0,1}, {1,1}</li>
<li>Pick a random urn and an element from it</li>
<li>If the element was a 0, go back a step</li>
<li>Record the remaining element in the urn</li>
<li>calculate the ratio of 1â€™s to 0â€™s</li>
</ol>
</div>
</blockquote>
This is confusing, he says find the odds, but 2/3 is probability. The odds of finding silver should be 2:1 (he also flip-flops between saying they found silver and gold in the first trunk, but that is another problem â€“ and the book was free, so what the heck).<br>
<br>
<div class="highlight-python">
<div class="highlight">
<pre><span class="n">GOLD</span> <span class="o">=</span> <span class="mi">0</span><br><span class="n">SILVER</span> <span class="o">=</span> <span class="mi">1</span><br><span class="n">ship_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">GOLD</span><span class="p">,</span> <span class="n">SILVER</span><span class="p">)</span><br><span class="n">ship_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">SILVER</span><span class="p">,</span> <span class="n">SILVER</span><span class="p">)</span><br><span class="n">fleet</span> <span class="o">=</span> <span class="p">(</span><span class="n">ship_2</span><span class="p">,</span> <span class="n">ship_3</span><span class="p">)</span><br><span class="n">trials</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><br><br><span class="c"># ships is a list of random ships from the fleet</span><br><span class="n">ships</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">fleet</span><span class="p">)</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">trials</span><span class="p">)]</span><br><br><span class="c"># found_trunks is a list of trunk-indices chosen for each ship (the trunk found by the diver)</span><br><span class="c"># although the values are the same as gold and silver (0 and 1)</span><br><span class="c"># in this case they are tuple indices for the trunk-tuples in the ships</span><br><span class="n">found_trunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">ship</span> <span class="ow">in</span> <span class="n">ships</span><span class="p">]</span><br><br><span class="c"># next_trunks is the type of trunk not chosen for found_trunks if found_trunks wasn't gold</span><br><span class="c"># because it's filtered, its length is the count of all cases where the first trunk was silver</span><br><span class="n">next_trunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ships</span><span class="p">[</span><span class="n">index</span><span class="p">][(</span><span class="n">found_trunks</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ships</span><span class="p">))</span><br><span class="k">if</span> <span class="n">ships</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">found_trunks</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="o">!=</span> <span class="n">GOLD</span><span class="p">]</span><br><br><span class="c"># silvers is a count of the next_trunks that were silver</span><br><span class="n">silvers</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">trunk</span> <span class="ow">in</span> <span class="n">next_trunks</span> <span class="k">if</span> <span class="n">trunk</span> <span class="o">==</span> <span class="n">SILVER</span><span class="p">)</span><br><br><span class="k">print</span> <span class="s">"Probability next trunk is silver: {0:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">silvers</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">next_trunks</span><span class="p">))</span><br><span class="k">print</span> <span class="s">"(Compare to 2/3 = {0:.2f})."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> </pre>
<pre> </pre></div>
</div>
Probability next trunk is silver: 0.67 (Compare to 2/3 = 0.67).</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-6.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-4.html" rel="next">Older posts</a></li>
</ul>
<!--End of body content-->
<footer id="footer">Contents Â© 2020 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
