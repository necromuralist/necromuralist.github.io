<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>The Cloistered Monkey (Posts about Git)</title><link>https://necromuralist.github.io/</link><description></description><atom:link href="https://necromuralist.github.io/categories/cat_git.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2023 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;Cloistered Monkey&lt;/a&gt; </copyright><lastBuildDate>Thu, 04 May 2023 00:33:52 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Pruning Large Files From Git with BFG</title><link>https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/</link><dc:creator>hades</dc:creator><description>&lt;p&gt;These are my notes on removing large files from a git repository with the &lt;a class="reference external" href="https://rtyley.github.io/bfg-repo-cleaner/"&gt;BFG Repo-Cleaner&lt;/a&gt;. It assumes that you have already pushed it to a remote repository. If you've committed the changes but haven't pushed them, see &lt;a class="reference external" href="https://necromuralist.github.io/posts/removing-large-files-from-git-using-bfg-and-a-local-repository/"&gt;this post&lt;/a&gt;.&lt;/p&gt;
&lt;section id="background"&gt;
&lt;h2&gt;1 Background&lt;/h2&gt;
&lt;p&gt;I accidentally committed an 89 MB file to git and pushed it upstream to github. This is within the allowed file-size limit, but when I looked in the file it was filled with the same error message over and over again, so it wasn't useful to keep, anyway. I was just working with small log-files, so any large files indicated an error, anyway, so I decided to clean anything over 50 MB from the repository using &lt;em&gt;BFG&lt;/em&gt;. The instructions on the home page mostly work, but didn't exactly work so I'm making some notes here for the next time.&lt;/p&gt;
&lt;/section&gt;
&lt;section id="the-process"&gt;
&lt;h2&gt;2 The Process&lt;/h2&gt;
&lt;p&gt;Assuming you've downloaded the BFG jar file, this is what you need to do.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code sh"&gt;&lt;a id="rest_code_cb0cdd0452aa4516b98ee39f83e390f5-1" name="rest_code_cb0cdd0452aa4516b98ee39f83e390f5-1" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_cb0cdd0452aa4516b98ee39f83e390f5-1"&gt;&lt;/a&gt;git&lt;span class="w"&gt; &lt;/span&gt;clone&lt;span class="w"&gt; &lt;/span&gt;--mirror&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;remote&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;address&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;--mirror&lt;/span&gt;&lt;/code&gt; flag creates a bare repository so it will look a little odd (the top level has the contents of what are normally in the &lt;code class="docutils literal"&gt;.git&lt;/code&gt; folder). When I first tried this I thought I could clone my local copy but when I ran BFG on the clone it said that it couldn't find any large files. As noted in &lt;a class="reference external" href="https://github.com/rtyley/bfg-repo-cleaner/issues/65"&gt;this bug-report&lt;/a&gt; the large files would be in the packfile if you clone it from a remote repository, but not necessarily in the local repository, so I had to clone it from github.&lt;/p&gt;
&lt;p&gt;Next run the BFG.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code sh"&gt;&lt;a id="rest_code_e724e609e066421d80fdf165a8e5ec45-1" name="rest_code_e724e609e066421d80fdf165a8e5ec45-1" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_e724e609e066421d80fdf165a8e5ec45-1"&gt;&lt;/a&gt;java&lt;span class="w"&gt; &lt;/span&gt;-jar&lt;span class="w"&gt; &lt;/span&gt;BFG-1.12.15.jar&lt;span class="w"&gt; &lt;/span&gt;--strip-blobs-bigger-than&lt;span class="w"&gt; &lt;/span&gt;50M&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;path&lt;span class="w"&gt; &lt;/span&gt;to&lt;span class="w"&gt; &lt;/span&gt;cloned&lt;span class="w"&gt; &lt;/span&gt;mirror&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now you have to change into the cloned repository and execute some commands to update it.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code sh"&gt;&lt;a id="rest_code_fc459c76b8f44c5da41b0e5ebd558267-1" name="rest_code_fc459c76b8f44c5da41b0e5ebd558267-1" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_fc459c76b8f44c5da41b0e5ebd558267-1"&gt;&lt;/a&gt;git&lt;span class="w"&gt; &lt;/span&gt;reflog&lt;span class="w"&gt; &lt;/span&gt;expire&lt;span class="w"&gt; &lt;/span&gt;--expire-now&lt;span class="w"&gt; &lt;/span&gt;--all
&lt;a id="rest_code_fc459c76b8f44c5da41b0e5ebd558267-2" name="rest_code_fc459c76b8f44c5da41b0e5ebd558267-2" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_fc459c76b8f44c5da41b0e5ebd558267-2"&gt;&lt;/a&gt;git&lt;span class="w"&gt; &lt;/span&gt;gc&lt;span class="w"&gt; &lt;/span&gt;--prune&lt;span class="o"&gt;=&lt;/span&gt;now&lt;span class="w"&gt; &lt;/span&gt;--aggressive
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now push it back to github.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code sh"&gt;&lt;a id="rest_code_bdb8ab48cb1c4ca1a06d10b528e8936e-1" name="rest_code_bdb8ab48cb1c4ca1a06d10b528e8936e-1" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_bdb8ab48cb1c4ca1a06d10b528e8936e-1"&gt;&lt;/a&gt;git&lt;span class="w"&gt; &lt;/span&gt;push
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point the original local copy of the repository will still have the large file(s) in the history so if you just do a git pull it will think you are ahead of the remote, so you have to remove your original local repository and re-clone the remote.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code sh"&gt;&lt;a id="rest_code_3c725d32d12744729c54572b631c7336-1" name="rest_code_3c725d32d12744729c54572b631c7336-1" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_3c725d32d12744729c54572b631c7336-1"&gt;&lt;/a&gt;rm&lt;span class="w"&gt; &lt;/span&gt;-r&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;original&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;local&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;repository&amp;gt;
&lt;a id="rest_code_3c725d32d12744729c54572b631c7336-2" name="rest_code_3c725d32d12744729c54572b631c7336-2" href="https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/#rest_code_3c725d32d12744729c54572b631c7336-2"&gt;&lt;/a&gt;git&lt;span class="w"&gt; &lt;/span&gt;clone&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;remote&lt;span class="w"&gt; &lt;/span&gt;repository&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One thing that tripped me up a little was that I had removed the &lt;em&gt;master&lt;/em&gt; branch but the &lt;em&gt;BFG&lt;/em&gt; re-added it, so it originally looked like I had lost some changes. Once I changed back into my working branch everything was as I had expected.&lt;/p&gt;
&lt;/section&gt;</description><category>bfg</category><category>git</category><category>how-to</category><guid>https://necromuralist.github.io/posts/pruning-large-files-from-git-with-bfg/</guid><pubDate>Sun, 14 Jan 2018 20:57:59 GMT</pubDate></item></channel></rss>